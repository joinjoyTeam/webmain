(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))y(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const S of I.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&y(S)}).observe(document,{childList:!0,subtree:!0});function h(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function y(b){if(b.ep)return;b.ep=!0;const I=h(b);fetch(b.href,I)}})();var rb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qv(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gv={exports:{}},np={},Hv={exports:{}},Pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kc=Symbol.for("react.element"),ib=Symbol.for("react.portal"),nb=Symbol.for("react.fragment"),sb=Symbol.for("react.strict_mode"),ab=Symbol.for("react.profiler"),ob=Symbol.for("react.provider"),lb=Symbol.for("react.context"),ub=Symbol.for("react.forward_ref"),cb=Symbol.for("react.suspense"),hb=Symbol.for("react.memo"),db=Symbol.for("react.lazy"),L_=Symbol.iterator;function pb(i){return i===null||typeof i!="object"?null:(i=L_&&i[L_]||i["@@iterator"],typeof i=="function"?i:null)}var Wv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xv=Object.assign,Kv={};function tu(i,a,h){this.props=i,this.context=a,this.refs=Kv,this.updater=h||Wv}tu.prototype.isReactComponent={};tu.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};tu.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Jv(){}Jv.prototype=tu.prototype;function rg(i,a,h){this.props=i,this.context=a,this.refs=Kv,this.updater=h||Wv}var ig=rg.prototype=new Jv;ig.constructor=rg;Xv(ig,tu.prototype);ig.isPureReactComponent=!0;var R_=Array.isArray,Yv=Object.prototype.hasOwnProperty,ng={current:null},Qv={key:!0,ref:!0,__self:!0,__source:!0};function ex(i,a,h){var y,b={},I=null,S=null;if(a!=null)for(y in a.ref!==void 0&&(S=a.ref),a.key!==void 0&&(I=""+a.key),a)Yv.call(a,y)&&!Qv.hasOwnProperty(y)&&(b[y]=a[y]);var d=arguments.length-2;if(d===1)b.children=h;else if(1<d){for(var $=Array(d),ue=0;ue<d;ue++)$[ue]=arguments[ue+2];b.children=$}if(i&&i.defaultProps)for(y in d=i.defaultProps,d)b[y]===void 0&&(b[y]=d[y]);return{$$typeof:Kc,type:i,key:I,ref:S,props:b,_owner:ng.current}}function fb(i,a){return{$$typeof:Kc,type:i.type,key:a,ref:i.ref,props:i.props,_owner:i._owner}}function sg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Kc}function mb(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return a[h]})}var F_=/\/+/g;function Ff(i,a){return typeof i=="object"&&i!==null&&i.key!=null?mb(""+i.key):a.toString(36)}function xd(i,a,h,y,b){var I=typeof i;(I==="undefined"||I==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(I){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Kc:case ib:S=!0}}if(S)return S=i,b=b(S),i=y===""?"."+Ff(S,0):y,R_(b)?(h="",i!=null&&(h=i.replace(F_,"$&/")+"/"),xd(b,a,h,"",function(ue){return ue})):b!=null&&(sg(b)&&(b=fb(b,h+(!b.key||S&&S.key===b.key?"":(""+b.key).replace(F_,"$&/")+"/")+i)),a.push(b)),1;if(S=0,y=y===""?".":y+":",R_(i))for(var d=0;d<i.length;d++){I=i[d];var $=y+Ff(I,d);S+=xd(I,a,h,$,b)}else if($=pb(i),typeof $=="function")for(i=$.call(i),d=0;!(I=i.next()).done;)I=I.value,$=y+Ff(I,d++),S+=xd(I,a,h,$,b);else if(I==="object")throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return S}function id(i,a,h){if(i==null)return i;var y=[],b=0;return xd(i,y,"","",function(I){return a.call(h,I,b++)}),y}function gb(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var Ti={current:null},wd={transition:null},yb={ReactCurrentDispatcher:Ti,ReactCurrentBatchConfig:wd,ReactCurrentOwner:ng};function tx(){throw Error("act(...) is not supported in production builds of React.")}Pt.Children={map:id,forEach:function(i,a,h){id(i,function(){a.apply(this,arguments)},h)},count:function(i){var a=0;return id(i,function(){a++}),a},toArray:function(i){return id(i,function(a){return a})||[]},only:function(i){if(!sg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Pt.Component=tu;Pt.Fragment=nb;Pt.Profiler=ab;Pt.PureComponent=rg;Pt.StrictMode=sb;Pt.Suspense=cb;Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yb;Pt.act=tx;Pt.cloneElement=function(i,a,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var y=Xv({},i.props),b=i.key,I=i.ref,S=i._owner;if(a!=null){if(a.ref!==void 0&&(I=a.ref,S=ng.current),a.key!==void 0&&(b=""+a.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for($ in a)Yv.call(a,$)&&!Qv.hasOwnProperty($)&&(y[$]=a[$]===void 0&&d!==void 0?d[$]:a[$])}var $=arguments.length-2;if($===1)y.children=h;else if(1<$){d=Array($);for(var ue=0;ue<$;ue++)d[ue]=arguments[ue+2];y.children=d}return{$$typeof:Kc,type:i.type,key:b,ref:I,props:y,_owner:S}};Pt.createContext=function(i){return i={$$typeof:lb,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:ob,_context:i},i.Consumer=i};Pt.createElement=ex;Pt.createFactory=function(i){var a=ex.bind(null,i);return a.type=i,a};Pt.createRef=function(){return{current:null}};Pt.forwardRef=function(i){return{$$typeof:ub,render:i}};Pt.isValidElement=sg;Pt.lazy=function(i){return{$$typeof:db,_payload:{_status:-1,_result:i},_init:gb}};Pt.memo=function(i,a){return{$$typeof:hb,type:i,compare:a===void 0?null:a}};Pt.startTransition=function(i){var a=wd.transition;wd.transition={};try{i()}finally{wd.transition=a}};Pt.unstable_act=tx;Pt.useCallback=function(i,a){return Ti.current.useCallback(i,a)};Pt.useContext=function(i){return Ti.current.useContext(i)};Pt.useDebugValue=function(){};Pt.useDeferredValue=function(i){return Ti.current.useDeferredValue(i)};Pt.useEffect=function(i,a){return Ti.current.useEffect(i,a)};Pt.useId=function(){return Ti.current.useId()};Pt.useImperativeHandle=function(i,a,h){return Ti.current.useImperativeHandle(i,a,h)};Pt.useInsertionEffect=function(i,a){return Ti.current.useInsertionEffect(i,a)};Pt.useLayoutEffect=function(i,a){return Ti.current.useLayoutEffect(i,a)};Pt.useMemo=function(i,a){return Ti.current.useMemo(i,a)};Pt.useReducer=function(i,a,h){return Ti.current.useReducer(i,a,h)};Pt.useRef=function(i){return Ti.current.useRef(i)};Pt.useState=function(i){return Ti.current.useState(i)};Pt.useSyncExternalStore=function(i,a,h){return Ti.current.useSyncExternalStore(i,a,h)};Pt.useTransition=function(){return Ti.current.useTransition()};Pt.version="18.3.1";Hv.exports=Pt;var ir=Hv.exports;const Ta=qv(ir);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _b=ir,vb=Symbol.for("react.element"),xb=Symbol.for("react.fragment"),wb=Object.prototype.hasOwnProperty,bb=_b.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Sb={key:!0,ref:!0,__self:!0,__source:!0};function rx(i,a,h){var y,b={},I=null,S=null;h!==void 0&&(I=""+h),a.key!==void 0&&(I=""+a.key),a.ref!==void 0&&(S=a.ref);for(y in a)wb.call(a,y)&&!Sb.hasOwnProperty(y)&&(b[y]=a[y]);if(i&&i.defaultProps)for(y in a=i.defaultProps,a)b[y]===void 0&&(b[y]=a[y]);return{$$typeof:vb,type:i,key:I,ref:S,props:b,_owner:bb.current}}np.Fragment=xb;np.jsx=rx;np.jsxs=rx;Gv.exports=np;var K=Gv.exports,um={},ix={exports:{}},ln={},nx={exports:{}},sx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(We,ct){var ht=We.length;We.push(ct);e:for(;0<ht;){var kt=ht-1>>>1,Ft=We[kt];if(0<b(Ft,ct))We[kt]=ct,We[ht]=Ft,ht=kt;else break e}}function h(We){return We.length===0?null:We[0]}function y(We){if(We.length===0)return null;var ct=We[0],ht=We.pop();if(ht!==ct){We[0]=ht;e:for(var kt=0,Ft=We.length,Ui=Ft>>>1;kt<Ui;){var Dr=2*(kt+1)-1,ei=We[Dr],ti=Dr+1,br=We[ti];if(0>b(ei,ht))ti<Ft&&0>b(br,ei)?(We[kt]=br,We[ti]=ht,kt=ti):(We[kt]=ei,We[Dr]=ht,kt=Dr);else if(ti<Ft&&0>b(br,ht))We[kt]=br,We[ti]=ht,kt=ti;else break e}}return ct}function b(We,ct){var ht=We.sortIndex-ct.sortIndex;return ht!==0?ht:We.id-ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;i.unstable_now=function(){return I.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var $=[],ue=[],xe=1,ae=null,U=3,ze=!1,Be=!1,Pe=!1,Tt=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(We){for(var ct=h(ue);ct!==null;){if(ct.callback===null)y(ue);else if(ct.startTime<=We)y(ue),ct.sortIndex=ct.expirationTime,a($,ct);else break;ct=h(ue)}}function ke(We){if(Pe=!1,le(We),!Be)if(h($)!==null)Be=!0,hn(Oe);else{var ct=h(ue);ct!==null&&Qr(ke,ct.startTime-We)}}function Oe(We,ct){Be=!1,Pe&&(Pe=!1,re(it),it=-1),ze=!0;var ht=U;try{for(le(ct),ae=h($);ae!==null&&(!(ae.expirationTime>ct)||We&&!_t());){var kt=ae.callback;if(typeof kt=="function"){ae.callback=null,U=ae.priorityLevel;var Ft=kt(ae.expirationTime<=ct);ct=i.unstable_now(),typeof Ft=="function"?ae.callback=Ft:ae===h($)&&y($),le(ct)}else y($);ae=h($)}if(ae!==null)var Ui=!0;else{var Dr=h(ue);Dr!==null&&Qr(ke,Dr.startTime-ct),Ui=!1}return Ui}finally{ae=null,U=ht,ze=!1}}var qe=!1,He=null,it=-1,Dt=5,yt=-1;function _t(){return!(i.unstable_now()-yt<Dt)}function cn(){if(He!==null){var We=i.unstable_now();yt=We;var ct=!0;try{ct=He(!0,We)}finally{ct?sr():(qe=!1,He=null)}}else qe=!1}var sr;if(typeof Q=="function")sr=function(){Q(cn)};else if(typeof MessageChannel<"u"){var wr=new MessageChannel,Vi=wr.port2;wr.port1.onmessage=cn,sr=function(){Vi.postMessage(null)}}else sr=function(){Tt(cn,0)};function hn(We){He=We,qe||(qe=!0,sr())}function Qr(We,ct){it=Tt(function(){We(i.unstable_now())},ct)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(We){We.callback=null},i.unstable_continueExecution=function(){Be||ze||(Be=!0,hn(Oe))},i.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Dt=0<We?Math.floor(1e3/We):5},i.unstable_getCurrentPriorityLevel=function(){return U},i.unstable_getFirstCallbackNode=function(){return h($)},i.unstable_next=function(We){switch(U){case 1:case 2:case 3:var ct=3;break;default:ct=U}var ht=U;U=ct;try{return We()}finally{U=ht}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(We,ct){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var ht=U;U=We;try{return ct()}finally{U=ht}},i.unstable_scheduleCallback=function(We,ct,ht){var kt=i.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?kt+ht:kt):ht=kt,We){case 1:var Ft=-1;break;case 2:Ft=250;break;case 5:Ft=1073741823;break;case 4:Ft=1e4;break;default:Ft=5e3}return Ft=ht+Ft,We={id:xe++,callback:ct,priorityLevel:We,startTime:ht,expirationTime:Ft,sortIndex:-1},ht>kt?(We.sortIndex=ht,a(ue,We),h($)===null&&We===h(ue)&&(Pe?(re(it),it=-1):Pe=!0,Qr(ke,ht-kt))):(We.sortIndex=Ft,a($,We),Be||ze||(Be=!0,hn(Oe))),We},i.unstable_shouldYield=_t,i.unstable_wrapCallback=function(We){var ct=U;return function(){var ht=U;U=ct;try{return We.apply(this,arguments)}finally{U=ht}}}})(sx);nx.exports=sx;var kb=nx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tb=ir,on=kb;function Ce(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)a+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ax=new Set,Dc={};function Ao(i,a){Hl(i,a),Hl(i+"Capture",a)}function Hl(i,a){for(Dc[i]=a,i=0;i<a.length;i++)ax.add(a[i])}var zs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cm=Object.prototype.hasOwnProperty,Ib=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B_={},O_={};function Cb(i){return cm.call(O_,i)?!0:cm.call(B_,i)?!1:Ib.test(i)?O_[i]=!0:(B_[i]=!0,!1)}function Pb(i,a,h,y){if(h!==null&&h.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return y?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Eb(i,a,h,y){if(a===null||typeof a>"u"||Pb(i,a,h,y))return!0;if(y)return!1;if(h!==null)switch(h.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Ii(i,a,h,y,b,I,S){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=y,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=i,this.type=a,this.sanitizeURL=I,this.removeEmptyString=S}var Yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Yr[i]=new Ii(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];Yr[a]=new Ii(a,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Yr[i]=new Ii(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Yr[i]=new Ii(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Yr[i]=new Ii(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Yr[i]=new Ii(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Yr[i]=new Ii(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Yr[i]=new Ii(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Yr[i]=new Ii(i,5,!1,i.toLowerCase(),null,!1,!1)});var ag=/[\-:]([a-z])/g;function og(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(ag,og);Yr[a]=new Ii(a,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(ag,og);Yr[a]=new Ii(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(ag,og);Yr[a]=new Ii(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Yr[i]=new Ii(i,1,!1,i.toLowerCase(),null,!1,!1)});Yr.xlinkHref=new Ii("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Yr[i]=new Ii(i,1,!1,i.toLowerCase(),null,!0,!0)});function lg(i,a,h,y){var b=Yr.hasOwnProperty(a)?Yr[a]:null;(b!==null?b.type!==0:y||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Eb(a,h,b,y)&&(h=null),y||b===null?Cb(a)&&(h===null?i.removeAttribute(a):i.setAttribute(a,""+h)):b.mustUseProperty?i[b.propertyName]=h===null?b.type===3?!1:"":h:(a=b.attributeName,y=b.attributeNamespace,h===null?i.removeAttribute(a):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,y?i.setAttributeNS(y,a,h):i.setAttribute(a,h))))}var Fs=Tb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nd=Symbol.for("react.element"),El=Symbol.for("react.portal"),Al=Symbol.for("react.fragment"),ug=Symbol.for("react.strict_mode"),hm=Symbol.for("react.profiler"),ox=Symbol.for("react.provider"),lx=Symbol.for("react.context"),cg=Symbol.for("react.forward_ref"),dm=Symbol.for("react.suspense"),pm=Symbol.for("react.suspense_list"),hg=Symbol.for("react.memo"),va=Symbol.for("react.lazy"),ux=Symbol.for("react.offscreen"),N_=Symbol.iterator;function dc(i){return i===null||typeof i!="object"?null:(i=N_&&i[N_]||i["@@iterator"],typeof i=="function"?i:null)}var fr=Object.assign,Bf;function xc(i){if(Bf===void 0)try{throw Error()}catch(h){var a=h.stack.trim().match(/\n( *(at )?)/);Bf=a&&a[1]||""}return`
`+Bf+i}var Of=!1;function Nf(i,a){if(!i||Of)return"";Of=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(ue){var y=ue}Reflect.construct(i,[],a)}else{try{a.call()}catch(ue){y=ue}i.call(a.prototype)}else{try{throw Error()}catch(ue){y=ue}i()}}catch(ue){if(ue&&y&&typeof ue.stack=="string"){for(var b=ue.stack.split(`
`),I=y.stack.split(`
`),S=b.length-1,d=I.length-1;1<=S&&0<=d&&b[S]!==I[d];)d--;for(;1<=S&&0<=d;S--,d--)if(b[S]!==I[d]){if(S!==1||d!==1)do if(S--,d--,0>d||b[S]!==I[d]){var $=`
`+b[S].replace(" at new "," at ");return i.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",i.displayName)),$}while(1<=S&&0<=d);break}}}finally{Of=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?xc(i):""}function Ab(i){switch(i.tag){case 5:return xc(i.type);case 16:return xc("Lazy");case 13:return xc("Suspense");case 19:return xc("SuspenseList");case 0:case 2:case 15:return i=Nf(i.type,!1),i;case 11:return i=Nf(i.type.render,!1),i;case 1:return i=Nf(i.type,!0),i;default:return""}}function fm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Al:return"Fragment";case El:return"Portal";case hm:return"Profiler";case ug:return"StrictMode";case dm:return"Suspense";case pm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case lx:return(i.displayName||"Context")+".Consumer";case ox:return(i._context.displayName||"Context")+".Provider";case cg:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case hg:return a=i.displayName||null,a!==null?a:fm(i.type)||"Memo";case va:a=i._payload,i=i._init;try{return fm(i(a))}catch{}}return null}function Mb(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fm(a);case 8:return a===ug?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function La(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function cx(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function zb(i){var a=cx(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),y=""+i[a];if(!i.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,I=h.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return b.call(this)},set:function(S){y=""+S,I.call(this,S)}}),Object.defineProperty(i,a,{enumerable:h.enumerable}),{getValue:function(){return y},setValue:function(S){y=""+S},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function sd(i){i._valueTracker||(i._valueTracker=zb(i))}function hx(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var h=a.getValue(),y="";return i&&(y=cx(i)?i.checked?"true":"false":i.value),i=y,i!==h?(a.setValue(i),!0):!1}function zd(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function mm(i,a){var h=a.checked;return fr({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function j_(i,a){var h=a.defaultValue==null?"":a.defaultValue,y=a.checked!=null?a.checked:a.defaultChecked;h=La(a.value!=null?a.value:h),i._wrapperState={initialChecked:y,initialValue:h,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function dx(i,a){a=a.checked,a!=null&&lg(i,"checked",a,!1)}function gm(i,a){dx(i,a);var h=La(a.value),y=a.type;if(h!=null)y==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(y==="submit"||y==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?ym(i,a.type,h):a.hasOwnProperty("defaultValue")&&ym(i,a.type,La(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function V_(i,a,h){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var y=a.type;if(!(y!=="submit"&&y!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,h||a===i.value||(i.value=a),i.defaultValue=a}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function ym(i,a,h){(a!=="number"||zd(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var wc=Array.isArray;function Vl(i,a,h,y){if(i=i.options,a){a={};for(var b=0;b<h.length;b++)a["$"+h[b]]=!0;for(h=0;h<i.length;h++)b=a.hasOwnProperty("$"+i[h].value),i[h].selected!==b&&(i[h].selected=b),b&&y&&(i[h].defaultSelected=!0)}else{for(h=""+La(h),a=null,b=0;b<i.length;b++){if(i[b].value===h){i[b].selected=!0,y&&(i[b].defaultSelected=!0);return}a!==null||i[b].disabled||(a=i[b])}a!==null&&(a.selected=!0)}}function _m(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return fr({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function U_(i,a){var h=a.value;if(h==null){if(h=a.children,a=a.defaultValue,h!=null){if(a!=null)throw Error(Ce(92));if(wc(h)){if(1<h.length)throw Error(Ce(93));h=h[0]}a=h}a==null&&(a=""),h=a}i._wrapperState={initialValue:La(h)}}function px(i,a){var h=La(a.value),y=La(a.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),a.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),y!=null&&(i.defaultValue=""+y)}function $_(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function fx(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vm(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?fx(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var ad,mx=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,h,y,b){MSApp.execUnsafeLocalFunction(function(){return i(a,h,y,b)})}:i}(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(ad=ad||document.createElement("div"),ad.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=ad.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function Lc(i,a){if(a){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=a;return}}i.textContent=a}var kc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Db=["Webkit","ms","Moz","O"];Object.keys(kc).forEach(function(i){Db.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),kc[a]=kc[i]})});function gx(i,a,h){return a==null||typeof a=="boolean"||a===""?"":h||typeof a!="number"||a===0||kc.hasOwnProperty(i)&&kc[i]?(""+a).trim():a+"px"}function yx(i,a){i=i.style;for(var h in a)if(a.hasOwnProperty(h)){var y=h.indexOf("--")===0,b=gx(h,a[h],y);h==="float"&&(h="cssFloat"),y?i.setProperty(h,b):i[h]=b}}var Lb=fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xm(i,a){if(a){if(Lb[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(Ce(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(Ce(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(Ce(61))}if(a.style!=null&&typeof a.style!="object")throw Error(Ce(62))}}function wm(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bm=null;function dg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Sm=null,Ul=null,$l=null;function Z_(i){if(i=Qc(i)){if(typeof Sm!="function")throw Error(Ce(280));var a=i.stateNode;a&&(a=up(a),Sm(i.stateNode,i.type,a))}}function _x(i){Ul?$l?$l.push(i):$l=[i]:Ul=i}function vx(){if(Ul){var i=Ul,a=$l;if($l=Ul=null,Z_(i),a)for(i=0;i<a.length;i++)Z_(a[i])}}function xx(i,a){return i(a)}function wx(){}var jf=!1;function bx(i,a,h){if(jf)return i(a,h);jf=!0;try{return xx(i,a,h)}finally{jf=!1,(Ul!==null||$l!==null)&&(wx(),vx())}}function Rc(i,a){var h=i.stateNode;if(h===null)return null;var y=up(h);if(y===null)return null;h=y[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(i=i.type,y=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!y;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Ce(231,a,typeof h));return h}var km=!1;if(zs)try{var pc={};Object.defineProperty(pc,"passive",{get:function(){km=!0}}),window.addEventListener("test",pc,pc),window.removeEventListener("test",pc,pc)}catch{km=!1}function Rb(i,a,h,y,b,I,S,d,$){var ue=Array.prototype.slice.call(arguments,3);try{a.apply(h,ue)}catch(xe){this.onError(xe)}}var Tc=!1,Dd=null,Ld=!1,Tm=null,Fb={onError:function(i){Tc=!0,Dd=i}};function Bb(i,a,h,y,b,I,S,d,$){Tc=!1,Dd=null,Rb.apply(Fb,arguments)}function Ob(i,a,h,y,b,I,S,d,$){if(Bb.apply(this,arguments),Tc){if(Tc){var ue=Dd;Tc=!1,Dd=null}else throw Error(Ce(198));Ld||(Ld=!0,Tm=ue)}}function Mo(i){var a=i,h=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(h=a.return),i=a.return;while(i)}return a.tag===3?h:null}function Sx(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function q_(i){if(Mo(i)!==i)throw Error(Ce(188))}function Nb(i){var a=i.alternate;if(!a){if(a=Mo(i),a===null)throw Error(Ce(188));return a!==i?null:i}for(var h=i,y=a;;){var b=h.return;if(b===null)break;var I=b.alternate;if(I===null){if(y=b.return,y!==null){h=y;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===h)return q_(b),i;if(I===y)return q_(b),a;I=I.sibling}throw Error(Ce(188))}if(h.return!==y.return)h=b,y=I;else{for(var S=!1,d=b.child;d;){if(d===h){S=!0,h=b,y=I;break}if(d===y){S=!0,y=b,h=I;break}d=d.sibling}if(!S){for(d=I.child;d;){if(d===h){S=!0,h=I,y=b;break}if(d===y){S=!0,y=I,h=b;break}d=d.sibling}if(!S)throw Error(Ce(189))}}if(h.alternate!==y)throw Error(Ce(190))}if(h.tag!==3)throw Error(Ce(188));return h.stateNode.current===h?i:a}function kx(i){return i=Nb(i),i!==null?Tx(i):null}function Tx(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=Tx(i);if(a!==null)return a;i=i.sibling}return null}var Ix=on.unstable_scheduleCallback,G_=on.unstable_cancelCallback,jb=on.unstable_shouldYield,Vb=on.unstable_requestPaint,xr=on.unstable_now,Ub=on.unstable_getCurrentPriorityLevel,pg=on.unstable_ImmediatePriority,Cx=on.unstable_UserBlockingPriority,Rd=on.unstable_NormalPriority,$b=on.unstable_LowPriority,Px=on.unstable_IdlePriority,sp=null,ss=null;function Zb(i){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(sp,i,void 0,(i.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:Hb,qb=Math.log,Gb=Math.LN2;function Hb(i){return i>>>=0,i===0?32:31-(qb(i)/Gb|0)|0}var od=64,ld=4194304;function bc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Fd(i,a){var h=i.pendingLanes;if(h===0)return 0;var y=0,b=i.suspendedLanes,I=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~b;d!==0?y=bc(d):(I&=S,I!==0&&(y=bc(I)))}else S=h&~b,S!==0?y=bc(S):I!==0&&(y=bc(I));if(y===0)return 0;if(a!==0&&a!==y&&!(a&b)&&(b=y&-y,I=a&-a,b>=I||b===16&&(I&4194240)!==0))return a;if(y&4&&(y|=h&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=y;0<a;)h=31-jn(a),b=1<<h,y|=i[h],a&=~b;return y}function Wb(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xb(i,a){for(var h=i.suspendedLanes,y=i.pingedLanes,b=i.expirationTimes,I=i.pendingLanes;0<I;){var S=31-jn(I),d=1<<S,$=b[S];$===-1?(!(d&h)||d&y)&&(b[S]=Wb(d,a)):$<=a&&(i.expiredLanes|=d),I&=~d}}function Im(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Ex(){var i=od;return od<<=1,!(od&4194240)&&(od=64),i}function Vf(i){for(var a=[],h=0;31>h;h++)a.push(i);return a}function Jc(i,a,h){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-jn(a),i[a]=h}function Kb(i,a){var h=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var y=i.eventTimes;for(i=i.expirationTimes;0<h;){var b=31-jn(h),I=1<<b;a[b]=0,y[b]=-1,i[b]=-1,h&=~I}}function fg(i,a){var h=i.entangledLanes|=a;for(i=i.entanglements;h;){var y=31-jn(h),b=1<<y;b&a|i[y]&a&&(i[y]|=a),h&=~b}}var qt=0;function Ax(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Mx,mg,zx,Dx,Lx,Cm=!1,ud=[],Ia=null,Ca=null,Pa=null,Fc=new Map,Bc=new Map,wa=[],Jb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function H_(i,a){switch(i){case"focusin":case"focusout":Ia=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Pa=null;break;case"pointerover":case"pointerout":Fc.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bc.delete(a.pointerId)}}function fc(i,a,h,y,b,I){return i===null||i.nativeEvent!==I?(i={blockedOn:a,domEventName:h,eventSystemFlags:y,nativeEvent:I,targetContainers:[b]},a!==null&&(a=Qc(a),a!==null&&mg(a)),i):(i.eventSystemFlags|=y,a=i.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),i)}function Yb(i,a,h,y,b){switch(a){case"focusin":return Ia=fc(Ia,i,a,h,y,b),!0;case"dragenter":return Ca=fc(Ca,i,a,h,y,b),!0;case"mouseover":return Pa=fc(Pa,i,a,h,y,b),!0;case"pointerover":var I=b.pointerId;return Fc.set(I,fc(Fc.get(I)||null,i,a,h,y,b)),!0;case"gotpointercapture":return I=b.pointerId,Bc.set(I,fc(Bc.get(I)||null,i,a,h,y,b)),!0}return!1}function Rx(i){var a=xo(i.target);if(a!==null){var h=Mo(a);if(h!==null){if(a=h.tag,a===13){if(a=Sx(h),a!==null){i.blockedOn=a,Lx(i.priority,function(){zx(h)});return}}else if(a===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function bd(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var h=Pm(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var y=new h.constructor(h.type,h);bm=y,h.target.dispatchEvent(y),bm=null}else return a=Qc(h),a!==null&&mg(a),i.blockedOn=h,!1;a.shift()}return!0}function W_(i,a,h){bd(i)&&h.delete(a)}function Qb(){Cm=!1,Ia!==null&&bd(Ia)&&(Ia=null),Ca!==null&&bd(Ca)&&(Ca=null),Pa!==null&&bd(Pa)&&(Pa=null),Fc.forEach(W_),Bc.forEach(W_)}function mc(i,a){i.blockedOn===a&&(i.blockedOn=null,Cm||(Cm=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,Qb)))}function Oc(i){function a(b){return mc(b,i)}if(0<ud.length){mc(ud[0],i);for(var h=1;h<ud.length;h++){var y=ud[h];y.blockedOn===i&&(y.blockedOn=null)}}for(Ia!==null&&mc(Ia,i),Ca!==null&&mc(Ca,i),Pa!==null&&mc(Pa,i),Fc.forEach(a),Bc.forEach(a),h=0;h<wa.length;h++)y=wa[h],y.blockedOn===i&&(y.blockedOn=null);for(;0<wa.length&&(h=wa[0],h.blockedOn===null);)Rx(h),h.blockedOn===null&&wa.shift()}var Zl=Fs.ReactCurrentBatchConfig,Bd=!0;function e2(i,a,h,y){var b=qt,I=Zl.transition;Zl.transition=null;try{qt=1,gg(i,a,h,y)}finally{qt=b,Zl.transition=I}}function t2(i,a,h,y){var b=qt,I=Zl.transition;Zl.transition=null;try{qt=4,gg(i,a,h,y)}finally{qt=b,Zl.transition=I}}function gg(i,a,h,y){if(Bd){var b=Pm(i,a,h,y);if(b===null)Jf(i,a,y,Od,h),H_(i,y);else if(Yb(b,i,a,h,y))y.stopPropagation();else if(H_(i,y),a&4&&-1<Jb.indexOf(i)){for(;b!==null;){var I=Qc(b);if(I!==null&&Mx(I),I=Pm(i,a,h,y),I===null&&Jf(i,a,y,Od,h),I===b)break;b=I}b!==null&&y.stopPropagation()}else Jf(i,a,y,null,h)}}var Od=null;function Pm(i,a,h,y){if(Od=null,i=dg(y),i=xo(i),i!==null)if(a=Mo(i),a===null)i=null;else if(h=a.tag,h===13){if(i=Sx(a),i!==null)return i;i=null}else if(h===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Od=i,null}function Fx(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ub()){case pg:return 1;case Cx:return 4;case Rd:case $b:return 16;case Px:return 536870912;default:return 16}default:return 16}}var Sa=null,yg=null,Sd=null;function Bx(){if(Sd)return Sd;var i,a=yg,h=a.length,y,b="value"in Sa?Sa.value:Sa.textContent,I=b.length;for(i=0;i<h&&a[i]===b[i];i++);var S=h-i;for(y=1;y<=S&&a[h-y]===b[I-y];y++);return Sd=b.slice(i,1<y?1-y:void 0)}function kd(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function cd(){return!0}function X_(){return!1}function un(i){function a(h,y,b,I,S){this._reactName=h,this._targetInst=b,this.type=y,this.nativeEvent=I,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(I):I[d]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?cd:X_,this.isPropagationStopped=X_,this}return fr(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=cd)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=cd)},persist:function(){},isPersistent:cd}),a}var ru={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_g=un(ru),Yc=fr({},ru,{view:0,detail:0}),r2=un(Yc),Uf,$f,gc,ap=fr({},Yc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==gc&&(gc&&i.type==="mousemove"?(Uf=i.screenX-gc.screenX,$f=i.screenY-gc.screenY):$f=Uf=0,gc=i),Uf)},movementY:function(i){return"movementY"in i?i.movementY:$f}}),K_=un(ap),i2=fr({},ap,{dataTransfer:0}),n2=un(i2),s2=fr({},Yc,{relatedTarget:0}),Zf=un(s2),a2=fr({},ru,{animationName:0,elapsedTime:0,pseudoElement:0}),o2=un(a2),l2=fr({},ru,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),u2=un(l2),c2=fr({},ru,{data:0}),J_=un(c2),h2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},d2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},p2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function f2(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=p2[i])?!!a[i]:!1}function vg(){return f2}var m2=fr({},Yc,{key:function(i){if(i.key){var a=h2[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=kd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?d2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vg,charCode:function(i){return i.type==="keypress"?kd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?kd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),g2=un(m2),y2=fr({},ap,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Y_=un(y2),_2=fr({},Yc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vg}),v2=un(_2),x2=fr({},ru,{propertyName:0,elapsedTime:0,pseudoElement:0}),w2=un(x2),b2=fr({},ap,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),S2=un(b2),k2=[9,13,27,32],xg=zs&&"CompositionEvent"in window,Ic=null;zs&&"documentMode"in document&&(Ic=document.documentMode);var T2=zs&&"TextEvent"in window&&!Ic,Ox=zs&&(!xg||Ic&&8<Ic&&11>=Ic),Q_=" ",ev=!1;function Nx(i,a){switch(i){case"keyup":return k2.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jx(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ml=!1;function I2(i,a){switch(i){case"compositionend":return jx(a);case"keypress":return a.which!==32?null:(ev=!0,Q_);case"textInput":return i=a.data,i===Q_&&ev?null:i;default:return null}}function C2(i,a){if(Ml)return i==="compositionend"||!xg&&Nx(i,a)?(i=Bx(),Sd=yg=Sa=null,Ml=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ox&&a.locale!=="ko"?null:a.data;default:return null}}var P2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tv(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!P2[i.type]:a==="textarea"}function Vx(i,a,h,y){_x(y),a=Nd(a,"onChange"),0<a.length&&(h=new _g("onChange","change",null,h,y),i.push({event:h,listeners:a}))}var Cc=null,Nc=null;function E2(i){Yx(i,0)}function op(i){var a=Ll(i);if(hx(a))return i}function A2(i,a){if(i==="change")return a}var Ux=!1;if(zs){var qf;if(zs){var Gf="oninput"in document;if(!Gf){var rv=document.createElement("div");rv.setAttribute("oninput","return;"),Gf=typeof rv.oninput=="function"}qf=Gf}else qf=!1;Ux=qf&&(!document.documentMode||9<document.documentMode)}function iv(){Cc&&(Cc.detachEvent("onpropertychange",$x),Nc=Cc=null)}function $x(i){if(i.propertyName==="value"&&op(Nc)){var a=[];Vx(a,Nc,i,dg(i)),bx(E2,a)}}function M2(i,a,h){i==="focusin"?(iv(),Cc=a,Nc=h,Cc.attachEvent("onpropertychange",$x)):i==="focusout"&&iv()}function z2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return op(Nc)}function D2(i,a){if(i==="click")return op(a)}function L2(i,a){if(i==="input"||i==="change")return op(a)}function R2(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var Un=typeof Object.is=="function"?Object.is:R2;function jc(i,a){if(Un(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var h=Object.keys(i),y=Object.keys(a);if(h.length!==y.length)return!1;for(y=0;y<h.length;y++){var b=h[y];if(!cm.call(a,b)||!Un(i[b],a[b]))return!1}return!0}function nv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function sv(i,a){var h=nv(i);i=0;for(var y;h;){if(h.nodeType===3){if(y=i+h.textContent.length,i<=a&&y>=a)return{node:h,offset:a-i};i=y}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=nv(h)}}function Zx(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?Zx(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function qx(){for(var i=window,a=zd();a instanceof i.HTMLIFrameElement;){try{var h=typeof a.contentWindow.location.href=="string"}catch{h=!1}if(h)i=a.contentWindow;else break;a=zd(i.document)}return a}function wg(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function F2(i){var a=qx(),h=i.focusedElem,y=i.selectionRange;if(a!==h&&h&&h.ownerDocument&&Zx(h.ownerDocument.documentElement,h)){if(y!==null&&wg(h)){if(a=y.start,i=y.end,i===void 0&&(i=a),"selectionStart"in h)h.selectionStart=a,h.selectionEnd=Math.min(i,h.value.length);else if(i=(a=h.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var b=h.textContent.length,I=Math.min(y.start,b);y=y.end===void 0?I:Math.min(y.end,b),!i.extend&&I>y&&(b=y,y=I,I=b),b=sv(h,I);var S=sv(h,y);b&&S&&(i.rangeCount!==1||i.anchorNode!==b.node||i.anchorOffset!==b.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(a=a.createRange(),a.setStart(b.node,b.offset),i.removeAllRanges(),I>y?(i.addRange(a),i.extend(S.node,S.offset)):(a.setEnd(S.node,S.offset),i.addRange(a)))}}for(a=[],i=h;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<a.length;h++)i=a[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var B2=zs&&"documentMode"in document&&11>=document.documentMode,zl=null,Em=null,Pc=null,Am=!1;function av(i,a,h){var y=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Am||zl==null||zl!==zd(y)||(y=zl,"selectionStart"in y&&wg(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Pc&&jc(Pc,y)||(Pc=y,y=Nd(Em,"onSelect"),0<y.length&&(a=new _g("onSelect","select",null,a,h),i.push({event:a,listeners:y}),a.target=zl)))}function hd(i,a){var h={};return h[i.toLowerCase()]=a.toLowerCase(),h["Webkit"+i]="webkit"+a,h["Moz"+i]="moz"+a,h}var Dl={animationend:hd("Animation","AnimationEnd"),animationiteration:hd("Animation","AnimationIteration"),animationstart:hd("Animation","AnimationStart"),transitionend:hd("Transition","TransitionEnd")},Hf={},Gx={};zs&&(Gx=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function lp(i){if(Hf[i])return Hf[i];if(!Dl[i])return i;var a=Dl[i],h;for(h in a)if(a.hasOwnProperty(h)&&h in Gx)return Hf[i]=a[h];return i}var Hx=lp("animationend"),Wx=lp("animationiteration"),Xx=lp("animationstart"),Kx=lp("transitionend"),Jx=new Map,ov="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fa(i,a){Jx.set(i,a),Ao(a,[i])}for(var Wf=0;Wf<ov.length;Wf++){var Xf=ov[Wf],O2=Xf.toLowerCase(),N2=Xf[0].toUpperCase()+Xf.slice(1);Fa(O2,"on"+N2)}Fa(Hx,"onAnimationEnd");Fa(Wx,"onAnimationIteration");Fa(Xx,"onAnimationStart");Fa("dblclick","onDoubleClick");Fa("focusin","onFocus");Fa("focusout","onBlur");Fa(Kx,"onTransitionEnd");Hl("onMouseEnter",["mouseout","mouseover"]);Hl("onMouseLeave",["mouseout","mouseover"]);Hl("onPointerEnter",["pointerout","pointerover"]);Hl("onPointerLeave",["pointerout","pointerover"]);Ao("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ao("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ao("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ao("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ao("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ao("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),j2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sc));function lv(i,a,h){var y=i.type||"unknown-event";i.currentTarget=h,Ob(y,a,void 0,i),i.currentTarget=null}function Yx(i,a){a=(a&4)!==0;for(var h=0;h<i.length;h++){var y=i[h],b=y.event;y=y.listeners;e:{var I=void 0;if(a)for(var S=y.length-1;0<=S;S--){var d=y[S],$=d.instance,ue=d.currentTarget;if(d=d.listener,$!==I&&b.isPropagationStopped())break e;lv(b,d,ue),I=$}else for(S=0;S<y.length;S++){if(d=y[S],$=d.instance,ue=d.currentTarget,d=d.listener,$!==I&&b.isPropagationStopped())break e;lv(b,d,ue),I=$}}}if(Ld)throw i=Tm,Ld=!1,Tm=null,i}function rr(i,a){var h=a[Rm];h===void 0&&(h=a[Rm]=new Set);var y=i+"__bubble";h.has(y)||(Qx(a,i,2,!1),h.add(y))}function Kf(i,a,h){var y=0;a&&(y|=4),Qx(h,i,y,a)}var dd="_reactListening"+Math.random().toString(36).slice(2);function Vc(i){if(!i[dd]){i[dd]=!0,ax.forEach(function(h){h!=="selectionchange"&&(j2.has(h)||Kf(h,!1,i),Kf(h,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[dd]||(a[dd]=!0,Kf("selectionchange",!1,a))}}function Qx(i,a,h,y){switch(Fx(a)){case 1:var b=e2;break;case 4:b=t2;break;default:b=gg}h=b.bind(null,a,h,i),b=void 0,!km||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),y?b!==void 0?i.addEventListener(a,h,{capture:!0,passive:b}):i.addEventListener(a,h,!0):b!==void 0?i.addEventListener(a,h,{passive:b}):i.addEventListener(a,h,!1)}function Jf(i,a,h,y,b){var I=y;if(!(a&1)&&!(a&2)&&y!==null)e:for(;;){if(y===null)return;var S=y.tag;if(S===3||S===4){var d=y.stateNode.containerInfo;if(d===b||d.nodeType===8&&d.parentNode===b)break;if(S===4)for(S=y.return;S!==null;){var $=S.tag;if(($===3||$===4)&&($=S.stateNode.containerInfo,$===b||$.nodeType===8&&$.parentNode===b))return;S=S.return}for(;d!==null;){if(S=xo(d),S===null)return;if($=S.tag,$===5||$===6){y=I=S;continue e}d=d.parentNode}}y=y.return}bx(function(){var ue=I,xe=dg(h),ae=[];e:{var U=Jx.get(i);if(U!==void 0){var ze=_g,Be=i;switch(i){case"keypress":if(kd(h)===0)break e;case"keydown":case"keyup":ze=g2;break;case"focusin":Be="focus",ze=Zf;break;case"focusout":Be="blur",ze=Zf;break;case"beforeblur":case"afterblur":ze=Zf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=K_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=n2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=v2;break;case Hx:case Wx:case Xx:ze=o2;break;case Kx:ze=w2;break;case"scroll":ze=r2;break;case"wheel":ze=S2;break;case"copy":case"cut":case"paste":ze=u2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=Y_}var Pe=(a&4)!==0,Tt=!Pe&&i==="scroll",re=Pe?U!==null?U+"Capture":null:U;Pe=[];for(var Q=ue,le;Q!==null;){le=Q;var ke=le.stateNode;if(le.tag===5&&ke!==null&&(le=ke,re!==null&&(ke=Rc(Q,re),ke!=null&&Pe.push(Uc(Q,ke,le)))),Tt)break;Q=Q.return}0<Pe.length&&(U=new ze(U,Be,null,h,xe),ae.push({event:U,listeners:Pe}))}}if(!(a&7)){e:{if(U=i==="mouseover"||i==="pointerover",ze=i==="mouseout"||i==="pointerout",U&&h!==bm&&(Be=h.relatedTarget||h.fromElement)&&(xo(Be)||Be[Ds]))break e;if((ze||U)&&(U=xe.window===xe?xe:(U=xe.ownerDocument)?U.defaultView||U.parentWindow:window,ze?(Be=h.relatedTarget||h.toElement,ze=ue,Be=Be?xo(Be):null,Be!==null&&(Tt=Mo(Be),Be!==Tt||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(ze=null,Be=ue),ze!==Be)){if(Pe=K_,ke="onMouseLeave",re="onMouseEnter",Q="mouse",(i==="pointerout"||i==="pointerover")&&(Pe=Y_,ke="onPointerLeave",re="onPointerEnter",Q="pointer"),Tt=ze==null?U:Ll(ze),le=Be==null?U:Ll(Be),U=new Pe(ke,Q+"leave",ze,h,xe),U.target=Tt,U.relatedTarget=le,ke=null,xo(xe)===ue&&(Pe=new Pe(re,Q+"enter",Be,h,xe),Pe.target=le,Pe.relatedTarget=Tt,ke=Pe),Tt=ke,ze&&Be)t:{for(Pe=ze,re=Be,Q=0,le=Pe;le;le=Il(le))Q++;for(le=0,ke=re;ke;ke=Il(ke))le++;for(;0<Q-le;)Pe=Il(Pe),Q--;for(;0<le-Q;)re=Il(re),le--;for(;Q--;){if(Pe===re||re!==null&&Pe===re.alternate)break t;Pe=Il(Pe),re=Il(re)}Pe=null}else Pe=null;ze!==null&&uv(ae,U,ze,Pe,!1),Be!==null&&Tt!==null&&uv(ae,Tt,Be,Pe,!0)}}e:{if(U=ue?Ll(ue):window,ze=U.nodeName&&U.nodeName.toLowerCase(),ze==="select"||ze==="input"&&U.type==="file")var Oe=A2;else if(tv(U))if(Ux)Oe=L2;else{Oe=z2;var qe=M2}else(ze=U.nodeName)&&ze.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(Oe=D2);if(Oe&&(Oe=Oe(i,ue))){Vx(ae,Oe,h,xe);break e}qe&&qe(i,U,ue),i==="focusout"&&(qe=U._wrapperState)&&qe.controlled&&U.type==="number"&&ym(U,"number",U.value)}switch(qe=ue?Ll(ue):window,i){case"focusin":(tv(qe)||qe.contentEditable==="true")&&(zl=qe,Em=ue,Pc=null);break;case"focusout":Pc=Em=zl=null;break;case"mousedown":Am=!0;break;case"contextmenu":case"mouseup":case"dragend":Am=!1,av(ae,h,xe);break;case"selectionchange":if(B2)break;case"keydown":case"keyup":av(ae,h,xe)}var He;if(xg)e:{switch(i){case"compositionstart":var it="onCompositionStart";break e;case"compositionend":it="onCompositionEnd";break e;case"compositionupdate":it="onCompositionUpdate";break e}it=void 0}else Ml?Nx(i,h)&&(it="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(it="onCompositionStart");it&&(Ox&&h.locale!=="ko"&&(Ml||it!=="onCompositionStart"?it==="onCompositionEnd"&&Ml&&(He=Bx()):(Sa=xe,yg="value"in Sa?Sa.value:Sa.textContent,Ml=!0)),qe=Nd(ue,it),0<qe.length&&(it=new J_(it,i,null,h,xe),ae.push({event:it,listeners:qe}),He?it.data=He:(He=jx(h),He!==null&&(it.data=He)))),(He=T2?I2(i,h):C2(i,h))&&(ue=Nd(ue,"onBeforeInput"),0<ue.length&&(xe=new J_("onBeforeInput","beforeinput",null,h,xe),ae.push({event:xe,listeners:ue}),xe.data=He))}Yx(ae,a)})}function Uc(i,a,h){return{instance:i,listener:a,currentTarget:h}}function Nd(i,a){for(var h=a+"Capture",y=[];i!==null;){var b=i,I=b.stateNode;b.tag===5&&I!==null&&(b=I,I=Rc(i,h),I!=null&&y.unshift(Uc(i,I,b)),I=Rc(i,a),I!=null&&y.push(Uc(i,I,b))),i=i.return}return y}function Il(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function uv(i,a,h,y,b){for(var I=a._reactName,S=[];h!==null&&h!==y;){var d=h,$=d.alternate,ue=d.stateNode;if($!==null&&$===y)break;d.tag===5&&ue!==null&&(d=ue,b?($=Rc(h,I),$!=null&&S.unshift(Uc(h,$,d))):b||($=Rc(h,I),$!=null&&S.push(Uc(h,$,d)))),h=h.return}S.length!==0&&i.push({event:a,listeners:S})}var V2=/\r\n?/g,U2=/\u0000|\uFFFD/g;function cv(i){return(typeof i=="string"?i:""+i).replace(V2,`
`).replace(U2,"")}function pd(i,a,h){if(a=cv(a),cv(i)!==a&&h)throw Error(Ce(425))}function jd(){}var Mm=null,zm=null;function Dm(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Lm=typeof setTimeout=="function"?setTimeout:void 0,$2=typeof clearTimeout=="function"?clearTimeout:void 0,hv=typeof Promise=="function"?Promise:void 0,Z2=typeof queueMicrotask=="function"?queueMicrotask:typeof hv<"u"?function(i){return hv.resolve(null).then(i).catch(q2)}:Lm;function q2(i){setTimeout(function(){throw i})}function Yf(i,a){var h=a,y=0;do{var b=h.nextSibling;if(i.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(y===0){i.removeChild(b),Oc(a);return}y--}else h!=="$"&&h!=="$?"&&h!=="$!"||y++;h=b}while(h);Oc(a)}function Ea(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function dv(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(a===0)return i;a--}else h==="/$"&&a++}i=i.previousSibling}return null}var iu=Math.random().toString(36).slice(2),ns="__reactFiber$"+iu,$c="__reactProps$"+iu,Ds="__reactContainer$"+iu,Rm="__reactEvents$"+iu,G2="__reactListeners$"+iu,H2="__reactHandles$"+iu;function xo(i){var a=i[ns];if(a)return a;for(var h=i.parentNode;h;){if(a=h[Ds]||h[ns]){if(h=a.alternate,a.child!==null||h!==null&&h.child!==null)for(i=dv(i);i!==null;){if(h=i[ns])return h;i=dv(i)}return a}i=h,h=i.parentNode}return null}function Qc(i){return i=i[ns]||i[Ds],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ll(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ce(33))}function up(i){return i[$c]||null}var Fm=[],Rl=-1;function Ba(i){return{current:i}}function nr(i){0>Rl||(i.current=Fm[Rl],Fm[Rl]=null,Rl--)}function Yt(i,a){Rl++,Fm[Rl]=i.current,i.current=a}var Ra={},fi=Ba(Ra),Oi=Ba(!1),To=Ra;function Wl(i,a){var h=i.type.contextTypes;if(!h)return Ra;var y=i.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===a)return y.__reactInternalMemoizedMaskedChildContext;var b={},I;for(I in h)b[I]=a[I];return y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=b),b}function Ni(i){return i=i.childContextTypes,i!=null}function Vd(){nr(Oi),nr(fi)}function pv(i,a,h){if(fi.current!==Ra)throw Error(Ce(168));Yt(fi,a),Yt(Oi,h)}function e0(i,a,h){var y=i.stateNode;if(a=a.childContextTypes,typeof y.getChildContext!="function")return h;y=y.getChildContext();for(var b in y)if(!(b in a))throw Error(Ce(108,Mb(i)||"Unknown",b));return fr({},h,y)}function Ud(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Ra,To=fi.current,Yt(fi,i),Yt(Oi,Oi.current),!0}function fv(i,a,h){var y=i.stateNode;if(!y)throw Error(Ce(169));h?(i=e0(i,a,To),y.__reactInternalMemoizedMergedChildContext=i,nr(Oi),nr(fi),Yt(fi,i)):nr(Oi),Yt(Oi,h)}var Ps=null,cp=!1,Qf=!1;function t0(i){Ps===null?Ps=[i]:Ps.push(i)}function W2(i){cp=!0,t0(i)}function Oa(){if(!Qf&&Ps!==null){Qf=!0;var i=0,a=qt;try{var h=Ps;for(qt=1;i<h.length;i++){var y=h[i];do y=y(!0);while(y!==null)}Ps=null,cp=!1}catch(b){throw Ps!==null&&(Ps=Ps.slice(i+1)),Ix(pg,Oa),b}finally{qt=a,Qf=!1}}return null}var Fl=[],Bl=0,$d=null,Zd=0,bn=[],Sn=0,Io=null,Es=1,As="";function _o(i,a){Fl[Bl++]=Zd,Fl[Bl++]=$d,$d=i,Zd=a}function r0(i,a,h){bn[Sn++]=Es,bn[Sn++]=As,bn[Sn++]=Io,Io=i;var y=Es;i=As;var b=32-jn(y)-1;y&=~(1<<b),h+=1;var I=32-jn(a)+b;if(30<I){var S=b-b%5;I=(y&(1<<S)-1).toString(32),y>>=S,b-=S,Es=1<<32-jn(a)+b|h<<b|y,As=I+i}else Es=1<<I|h<<b|y,As=i}function bg(i){i.return!==null&&(_o(i,1),r0(i,1,0))}function Sg(i){for(;i===$d;)$d=Fl[--Bl],Fl[Bl]=null,Zd=Fl[--Bl],Fl[Bl]=null;for(;i===Io;)Io=bn[--Sn],bn[Sn]=null,As=bn[--Sn],bn[Sn]=null,Es=bn[--Sn],bn[Sn]=null}var an=null,sn=null,ur=!1,Nn=null;function i0(i,a){var h=kn(5,null,null,0);h.elementType="DELETED",h.stateNode=a,h.return=i,a=i.deletions,a===null?(i.deletions=[h],i.flags|=16):a.push(h)}function mv(i,a){switch(i.tag){case 5:var h=i.type;return a=a.nodeType!==1||h.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,an=i,sn=Ea(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,an=i,sn=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(h=Io!==null?{id:Es,overflow:As}:null,i.memoizedState={dehydrated:a,treeContext:h,retryLane:1073741824},h=kn(18,null,null,0),h.stateNode=a,h.return=i,i.child=h,an=i,sn=null,!0):!1;default:return!1}}function Bm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Om(i){if(ur){var a=sn;if(a){var h=a;if(!mv(i,a)){if(Bm(i))throw Error(Ce(418));a=Ea(h.nextSibling);var y=an;a&&mv(i,a)?i0(y,h):(i.flags=i.flags&-4097|2,ur=!1,an=i)}}else{if(Bm(i))throw Error(Ce(418));i.flags=i.flags&-4097|2,ur=!1,an=i}}}function gv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;an=i}function fd(i){if(i!==an)return!1;if(!ur)return gv(i),ur=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Dm(i.type,i.memoizedProps)),a&&(a=sn)){if(Bm(i))throw n0(),Error(Ce(418));for(;a;)i0(i,a),a=Ea(a.nextSibling)}if(gv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ce(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(a===0){sn=Ea(i.nextSibling);break e}a--}else h!=="$"&&h!=="$!"&&h!=="$?"||a++}i=i.nextSibling}sn=null}}else sn=an?Ea(i.stateNode.nextSibling):null;return!0}function n0(){for(var i=sn;i;)i=Ea(i.nextSibling)}function Xl(){sn=an=null,ur=!1}function kg(i){Nn===null?Nn=[i]:Nn.push(i)}var X2=Fs.ReactCurrentBatchConfig;function yc(i,a,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Ce(309));var y=h.stateNode}if(!y)throw Error(Ce(147,i));var b=y,I=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===I?a.ref:(a=function(S){var d=b.refs;S===null?delete d[I]:d[I]=S},a._stringRef=I,a)}if(typeof i!="string")throw Error(Ce(284));if(!h._owner)throw Error(Ce(290,i))}return i}function md(i,a){throw i=Object.prototype.toString.call(a),Error(Ce(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function yv(i){var a=i._init;return a(i._payload)}function s0(i){function a(re,Q){if(i){var le=re.deletions;le===null?(re.deletions=[Q],re.flags|=16):le.push(Q)}}function h(re,Q){if(!i)return null;for(;Q!==null;)a(re,Q),Q=Q.sibling;return null}function y(re,Q){for(re=new Map;Q!==null;)Q.key!==null?re.set(Q.key,Q):re.set(Q.index,Q),Q=Q.sibling;return re}function b(re,Q){return re=Da(re,Q),re.index=0,re.sibling=null,re}function I(re,Q,le){return re.index=le,i?(le=re.alternate,le!==null?(le=le.index,le<Q?(re.flags|=2,Q):le):(re.flags|=2,Q)):(re.flags|=1048576,Q)}function S(re){return i&&re.alternate===null&&(re.flags|=2),re}function d(re,Q,le,ke){return Q===null||Q.tag!==6?(Q=am(le,re.mode,ke),Q.return=re,Q):(Q=b(Q,le),Q.return=re,Q)}function $(re,Q,le,ke){var Oe=le.type;return Oe===Al?xe(re,Q,le.props.children,ke,le.key):Q!==null&&(Q.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===va&&yv(Oe)===Q.type)?(ke=b(Q,le.props),ke.ref=yc(re,Q,le),ke.return=re,ke):(ke=Md(le.type,le.key,le.props,null,re.mode,ke),ke.ref=yc(re,Q,le),ke.return=re,ke)}function ue(re,Q,le,ke){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==le.containerInfo||Q.stateNode.implementation!==le.implementation?(Q=om(le,re.mode,ke),Q.return=re,Q):(Q=b(Q,le.children||[]),Q.return=re,Q)}function xe(re,Q,le,ke,Oe){return Q===null||Q.tag!==7?(Q=ko(le,re.mode,ke,Oe),Q.return=re,Q):(Q=b(Q,le),Q.return=re,Q)}function ae(re,Q,le){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=am(""+Q,re.mode,le),Q.return=re,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case nd:return le=Md(Q.type,Q.key,Q.props,null,re.mode,le),le.ref=yc(re,null,Q),le.return=re,le;case El:return Q=om(Q,re.mode,le),Q.return=re,Q;case va:var ke=Q._init;return ae(re,ke(Q._payload),le)}if(wc(Q)||dc(Q))return Q=ko(Q,re.mode,le,null),Q.return=re,Q;md(re,Q)}return null}function U(re,Q,le,ke){var Oe=Q!==null?Q.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return Oe!==null?null:d(re,Q,""+le,ke);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case nd:return le.key===Oe?$(re,Q,le,ke):null;case El:return le.key===Oe?ue(re,Q,le,ke):null;case va:return Oe=le._init,U(re,Q,Oe(le._payload),ke)}if(wc(le)||dc(le))return Oe!==null?null:xe(re,Q,le,ke,null);md(re,le)}return null}function ze(re,Q,le,ke,Oe){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return re=re.get(le)||null,d(Q,re,""+ke,Oe);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case nd:return re=re.get(ke.key===null?le:ke.key)||null,$(Q,re,ke,Oe);case El:return re=re.get(ke.key===null?le:ke.key)||null,ue(Q,re,ke,Oe);case va:var qe=ke._init;return ze(re,Q,le,qe(ke._payload),Oe)}if(wc(ke)||dc(ke))return re=re.get(le)||null,xe(Q,re,ke,Oe,null);md(Q,ke)}return null}function Be(re,Q,le,ke){for(var Oe=null,qe=null,He=Q,it=Q=0,Dt=null;He!==null&&it<le.length;it++){He.index>it?(Dt=He,He=null):Dt=He.sibling;var yt=U(re,He,le[it],ke);if(yt===null){He===null&&(He=Dt);break}i&&He&&yt.alternate===null&&a(re,He),Q=I(yt,Q,it),qe===null?Oe=yt:qe.sibling=yt,qe=yt,He=Dt}if(it===le.length)return h(re,He),ur&&_o(re,it),Oe;if(He===null){for(;it<le.length;it++)He=ae(re,le[it],ke),He!==null&&(Q=I(He,Q,it),qe===null?Oe=He:qe.sibling=He,qe=He);return ur&&_o(re,it),Oe}for(He=y(re,He);it<le.length;it++)Dt=ze(He,re,it,le[it],ke),Dt!==null&&(i&&Dt.alternate!==null&&He.delete(Dt.key===null?it:Dt.key),Q=I(Dt,Q,it),qe===null?Oe=Dt:qe.sibling=Dt,qe=Dt);return i&&He.forEach(function(_t){return a(re,_t)}),ur&&_o(re,it),Oe}function Pe(re,Q,le,ke){var Oe=dc(le);if(typeof Oe!="function")throw Error(Ce(150));if(le=Oe.call(le),le==null)throw Error(Ce(151));for(var qe=Oe=null,He=Q,it=Q=0,Dt=null,yt=le.next();He!==null&&!yt.done;it++,yt=le.next()){He.index>it?(Dt=He,He=null):Dt=He.sibling;var _t=U(re,He,yt.value,ke);if(_t===null){He===null&&(He=Dt);break}i&&He&&_t.alternate===null&&a(re,He),Q=I(_t,Q,it),qe===null?Oe=_t:qe.sibling=_t,qe=_t,He=Dt}if(yt.done)return h(re,He),ur&&_o(re,it),Oe;if(He===null){for(;!yt.done;it++,yt=le.next())yt=ae(re,yt.value,ke),yt!==null&&(Q=I(yt,Q,it),qe===null?Oe=yt:qe.sibling=yt,qe=yt);return ur&&_o(re,it),Oe}for(He=y(re,He);!yt.done;it++,yt=le.next())yt=ze(He,re,it,yt.value,ke),yt!==null&&(i&&yt.alternate!==null&&He.delete(yt.key===null?it:yt.key),Q=I(yt,Q,it),qe===null?Oe=yt:qe.sibling=yt,qe=yt);return i&&He.forEach(function(cn){return a(re,cn)}),ur&&_o(re,it),Oe}function Tt(re,Q,le,ke){if(typeof le=="object"&&le!==null&&le.type===Al&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case nd:e:{for(var Oe=le.key,qe=Q;qe!==null;){if(qe.key===Oe){if(Oe=le.type,Oe===Al){if(qe.tag===7){h(re,qe.sibling),Q=b(qe,le.props.children),Q.return=re,re=Q;break e}}else if(qe.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===va&&yv(Oe)===qe.type){h(re,qe.sibling),Q=b(qe,le.props),Q.ref=yc(re,qe,le),Q.return=re,re=Q;break e}h(re,qe);break}else a(re,qe);qe=qe.sibling}le.type===Al?(Q=ko(le.props.children,re.mode,ke,le.key),Q.return=re,re=Q):(ke=Md(le.type,le.key,le.props,null,re.mode,ke),ke.ref=yc(re,Q,le),ke.return=re,re=ke)}return S(re);case El:e:{for(qe=le.key;Q!==null;){if(Q.key===qe)if(Q.tag===4&&Q.stateNode.containerInfo===le.containerInfo&&Q.stateNode.implementation===le.implementation){h(re,Q.sibling),Q=b(Q,le.children||[]),Q.return=re,re=Q;break e}else{h(re,Q);break}else a(re,Q);Q=Q.sibling}Q=om(le,re.mode,ke),Q.return=re,re=Q}return S(re);case va:return qe=le._init,Tt(re,Q,qe(le._payload),ke)}if(wc(le))return Be(re,Q,le,ke);if(dc(le))return Pe(re,Q,le,ke);md(re,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,Q!==null&&Q.tag===6?(h(re,Q.sibling),Q=b(Q,le),Q.return=re,re=Q):(h(re,Q),Q=am(le,re.mode,ke),Q.return=re,re=Q),S(re)):h(re,Q)}return Tt}var Kl=s0(!0),a0=s0(!1),qd=Ba(null),Gd=null,Ol=null,Tg=null;function Ig(){Tg=Ol=Gd=null}function Cg(i){var a=qd.current;nr(qd),i._currentValue=a}function Nm(i,a,h){for(;i!==null;){var y=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,y!==null&&(y.childLanes|=a)):y!==null&&(y.childLanes&a)!==a&&(y.childLanes|=a),i===h)break;i=i.return}}function ql(i,a){Gd=i,Tg=Ol=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&a&&(Bi=!0),i.firstContext=null)}function In(i){var a=i._currentValue;if(Tg!==i)if(i={context:i,memoizedValue:a,next:null},Ol===null){if(Gd===null)throw Error(Ce(308));Ol=i,Gd.dependencies={lanes:0,firstContext:i}}else Ol=Ol.next=i;return a}var wo=null;function Pg(i){wo===null?wo=[i]:wo.push(i)}function o0(i,a,h,y){var b=a.interleaved;return b===null?(h.next=h,Pg(a)):(h.next=b.next,b.next=h),a.interleaved=h,Ls(i,y)}function Ls(i,a){i.lanes|=a;var h=i.alternate;for(h!==null&&(h.lanes|=a),h=i,i=i.return;i!==null;)i.childLanes|=a,h=i.alternate,h!==null&&(h.childLanes|=a),h=i,i=i.return;return h.tag===3?h.stateNode:null}var xa=!1;function Eg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l0(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ms(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function Aa(i,a,h){var y=i.updateQueue;if(y===null)return null;if(y=y.shared,Rt&2){var b=y.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),y.pending=a,Ls(i,h)}return b=y.interleaved,b===null?(a.next=a,Pg(y)):(a.next=b.next,b.next=a),y.interleaved=a,Ls(i,h)}function Td(i,a,h){if(a=a.updateQueue,a!==null&&(a=a.shared,(h&4194240)!==0)){var y=a.lanes;y&=i.pendingLanes,h|=y,a.lanes=h,fg(i,h)}}function _v(i,a){var h=i.updateQueue,y=i.alternate;if(y!==null&&(y=y.updateQueue,h===y)){var b=null,I=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};I===null?b=I=S:I=I.next=S,h=h.next}while(h!==null);I===null?b=I=a:I=I.next=a}else b=I=a;h={baseState:y.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:y.shared,effects:y.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=a:i.next=a,h.lastBaseUpdate=a}function Hd(i,a,h,y){var b=i.updateQueue;xa=!1;var I=b.firstBaseUpdate,S=b.lastBaseUpdate,d=b.shared.pending;if(d!==null){b.shared.pending=null;var $=d,ue=$.next;$.next=null,S===null?I=ue:S.next=ue,S=$;var xe=i.alternate;xe!==null&&(xe=xe.updateQueue,d=xe.lastBaseUpdate,d!==S&&(d===null?xe.firstBaseUpdate=ue:d.next=ue,xe.lastBaseUpdate=$))}if(I!==null){var ae=b.baseState;S=0,xe=ue=$=null,d=I;do{var U=d.lane,ze=d.eventTime;if((y&U)===U){xe!==null&&(xe=xe.next={eventTime:ze,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Be=i,Pe=d;switch(U=a,ze=h,Pe.tag){case 1:if(Be=Pe.payload,typeof Be=="function"){ae=Be.call(ze,ae,U);break e}ae=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=Pe.payload,U=typeof Be=="function"?Be.call(ze,ae,U):Be,U==null)break e;ae=fr({},ae,U);break e;case 2:xa=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,U=b.effects,U===null?b.effects=[d]:U.push(d))}else ze={eventTime:ze,lane:U,tag:d.tag,payload:d.payload,callback:d.callback,next:null},xe===null?(ue=xe=ze,$=ae):xe=xe.next=ze,S|=U;if(d=d.next,d===null){if(d=b.shared.pending,d===null)break;U=d,d=U.next,U.next=null,b.lastBaseUpdate=U,b.shared.pending=null}}while(!0);if(xe===null&&($=ae),b.baseState=$,b.firstBaseUpdate=ue,b.lastBaseUpdate=xe,a=b.shared.interleaved,a!==null){b=a;do S|=b.lane,b=b.next;while(b!==a)}else I===null&&(b.shared.lanes=0);Po|=S,i.lanes=S,i.memoizedState=ae}}function vv(i,a,h){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var y=i[a],b=y.callback;if(b!==null){if(y.callback=null,y=h,typeof b!="function")throw Error(Ce(191,b));b.call(y)}}}var eh={},as=Ba(eh),Zc=Ba(eh),qc=Ba(eh);function bo(i){if(i===eh)throw Error(Ce(174));return i}function Ag(i,a){switch(Yt(qc,a),Yt(Zc,i),Yt(as,eh),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:vm(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=vm(a,i)}nr(as),Yt(as,a)}function Jl(){nr(as),nr(Zc),nr(qc)}function u0(i){bo(qc.current);var a=bo(as.current),h=vm(a,i.type);a!==h&&(Yt(Zc,i),Yt(as,h))}function Mg(i){Zc.current===i&&(nr(as),nr(Zc))}var dr=Ba(0);function Wd(i){for(var a=i;a!==null;){if(a.tag===13){var h=a.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var em=[];function zg(){for(var i=0;i<em.length;i++)em[i]._workInProgressVersionPrimary=null;em.length=0}var Id=Fs.ReactCurrentDispatcher,tm=Fs.ReactCurrentBatchConfig,Co=0,pr=null,Mr=null,Ur=null,Xd=!1,Ec=!1,Gc=0,K2=0;function hi(){throw Error(Ce(321))}function Dg(i,a){if(a===null)return!1;for(var h=0;h<a.length&&h<i.length;h++)if(!Un(i[h],a[h]))return!1;return!0}function Lg(i,a,h,y,b,I){if(Co=I,pr=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Id.current=i===null||i.memoizedState===null?eS:tS,i=h(y,b),Ec){I=0;do{if(Ec=!1,Gc=0,25<=I)throw Error(Ce(301));I+=1,Ur=Mr=null,a.updateQueue=null,Id.current=rS,i=h(y,b)}while(Ec)}if(Id.current=Kd,a=Mr!==null&&Mr.next!==null,Co=0,Ur=Mr=pr=null,Xd=!1,a)throw Error(Ce(300));return i}function Rg(){var i=Gc!==0;return Gc=0,i}function is(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ur===null?pr.memoizedState=Ur=i:Ur=Ur.next=i,Ur}function Cn(){if(Mr===null){var i=pr.alternate;i=i!==null?i.memoizedState:null}else i=Mr.next;var a=Ur===null?pr.memoizedState:Ur.next;if(a!==null)Ur=a,Mr=i;else{if(i===null)throw Error(Ce(310));Mr=i,i={memoizedState:Mr.memoizedState,baseState:Mr.baseState,baseQueue:Mr.baseQueue,queue:Mr.queue,next:null},Ur===null?pr.memoizedState=Ur=i:Ur=Ur.next=i}return Ur}function Hc(i,a){return typeof a=="function"?a(i):a}function rm(i){var a=Cn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var y=Mr,b=y.baseQueue,I=h.pending;if(I!==null){if(b!==null){var S=b.next;b.next=I.next,I.next=S}y.baseQueue=b=I,h.pending=null}if(b!==null){I=b.next,y=y.baseState;var d=S=null,$=null,ue=I;do{var xe=ue.lane;if((Co&xe)===xe)$!==null&&($=$.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),y=ue.hasEagerState?ue.eagerState:i(y,ue.action);else{var ae={lane:xe,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};$===null?(d=$=ae,S=y):$=$.next=ae,pr.lanes|=xe,Po|=xe}ue=ue.next}while(ue!==null&&ue!==I);$===null?S=y:$.next=d,Un(y,a.memoizedState)||(Bi=!0),a.memoizedState=y,a.baseState=S,a.baseQueue=$,h.lastRenderedState=y}if(i=h.interleaved,i!==null){b=i;do I=b.lane,pr.lanes|=I,Po|=I,b=b.next;while(b!==i)}else b===null&&(h.lanes=0);return[a.memoizedState,h.dispatch]}function im(i){var a=Cn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var y=h.dispatch,b=h.pending,I=a.memoizedState;if(b!==null){h.pending=null;var S=b=b.next;do I=i(I,S.action),S=S.next;while(S!==b);Un(I,a.memoizedState)||(Bi=!0),a.memoizedState=I,a.baseQueue===null&&(a.baseState=I),h.lastRenderedState=I}return[I,y]}function c0(){}function h0(i,a){var h=pr,y=Cn(),b=a(),I=!Un(y.memoizedState,b);if(I&&(y.memoizedState=b,Bi=!0),y=y.queue,Fg(f0.bind(null,h,y,i),[i]),y.getSnapshot!==a||I||Ur!==null&&Ur.memoizedState.tag&1){if(h.flags|=2048,Wc(9,p0.bind(null,h,y,b,a),void 0,null),$r===null)throw Error(Ce(349));Co&30||d0(h,a,b)}return b}function d0(i,a,h){i.flags|=16384,i={getSnapshot:a,value:h},a=pr.updateQueue,a===null?(a={lastEffect:null,stores:null},pr.updateQueue=a,a.stores=[i]):(h=a.stores,h===null?a.stores=[i]:h.push(i))}function p0(i,a,h,y){a.value=h,a.getSnapshot=y,m0(a)&&g0(i)}function f0(i,a,h){return h(function(){m0(a)&&g0(i)})}function m0(i){var a=i.getSnapshot;i=i.value;try{var h=a();return!Un(i,h)}catch{return!0}}function g0(i){var a=Ls(i,1);a!==null&&Vn(a,i,1,-1)}function xv(i){var a=is();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hc,lastRenderedState:i},a.queue=i,i=i.dispatch=Q2.bind(null,pr,i),[a.memoizedState,i]}function Wc(i,a,h,y){return i={tag:i,create:a,destroy:h,deps:y,next:null},a=pr.updateQueue,a===null?(a={lastEffect:null,stores:null},pr.updateQueue=a,a.lastEffect=i.next=i):(h=a.lastEffect,h===null?a.lastEffect=i.next=i:(y=h.next,h.next=i,i.next=y,a.lastEffect=i)),i}function y0(){return Cn().memoizedState}function Cd(i,a,h,y){var b=is();pr.flags|=i,b.memoizedState=Wc(1|a,h,void 0,y===void 0?null:y)}function hp(i,a,h,y){var b=Cn();y=y===void 0?null:y;var I=void 0;if(Mr!==null){var S=Mr.memoizedState;if(I=S.destroy,y!==null&&Dg(y,S.deps)){b.memoizedState=Wc(a,h,I,y);return}}pr.flags|=i,b.memoizedState=Wc(1|a,h,I,y)}function wv(i,a){return Cd(8390656,8,i,a)}function Fg(i,a){return hp(2048,8,i,a)}function _0(i,a){return hp(4,2,i,a)}function v0(i,a){return hp(4,4,i,a)}function x0(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function w0(i,a,h){return h=h!=null?h.concat([i]):null,hp(4,4,x0.bind(null,a,i),h)}function Bg(){}function b0(i,a){var h=Cn();a=a===void 0?null:a;var y=h.memoizedState;return y!==null&&a!==null&&Dg(a,y[1])?y[0]:(h.memoizedState=[i,a],i)}function S0(i,a){var h=Cn();a=a===void 0?null:a;var y=h.memoizedState;return y!==null&&a!==null&&Dg(a,y[1])?y[0]:(i=i(),h.memoizedState=[i,a],i)}function k0(i,a,h){return Co&21?(Un(h,a)||(h=Ex(),pr.lanes|=h,Po|=h,i.baseState=!0),a):(i.baseState&&(i.baseState=!1,Bi=!0),i.memoizedState=h)}function J2(i,a){var h=qt;qt=h!==0&&4>h?h:4,i(!0);var y=tm.transition;tm.transition={};try{i(!1),a()}finally{qt=h,tm.transition=y}}function T0(){return Cn().memoizedState}function Y2(i,a,h){var y=za(i);if(h={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null},I0(i))C0(a,h);else if(h=o0(i,a,h,y),h!==null){var b=ki();Vn(h,i,y,b),P0(h,a,y)}}function Q2(i,a,h){var y=za(i),b={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null};if(I0(i))C0(a,b);else{var I=i.alternate;if(i.lanes===0&&(I===null||I.lanes===0)&&(I=a.lastRenderedReducer,I!==null))try{var S=a.lastRenderedState,d=I(S,h);if(b.hasEagerState=!0,b.eagerState=d,Un(d,S)){var $=a.interleaved;$===null?(b.next=b,Pg(a)):(b.next=$.next,$.next=b),a.interleaved=b;return}}catch{}finally{}h=o0(i,a,b,y),h!==null&&(b=ki(),Vn(h,i,y,b),P0(h,a,y))}}function I0(i){var a=i.alternate;return i===pr||a!==null&&a===pr}function C0(i,a){Ec=Xd=!0;var h=i.pending;h===null?a.next=a:(a.next=h.next,h.next=a),i.pending=a}function P0(i,a,h){if(h&4194240){var y=a.lanes;y&=i.pendingLanes,h|=y,a.lanes=h,fg(i,h)}}var Kd={readContext:In,useCallback:hi,useContext:hi,useEffect:hi,useImperativeHandle:hi,useInsertionEffect:hi,useLayoutEffect:hi,useMemo:hi,useReducer:hi,useRef:hi,useState:hi,useDebugValue:hi,useDeferredValue:hi,useTransition:hi,useMutableSource:hi,useSyncExternalStore:hi,useId:hi,unstable_isNewReconciler:!1},eS={readContext:In,useCallback:function(i,a){return is().memoizedState=[i,a===void 0?null:a],i},useContext:In,useEffect:wv,useImperativeHandle:function(i,a,h){return h=h!=null?h.concat([i]):null,Cd(4194308,4,x0.bind(null,a,i),h)},useLayoutEffect:function(i,a){return Cd(4194308,4,i,a)},useInsertionEffect:function(i,a){return Cd(4,2,i,a)},useMemo:function(i,a){var h=is();return a=a===void 0?null:a,i=i(),h.memoizedState=[i,a],i},useReducer:function(i,a,h){var y=is();return a=h!==void 0?h(a):a,y.memoizedState=y.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},y.queue=i,i=i.dispatch=Y2.bind(null,pr,i),[y.memoizedState,i]},useRef:function(i){var a=is();return i={current:i},a.memoizedState=i},useState:xv,useDebugValue:Bg,useDeferredValue:function(i){return is().memoizedState=i},useTransition:function(){var i=xv(!1),a=i[0];return i=J2.bind(null,i[1]),is().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,h){var y=pr,b=is();if(ur){if(h===void 0)throw Error(Ce(407));h=h()}else{if(h=a(),$r===null)throw Error(Ce(349));Co&30||d0(y,a,h)}b.memoizedState=h;var I={value:h,getSnapshot:a};return b.queue=I,wv(f0.bind(null,y,I,i),[i]),y.flags|=2048,Wc(9,p0.bind(null,y,I,h,a),void 0,null),h},useId:function(){var i=is(),a=$r.identifierPrefix;if(ur){var h=As,y=Es;h=(y&~(1<<32-jn(y)-1)).toString(32)+h,a=":"+a+"R"+h,h=Gc++,0<h&&(a+="H"+h.toString(32)),a+=":"}else h=K2++,a=":"+a+"r"+h.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},tS={readContext:In,useCallback:b0,useContext:In,useEffect:Fg,useImperativeHandle:w0,useInsertionEffect:_0,useLayoutEffect:v0,useMemo:S0,useReducer:rm,useRef:y0,useState:function(){return rm(Hc)},useDebugValue:Bg,useDeferredValue:function(i){var a=Cn();return k0(a,Mr.memoizedState,i)},useTransition:function(){var i=rm(Hc)[0],a=Cn().memoizedState;return[i,a]},useMutableSource:c0,useSyncExternalStore:h0,useId:T0,unstable_isNewReconciler:!1},rS={readContext:In,useCallback:b0,useContext:In,useEffect:Fg,useImperativeHandle:w0,useInsertionEffect:_0,useLayoutEffect:v0,useMemo:S0,useReducer:im,useRef:y0,useState:function(){return im(Hc)},useDebugValue:Bg,useDeferredValue:function(i){var a=Cn();return Mr===null?a.memoizedState=i:k0(a,Mr.memoizedState,i)},useTransition:function(){var i=im(Hc)[0],a=Cn().memoizedState;return[i,a]},useMutableSource:c0,useSyncExternalStore:h0,useId:T0,unstable_isNewReconciler:!1};function Bn(i,a){if(i&&i.defaultProps){a=fr({},a),i=i.defaultProps;for(var h in i)a[h]===void 0&&(a[h]=i[h]);return a}return a}function jm(i,a,h,y){a=i.memoizedState,h=h(y,a),h=h==null?a:fr({},a,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var dp={isMounted:function(i){return(i=i._reactInternals)?Mo(i)===i:!1},enqueueSetState:function(i,a,h){i=i._reactInternals;var y=ki(),b=za(i),I=Ms(y,b);I.payload=a,h!=null&&(I.callback=h),a=Aa(i,I,b),a!==null&&(Vn(a,i,b,y),Td(a,i,b))},enqueueReplaceState:function(i,a,h){i=i._reactInternals;var y=ki(),b=za(i),I=Ms(y,b);I.tag=1,I.payload=a,h!=null&&(I.callback=h),a=Aa(i,I,b),a!==null&&(Vn(a,i,b,y),Td(a,i,b))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var h=ki(),y=za(i),b=Ms(h,y);b.tag=2,a!=null&&(b.callback=a),a=Aa(i,b,y),a!==null&&(Vn(a,i,y,h),Td(a,i,y))}};function bv(i,a,h,y,b,I,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(y,I,S):a.prototype&&a.prototype.isPureReactComponent?!jc(h,y)||!jc(b,I):!0}function E0(i,a,h){var y=!1,b=Ra,I=a.contextType;return typeof I=="object"&&I!==null?I=In(I):(b=Ni(a)?To:fi.current,y=a.contextTypes,I=(y=y!=null)?Wl(i,b):Ra),a=new a(h,I),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=dp,i.stateNode=a,a._reactInternals=i,y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=b,i.__reactInternalMemoizedMaskedChildContext=I),a}function Sv(i,a,h,y){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(h,y),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(h,y),a.state!==i&&dp.enqueueReplaceState(a,a.state,null)}function Vm(i,a,h,y){var b=i.stateNode;b.props=h,b.state=i.memoizedState,b.refs={},Eg(i);var I=a.contextType;typeof I=="object"&&I!==null?b.context=In(I):(I=Ni(a)?To:fi.current,b.context=Wl(i,I)),b.state=i.memoizedState,I=a.getDerivedStateFromProps,typeof I=="function"&&(jm(i,a,I,h),b.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(a=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),a!==b.state&&dp.enqueueReplaceState(b,b.state,null),Hd(i,h,b,y),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308)}function Yl(i,a){try{var h="",y=a;do h+=Ab(y),y=y.return;while(y);var b=h}catch(I){b=`
Error generating stack: `+I.message+`
`+I.stack}return{value:i,source:a,stack:b,digest:null}}function nm(i,a,h){return{value:i,source:null,stack:h??null,digest:a??null}}function Um(i,a){try{console.error(a.value)}catch(h){setTimeout(function(){throw h})}}var iS=typeof WeakMap=="function"?WeakMap:Map;function A0(i,a,h){h=Ms(-1,h),h.tag=3,h.payload={element:null};var y=a.value;return h.callback=function(){Yd||(Yd=!0,Ym=y),Um(i,a)},h}function M0(i,a,h){h=Ms(-1,h),h.tag=3;var y=i.type.getDerivedStateFromError;if(typeof y=="function"){var b=a.value;h.payload=function(){return y(b)},h.callback=function(){Um(i,a)}}var I=i.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(h.callback=function(){Um(i,a),typeof y!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var S=a.stack;this.componentDidCatch(a.value,{componentStack:S!==null?S:""})}),h}function kv(i,a,h){var y=i.pingCache;if(y===null){y=i.pingCache=new iS;var b=new Set;y.set(a,b)}else b=y.get(a),b===void 0&&(b=new Set,y.set(a,b));b.has(h)||(b.add(h),i=yS.bind(null,i,a,h),a.then(i,i))}function Tv(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function Iv(i,a,h,y,b){return i.mode&1?(i.flags|=65536,i.lanes=b,i):(i===a?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(a=Ms(-1,1),a.tag=2,Aa(h,a,1))),h.lanes|=1),i)}var nS=Fs.ReactCurrentOwner,Bi=!1;function Si(i,a,h,y){a.child=i===null?a0(a,null,h,y):Kl(a,i.child,h,y)}function Cv(i,a,h,y,b){h=h.render;var I=a.ref;return ql(a,b),y=Lg(i,a,h,y,I,b),h=Rg(),i!==null&&!Bi?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,Rs(i,a,b)):(ur&&h&&bg(a),a.flags|=1,Si(i,a,y,b),a.child)}function Pv(i,a,h,y,b){if(i===null){var I=h.type;return typeof I=="function"&&!qg(I)&&I.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(a.tag=15,a.type=I,z0(i,a,I,y,b)):(i=Md(h.type,null,y,a,a.mode,b),i.ref=a.ref,i.return=a,a.child=i)}if(I=i.child,!(i.lanes&b)){var S=I.memoizedProps;if(h=h.compare,h=h!==null?h:jc,h(S,y)&&i.ref===a.ref)return Rs(i,a,b)}return a.flags|=1,i=Da(I,y),i.ref=a.ref,i.return=a,a.child=i}function z0(i,a,h,y,b){if(i!==null){var I=i.memoizedProps;if(jc(I,y)&&i.ref===a.ref)if(Bi=!1,a.pendingProps=y=I,(i.lanes&b)!==0)i.flags&131072&&(Bi=!0);else return a.lanes=i.lanes,Rs(i,a,b)}return $m(i,a,h,y,b)}function D0(i,a,h){var y=a.pendingProps,b=y.children,I=i!==null?i.memoizedState:null;if(y.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(jl,nn),nn|=h;else{if(!(h&1073741824))return i=I!==null?I.baseLanes|h:h,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,Yt(jl,nn),nn|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=I!==null?I.baseLanes:h,Yt(jl,nn),nn|=y}else I!==null?(y=I.baseLanes|h,a.memoizedState=null):y=h,Yt(jl,nn),nn|=y;return Si(i,a,b,h),a.child}function L0(i,a){var h=a.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(a.flags|=512,a.flags|=2097152)}function $m(i,a,h,y,b){var I=Ni(h)?To:fi.current;return I=Wl(a,I),ql(a,b),h=Lg(i,a,h,y,I,b),y=Rg(),i!==null&&!Bi?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,Rs(i,a,b)):(ur&&y&&bg(a),a.flags|=1,Si(i,a,h,b),a.child)}function Ev(i,a,h,y,b){if(Ni(h)){var I=!0;Ud(a)}else I=!1;if(ql(a,b),a.stateNode===null)Pd(i,a),E0(a,h,y),Vm(a,h,y,b),y=!0;else if(i===null){var S=a.stateNode,d=a.memoizedProps;S.props=d;var $=S.context,ue=h.contextType;typeof ue=="object"&&ue!==null?ue=In(ue):(ue=Ni(h)?To:fi.current,ue=Wl(a,ue));var xe=h.getDerivedStateFromProps,ae=typeof xe=="function"||typeof S.getSnapshotBeforeUpdate=="function";ae||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==y||$!==ue)&&Sv(a,S,y,ue),xa=!1;var U=a.memoizedState;S.state=U,Hd(a,y,S,b),$=a.memoizedState,d!==y||U!==$||Oi.current||xa?(typeof xe=="function"&&(jm(a,h,xe,y),$=a.memoizedState),(d=xa||bv(a,h,d,y,U,$,ue))?(ae||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=y,a.memoizedState=$),S.props=y,S.state=$,S.context=ue,y=d):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),y=!1)}else{S=a.stateNode,l0(i,a),d=a.memoizedProps,ue=a.type===a.elementType?d:Bn(a.type,d),S.props=ue,ae=a.pendingProps,U=S.context,$=h.contextType,typeof $=="object"&&$!==null?$=In($):($=Ni(h)?To:fi.current,$=Wl(a,$));var ze=h.getDerivedStateFromProps;(xe=typeof ze=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==ae||U!==$)&&Sv(a,S,y,$),xa=!1,U=a.memoizedState,S.state=U,Hd(a,y,S,b);var Be=a.memoizedState;d!==ae||U!==Be||Oi.current||xa?(typeof ze=="function"&&(jm(a,h,ze,y),Be=a.memoizedState),(ue=xa||bv(a,h,ue,y,U,Be,$)||!1)?(xe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(y,Be,$),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(y,Be,$)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&U===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&U===i.memoizedState||(a.flags|=1024),a.memoizedProps=y,a.memoizedState=Be),S.props=y,S.state=Be,S.context=$,y=ue):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&U===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&U===i.memoizedState||(a.flags|=1024),y=!1)}return Zm(i,a,h,y,I,b)}function Zm(i,a,h,y,b,I){L0(i,a);var S=(a.flags&128)!==0;if(!y&&!S)return b&&fv(a,h,!1),Rs(i,a,I);y=a.stateNode,nS.current=a;var d=S&&typeof h.getDerivedStateFromError!="function"?null:y.render();return a.flags|=1,i!==null&&S?(a.child=Kl(a,i.child,null,I),a.child=Kl(a,null,d,I)):Si(i,a,d,I),a.memoizedState=y.state,b&&fv(a,h,!0),a.child}function R0(i){var a=i.stateNode;a.pendingContext?pv(i,a.pendingContext,a.pendingContext!==a.context):a.context&&pv(i,a.context,!1),Ag(i,a.containerInfo)}function Av(i,a,h,y,b){return Xl(),kg(b),a.flags|=256,Si(i,a,h,y),a.child}var qm={dehydrated:null,treeContext:null,retryLane:0};function Gm(i){return{baseLanes:i,cachePool:null,transitions:null}}function F0(i,a,h){var y=a.pendingProps,b=dr.current,I=!1,S=(a.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(b&2)!==0),d?(I=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(b|=1),Yt(dr,b&1),i===null)return Om(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(a.mode&1?i.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(S=y.children,i=y.fallback,I?(y=a.mode,I=a.child,S={mode:"hidden",children:S},!(y&1)&&I!==null?(I.childLanes=0,I.pendingProps=S):I=mp(S,y,0,null),i=ko(i,y,h,null),I.return=a,i.return=a,I.sibling=i,a.child=I,a.child.memoizedState=Gm(h),a.memoizedState=qm,i):Og(a,S));if(b=i.memoizedState,b!==null&&(d=b.dehydrated,d!==null))return sS(i,a,S,y,d,b,h);if(I){I=y.fallback,S=a.mode,b=i.child,d=b.sibling;var $={mode:"hidden",children:y.children};return!(S&1)&&a.child!==b?(y=a.child,y.childLanes=0,y.pendingProps=$,a.deletions=null):(y=Da(b,$),y.subtreeFlags=b.subtreeFlags&14680064),d!==null?I=Da(d,I):(I=ko(I,S,h,null),I.flags|=2),I.return=a,y.return=a,y.sibling=I,a.child=y,y=I,I=a.child,S=i.child.memoizedState,S=S===null?Gm(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},I.memoizedState=S,I.childLanes=i.childLanes&~h,a.memoizedState=qm,y}return I=i.child,i=I.sibling,y=Da(I,{mode:"visible",children:y.children}),!(a.mode&1)&&(y.lanes=h),y.return=a,y.sibling=null,i!==null&&(h=a.deletions,h===null?(a.deletions=[i],a.flags|=16):h.push(i)),a.child=y,a.memoizedState=null,y}function Og(i,a){return a=mp({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function gd(i,a,h,y){return y!==null&&kg(y),Kl(a,i.child,null,h),i=Og(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function sS(i,a,h,y,b,I,S){if(h)return a.flags&256?(a.flags&=-257,y=nm(Error(Ce(422))),gd(i,a,S,y)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(I=y.fallback,b=a.mode,y=mp({mode:"visible",children:y.children},b,0,null),I=ko(I,b,S,null),I.flags|=2,y.return=a,I.return=a,y.sibling=I,a.child=y,a.mode&1&&Kl(a,i.child,null,S),a.child.memoizedState=Gm(S),a.memoizedState=qm,I);if(!(a.mode&1))return gd(i,a,S,null);if(b.data==="$!"){if(y=b.nextSibling&&b.nextSibling.dataset,y)var d=y.dgst;return y=d,I=Error(Ce(419)),y=nm(I,y,void 0),gd(i,a,S,y)}if(d=(S&i.childLanes)!==0,Bi||d){if(y=$r,y!==null){switch(S&-S){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(y.suspendedLanes|S)?0:b,b!==0&&b!==I.retryLane&&(I.retryLane=b,Ls(i,b),Vn(y,i,b,-1))}return Zg(),y=nm(Error(Ce(421))),gd(i,a,S,y)}return b.data==="$?"?(a.flags|=128,a.child=i.child,a=_S.bind(null,i),b._reactRetry=a,null):(i=I.treeContext,sn=Ea(b.nextSibling),an=a,ur=!0,Nn=null,i!==null&&(bn[Sn++]=Es,bn[Sn++]=As,bn[Sn++]=Io,Es=i.id,As=i.overflow,Io=a),a=Og(a,y.children),a.flags|=4096,a)}function Mv(i,a,h){i.lanes|=a;var y=i.alternate;y!==null&&(y.lanes|=a),Nm(i.return,a,h)}function sm(i,a,h,y,b){var I=i.memoizedState;I===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:y,tail:h,tailMode:b}:(I.isBackwards=a,I.rendering=null,I.renderingStartTime=0,I.last=y,I.tail=h,I.tailMode=b)}function B0(i,a,h){var y=a.pendingProps,b=y.revealOrder,I=y.tail;if(Si(i,a,y.children,h),y=dr.current,y&2)y=y&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Mv(i,h,a);else if(i.tag===19)Mv(i,h,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}y&=1}if(Yt(dr,y),!(a.mode&1))a.memoizedState=null;else switch(b){case"forwards":for(h=a.child,b=null;h!==null;)i=h.alternate,i!==null&&Wd(i)===null&&(b=h),h=h.sibling;h=b,h===null?(b=a.child,a.child=null):(b=h.sibling,h.sibling=null),sm(a,!1,b,h,I);break;case"backwards":for(h=null,b=a.child,a.child=null;b!==null;){if(i=b.alternate,i!==null&&Wd(i)===null){a.child=b;break}i=b.sibling,b.sibling=h,h=b,b=i}sm(a,!0,h,null,I);break;case"together":sm(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Pd(i,a){!(a.mode&1)&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function Rs(i,a,h){if(i!==null&&(a.dependencies=i.dependencies),Po|=a.lanes,!(h&a.childLanes))return null;if(i!==null&&a.child!==i.child)throw Error(Ce(153));if(a.child!==null){for(i=a.child,h=Da(i,i.pendingProps),a.child=h,h.return=a;i.sibling!==null;)i=i.sibling,h=h.sibling=Da(i,i.pendingProps),h.return=a;h.sibling=null}return a.child}function aS(i,a,h){switch(a.tag){case 3:R0(a),Xl();break;case 5:u0(a);break;case 1:Ni(a.type)&&Ud(a);break;case 4:Ag(a,a.stateNode.containerInfo);break;case 10:var y=a.type._context,b=a.memoizedProps.value;Yt(qd,y._currentValue),y._currentValue=b;break;case 13:if(y=a.memoizedState,y!==null)return y.dehydrated!==null?(Yt(dr,dr.current&1),a.flags|=128,null):h&a.child.childLanes?F0(i,a,h):(Yt(dr,dr.current&1),i=Rs(i,a,h),i!==null?i.sibling:null);Yt(dr,dr.current&1);break;case 19:if(y=(h&a.childLanes)!==0,i.flags&128){if(y)return B0(i,a,h);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Yt(dr,dr.current),y)break;return null;case 22:case 23:return a.lanes=0,D0(i,a,h)}return Rs(i,a,h)}var O0,Hm,N0,j0;O0=function(i,a){for(var h=a.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};Hm=function(){};N0=function(i,a,h,y){var b=i.memoizedProps;if(b!==y){i=a.stateNode,bo(as.current);var I=null;switch(h){case"input":b=mm(i,b),y=mm(i,y),I=[];break;case"select":b=fr({},b,{value:void 0}),y=fr({},y,{value:void 0}),I=[];break;case"textarea":b=_m(i,b),y=_m(i,y),I=[];break;default:typeof b.onClick!="function"&&typeof y.onClick=="function"&&(i.onclick=jd)}xm(h,y);var S;h=null;for(ue in b)if(!y.hasOwnProperty(ue)&&b.hasOwnProperty(ue)&&b[ue]!=null)if(ue==="style"){var d=b[ue];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else ue!=="dangerouslySetInnerHTML"&&ue!=="children"&&ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&ue!=="autoFocus"&&(Dc.hasOwnProperty(ue)?I||(I=[]):(I=I||[]).push(ue,null));for(ue in y){var $=y[ue];if(d=b!=null?b[ue]:void 0,y.hasOwnProperty(ue)&&$!==d&&($!=null||d!=null))if(ue==="style")if(d){for(S in d)!d.hasOwnProperty(S)||$&&$.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in $)$.hasOwnProperty(S)&&d[S]!==$[S]&&(h||(h={}),h[S]=$[S])}else h||(I||(I=[]),I.push(ue,h)),h=$;else ue==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,d=d?d.__html:void 0,$!=null&&d!==$&&(I=I||[]).push(ue,$)):ue==="children"?typeof $!="string"&&typeof $!="number"||(I=I||[]).push(ue,""+$):ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&(Dc.hasOwnProperty(ue)?($!=null&&ue==="onScroll"&&rr("scroll",i),I||d===$||(I=[])):(I=I||[]).push(ue,$))}h&&(I=I||[]).push("style",h);var ue=I;(a.updateQueue=ue)&&(a.flags|=4)}};j0=function(i,a,h,y){h!==y&&(a.flags|=4)};function _c(i,a){if(!ur)switch(i.tailMode){case"hidden":a=i.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:y.sibling=null}}function di(i){var a=i.alternate!==null&&i.alternate.child===i.child,h=0,y=0;if(a)for(var b=i.child;b!==null;)h|=b.lanes|b.childLanes,y|=b.subtreeFlags&14680064,y|=b.flags&14680064,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)h|=b.lanes|b.childLanes,y|=b.subtreeFlags,y|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=y,i.childLanes=h,a}function oS(i,a,h){var y=a.pendingProps;switch(Sg(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return di(a),null;case 1:return Ni(a.type)&&Vd(),di(a),null;case 3:return y=a.stateNode,Jl(),nr(Oi),nr(fi),zg(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(i===null||i.child===null)&&(fd(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Nn!==null&&(tg(Nn),Nn=null))),Hm(i,a),di(a),null;case 5:Mg(a);var b=bo(qc.current);if(h=a.type,i!==null&&a.stateNode!=null)N0(i,a,h,y,b),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!y){if(a.stateNode===null)throw Error(Ce(166));return di(a),null}if(i=bo(as.current),fd(a)){y=a.stateNode,h=a.type;var I=a.memoizedProps;switch(y[ns]=a,y[$c]=I,i=(a.mode&1)!==0,h){case"dialog":rr("cancel",y),rr("close",y);break;case"iframe":case"object":case"embed":rr("load",y);break;case"video":case"audio":for(b=0;b<Sc.length;b++)rr(Sc[b],y);break;case"source":rr("error",y);break;case"img":case"image":case"link":rr("error",y),rr("load",y);break;case"details":rr("toggle",y);break;case"input":j_(y,I),rr("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!I.multiple},rr("invalid",y);break;case"textarea":U_(y,I),rr("invalid",y)}xm(h,I),b=null;for(var S in I)if(I.hasOwnProperty(S)){var d=I[S];S==="children"?typeof d=="string"?y.textContent!==d&&(I.suppressHydrationWarning!==!0&&pd(y.textContent,d,i),b=["children",d]):typeof d=="number"&&y.textContent!==""+d&&(I.suppressHydrationWarning!==!0&&pd(y.textContent,d,i),b=["children",""+d]):Dc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&rr("scroll",y)}switch(h){case"input":sd(y),V_(y,I,!0);break;case"textarea":sd(y),$_(y);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(y.onclick=jd)}y=b,a.updateQueue=y,y!==null&&(a.flags|=4)}else{S=b.nodeType===9?b:b.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=fx(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof y.is=="string"?i=S.createElement(h,{is:y.is}):(i=S.createElement(h),h==="select"&&(S=i,y.multiple?S.multiple=!0:y.size&&(S.size=y.size))):i=S.createElementNS(i,h),i[ns]=a,i[$c]=y,O0(i,a,!1,!1),a.stateNode=i;e:{switch(S=wm(h,y),h){case"dialog":rr("cancel",i),rr("close",i),b=y;break;case"iframe":case"object":case"embed":rr("load",i),b=y;break;case"video":case"audio":for(b=0;b<Sc.length;b++)rr(Sc[b],i);b=y;break;case"source":rr("error",i),b=y;break;case"img":case"image":case"link":rr("error",i),rr("load",i),b=y;break;case"details":rr("toggle",i),b=y;break;case"input":j_(i,y),b=mm(i,y),rr("invalid",i);break;case"option":b=y;break;case"select":i._wrapperState={wasMultiple:!!y.multiple},b=fr({},y,{value:void 0}),rr("invalid",i);break;case"textarea":U_(i,y),b=_m(i,y),rr("invalid",i);break;default:b=y}xm(h,b),d=b;for(I in d)if(d.hasOwnProperty(I)){var $=d[I];I==="style"?yx(i,$):I==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,$!=null&&mx(i,$)):I==="children"?typeof $=="string"?(h!=="textarea"||$!=="")&&Lc(i,$):typeof $=="number"&&Lc(i,""+$):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Dc.hasOwnProperty(I)?$!=null&&I==="onScroll"&&rr("scroll",i):$!=null&&lg(i,I,$,S))}switch(h){case"input":sd(i),V_(i,y,!1);break;case"textarea":sd(i),$_(i);break;case"option":y.value!=null&&i.setAttribute("value",""+La(y.value));break;case"select":i.multiple=!!y.multiple,I=y.value,I!=null?Vl(i,!!y.multiple,I,!1):y.defaultValue!=null&&Vl(i,!!y.multiple,y.defaultValue,!0);break;default:typeof b.onClick=="function"&&(i.onclick=jd)}switch(h){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return di(a),null;case 6:if(i&&a.stateNode!=null)j0(i,a,i.memoizedProps,y);else{if(typeof y!="string"&&a.stateNode===null)throw Error(Ce(166));if(h=bo(qc.current),bo(as.current),fd(a)){if(y=a.stateNode,h=a.memoizedProps,y[ns]=a,(I=y.nodeValue!==h)&&(i=an,i!==null))switch(i.tag){case 3:pd(y.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&pd(y.nodeValue,h,(i.mode&1)!==0)}I&&(a.flags|=4)}else y=(h.nodeType===9?h:h.ownerDocument).createTextNode(y),y[ns]=a,a.stateNode=y}return di(a),null;case 13:if(nr(dr),y=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ur&&sn!==null&&a.mode&1&&!(a.flags&128))n0(),Xl(),a.flags|=98560,I=!1;else if(I=fd(a),y!==null&&y.dehydrated!==null){if(i===null){if(!I)throw Error(Ce(318));if(I=a.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(Ce(317));I[ns]=a}else Xl(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;di(a),I=!1}else Nn!==null&&(tg(Nn),Nn=null),I=!0;if(!I)return a.flags&65536?a:null}return a.flags&128?(a.lanes=h,a):(y=y!==null,y!==(i!==null&&i.memoizedState!==null)&&y&&(a.child.flags|=8192,a.mode&1&&(i===null||dr.current&1?zr===0&&(zr=3):Zg())),a.updateQueue!==null&&(a.flags|=4),di(a),null);case 4:return Jl(),Hm(i,a),i===null&&Vc(a.stateNode.containerInfo),di(a),null;case 10:return Cg(a.type._context),di(a),null;case 17:return Ni(a.type)&&Vd(),di(a),null;case 19:if(nr(dr),I=a.memoizedState,I===null)return di(a),null;if(y=(a.flags&128)!==0,S=I.rendering,S===null)if(y)_c(I,!1);else{if(zr!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(S=Wd(i),S!==null){for(a.flags|=128,_c(I,!1),y=S.updateQueue,y!==null&&(a.updateQueue=y,a.flags|=4),a.subtreeFlags=0,y=h,h=a.child;h!==null;)I=h,i=y,I.flags&=14680066,S=I.alternate,S===null?(I.childLanes=0,I.lanes=i,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=S.childLanes,I.lanes=S.lanes,I.child=S.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=S.memoizedProps,I.memoizedState=S.memoizedState,I.updateQueue=S.updateQueue,I.type=S.type,i=S.dependencies,I.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return Yt(dr,dr.current&1|2),a.child}i=i.sibling}I.tail!==null&&xr()>Ql&&(a.flags|=128,y=!0,_c(I,!1),a.lanes=4194304)}else{if(!y)if(i=Wd(S),i!==null){if(a.flags|=128,y=!0,h=i.updateQueue,h!==null&&(a.updateQueue=h,a.flags|=4),_c(I,!0),I.tail===null&&I.tailMode==="hidden"&&!S.alternate&&!ur)return di(a),null}else 2*xr()-I.renderingStartTime>Ql&&h!==1073741824&&(a.flags|=128,y=!0,_c(I,!1),a.lanes=4194304);I.isBackwards?(S.sibling=a.child,a.child=S):(h=I.last,h!==null?h.sibling=S:a.child=S,I.last=S)}return I.tail!==null?(a=I.tail,I.rendering=a,I.tail=a.sibling,I.renderingStartTime=xr(),a.sibling=null,h=dr.current,Yt(dr,y?h&1|2:h&1),a):(di(a),null);case 22:case 23:return $g(),y=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==y&&(a.flags|=8192),y&&a.mode&1?nn&1073741824&&(di(a),a.subtreeFlags&6&&(a.flags|=8192)):di(a),null;case 24:return null;case 25:return null}throw Error(Ce(156,a.tag))}function lS(i,a){switch(Sg(a),a.tag){case 1:return Ni(a.type)&&Vd(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Jl(),nr(Oi),nr(fi),zg(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 5:return Mg(a),null;case 13:if(nr(dr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(Ce(340));Xl()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return nr(dr),null;case 4:return Jl(),null;case 10:return Cg(a.type._context),null;case 22:case 23:return $g(),null;case 24:return null;default:return null}}var yd=!1,pi=!1,uS=typeof WeakSet=="function"?WeakSet:Set,tt=null;function Nl(i,a){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(y){_r(i,a,y)}else h.current=null}function Wm(i,a,h){try{h()}catch(y){_r(i,a,y)}}var zv=!1;function cS(i,a){if(Mm=Bd,i=qx(),wg(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var y=h.getSelection&&h.getSelection();if(y&&y.rangeCount!==0){h=y.anchorNode;var b=y.anchorOffset,I=y.focusNode;y=y.focusOffset;try{h.nodeType,I.nodeType}catch{h=null;break e}var S=0,d=-1,$=-1,ue=0,xe=0,ae=i,U=null;t:for(;;){for(var ze;ae!==h||b!==0&&ae.nodeType!==3||(d=S+b),ae!==I||y!==0&&ae.nodeType!==3||($=S+y),ae.nodeType===3&&(S+=ae.nodeValue.length),(ze=ae.firstChild)!==null;)U=ae,ae=ze;for(;;){if(ae===i)break t;if(U===h&&++ue===b&&(d=S),U===I&&++xe===y&&($=S),(ze=ae.nextSibling)!==null)break;ae=U,U=ae.parentNode}ae=ze}h=d===-1||$===-1?null:{start:d,end:$}}else h=null}h=h||{start:0,end:0}}else h=null;for(zm={focusedElem:i,selectionRange:h},Bd=!1,tt=a;tt!==null;)if(a=tt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,tt=i;else for(;tt!==null;){a=tt;try{var Be=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var Pe=Be.memoizedProps,Tt=Be.memoizedState,re=a.stateNode,Q=re.getSnapshotBeforeUpdate(a.elementType===a.type?Pe:Bn(a.type,Pe),Tt);re.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var le=a.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(ke){_r(a,a.return,ke)}if(i=a.sibling,i!==null){i.return=a.return,tt=i;break}tt=a.return}return Be=zv,zv=!1,Be}function Ac(i,a,h){var y=a.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var b=y=y.next;do{if((b.tag&i)===i){var I=b.destroy;b.destroy=void 0,I!==void 0&&Wm(a,h,I)}b=b.next}while(b!==y)}}function pp(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&i)===i){var y=h.create;h.destroy=y()}h=h.next}while(h!==a)}}function Xm(i){var a=i.ref;if(a!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof a=="function"?a(i):a.current=i}}function V0(i){var a=i.alternate;a!==null&&(i.alternate=null,V0(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[ns],delete a[$c],delete a[Rm],delete a[G2],delete a[H2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function U0(i){return i.tag===5||i.tag===3||i.tag===4}function Dv(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||U0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Km(i,a,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,a?h.nodeType===8?h.parentNode.insertBefore(i,a):h.insertBefore(i,a):(h.nodeType===8?(a=h.parentNode,a.insertBefore(i,h)):(a=h,a.appendChild(i)),h=h._reactRootContainer,h!=null||a.onclick!==null||(a.onclick=jd));else if(y!==4&&(i=i.child,i!==null))for(Km(i,a,h),i=i.sibling;i!==null;)Km(i,a,h),i=i.sibling}function Jm(i,a,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,a?h.insertBefore(i,a):h.appendChild(i);else if(y!==4&&(i=i.child,i!==null))for(Jm(i,a,h),i=i.sibling;i!==null;)Jm(i,a,h),i=i.sibling}var Kr=null,On=!1;function _a(i,a,h){for(h=h.child;h!==null;)$0(i,a,h),h=h.sibling}function $0(i,a,h){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(sp,h)}catch{}switch(h.tag){case 5:pi||Nl(h,a);case 6:var y=Kr,b=On;Kr=null,_a(i,a,h),Kr=y,On=b,Kr!==null&&(On?(i=Kr,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):Kr.removeChild(h.stateNode));break;case 18:Kr!==null&&(On?(i=Kr,h=h.stateNode,i.nodeType===8?Yf(i.parentNode,h):i.nodeType===1&&Yf(i,h),Oc(i)):Yf(Kr,h.stateNode));break;case 4:y=Kr,b=On,Kr=h.stateNode.containerInfo,On=!0,_a(i,a,h),Kr=y,On=b;break;case 0:case 11:case 14:case 15:if(!pi&&(y=h.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){b=y=y.next;do{var I=b,S=I.destroy;I=I.tag,S!==void 0&&(I&2||I&4)&&Wm(h,a,S),b=b.next}while(b!==y)}_a(i,a,h);break;case 1:if(!pi&&(Nl(h,a),y=h.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=h.memoizedProps,y.state=h.memoizedState,y.componentWillUnmount()}catch(d){_r(h,a,d)}_a(i,a,h);break;case 21:_a(i,a,h);break;case 22:h.mode&1?(pi=(y=pi)||h.memoizedState!==null,_a(i,a,h),pi=y):_a(i,a,h);break;default:_a(i,a,h)}}function Lv(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new uS),a.forEach(function(y){var b=vS.bind(null,i,y);h.has(y)||(h.add(y),y.then(b,b))})}}function Fn(i,a){var h=a.deletions;if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];try{var I=i,S=a,d=S;e:for(;d!==null;){switch(d.tag){case 5:Kr=d.stateNode,On=!1;break e;case 3:Kr=d.stateNode.containerInfo,On=!0;break e;case 4:Kr=d.stateNode.containerInfo,On=!0;break e}d=d.return}if(Kr===null)throw Error(Ce(160));$0(I,S,b),Kr=null,On=!1;var $=b.alternate;$!==null&&($.return=null),b.return=null}catch(ue){_r(b,a,ue)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)Z0(a,i),a=a.sibling}function Z0(i,a){var h=i.alternate,y=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Fn(a,i),rs(i),y&4){try{Ac(3,i,i.return),pp(3,i)}catch(Pe){_r(i,i.return,Pe)}try{Ac(5,i,i.return)}catch(Pe){_r(i,i.return,Pe)}}break;case 1:Fn(a,i),rs(i),y&512&&h!==null&&Nl(h,h.return);break;case 5:if(Fn(a,i),rs(i),y&512&&h!==null&&Nl(h,h.return),i.flags&32){var b=i.stateNode;try{Lc(b,"")}catch(Pe){_r(i,i.return,Pe)}}if(y&4&&(b=i.stateNode,b!=null)){var I=i.memoizedProps,S=h!==null?h.memoizedProps:I,d=i.type,$=i.updateQueue;if(i.updateQueue=null,$!==null)try{d==="input"&&I.type==="radio"&&I.name!=null&&dx(b,I),wm(d,S);var ue=wm(d,I);for(S=0;S<$.length;S+=2){var xe=$[S],ae=$[S+1];xe==="style"?yx(b,ae):xe==="dangerouslySetInnerHTML"?mx(b,ae):xe==="children"?Lc(b,ae):lg(b,xe,ae,ue)}switch(d){case"input":gm(b,I);break;case"textarea":px(b,I);break;case"select":var U=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!I.multiple;var ze=I.value;ze!=null?Vl(b,!!I.multiple,ze,!1):U!==!!I.multiple&&(I.defaultValue!=null?Vl(b,!!I.multiple,I.defaultValue,!0):Vl(b,!!I.multiple,I.multiple?[]:"",!1))}b[$c]=I}catch(Pe){_r(i,i.return,Pe)}}break;case 6:if(Fn(a,i),rs(i),y&4){if(i.stateNode===null)throw Error(Ce(162));b=i.stateNode,I=i.memoizedProps;try{b.nodeValue=I}catch(Pe){_r(i,i.return,Pe)}}break;case 3:if(Fn(a,i),rs(i),y&4&&h!==null&&h.memoizedState.isDehydrated)try{Oc(a.containerInfo)}catch(Pe){_r(i,i.return,Pe)}break;case 4:Fn(a,i),rs(i);break;case 13:Fn(a,i),rs(i),b=i.child,b.flags&8192&&(I=b.memoizedState!==null,b.stateNode.isHidden=I,!I||b.alternate!==null&&b.alternate.memoizedState!==null||(Vg=xr())),y&4&&Lv(i);break;case 22:if(xe=h!==null&&h.memoizedState!==null,i.mode&1?(pi=(ue=pi)||xe,Fn(a,i),pi=ue):Fn(a,i),rs(i),y&8192){if(ue=i.memoizedState!==null,(i.stateNode.isHidden=ue)&&!xe&&i.mode&1)for(tt=i,xe=i.child;xe!==null;){for(ae=tt=xe;tt!==null;){switch(U=tt,ze=U.child,U.tag){case 0:case 11:case 14:case 15:Ac(4,U,U.return);break;case 1:Nl(U,U.return);var Be=U.stateNode;if(typeof Be.componentWillUnmount=="function"){y=U,h=U.return;try{a=y,Be.props=a.memoizedProps,Be.state=a.memoizedState,Be.componentWillUnmount()}catch(Pe){_r(y,h,Pe)}}break;case 5:Nl(U,U.return);break;case 22:if(U.memoizedState!==null){Fv(ae);continue}}ze!==null?(ze.return=U,tt=ze):Fv(ae)}xe=xe.sibling}e:for(xe=null,ae=i;;){if(ae.tag===5){if(xe===null){xe=ae;try{b=ae.stateNode,ue?(I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(d=ae.stateNode,$=ae.memoizedProps.style,S=$!=null&&$.hasOwnProperty("display")?$.display:null,d.style.display=gx("display",S))}catch(Pe){_r(i,i.return,Pe)}}}else if(ae.tag===6){if(xe===null)try{ae.stateNode.nodeValue=ue?"":ae.memoizedProps}catch(Pe){_r(i,i.return,Pe)}}else if((ae.tag!==22&&ae.tag!==23||ae.memoizedState===null||ae===i)&&ae.child!==null){ae.child.return=ae,ae=ae.child;continue}if(ae===i)break e;for(;ae.sibling===null;){if(ae.return===null||ae.return===i)break e;xe===ae&&(xe=null),ae=ae.return}xe===ae&&(xe=null),ae.sibling.return=ae.return,ae=ae.sibling}}break;case 19:Fn(a,i),rs(i),y&4&&Lv(i);break;case 21:break;default:Fn(a,i),rs(i)}}function rs(i){var a=i.flags;if(a&2){try{e:{for(var h=i.return;h!==null;){if(U0(h)){var y=h;break e}h=h.return}throw Error(Ce(160))}switch(y.tag){case 5:var b=y.stateNode;y.flags&32&&(Lc(b,""),y.flags&=-33);var I=Dv(i);Jm(i,I,b);break;case 3:case 4:var S=y.stateNode.containerInfo,d=Dv(i);Km(i,d,S);break;default:throw Error(Ce(161))}}catch($){_r(i,i.return,$)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function hS(i,a,h){tt=i,q0(i)}function q0(i,a,h){for(var y=(i.mode&1)!==0;tt!==null;){var b=tt,I=b.child;if(b.tag===22&&y){var S=b.memoizedState!==null||yd;if(!S){var d=b.alternate,$=d!==null&&d.memoizedState!==null||pi;d=yd;var ue=pi;if(yd=S,(pi=$)&&!ue)for(tt=b;tt!==null;)S=tt,$=S.child,S.tag===22&&S.memoizedState!==null?Bv(b):$!==null?($.return=S,tt=$):Bv(b);for(;I!==null;)tt=I,q0(I),I=I.sibling;tt=b,yd=d,pi=ue}Rv(i)}else b.subtreeFlags&8772&&I!==null?(I.return=b,tt=I):Rv(i)}}function Rv(i){for(;tt!==null;){var a=tt;if(a.flags&8772){var h=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:pi||pp(5,a);break;case 1:var y=a.stateNode;if(a.flags&4&&!pi)if(h===null)y.componentDidMount();else{var b=a.elementType===a.type?h.memoizedProps:Bn(a.type,h.memoizedProps);y.componentDidUpdate(b,h.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var I=a.updateQueue;I!==null&&vv(a,I,y);break;case 3:var S=a.updateQueue;if(S!==null){if(h=null,a.child!==null)switch(a.child.tag){case 5:h=a.child.stateNode;break;case 1:h=a.child.stateNode}vv(a,S,h)}break;case 5:var d=a.stateNode;if(h===null&&a.flags&4){h=d;var $=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":$.autoFocus&&h.focus();break;case"img":$.src&&(h.src=$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var ue=a.alternate;if(ue!==null){var xe=ue.memoizedState;if(xe!==null){var ae=xe.dehydrated;ae!==null&&Oc(ae)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}pi||a.flags&512&&Xm(a)}catch(U){_r(a,a.return,U)}}if(a===i){tt=null;break}if(h=a.sibling,h!==null){h.return=a.return,tt=h;break}tt=a.return}}function Fv(i){for(;tt!==null;){var a=tt;if(a===i){tt=null;break}var h=a.sibling;if(h!==null){h.return=a.return,tt=h;break}tt=a.return}}function Bv(i){for(;tt!==null;){var a=tt;try{switch(a.tag){case 0:case 11:case 15:var h=a.return;try{pp(4,a)}catch($){_r(a,h,$)}break;case 1:var y=a.stateNode;if(typeof y.componentDidMount=="function"){var b=a.return;try{y.componentDidMount()}catch($){_r(a,b,$)}}var I=a.return;try{Xm(a)}catch($){_r(a,I,$)}break;case 5:var S=a.return;try{Xm(a)}catch($){_r(a,S,$)}}}catch($){_r(a,a.return,$)}if(a===i){tt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,tt=d;break}tt=a.return}}var dS=Math.ceil,Jd=Fs.ReactCurrentDispatcher,Ng=Fs.ReactCurrentOwner,Tn=Fs.ReactCurrentBatchConfig,Rt=0,$r=null,Cr=null,Jr=0,nn=0,jl=Ba(0),zr=0,Xc=null,Po=0,fp=0,jg=0,Mc=null,Fi=null,Vg=0,Ql=1/0,Cs=null,Yd=!1,Ym=null,Ma=null,_d=!1,ka=null,Qd=0,zc=0,Qm=null,Ed=-1,Ad=0;function ki(){return Rt&6?xr():Ed!==-1?Ed:Ed=xr()}function za(i){return i.mode&1?Rt&2&&Jr!==0?Jr&-Jr:X2.transition!==null?(Ad===0&&(Ad=Ex()),Ad):(i=qt,i!==0||(i=window.event,i=i===void 0?16:Fx(i.type)),i):1}function Vn(i,a,h,y){if(50<zc)throw zc=0,Qm=null,Error(Ce(185));Jc(i,h,y),(!(Rt&2)||i!==$r)&&(i===$r&&(!(Rt&2)&&(fp|=h),zr===4&&ba(i,Jr)),ji(i,y),h===1&&Rt===0&&!(a.mode&1)&&(Ql=xr()+500,cp&&Oa()))}function ji(i,a){var h=i.callbackNode;Xb(i,a);var y=Fd(i,i===$r?Jr:0);if(y===0)h!==null&&G_(h),i.callbackNode=null,i.callbackPriority=0;else if(a=y&-y,i.callbackPriority!==a){if(h!=null&&G_(h),a===1)i.tag===0?W2(Ov.bind(null,i)):t0(Ov.bind(null,i)),Z2(function(){!(Rt&6)&&Oa()}),h=null;else{switch(Ax(y)){case 1:h=pg;break;case 4:h=Cx;break;case 16:h=Rd;break;case 536870912:h=Px;break;default:h=Rd}h=Q0(h,G0.bind(null,i))}i.callbackPriority=a,i.callbackNode=h}}function G0(i,a){if(Ed=-1,Ad=0,Rt&6)throw Error(Ce(327));var h=i.callbackNode;if(Gl()&&i.callbackNode!==h)return null;var y=Fd(i,i===$r?Jr:0);if(y===0)return null;if(y&30||y&i.expiredLanes||a)a=ep(i,y);else{a=y;var b=Rt;Rt|=2;var I=W0();($r!==i||Jr!==a)&&(Cs=null,Ql=xr()+500,So(i,a));do try{mS();break}catch(d){H0(i,d)}while(!0);Ig(),Jd.current=I,Rt=b,Cr!==null?a=0:($r=null,Jr=0,a=zr)}if(a!==0){if(a===2&&(b=Im(i),b!==0&&(y=b,a=eg(i,b))),a===1)throw h=Xc,So(i,0),ba(i,y),ji(i,xr()),h;if(a===6)ba(i,y);else{if(b=i.current.alternate,!(y&30)&&!pS(b)&&(a=ep(i,y),a===2&&(I=Im(i),I!==0&&(y=I,a=eg(i,I))),a===1))throw h=Xc,So(i,0),ba(i,y),ji(i,xr()),h;switch(i.finishedWork=b,i.finishedLanes=y,a){case 0:case 1:throw Error(Ce(345));case 2:vo(i,Fi,Cs);break;case 3:if(ba(i,y),(y&130023424)===y&&(a=Vg+500-xr(),10<a)){if(Fd(i,0)!==0)break;if(b=i.suspendedLanes,(b&y)!==y){ki(),i.pingedLanes|=i.suspendedLanes&b;break}i.timeoutHandle=Lm(vo.bind(null,i,Fi,Cs),a);break}vo(i,Fi,Cs);break;case 4:if(ba(i,y),(y&4194240)===y)break;for(a=i.eventTimes,b=-1;0<y;){var S=31-jn(y);I=1<<S,S=a[S],S>b&&(b=S),y&=~I}if(y=b,y=xr()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*dS(y/1960))-y,10<y){i.timeoutHandle=Lm(vo.bind(null,i,Fi,Cs),y);break}vo(i,Fi,Cs);break;case 5:vo(i,Fi,Cs);break;default:throw Error(Ce(329))}}}return ji(i,xr()),i.callbackNode===h?G0.bind(null,i):null}function eg(i,a){var h=Mc;return i.current.memoizedState.isDehydrated&&(So(i,a).flags|=256),i=ep(i,a),i!==2&&(a=Fi,Fi=h,a!==null&&tg(a)),i}function tg(i){Fi===null?Fi=i:Fi.push.apply(Fi,i)}function pS(i){for(var a=i;;){if(a.flags&16384){var h=a.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var y=0;y<h.length;y++){var b=h[y],I=b.getSnapshot;b=b.value;try{if(!Un(I(),b))return!1}catch{return!1}}}if(h=a.child,a.subtreeFlags&16384&&h!==null)h.return=a,a=h;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ba(i,a){for(a&=~jg,a&=~fp,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var h=31-jn(a),y=1<<h;i[h]=-1,a&=~y}}function Ov(i){if(Rt&6)throw Error(Ce(327));Gl();var a=Fd(i,0);if(!(a&1))return ji(i,xr()),null;var h=ep(i,a);if(i.tag!==0&&h===2){var y=Im(i);y!==0&&(a=y,h=eg(i,y))}if(h===1)throw h=Xc,So(i,0),ba(i,a),ji(i,xr()),h;if(h===6)throw Error(Ce(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,vo(i,Fi,Cs),ji(i,xr()),null}function Ug(i,a){var h=Rt;Rt|=1;try{return i(a)}finally{Rt=h,Rt===0&&(Ql=xr()+500,cp&&Oa())}}function Eo(i){ka!==null&&ka.tag===0&&!(Rt&6)&&Gl();var a=Rt;Rt|=1;var h=Tn.transition,y=qt;try{if(Tn.transition=null,qt=1,i)return i()}finally{qt=y,Tn.transition=h,Rt=a,!(Rt&6)&&Oa()}}function $g(){nn=jl.current,nr(jl)}function So(i,a){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,$2(h)),Cr!==null)for(h=Cr.return;h!==null;){var y=h;switch(Sg(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&Vd();break;case 3:Jl(),nr(Oi),nr(fi),zg();break;case 5:Mg(y);break;case 4:Jl();break;case 13:nr(dr);break;case 19:nr(dr);break;case 10:Cg(y.type._context);break;case 22:case 23:$g()}h=h.return}if($r=i,Cr=i=Da(i.current,null),Jr=nn=a,zr=0,Xc=null,jg=fp=Po=0,Fi=Mc=null,wo!==null){for(a=0;a<wo.length;a++)if(h=wo[a],y=h.interleaved,y!==null){h.interleaved=null;var b=y.next,I=h.pending;if(I!==null){var S=I.next;I.next=b,y.next=S}h.pending=y}wo=null}return i}function H0(i,a){do{var h=Cr;try{if(Ig(),Id.current=Kd,Xd){for(var y=pr.memoizedState;y!==null;){var b=y.queue;b!==null&&(b.pending=null),y=y.next}Xd=!1}if(Co=0,Ur=Mr=pr=null,Ec=!1,Gc=0,Ng.current=null,h===null||h.return===null){zr=1,Xc=a,Cr=null;break}e:{var I=i,S=h.return,d=h,$=a;if(a=Jr,d.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){var ue=$,xe=d,ae=xe.tag;if(!(xe.mode&1)&&(ae===0||ae===11||ae===15)){var U=xe.alternate;U?(xe.updateQueue=U.updateQueue,xe.memoizedState=U.memoizedState,xe.lanes=U.lanes):(xe.updateQueue=null,xe.memoizedState=null)}var ze=Tv(S);if(ze!==null){ze.flags&=-257,Iv(ze,S,d,I,a),ze.mode&1&&kv(I,ue,a),a=ze,$=ue;var Be=a.updateQueue;if(Be===null){var Pe=new Set;Pe.add($),a.updateQueue=Pe}else Be.add($);break e}else{if(!(a&1)){kv(I,ue,a),Zg();break e}$=Error(Ce(426))}}else if(ur&&d.mode&1){var Tt=Tv(S);if(Tt!==null){!(Tt.flags&65536)&&(Tt.flags|=256),Iv(Tt,S,d,I,a),kg(Yl($,d));break e}}I=$=Yl($,d),zr!==4&&(zr=2),Mc===null?Mc=[I]:Mc.push(I),I=S;do{switch(I.tag){case 3:I.flags|=65536,a&=-a,I.lanes|=a;var re=A0(I,$,a);_v(I,re);break e;case 1:d=$;var Q=I.type,le=I.stateNode;if(!(I.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(Ma===null||!Ma.has(le)))){I.flags|=65536,a&=-a,I.lanes|=a;var ke=M0(I,d,a);_v(I,ke);break e}}I=I.return}while(I!==null)}K0(h)}catch(Oe){a=Oe,Cr===h&&h!==null&&(Cr=h=h.return);continue}break}while(!0)}function W0(){var i=Jd.current;return Jd.current=Kd,i===null?Kd:i}function Zg(){(zr===0||zr===3||zr===2)&&(zr=4),$r===null||!(Po&268435455)&&!(fp&268435455)||ba($r,Jr)}function ep(i,a){var h=Rt;Rt|=2;var y=W0();($r!==i||Jr!==a)&&(Cs=null,So(i,a));do try{fS();break}catch(b){H0(i,b)}while(!0);if(Ig(),Rt=h,Jd.current=y,Cr!==null)throw Error(Ce(261));return $r=null,Jr=0,zr}function fS(){for(;Cr!==null;)X0(Cr)}function mS(){for(;Cr!==null&&!jb();)X0(Cr)}function X0(i){var a=Y0(i.alternate,i,nn);i.memoizedProps=i.pendingProps,a===null?K0(i):Cr=a,Ng.current=null}function K0(i){var a=i;do{var h=a.alternate;if(i=a.return,a.flags&32768){if(h=lS(h,a),h!==null){h.flags&=32767,Cr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{zr=6,Cr=null;return}}else if(h=oS(h,a,nn),h!==null){Cr=h;return}if(a=a.sibling,a!==null){Cr=a;return}Cr=a=i}while(a!==null);zr===0&&(zr=5)}function vo(i,a,h){var y=qt,b=Tn.transition;try{Tn.transition=null,qt=1,gS(i,a,h,y)}finally{Tn.transition=b,qt=y}return null}function gS(i,a,h,y){do Gl();while(ka!==null);if(Rt&6)throw Error(Ce(327));h=i.finishedWork;var b=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Ce(177));i.callbackNode=null,i.callbackPriority=0;var I=h.lanes|h.childLanes;if(Kb(i,I),i===$r&&(Cr=$r=null,Jr=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||_d||(_d=!0,Q0(Rd,function(){return Gl(),null})),I=(h.flags&15990)!==0,h.subtreeFlags&15990||I){I=Tn.transition,Tn.transition=null;var S=qt;qt=1;var d=Rt;Rt|=4,Ng.current=null,cS(i,h),Z0(h,i),F2(zm),Bd=!!Mm,zm=Mm=null,i.current=h,hS(h),Vb(),Rt=d,qt=S,Tn.transition=I}else i.current=h;if(_d&&(_d=!1,ka=i,Qd=b),I=i.pendingLanes,I===0&&(Ma=null),Zb(h.stateNode),ji(i,xr()),a!==null)for(y=i.onRecoverableError,h=0;h<a.length;h++)b=a[h],y(b.value,{componentStack:b.stack,digest:b.digest});if(Yd)throw Yd=!1,i=Ym,Ym=null,i;return Qd&1&&i.tag!==0&&Gl(),I=i.pendingLanes,I&1?i===Qm?zc++:(zc=0,Qm=i):zc=0,Oa(),null}function Gl(){if(ka!==null){var i=Ax(Qd),a=Tn.transition,h=qt;try{if(Tn.transition=null,qt=16>i?16:i,ka===null)var y=!1;else{if(i=ka,ka=null,Qd=0,Rt&6)throw Error(Ce(331));var b=Rt;for(Rt|=4,tt=i.current;tt!==null;){var I=tt,S=I.child;if(tt.flags&16){var d=I.deletions;if(d!==null){for(var $=0;$<d.length;$++){var ue=d[$];for(tt=ue;tt!==null;){var xe=tt;switch(xe.tag){case 0:case 11:case 15:Ac(8,xe,I)}var ae=xe.child;if(ae!==null)ae.return=xe,tt=ae;else for(;tt!==null;){xe=tt;var U=xe.sibling,ze=xe.return;if(V0(xe),xe===ue){tt=null;break}if(U!==null){U.return=ze,tt=U;break}tt=ze}}}var Be=I.alternate;if(Be!==null){var Pe=Be.child;if(Pe!==null){Be.child=null;do{var Tt=Pe.sibling;Pe.sibling=null,Pe=Tt}while(Pe!==null)}}tt=I}}if(I.subtreeFlags&2064&&S!==null)S.return=I,tt=S;else e:for(;tt!==null;){if(I=tt,I.flags&2048)switch(I.tag){case 0:case 11:case 15:Ac(9,I,I.return)}var re=I.sibling;if(re!==null){re.return=I.return,tt=re;break e}tt=I.return}}var Q=i.current;for(tt=Q;tt!==null;){S=tt;var le=S.child;if(S.subtreeFlags&2064&&le!==null)le.return=S,tt=le;else e:for(S=Q;tt!==null;){if(d=tt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:pp(9,d)}}catch(Oe){_r(d,d.return,Oe)}if(d===S){tt=null;break e}var ke=d.sibling;if(ke!==null){ke.return=d.return,tt=ke;break e}tt=d.return}}if(Rt=b,Oa(),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(sp,i)}catch{}y=!0}return y}finally{qt=h,Tn.transition=a}}return!1}function Nv(i,a,h){a=Yl(h,a),a=A0(i,a,1),i=Aa(i,a,1),a=ki(),i!==null&&(Jc(i,1,a),ji(i,a))}function _r(i,a,h){if(i.tag===3)Nv(i,i,h);else for(;a!==null;){if(a.tag===3){Nv(a,i,h);break}else if(a.tag===1){var y=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(Ma===null||!Ma.has(y))){i=Yl(h,i),i=M0(a,i,1),a=Aa(a,i,1),i=ki(),a!==null&&(Jc(a,1,i),ji(a,i));break}}a=a.return}}function yS(i,a,h){var y=i.pingCache;y!==null&&y.delete(a),a=ki(),i.pingedLanes|=i.suspendedLanes&h,$r===i&&(Jr&h)===h&&(zr===4||zr===3&&(Jr&130023424)===Jr&&500>xr()-Vg?So(i,0):jg|=h),ji(i,a)}function J0(i,a){a===0&&(i.mode&1?(a=ld,ld<<=1,!(ld&130023424)&&(ld=4194304)):a=1);var h=ki();i=Ls(i,a),i!==null&&(Jc(i,a,h),ji(i,h))}function _S(i){var a=i.memoizedState,h=0;a!==null&&(h=a.retryLane),J0(i,h)}function vS(i,a){var h=0;switch(i.tag){case 13:var y=i.stateNode,b=i.memoizedState;b!==null&&(h=b.retryLane);break;case 19:y=i.stateNode;break;default:throw Error(Ce(314))}y!==null&&y.delete(a),J0(i,h)}var Y0;Y0=function(i,a,h){if(i!==null)if(i.memoizedProps!==a.pendingProps||Oi.current)Bi=!0;else{if(!(i.lanes&h)&&!(a.flags&128))return Bi=!1,aS(i,a,h);Bi=!!(i.flags&131072)}else Bi=!1,ur&&a.flags&1048576&&r0(a,Zd,a.index);switch(a.lanes=0,a.tag){case 2:var y=a.type;Pd(i,a),i=a.pendingProps;var b=Wl(a,fi.current);ql(a,h),b=Lg(null,a,y,i,b,h);var I=Rg();return a.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,Ni(y)?(I=!0,Ud(a)):I=!1,a.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,Eg(a),b.updater=dp,a.stateNode=b,b._reactInternals=a,Vm(a,y,i,h),a=Zm(null,a,y,!0,I,h)):(a.tag=0,ur&&I&&bg(a),Si(null,a,b,h),a=a.child),a;case 16:y=a.elementType;e:{switch(Pd(i,a),i=a.pendingProps,b=y._init,y=b(y._payload),a.type=y,b=a.tag=wS(y),i=Bn(y,i),b){case 0:a=$m(null,a,y,i,h);break e;case 1:a=Ev(null,a,y,i,h);break e;case 11:a=Cv(null,a,y,i,h);break e;case 14:a=Pv(null,a,y,Bn(y.type,i),h);break e}throw Error(Ce(306,y,""))}return a;case 0:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Bn(y,b),$m(i,a,y,b,h);case 1:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Bn(y,b),Ev(i,a,y,b,h);case 3:e:{if(R0(a),i===null)throw Error(Ce(387));y=a.pendingProps,I=a.memoizedState,b=I.element,l0(i,a),Hd(a,y,null,h);var S=a.memoizedState;if(y=S.element,I.isDehydrated)if(I={element:y,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},a.updateQueue.baseState=I,a.memoizedState=I,a.flags&256){b=Yl(Error(Ce(423)),a),a=Av(i,a,y,h,b);break e}else if(y!==b){b=Yl(Error(Ce(424)),a),a=Av(i,a,y,h,b);break e}else for(sn=Ea(a.stateNode.containerInfo.firstChild),an=a,ur=!0,Nn=null,h=a0(a,null,y,h),a.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Xl(),y===b){a=Rs(i,a,h);break e}Si(i,a,y,h)}a=a.child}return a;case 5:return u0(a),i===null&&Om(a),y=a.type,b=a.pendingProps,I=i!==null?i.memoizedProps:null,S=b.children,Dm(y,b)?S=null:I!==null&&Dm(y,I)&&(a.flags|=32),L0(i,a),Si(i,a,S,h),a.child;case 6:return i===null&&Om(a),null;case 13:return F0(i,a,h);case 4:return Ag(a,a.stateNode.containerInfo),y=a.pendingProps,i===null?a.child=Kl(a,null,y,h):Si(i,a,y,h),a.child;case 11:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Bn(y,b),Cv(i,a,y,b,h);case 7:return Si(i,a,a.pendingProps,h),a.child;case 8:return Si(i,a,a.pendingProps.children,h),a.child;case 12:return Si(i,a,a.pendingProps.children,h),a.child;case 10:e:{if(y=a.type._context,b=a.pendingProps,I=a.memoizedProps,S=b.value,Yt(qd,y._currentValue),y._currentValue=S,I!==null)if(Un(I.value,S)){if(I.children===b.children&&!Oi.current){a=Rs(i,a,h);break e}}else for(I=a.child,I!==null&&(I.return=a);I!==null;){var d=I.dependencies;if(d!==null){S=I.child;for(var $=d.firstContext;$!==null;){if($.context===y){if(I.tag===1){$=Ms(-1,h&-h),$.tag=2;var ue=I.updateQueue;if(ue!==null){ue=ue.shared;var xe=ue.pending;xe===null?$.next=$:($.next=xe.next,xe.next=$),ue.pending=$}}I.lanes|=h,$=I.alternate,$!==null&&($.lanes|=h),Nm(I.return,h,a),d.lanes|=h;break}$=$.next}}else if(I.tag===10)S=I.type===a.type?null:I.child;else if(I.tag===18){if(S=I.return,S===null)throw Error(Ce(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),Nm(S,h,a),S=I.sibling}else S=I.child;if(S!==null)S.return=I;else for(S=I;S!==null;){if(S===a){S=null;break}if(I=S.sibling,I!==null){I.return=S.return,S=I;break}S=S.return}I=S}Si(i,a,b.children,h),a=a.child}return a;case 9:return b=a.type,y=a.pendingProps.children,ql(a,h),b=In(b),y=y(b),a.flags|=1,Si(i,a,y,h),a.child;case 14:return y=a.type,b=Bn(y,a.pendingProps),b=Bn(y.type,b),Pv(i,a,y,b,h);case 15:return z0(i,a,a.type,a.pendingProps,h);case 17:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:Bn(y,b),Pd(i,a),a.tag=1,Ni(y)?(i=!0,Ud(a)):i=!1,ql(a,h),E0(a,y,b),Vm(a,y,b,h),Zm(null,a,y,!0,i,h);case 19:return B0(i,a,h);case 22:return D0(i,a,h)}throw Error(Ce(156,a.tag))};function Q0(i,a){return Ix(i,a)}function xS(i,a,h,y){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(i,a,h,y){return new xS(i,a,h,y)}function qg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function wS(i){if(typeof i=="function")return qg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===cg)return 11;if(i===hg)return 14}return 2}function Da(i,a){var h=i.alternate;return h===null?(h=kn(i.tag,a,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=a,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,a=i.dependencies,h.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Md(i,a,h,y,b,I){var S=2;if(y=i,typeof i=="function")qg(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case Al:return ko(h.children,b,I,a);case ug:S=8,b|=8;break;case hm:return i=kn(12,h,a,b|2),i.elementType=hm,i.lanes=I,i;case dm:return i=kn(13,h,a,b),i.elementType=dm,i.lanes=I,i;case pm:return i=kn(19,h,a,b),i.elementType=pm,i.lanes=I,i;case ux:return mp(h,b,I,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ox:S=10;break e;case lx:S=9;break e;case cg:S=11;break e;case hg:S=14;break e;case va:S=16,y=null;break e}throw Error(Ce(130,i==null?i:typeof i,""))}return a=kn(S,h,a,b),a.elementType=i,a.type=y,a.lanes=I,a}function ko(i,a,h,y){return i=kn(7,i,y,a),i.lanes=h,i}function mp(i,a,h,y){return i=kn(22,i,y,a),i.elementType=ux,i.lanes=h,i.stateNode={isHidden:!1},i}function am(i,a,h){return i=kn(6,i,null,a),i.lanes=h,i}function om(i,a,h){return a=kn(4,i.children!==null?i.children:[],i.key,a),a.lanes=h,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function bS(i,a,h,y,b){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vf(0),this.expirationTimes=Vf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vf(0),this.identifierPrefix=y,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Gg(i,a,h,y,b,I,S,d,$){return i=new bS(i,a,h,d,$),a===1?(a=1,I===!0&&(a|=8)):a=0,I=kn(3,null,null,a),i.current=I,I.stateNode=i,I.memoizedState={element:y,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Eg(I),i}function SS(i,a,h){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:El,key:y==null?null:""+y,children:i,containerInfo:a,implementation:h}}function e1(i){if(!i)return Ra;i=i._reactInternals;e:{if(Mo(i)!==i||i.tag!==1)throw Error(Ce(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(Ni(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Ce(171))}if(i.tag===1){var h=i.type;if(Ni(h))return e0(i,h,a)}return a}function t1(i,a,h,y,b,I,S,d,$){return i=Gg(h,y,!0,i,b,I,S,d,$),i.context=e1(null),h=i.current,y=ki(),b=za(h),I=Ms(y,b),I.callback=a??null,Aa(h,I,b),i.current.lanes=b,Jc(i,b,y),ji(i,y),i}function gp(i,a,h,y){var b=a.current,I=ki(),S=za(b);return h=e1(h),a.context===null?a.context=h:a.pendingContext=h,a=Ms(I,S),a.payload={element:i},y=y===void 0?null:y,y!==null&&(a.callback=y),i=Aa(b,a,S),i!==null&&(Vn(i,b,S,I),Td(i,b,S)),S}function tp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function jv(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<a?h:a}}function Hg(i,a){jv(i,a),(i=i.alternate)&&jv(i,a)}function kS(){return null}var r1=typeof reportError=="function"?reportError:function(i){console.error(i)};function Wg(i){this._internalRoot=i}yp.prototype.render=Wg.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(Ce(409));gp(i,a,null,null)};yp.prototype.unmount=Wg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Eo(function(){gp(null,i,null,null)}),a[Ds]=null}};function yp(i){this._internalRoot=i}yp.prototype.unstable_scheduleHydration=function(i){if(i){var a=Dx();i={blockedOn:null,target:i,priority:a};for(var h=0;h<wa.length&&a!==0&&a<wa[h].priority;h++);wa.splice(h,0,i),h===0&&Rx(i)}};function Xg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function _p(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Vv(){}function TS(i,a,h,y,b){if(b){if(typeof y=="function"){var I=y;y=function(){var ue=tp(S);I.call(ue)}}var S=t1(a,y,i,0,null,!1,!1,"",Vv);return i._reactRootContainer=S,i[Ds]=S.current,Vc(i.nodeType===8?i.parentNode:i),Eo(),S}for(;b=i.lastChild;)i.removeChild(b);if(typeof y=="function"){var d=y;y=function(){var ue=tp($);d.call(ue)}}var $=Gg(i,0,!1,null,null,!1,!1,"",Vv);return i._reactRootContainer=$,i[Ds]=$.current,Vc(i.nodeType===8?i.parentNode:i),Eo(function(){gp(a,$,h,y)}),$}function vp(i,a,h,y,b){var I=h._reactRootContainer;if(I){var S=I;if(typeof b=="function"){var d=b;b=function(){var $=tp(S);d.call($)}}gp(a,S,i,b)}else S=TS(h,a,i,b,y);return tp(S)}Mx=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var h=bc(a.pendingLanes);h!==0&&(fg(a,h|1),ji(a,xr()),!(Rt&6)&&(Ql=xr()+500,Oa()))}break;case 13:Eo(function(){var y=Ls(i,1);if(y!==null){var b=ki();Vn(y,i,1,b)}}),Hg(i,1)}};mg=function(i){if(i.tag===13){var a=Ls(i,134217728);if(a!==null){var h=ki();Vn(a,i,134217728,h)}Hg(i,134217728)}};zx=function(i){if(i.tag===13){var a=za(i),h=Ls(i,a);if(h!==null){var y=ki();Vn(h,i,a,y)}Hg(i,a)}};Dx=function(){return qt};Lx=function(i,a){var h=qt;try{return qt=i,a()}finally{qt=h}};Sm=function(i,a,h){switch(a){case"input":if(gm(i,h),a=h.name,h.type==="radio"&&a!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<h.length;a++){var y=h[a];if(y!==i&&y.form===i.form){var b=up(y);if(!b)throw Error(Ce(90));hx(y),gm(y,b)}}}break;case"textarea":px(i,h);break;case"select":a=h.value,a!=null&&Vl(i,!!h.multiple,a,!1)}};xx=Ug;wx=Eo;var IS={usingClientEntryPoint:!1,Events:[Qc,Ll,up,_x,vx,Ug]},vc={findFiberByHostInstance:xo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CS={bundleType:vc.bundleType,version:vc.version,rendererPackageName:vc.rendererPackageName,rendererConfig:vc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fs.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=kx(i),i===null?null:i.stateNode},findFiberByHostInstance:vc.findFiberByHostInstance||kS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vd.isDisabled&&vd.supportsFiber)try{sp=vd.inject(CS),ss=vd}catch{}}ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=IS;ln.createPortal=function(i,a){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xg(a))throw Error(Ce(200));return SS(i,a,null,h)};ln.createRoot=function(i,a){if(!Xg(i))throw Error(Ce(299));var h=!1,y="",b=r1;return a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(y=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=Gg(i,1,!1,null,null,h,!1,y,b),i[Ds]=a.current,Vc(i.nodeType===8?i.parentNode:i),new Wg(a)};ln.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(Ce(188)):(i=Object.keys(i).join(","),Error(Ce(268,i)));return i=kx(a),i=i===null?null:i.stateNode,i};ln.flushSync=function(i){return Eo(i)};ln.hydrate=function(i,a,h){if(!_p(a))throw Error(Ce(200));return vp(null,i,a,!0,h)};ln.hydrateRoot=function(i,a,h){if(!Xg(i))throw Error(Ce(405));var y=h!=null&&h.hydratedSources||null,b=!1,I="",S=r1;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),a=t1(a,null,i,1,h??null,b,!1,I,S),i[Ds]=a.current,Vc(i),y)for(i=0;i<y.length;i++)h=y[i],b=h._getVersion,b=b(h._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[h,b]:a.mutableSourceEagerHydrationData.push(h,b);return new yp(a)};ln.render=function(i,a,h){if(!_p(a))throw Error(Ce(200));return vp(null,i,a,!1,h)};ln.unmountComponentAtNode=function(i){if(!_p(i))throw Error(Ce(40));return i._reactRootContainer?(Eo(function(){vp(null,null,i,!1,function(){i._reactRootContainer=null,i[Ds]=null})}),!0):!1};ln.unstable_batchedUpdates=Ug;ln.unstable_renderSubtreeIntoContainer=function(i,a,h,y){if(!_p(h))throw Error(Ce(200));if(i==null||i._reactInternals===void 0)throw Error(Ce(38));return vp(i,a,h,!1,y)};ln.version="18.3.1-next-f1338f8080-20240426";function i1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i1)}catch(i){console.error(i)}}i1(),ix.exports=ln;var PS=ix.exports,Uv=PS;um.createRoot=Uv.createRoot,um.hydrateRoot=Uv.hydrateRoot;function ES(){const[i,a]=ir.useState(!1),[h,y]=ir.useState(!0),[b,I]=ir.useState(0),S=[],d="https://wa.me/66624290062",$="https://joinjoytravel.com/en";return ir.useEffect(()=>{const ue=()=>{window.scrollY>b?y(!1):y(!0),I(window.scrollY)};return window.addEventListener("scroll",ue),()=>window.removeEventListener("scroll",ue)},[b]),K.jsx("header",{className:`fixed inset-x-0 top-0 z-[50] border-b border-[#eee] bg-white transition-transform duration-300
      ${h?"translate-y-0":"-translate-y-full"}`,children:K.jsxs("div",{className:"section-shell flex h-[70px] items-center gap-2 sm:gap-3",children:[K.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-1",children:[K.jsx("img",{src:"/logo.png",alt:"JoinJoy Logo",className:"h-16 w-16 rounded-full object-contain"}),K.jsxs("div",{className:"leading-tight",children:[K.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#1877F2]",children:"JoinJoy"}),K.jsx("p",{className:"truncate text-lg font-semibold text-slate-900",children:"Journeys"})]})]}),K.jsx("nav",{className:"hidden flex-1 items-center justify-center gap-6 text-sm font-medium text-slate-700 md:flex lg:gap-8",children:S.map(ue=>K.jsx("a",{className:"transition hover:text-[#1877F2]",href:ue.href,children:ue.label},ue.href))}),K.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[K.jsx("a",{className:"inline-flex items-center rounded-xl bg-[#25D366] px-3 py-2 text-xs font-semibold text-white shadow-md shadow-[#25D366]/30 transition hover:scale-[1.01] hover:bg-[#22c05d] sm:px-4 sm:text-sm",href:d,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"}),K.jsx("button",{onClick:()=>window.location.href=$,className:"inline-flex rounded-xl bg-[#1877F2] px-3 py-2 text-xs font-semibold text-white shadow-md shadow-[#1877F2]/30 transition hover:scale-[1.01]",children:"Book with us"})]})]})})}function AS({boat:i}){const a=i.showRating!==!1,h=i.showCapacity!==!1,y=()=>{const b=[];for(let I=1;I<=5;I+=1){const S=i.rating>=I-.2,d=!S&&i.rating>=I-.7,$=S?"text-amber-500":"text-amber-200",ue=`star-${i.name.replace(/\s+/g,"-").toLowerCase()}-${I}`;b.push(K.jsxs("svg",{className:`h-4 w-4 ${$}`,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":!0,children:[d?K.jsx("defs",{children:K.jsxs("linearGradient",{id:ue,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[K.jsx("stop",{offset:"50%",stopColor:"currentColor"}),K.jsx("stop",{offset:"50%",stopColor:"rgb(252 211 77 / 0.35)"})]})}):null,K.jsx("path",{fill:d?`url(#${ue})`:"currentColor",d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.802 2.036a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.802-2.036a1 1 0 00-1.175 0l-2.802 2.036c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})]},I))}return b};return K.jsxs("article",{className:"card-surface h-full overflow-hidden",children:[K.jsxs("div",{className:"relative",children:[K.jsx("img",{className:`\r
    h-44 w-full object-cover\r
    brightness-110 contrast-105\r
    transition-transform duration-200 ease-out\r
    hover:scale-105\r
    active:scale-95\r
  `,src:i.image,alt:i.name,loading:"lazy"}),K.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/60 via-slate-900/10"}),K.jsx("div",{className:"absolute bottom-4 left-4 rounded-full bg-white/90 px-3 py-1 text-xs font-semibold text-[#1877F2] ring-1 ring-[#1877F2]/20",children:i.type})]}),K.jsxs("div",{className:"space-y-3 p-6",children:[K.jsxs("div",{className:"flex items-start justify-between gap-3",children:[K.jsxs("div",{className:"space-y-1",children:[K.jsx("h3",{className:"text-lg font-bold text-slate-900",children:i.name}),a&&K.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700","aria-label":`Rated ${i.rating.toFixed(1)} out of 5`,children:[K.jsx("div",{className:"flex items-center gap-1",children:y()}),K.jsx("span",{className:"font-semibold text-slate-900",children:i.rating.toFixed(1)})]}),h&&K.jsxs("p",{className:"text-sm text-slate-600",children:["Fits ",i.capacity," guests"]}),i.description&&K.jsx("p",{className:"text-sm text-slate-700 leading-relaxed whitespace-pre-line",children:i.description})]}),K.jsxs("div",{className:"text-right",children:[K.jsx("p",{className:"text-xs text-slate-500",children:"Starting from"}),K.jsxs("p",{className:"text-xl font-semibold text-[#1877F2]",children:["",i.price]})]})]}),K.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.map(b=>K.jsx("span",{className:"rounded-full bg-[#f0f6ff] px-3 py-1 text-xs font-semibold text-[#1877F2] ring-1 ring-[#1877F2]/20",children:b},b))}),K.jsx("button",{onClick:()=>window.location.href=i.link,className:"w-full rounded-xl bg-[#1877F2] px-4 py-2 text-sm font-semibold text-white shadow-md shadow-[#1877F2]/30 transition hover:scale-[1.01]",children:i.buttonLabel||"Book Now"})]})]})}function MS(){return K.jsx("footer",{className:"bg-gradient-to-b from-[#eaf3ff] to-[#f7f9fb] py-5",children:K.jsxs("div",{className:"section-shell flex flex-col items-center gap-3 text-center",children:[K.jsxs("a",{href:"/",className:"flex flex-col items-center gap-0",children:[K.jsx("img",{src:"/logo.png",alt:"JoinJoy Logo",className:"h-14 w-14 mix-blend-multiply"}),K.jsx("span",{className:"text-slate-800 font-semibold text-lg",children:"JoinJoy Krabi"})]}),K.jsxs("div",{className:"flex justify-center gap-6",children:[K.jsxs("a",{href:"https://www.instagram.com/joinjoy.travel/",target:"_blank",className:"flex flex-col items-center gap-1 hover:text-[#1877F2] transition text-slate-600",children:[K.jsxs("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",children:[K.jsx("rect",{x:"3",y:"3",width:"16",height:"16",rx:"4"}),K.jsx("circle",{cx:"11",cy:"11",r:"3"}),K.jsx("circle",{cx:"16",cy:"7",r:"1"})]}),K.jsx("span",{className:"text-sm",children:"Instagram"})]}),K.jsxs("a",{href:"https://www.facebook.com/Joinjoytravel",target:"_blank",className:"flex flex-col items-center gap-1 hover:text-[#1877F2] transition text-slate-600",children:[K.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"mx-auto",children:K.jsx("path",{d:"M12 2C6.486 2 2 6.486 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.99H8v-2.89h2.438V9.797c0-2.412 1.432-3.743 3.626-3.743 1.051 0 2.149.188 2.149.188v2.36h-1.212c-1.194 0-1.566.741-1.566 1.498v1.79H16.5l-.4 2.89h-2.099v6.99C18.343 21.128 22 16.991 22 12c0-5.514-4.486-10-10-10z"})}),K.jsx("span",{className:"text-sm",children:"Facebook"})]}),K.jsxs("a",{href:"https://www.tiktok.com/@joinjoytravel?lang=en",target:"_blank",className:"flex flex-col items-center gap-1 hover:text-[#1877F2] transition text-slate-600",children:[K.jsx("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:K.jsx("path",{d:"M14 3c.2 1.5 1.3 3 3 3.5v2.2c-1.3-.1-2.6-.6-3.7-1.3v5.4a4 4 0 1 1-4-4h1.2V6.5h-.2A6 6 0 1 0 14 12V3z"})}),K.jsx("span",{className:"text-sm",children:"TikTok"})]}),K.jsxs("a",{href:"https://joinjoytravel.com/pdf/Terms&Conditions-ENG.pdf",className:"flex flex-col items-center gap-1 hover:text-[#1877F2] transition text-slate-600",children:[K.jsxs("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",children:[K.jsx("path",{d:"M4 4h16v16H4z"}),K.jsx("path",{d:"M8 8h8M8 12h8M8 16h5"})]}),K.jsx("span",{className:"text-sm",children:"Terms"})]}),K.jsxs("a",{href:"https://joinjoytravel.com/pdf/PrivacyPolicy-ENG.pdf",className:"flex flex-col items-center gap-1 hover:text-[#1877F2] transition text-slate-600",children:[K.jsxs("svg",{width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",children:[K.jsx("path",{d:"M4 4h16v16H4z"}),K.jsx("path",{d:"M8 8h8M8 12h8M8 16h5"})]}),K.jsx("span",{className:"text-sm",children:"Policy"})]})]}),K.jsx("p",{className:"text-xs text-slate-400",children:" 2025 JoinJoy Travel"})]})})}var n1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,a){(function(h,y){i.exports=y()})(rb,function(){var h={},y={};function b(S,d,$){if(y[S]=$,S==="index"){var ue="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",xe={};return y.shared(xe),y.index(h,xe),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([ue],{type:"text/javascript"}))),h}}b("shared",["exports"],function(S){function d(r,t,n,o){return new(n||(n=Promise))(function(c,m){function g(T){try{x(o.next(T))}catch(C){m(C)}}function _(T){try{x(o.throw(T))}catch(C){m(C)}}function x(T){var C;T.done?c(T.value):(C=T.value,C instanceof n?C:new n(function(E){E(C)})).then(g,_)}x((o=o.apply(r,t||[])).next())})}function $(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ue=xe;function xe(r,t){this.x=r,this.y=t}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,t){var n=Math.cos(r),o=Math.sin(r),c=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(r){return r instanceof xe?r:Array.isArray(r)?new xe(r[0],r[1]):r};var ae=$(ue),U=ze;function ze(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}ze.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Be=$(U);let Pe,Tt;function re(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function Q(){if(Tt==null&&(Tt=!1,re())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const c=4*o;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){Tt=!0;break}}}return Tt||!1}function le(r,t,n,o){const c=new Be(r,t,n,o);return m=>c.solve(m)}const ke=le(.25,.1,.25,1);function Oe(r,t,n){return Math.min(n,Math.max(t,r))}function qe(r,t,n){const o=n-t,c=((r-t)%o+o)%o+t;return c===t?n:c}function He(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let it=1;function Dt(r,t,n){const o={};for(const c in r)o[c]=t.call(this,r[c],c,r);return o}function yt(r,t,n){const o={};for(const c in r)t.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function _t(r){return Array.isArray(r)?r.map(_t):typeof r=="object"&&r?Dt(r,_t):r}const cn={};function sr(r){cn[r]||(typeof console<"u"&&console.warn(r),cn[r]=!0)}function wr(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Vi(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let hn=null;function Qr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ct(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),x=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(x,function(T,C,E,z,R){const B=4*Math.max(-C,0),O=(Math.max(0,E)-E)*z*4+B,q=4*z,X=Math.max(0,C),pe=Math.max(0,E);return{rect:{x:X,y:pe,width:Math.min(T.width,C+z)-X,height:Math.min(T.height,E+R)-pe},layout:[{offset:O,stride:q}]}}(r,t,n,o,c)),_)for(let T=0;T<x.length;T+=4){const C=x[T];x[T]=x[T+2],x[T+2]=C}return x}finally{m.close()}})}let ht,kt;const Ft="AbortError";function Ui(){return new Error(Ft)}const Dr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ei(r){return Dr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const ti="global-dispatcher";class br extends Error{constructor(t,n,o,c){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=c}}const $i=()=>Vi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,os=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=ei(r.url);if(o)return o(r,t);if(Vi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:ti},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test($i())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return d(this,void 0,void 0,function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:$i(),signal:c.signal});o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const T=yield g.blob();throw new br(g.status,g.statusText,o.url,T)}let _;_=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const x=yield _;if(c.signal.aborted)throw Ui();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(Vi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:ti},t)}var n;return function(o,c){return new Promise((m,g)=>{var _;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(C){return void g(C)}m({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new br(x.status,x.statusText,o.url,T))}},c.signal.addEventListener("abort",()=>{x.abort(),g(Ui())}),x.send(o.body)})}(r,t)};function ls(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Na(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Pn(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class $n{constructor(t,n={}){He(this,n),this.type=t}}class Zn extends $n{constructor(t,n={}){super("error",He({error:t},n))}}class Bs{on(t,n){return this._listeners=this._listeners||{},Na(t,n,this._listeners),this}off(t,n){return Pn(t,n,this._listeners),Pn(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Na(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new $n(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of c)_.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of m)Pn(o,_,this._oneTimeListeners),_.call(this,t);const g=this._eventedParent;g&&(He(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Zn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const us=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ja(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return us.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Mt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Mt(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!Mt(r[n],t[n]))return!1;return!0}return r===t}function Qt(r,t){r.push(t)}function Va(r,t,n){Qt(n,{command:"addSource",args:[r,t[r]]})}function qn(r,t,n){Qt(t,{command:"removeSource",args:[r]}),n[r]=!0}function En(r,t,n,o){qn(r,n,o),Va(r,t,n)}function Os(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!Mt(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Mt(r[n][o],t[n][o]))return!1;return!0}function Ci(r,t,n,o,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(Mt(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(Mt(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}))}function Ua(r){return r.id}function $a(r,t){return r[t.id]=t,r}class Ie{constructor(t,n,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function dn(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class Zr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class pn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(t){return new pn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Gn={kind:"null"},De={kind:"number"},mt={kind:"string"},at={kind:"boolean"},ri={kind:"color"},Zi={kind:"object"},dt={kind:"value"},fn={kind:"collator"},An={kind:"formatted"},Hn={kind:"padding"},mn={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function L(r,t){return{kind:"array",itemType:r,N:t}}function D(r){if(r.kind==="array"){const t=D(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const N=[Gn,De,mt,at,ri,An,Zi,L(dt),Hn,mn,W];function G(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!G(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of N)if(!G(n,t))return null}}return`Expected ${D(r)} but found ${D(t)} instead.`}function ne(r,t){return t.some(n=>n.kind===r.kind)}function oe(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function de(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const ee=.96422,_e=.82521,be=4/29,me=6/29,Ee=3*me*me,et=me*me*me,rt=Math.PI/180,It=180/Math.PI;function pt(r){return(r%=360)<0&&(r+=360),r}function Ct([r,t,n,o]){let c,m;const g=mr((.2225045*(r=xt(r))+.7168786*(t=xt(t))+.0606169*(n=xt(n)))/1);r===t&&t===n?c=m=g:(c=mr((.4360747*r+.3850649*t+.1430804*n)/ee),m=mr((.0139322*r+.0971045*t+.7141733*n)/_e));const _=116*g-16;return[_<0?0:_,500*(c-g),200*(g-m),o]}function xt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function mr(r){return r>et?Math.pow(r,1/3):r/Ee+be}function er([r,t,n,o]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*Bt(c),m=ee*Bt(m),g=_e*Bt(g),[gt(3.1338561*m-1.6168667*c-.4906146*g),gt(-.9787684*m+1.9161415*c+.033454*g),gt(.0719453*m-.2289914*c+1.4052427*g),o]}function gt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Bt(r){return r>me?r*r*r:Ee*(r-be)}function Jt(r){return parseInt(r.padEnd(2,r),16)/255}function Sr(r,t){return Pr(t?r/100:r,0,1)}function Pr(r,t,n){return Math.min(Math.max(t,r),n)}function qr(r){return!r.some(Number.isNaN)}const Ns={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ot{constructor(t,n,o,c=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,o,c]))}static parse(t){if(t instanceof Ot)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Ns[o];if(c){const[g,_,x]=c;return[g/255,_/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let _=1;return[Jt(o.slice(_,_+=g)),Jt(o.slice(_,_+=g)),Jt(o.slice(_,_+=g)),Jt(o.slice(_,_+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,T,C,E,z,R,B,O,q,X,pe]=g,ie=[C||" ",R||" ",q].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const he=[T,z,O].join(""),ye=he==="%%%"?100:he===""?255:0;if(ye){const Se=[Pr(+x/ye,0,1),Pr(+E/ye,0,1),Pr(+B/ye,0,1),X?Sr(+X,pe):1];if(qr(Se))return Se}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,x,T,C,E,z,R,B]=m,O=[x||" ",C||" ",z].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const q=[+_,Pr(+T,0,100),Pr(+E,0,100),R?Sr(+R,B):1];if(qr(q))return function([X,pe,ie,he]){function ye(Se){const Ve=(Se+X/30)%12,nt=pe*Math.min(ie,1-ie);return ie-nt*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return X=pt(X),pe/=100,ie/=100,[ye(0),ye(8),ye(4),he]}(q)}}}(t);return n?new Ot(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,c,m]=Ct(t),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?pt(Math.atan2(c,o)*It):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ct(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,c]=this.rgb;return`rgba(${[t,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}Ot.black=new Ot(0,0,0,1),Ot.white=new Ot(1,1,1,1),Ot.transparent=new Ot(0,0,0,0),Ot.red=new Ot(1,0,0,1);class nu{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class su{constructor(t,n,o,c,m){this.text=t,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class mi{constructor(t){this.sections=t}static fromString(t){return new mi([new su(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof mi?t:mi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class gi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gi)return t;if(typeof t=="number")return new gi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new gi(t)}}toString(){return JSON.stringify(this.values)}}const xp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],c=t[n+1];if(typeof o!="string"||!xp.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Pi(t)}}toString(){return JSON.stringify(this.values)}}class yi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new yi({name:t,available:!1}):null}}function js(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cs(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ot||r instanceof nu||r instanceof mi||r instanceof gi||r instanceof Pi||r instanceof yi)return!0;if(Array.isArray(r)){for(const t of r)if(!cs(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!cs(r[t]))return!1;return!0}return!1}function gr(r){if(r===null)return Gn;if(typeof r=="string")return mt;if(typeof r=="boolean")return at;if(typeof r=="number")return De;if(r instanceof Ot)return ri;if(r instanceof nu)return fn;if(r instanceof mi)return An;if(r instanceof gi)return Hn;if(r instanceof Pi)return W;if(r instanceof yi)return mn;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const c=gr(o);if(n){if(n===c)continue;n=dt;break}n=c}return L(n||dt,t)}return Zi}function Za(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Ot||r instanceof mi||r instanceof gi||r instanceof Pi||r instanceof yi?r.toString():JSON.stringify(r)}class qi{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!cs(t[1]))return n.error("invalid value");const o=t[1];let c=gr(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new qi(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class cr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const zo={string:mt,number:De,boolean:at,object:Zi};class Gi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=t[0];if(m==="array"){let _,x;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in zo)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=zo[T],c++}else _=dt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}o=L(_,x)}else{if(!zo[m])throw new Error(`Types doesn't contain name = ${m}`);o=zo[m]}const g=[];for(;c<t.length;c++){const _=n.parse(t[c],c,dt);if(!_)return null;g.push(_)}return new Gi(o,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!G(this.type,gr(o)))return o;if(n===this.args.length-1)throw new cr(`Expected value to be of type ${D(this.type)}, but found ${D(gr(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const au={"to-boolean":at,"to-color":ri,"to-number":De,"to-string":mt};class Hi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!au[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=au[o],m=[];for(let g=1;g<t.length;g++){const _=n.parse(t[g],g,dt);if(!_)return null;m.push(_)}return new Hi(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(t),o=null,n instanceof Ot)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:js(n[0],n[1],n[2],n[3]),!o))return new Ot(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new cr(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const c=gi.parse(n);if(c)return c}throw new cr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const c=Pi.parse(n);if(c)return c}throw new cr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new cr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return mi.fromString(Za(this.args[0].evaluate(t)));case"resolvedImage":return yi.fromString(Za(this.args[0].evaluate(t)));default:return Za(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const wp=["Unknown","Point","LineString","Polygon"];class Do{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Ot.parse(t)),n}}class hs{constructor(t,n,o=[],c,m=new pn,g=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,o,c,m={}){return n?this.concat(n,o,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(c,m,g){return g==="assert"?new Gi(m,[c]):g==="coerce"?new Hi(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,x=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"assert")}if(!(g instanceof qi)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Do;try{g=new qi(g.type,g.evaluate(_))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const c=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new hs(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Zr(o,t))}checkSubtype(t,n){const o=G(t,n);return o&&this.error(o),o}}class Wn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=n.parse(t[m+1],m+1);if(!_)return null;o.push([g,_])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return c?new Wn(o,c):null}outputDefined(){return this.result.outputDefined()}}class zt{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new zt(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ou{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,De),c=n.parse(t[2],2,L(n.expectedType||dt));return o&&c?new ou(c.type.itemType,o,c):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new cr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new cr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new cr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class lu{constructor(t,n){this.type=at,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,dt),c=n.parse(t[2],2,dt);return o&&c?ne(o.type,[at,mt,De,Gn,dt])?new lu(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!oe(n,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${D(gr(n))} instead.`);if(!oe(o,["string","array"]))throw new cr(`Expected second argument to be of type array or string, but found ${D(gr(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Vs{constructor(t,n,o){this.type=De,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,dt),c=n.parse(t[2],2,dt);if(!o||!c)return null;if(!ne(o.type,[at,mt,De,Gn,dt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,De);return m?new Vs(o,c,m):null}return new Vs(o,c)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!oe(n,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${D(gr(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),oe(o,["string"])){const m=o.indexOf(n,c);return m===-1?-1:[...o.slice(0,m)].length}if(oe(o,["array"]))return o.indexOf(n,c);throw new cr(`Expected second argument to be of type array or string, but found ${D(gr(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class uu{constructor(t,n,o,c,m,g){this.inputType=t,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let T=2;T<t.length-1;T+=2){let C=t[T];const E=t[T+1];Array.isArray(C)||(C=[C]);const z=n.concat(T);if(C.length===0)return z.error("Expected at least one branch label.");for(const B of C){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(o){if(z.checkSubtype(o,gr(B)))return null}else o=gr(B);if(m[String(B)]!==void 0)return z.error("Branch labels must be unique.");m[String(B)]=g.length}const R=n.parse(E,T,c);if(!R)return null;c=c||R.type,g.push(R)}const _=n.parse(t[1],1,dt);if(!_)return null;const x=n.parse(t[t.length-1],t.length-1,c);return x?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new uu(o,c,_,m,g,x):null}evaluate(t){const n=this.input.evaluate(t);return(gr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Lo{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const _=n.parse(t[g],g,at);if(!_)return null;const x=n.parse(t[g+1],g+1,o);if(!x)return null;c.push([_,x]),o=o||x.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Lo(o,c,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class qa{constructor(t,n,o,c){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,dt),c=n.parse(t[2],2,De);if(!o||!c)return null;if(!ne(o.type,[L(dt),mt,dt]))return n.error(`Expected first argument to be of type array or string, but found ${D(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,De);return m?new qa(o.type,o,c,m):null}return new qa(o.type,o,c)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),oe(n,["string"]))return[...n].slice(o,c).join("");if(oe(n,["array"]))return n.slice(o,c);throw new cr(`Expected first argument to be of type array or string, but found ${D(gr(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ro(r,t){const n=r.length-1;let o,c,m=0,g=n,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),o=r[_],c=r[_+1],o<=t){if(_===n||t<c)return _;m=_+1}else{if(!(o>t))throw new cr("Input is not a number.");g=_-1}return 0}class Us{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,De);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const _=g===1?-1/0:t[g],x=t[g+1],T=g,C=g+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const E=n.parse(x,C,m);if(!E)return null;m=m||E.type,c.push([_,E])}return new Us(m,o,c)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(t):o[Ro(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function th(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var bp=rh;function rh(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}rh.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Sp=th(bp);function ds(r,t,n){return r+n*(t-r)}function Ga(r,t,n){return r.map((o,c)=>ds(o,t[c],n))}const ii={number:ds,color:function(r,t,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,_]=Ga(r.rgb,t.rgb,n);return new Ot(c,m,g,_,!1)}case"hcl":{const[c,m,g,_]=r.hcl,[x,T,C,E]=t.hcl;let z,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?z=NaN:(z=x,g!==1&&g!==0||(R=T)):(z=c,C!==1&&C!==0||(R=m));else{let pe=x-c;x>c&&pe>180?pe-=360:x<c&&c-x>180&&(pe+=360),z=c+n*pe}const[B,O,q,X]=function([pe,ie,he,ye]){return pe=isNaN(pe)?0:pe*rt,er([he,Math.cos(pe)*ie,Math.sin(pe)*ie,ye])}([z,R??ds(m,T,n),ds(g,C,n),ds(_,E,n)]);return new Ot(B,O,q,X,!1)}case"lab":{const[c,m,g,_]=er(Ga(r.lab,t.lab,n));return new Ot(c,m,g,_,!1)}}},array:Ga,padding:function(r,t,n){return new gi(Ga(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const o=r.values,c=t.values;if(o.length!==c.length)throw new cr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new cr(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[_,x]=o[g+1],[T,C]=c[g+1];m.push([ds(_,T,n),ds(x,C,n)])}return new Pi(m)}};class ni{constructor(t,n,o,c,m){this.type=t,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(t,n,o,c){let m=0;if(t.name==="exponential")m=Fo(n,t.base,o,c);else if(t.name==="linear")m=Fo(n,1,o,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new Sp(g[0],g[1],g[2],g[3]).solve(Fo(n,1,o,c))}return m}static parse(t,n){let[o,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,De),!m)return null;const _=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=ri:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let T=0;T<g.length;T+=2){const C=g[T],E=g[T+1],z=T+3,R=T+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(_.length&&_[_.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const B=n.parse(E,R,x);if(!B)return null;x=x||B.type,_.push([C,B])}return de(x,De)||de(x,ri)||de(x,Hn)||de(x,W)||de(x,L(De))?new ni(x,o,c,m,_):n.error(`Type ${D(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(t);const g=Ro(n,c),_=ni.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=o[g].evaluate(t),T=o[g+1].evaluate(t);switch(this.operator){case"interpolate":return ii[this.type.kind](x,T,_);case"interpolate-hcl":return ii.color(x,T,_,"hcl");case"interpolate-lab":return ii.color(x,T,_,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Fo(r,t,n,o){const c=o-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class Bo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const _ of t.slice(1)){const x=n.parse(_,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,m.push(x)}if(!o)throw new Error("No output type");const g=c&&m.some(_=>G(c,_.type));return new Bo(g?dt:o,m)}evaluate(t){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(t),o&&o instanceof yi&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Oo(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ih(r,t,n,o){return o.compare(t,n)===0}function $s(r,t,n){const o=r!=="=="&&r!=="!=";return class s1{constructor(m,g,_){this.type=at,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let x=g.parse(m[1],1,dt);if(!x)return null;if(!Oo(_,x.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${D(x.type)}'.`);let T=g.parse(m[2],2,dt);if(!T)return null;if(!Oo(_,T.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${D(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return g.error(`Cannot compare types '${D(x.type)}' and '${D(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Gi(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Gi(x.type,[T])));let C=null;if(m.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(m[3],3,fn),!C)return null}return new s1(x,T,C)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const x=gr(g),T=gr(_);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new cr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=gr(g),T=gr(_);if(x.kind!=="string"||T.kind!=="string")return t(m,g,_)}return this.collator?n(m,g,_,this.collator.evaluate(m)):t(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const kp=$s("==",function(r,t,n){return t===n},ih),nh=$s("!=",function(r,t,n){return t!==n},function(r,t,n,o){return!ih(0,t,n,o)}),sh=$s("<",function(r,t,n){return t<n},function(r,t,n,o){return o.compare(t,n)<0}),Tp=$s(">",function(r,t,n){return t>n},function(r,t,n,o){return o.compare(t,n)>0}),Ip=$s("<=",function(r,t,n){return t<=n},function(r,t,n,o){return o.compare(t,n)<=0}),ah=$s(">=",function(r,t,n){return t>=n},function(r,t,n,o){return o.compare(t,n)>=0});class Ha{constructor(t,n,o){this.type=fn,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,at);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,at);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,mt),!g)?null:new Ha(c,m,g)}evaluate(t){return new nu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class cu{constructor(t,n,o,c,m){this.type=mt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,De);if(!o)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,mt),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,mt),!g))return null;let _=null;if(c["min-fraction-digits"]&&(_=n.parse(c["min-fraction-digits"],1,De),!_))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,De),!x)?null:new cu(o,m,g,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class No{constructor(t){this.type=An,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const _=t[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let x=null;if(_["font-scale"]&&(x=n.parse(_["font-scale"],1,De),!x))return null;let T=null;if(_["text-font"]&&(T=n.parse(_["text-font"],1,L(mt)),!T))return null;let C=null;if(_["text-color"]&&(C=n.parse(_["text-color"],1,ri),!C))return null;const E=c[c.length-1];E.scale=x,E.font=T,E.textColor=C}else{const x=n.parse(t[g],1,dt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new No(c)}evaluate(t){return new mi(this.sections.map(n=>{const o=n.content.evaluate(t);return gr(o)===mn?new su("",o,null,null,null):new su(Za(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class hu{constructor(t){this.type=mn,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,mt);return o?new hu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=yi.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class du{constructor(t){this.type=De,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${D(o.type)} instead.`):new du(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new cr(`Expected value to be of type string or array, but found ${D(gr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const gn=8192;function Cp(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*gn),Math.round(o*c*gn)]}function pu(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/gn+t.x)/n,360*c-180),(o=(r[1]/gn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function ps(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Xn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Lt(r,t,n){const o=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function jo(r,t,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!lh(r,t,n,o)||!lh(n,o,r,t));var c,m}function Pp(r,t,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(jo(r,t,o[c],o[c+1]))return!0;return!1}function Zs(r,t,n=!1){let o=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(Lt(r,_[x],_[x+1]))return n;(m=_[x])[1]>(c=r)[1]!=(g=_[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var c,m,g;return o}function Ep(r,t){for(const n of t)if(Zs(r,n))return!0;return!1}function oh(r,t){for(const n of r)if(!Zs(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Pp(r[n],r[n+1],t))return!1;return!0}function Ap(r,t){for(const n of t)if(oh(r,n))return!0;return!1}function lh(r,t,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),_=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&_<0||g<0&&_>0}function fu(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const _=Cp(r[c][g],n);ps(t,_),m.push(_)}o.push(m)}return o}function uh(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=fu(r[c],t,n);o.push(m)}return o}function ch(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}ps(t,r)}function hh(r,t,n,o){const c=Math.pow(2,o.z)*gn,m=[o.x*gn,o.y*gn],g=[];for(const _ of r)for(const x of _){const T=[x.x+m[0],x.y+m[1]];ch(T,t,n,c),g.push(T)}return g}function dh(r,t,n,o){const c=Math.pow(2,o.z)*gn,m=[o.x*gn,o.y*gn],g=[];for(const x of r){const T=[];for(const C of x){const E=[C.x+m[0],C.y+m[1]];ps(t,E),T.push(E)}g.push(T)}if(t[2]-t[0]<=c/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of g)for(const T of x)ch(T,t,n,c)}var _;return g}class fs{constructor(t,n){this.type=at,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(cs(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const c=[];for(const m of o.features){const{type:g,coordinates:_}=m.geometry;g==="Polygon"&&c.push(_),g==="MultiPolygon"&&c.push(..._)}if(c.length)return new fs(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new fs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new fs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=fu(o.coordinates,m,g),x=hh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const T of x)if(!Zs(T,_))return!1}if(o.type==="MultiPolygon"){const _=uh(o.coordinates,m,g),x=hh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const T of x)if(!Ep(T,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=fu(o.coordinates,m,g),x=dh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const T of x)if(!oh(T,_))return!1}if(o.type==="MultiPolygon"){const _=uh(o.coordinates,m,g),x=dh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const T of x)if(!Ap(T,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ph=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(o,m)>=0)break;t[r]=m,r=c}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,c=t[r];for(;r<o;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function Mp(r,t,n,o,c){fh(r,t,n,o||r.length-1,c||zp)}function fh(r,t,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=t-n+1,_=Math.log(m),x=.5*Math.exp(2*_/3),T=.5*Math.sqrt(_*x*(m-x)/m)*(g-m/2<0?-1:1);fh(r,t,Math.max(n,Math.floor(t-g*x/m+T)),Math.min(o,Math.floor(t+(m-g)*x/m+T)),c)}var C=r[t],E=n,z=o;for(Wa(r,n,t),c(r[o],C)>0&&Wa(r,n,o);E<z;){for(Wa(r,E,z),E++,z--;c(r[E],C)<0;)E++;for(;c(r[z],C)>0;)z--}c(r[n],C)===0?Wa(r,n,z):Wa(r,++z,o),z<=t&&(n=z+1),t<=z&&(o=z-1)}}function Wa(r,t,n){var o=r[t];r[t]=r[n],r[n]=o}function zp(r,t){return r<t?-1:r>t?1:0}function Vo(r,t){if(r.length<=1)return[r];const n=[];let o,c;for(const m of r){const g=Lp(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Mp(n[m],t,1,n[m].length-1,Dp),n[m]=n[m].slice(0,t));return n}function Dp(r,t){return t.area-r.area}function Lp(r){let t=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],t+=(o.x-n.x)*(n.y+o.y);return t}const mh=1/298.257223563,gh=mh*(2-mh),yh=Math.PI/180;class mu{constructor(t){const n=6378.137*yh*1e3,o=Math.cos(t*yh),c=1/(1-gh*(1-o*o)),m=Math.sqrt(c);this.kx=n*m*o,this.ky=n*m*c*(1-gh)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(t,n){let o,c,m,g,_=1/0;for(let x=0;x<t.length-1;x++){let T=t[x][0],C=t[x][1],E=this.wrap(t[x+1][0]-T)*this.kx,z=(t[x+1][1]-C)*this.ky,R=0;E===0&&z===0||(R=(this.wrap(n[0]-T)*this.kx*E+(n[1]-C)*this.ky*z)/(E*E+z*z),R>1?(T=t[x+1][0],C=t[x+1][1]):R>0&&(T+=E/this.kx*R,C+=z/this.ky*R)),E=this.wrap(n[0]-T)*this.kx,z=(n[1]-C)*this.ky;const B=E*E+z*z;B<_&&(_=B,o=T,c=C,m=x,g=R)}return{point:[o,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function _h(r,t){return t[0]-r[0]}function Uo(r){return r[1]-r[0]+1}function Mn(r,t){return r[1]>=r[0]&&r[1]<t}function gu(r,t){if(r[0]>r[1])return[null,null];const n=Uo(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function yu(r,t){if(!Mn(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)ps(n,r[o]);return n}function _u(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)ps(t,o);return t}function $o(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function vu(r,t,n){if(!$o(r)||!$o(t))return NaN;let o=0,c=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[o,c])}function ms(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function xu(r,t,n,o,c){const m=Math.min(ms(r,[n,o],c),ms(t,[n,o],c)),g=Math.min(ms(n,[r,t],c),ms(o,[r,t],c));return Math.min(m,g)}function Rp(r,t,n,o,c){if(!Mn(t,r.length)||!Mn(o,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const _=r[g],x=r[g+1];for(let T=o[0];T<o[1];++T){const C=n[T],E=n[T+1];if(jo(_,x,C,E))return 0;m=Math.min(m,xu(_,x,C,E,c))}}return m}function ar(r,t,n,o,c){if(!Mn(t,r.length)||!Mn(o,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let _=o[0];_<=o[1];++_)if(m=Math.min(m,c.distance(r[g],n[_])),m===0)return m;return m}function Fp(r,t,n){if(Zs(r,t,!0))return 0;let o=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(o=Math.min(o,ms(r,[g,m],n)),o===0))return o;const _=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,_.point)),o===0)return o}return o}function vt(r,t,n,o){if(!Mn(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Zs(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],_=r[m+1];for(const x of n)for(let T=0,C=x.length,E=C-1;T<C;E=T++){const z=x[E],R=x[T];if(jo(g,_,z,R))return 0;c=Math.min(c,xu(g,_,z,R,o))}}return c}function Zo(r,t){for(const n of r)for(const o of n)if(Zs(o,t,!0))return!0;return!1}function $t(r,t,n,o=1/0){const c=_u(r),m=_u(t);if(o!==1/0&&vu(c,m,n)>=o)return o;if(Xn(c,m)){if(Zo(r,t))return 0}else if(Zo(t,r))return 0;let g=1/0;for(const _ of r)for(let x=0,T=_.length,C=T-1;x<T;C=x++){const E=_[C],z=_[x];for(const R of t)for(let B=0,O=R.length,q=O-1;B<O;q=B++){const X=R[q],pe=R[B];if(jo(E,z,X,pe))return 0;g=Math.min(g,xu(E,z,X,pe,n))}}return g}function Nt(r,t,n,o,c,m){if(!m)return;const g=vu(yu(o,m),c,n);g<t&&r.push([g,m,[0,0]])}function gs(r,t,n,o,c,m,g){if(!m||!g)return;const _=vu(yu(o,m),yu(c,g),n);_<t&&r.push([_,m,g])}function Xa(r,t,n,o,c=1/0){let m=Math.min(o.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new ph([[0,[0,r.length-1],[0,0]]],_h),_=_u(n);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const T=x[1],C=t?50:100;if(Uo(T)<=C){if(!Mn(T,r.length))return NaN;if(t){const E=vt(r,T,n,o);if(isNaN(E)||E===0)return E;m=Math.min(m,E)}else for(let E=T[0];E<=T[1];++E){const z=Fp(r[E],n,o);if(m=Math.min(m,z),m===0)return 0}}else{const E=gu(T,t);Nt(g,m,o,r,_,E[0]),Nt(g,m,o,r,_,E[1])}}return m}function Ka(r,t,n,o,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const _=new ph([[0,[0,r.length-1],[0,n.length-1]]],_h);for(;_.length>0;){const x=_.pop();if(x[0]>=g)continue;const T=x[1],C=x[2],E=t?50:100,z=o?50:100;if(Uo(T)<=E&&Uo(C)<=z){if(!Mn(T,r.length)&&Mn(C,n.length))return NaN;let R;if(t&&o)R=Rp(r,T,n,C,c),g=Math.min(g,R);else if(t&&!o){const B=r.slice(T[0],T[1]+1);for(let O=C[0];O<=C[1];++O)if(R=ms(n[O],B,c),g=Math.min(g,R),g===0)return g}else if(!t&&o){const B=n.slice(C[0],C[1]+1);for(let O=T[0];O<=T[1];++O)if(R=ms(r[O],B,c),g=Math.min(g,R),g===0)return g}else R=ar(r,T,n,C,c),g=Math.min(g,R)}else{const R=gu(T,t),B=gu(C,o);gs(_,g,c,r,n,R[0],B[0]),gs(_,g,c,r,n,R[0],B[1]),gs(_,g,c,r,n,R[1],B[0]),gs(_,g,c,r,n,R[1],B[1])}}return g}function wu(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class ys{constructor(t,n){this.type=De,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(cs(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new ys(o,o.features.map(c=>wu(c.geometry)).flat());if(o.type==="Feature")return new ys(o,wu(o.geometry));if("type"in o&&"coordinates"in o)return new ys(o,wu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>pu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new mu(m[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Ka(m,!1,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,Ka(m,!1,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Xa(m,!1,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>pu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new mu(m[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Ka(m,!0,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,Ka(m,!0,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Xa(m,!0,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=Vo(c,0).map(x=>x.map(T=>T.map(C=>pu([C.x,C.y],n.canonical)))),g=new mu(m[0][0][0][1]);let _=1/0;for(const x of o)for(const T of m){switch(x.type){case"Point":_=Math.min(_,Xa([x.coordinates],!1,T,g,_));break;case"LineString":_=Math.min(_,Xa(x.coordinates,!0,T,g,_));break;case"Polygon":_=Math.min(_,$t(T,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const qs={"==":kp,"!=":nh,">":Tp,"<":sh,">=":ah,"<=":Ip,array:Gi,at:ou,boolean:Gi,case:Lo,coalesce:Bo,collator:Ha,format:No,image:hu,in:lu,"index-of":Vs,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:du,let:Wn,literal:qi,match:uu,number:Gi,"number-format":cu,object:Gi,slice:qa,step:Us,string:Gi,"to-boolean":Hi,"to-color":Hi,"to-number":Hi,"to-string":Hi,var:zt,within:fs,distance:ys};class Ei{constructor(t,n,o,c){this.name=t,this.type=n,this._evaluate=o,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],c=Ei.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=g.filter(([T])=>!Array.isArray(T)||T.length===t.length-1);let x=null;for(const[T,C]of _){x=new hs(n.registry,Ja,n.path,null,n.scope);const E=[];let z=!1;for(let R=1;R<t.length;R++){const B=t[R],O=Array.isArray(T)?T[R-1]:T.type,q=x.parse(B,1+E.length,O);if(!q){z=!0;break}E.push(q)}if(!z)if(Array.isArray(T)&&T.length!==E.length)x.error(`Expected ${T.length} arguments, but found ${E.length} instead.`);else{for(let R=0;R<E.length;R++){const B=Array.isArray(T)?T[R]:T.type,O=E[R];x.concat(R+1).checkSubtype(B,O.type)}if(x.errors.length===0)return new Ei(o,m,C,E)}}if(_.length===1)n.errors.push(...x.errors);else{const T=(_.length?_:g).map(([E])=>{return z=E,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z}).join(" | "),C=[];for(let E=1;E<t.length;E++){const z=n.parse(t[E],1+C.length);if(!z)return null;C.push(D(z.type))}n.error(`Expected arguments of type ${T}, but found (${C.join(", ")}) instead.`)}return null}static register(t,n){Ei.definitions=n;for(const o in n)t[o]=Ei}}function bu(r,[t,n,o,c]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=js(t,n,o,m);if(g)throw new cr(g);return new Ot(t/255,n/255,o/255,m,!1)}function Su(r,t){return r in t}function ku(r,t){const n=t[r];return n===void 0?null:n}function _s(r){return{type:r}}function Ja(r){if(r instanceof zt)return Ja(r.boundExpression);if(r instanceof Ei&&r.name==="error"||r instanceof Ha||r instanceof fs||r instanceof ys)return!1;const t=r instanceof Hi||r instanceof Gi;let n=!0;return r.eachChild(o=>{n=t?n&&Ja(o):n&&o instanceof qi}),!!n&&Ya(r)&&Qa(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ya(r){if(r instanceof Ei&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fs||r instanceof ys)return!1;let t=!0;return r.eachChild(n=>{t&&!Ya(n)&&(t=!1)}),t}function Gs(r){if(r instanceof Ei&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!Gs(n)&&(t=!1)}),t}function Qa(r,t){if(r instanceof Ei&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!Qa(o,t)&&(n=!1)}),n}function qo(r){return{result:"success",value:r}}function Hs(r){return{result:"error",value:r}}function Ws(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function vh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Tu(r){return!!r.expression&&r.expression.interpolated}function Et(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Go(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Bp(r){return r}function xh(r,t){const n=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(Tu(t)?"exponential":"interval");if(n||t.type==="padding"){const C=n?Ot.parse:gi.parse;(r=dn({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],C(E[1])])),r.default=C(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,x,T;if(m==="exponential")_=bh;else if(m==="interval")_=Ho;else if(m==="categorical"){_=wh,x=Object.create(null);for(const C of r.stops)x[C[0]]=C[1];T=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Sh}if(o){const C={},E=[];for(let B=0;B<r.stops.length;B++){const O=r.stops[B],q=O[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:r.type,property:r.property,default:r.default,stops:[]},E.push(q)),C[q].stops.push([O[0].value,O[1]])}const z=[];for(const B of E)z.push([C[B].zoom,xh(C[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:ni.interpolationFactor.bind(void 0,R),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},O)=>bh({stops:z,base:r.base},t,B).evaluate(B,O)}}if(c){const C=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:ni.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map(E=>E[0]),evaluate:({zoom:E})=>_(r,t,E,x,T)}}return{kind:"source",evaluate(C,E){const z=E&&E.properties?E.properties[r.property]:void 0;return z===void 0?Xs(r.default,t.default):_(r,t,z,x,T)}}}function Xs(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function wh(r,t,n,o,c){return Xs(typeof n===c?o[n]:void 0,r.default,t.default)}function Ho(r,t,n){if(Et(n)!=="number")return Xs(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Ro(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function bh(r,t,n){const o=r.base!==void 0?r.base:1;if(Et(n)!=="number")return Xs(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=Ro(r.stops.map(C=>C[0]),n),g=function(C,E,z,R){const B=R-z,O=C-z;return B===0?0:E===1?O/B:(Math.pow(E,O)-1)/(Math.pow(E,B)-1)}(n,o,r.stops[m][0],r.stops[m+1][0]),_=r.stops[m][1],x=r.stops[m+1][1],T=ii[t.type]||Bp;return typeof _.evaluate=="function"?{evaluate(...C){const E=_.evaluate.apply(void 0,C),z=x.evaluate.apply(void 0,C);if(E!==void 0&&z!==void 0)return T(E,z,g,r.colorSpace)}}:T(_,x,g,r.colorSpace)}function Sh(r,t,n){switch(t.type){case"color":n=Ot.parse(n);break;case"formatted":n=mi.fromString(n.toString());break;case"resolvedImage":n=yi.fromString(n.toString());break;case"padding":n=gi.parse(n);break;default:Et(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Xs(n,r.default,t.default)}Ei.register(qs,{error:[{kind:"error"},[mt],(r,[t])=>{throw new cr(t.evaluate(r))}],typeof:[mt,[dt],(r,[t])=>D(gr(t.evaluate(r)))],"to-rgba":[L(De,4),[ri],(r,[t])=>{const[n,o,c,m]=t.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[ri,[De,De,De],bu],rgba:[ri,[De,De,De,De],bu],has:{type:at,overloads:[[[mt],(r,[t])=>Su(t.evaluate(r),r.properties())],[[mt,Zi],(r,[t,n])=>Su(t.evaluate(r),n.evaluate(r))]]},get:{type:dt,overloads:[[[mt],(r,[t])=>ku(t.evaluate(r),r.properties())],[[mt,Zi],(r,[t,n])=>ku(t.evaluate(r),n.evaluate(r))]]},"feature-state":[dt,[mt],(r,[t])=>ku(t.evaluate(r),r.featureState||{})],properties:[Zi,[],r=>r.properties()],"geometry-type":[mt,[],r=>r.geometryType()],id:[dt,[],r=>r.id()],zoom:[De,[],r=>r.globals.zoom],"heatmap-density":[De,[],r=>r.globals.heatmapDensity||0],"line-progress":[De,[],r=>r.globals.lineProgress||0],accumulated:[dt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[De,_s(De),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[De,_s(De),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:De,overloads:[[[De,De],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[De],(r,[t])=>-t.evaluate(r)]]},"/":[De,[De,De],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[De,[De,De],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[De,[De],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[De,[De],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[De,[De],(r,[t])=>Math.log(t.evaluate(r))],log2:[De,[De],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[De,[De],(r,[t])=>Math.sin(t.evaluate(r))],cos:[De,[De],(r,[t])=>Math.cos(t.evaluate(r))],tan:[De,[De],(r,[t])=>Math.tan(t.evaluate(r))],asin:[De,[De],(r,[t])=>Math.asin(t.evaluate(r))],acos:[De,[De],(r,[t])=>Math.acos(t.evaluate(r))],atan:[De,[De],(r,[t])=>Math.atan(t.evaluate(r))],min:[De,_s(De),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[De,_s(De),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[De,[De],(r,[t])=>Math.abs(t.evaluate(r))],round:[De,[De],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[De,[De],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[De,[De],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[at,[mt,dt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[at,[dt],(r,[t])=>r.id()===t.value],"filter-type-==":[at,[mt],(r,[t])=>r.geometryType()===t.value],"filter-<":[at,[mt,dt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[at,[dt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[at,[mt,dt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[at,[dt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[at,[mt,dt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[at,[dt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[at,[mt,dt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[at,[dt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[at,[dt],(r,[t])=>t.value in r.properties()],"filter-has-id":[at,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[at,[L(mt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[at,[L(dt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[at,[mt,L(dt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[at,[mt,L(dt)],(r,[t,n])=>function(o,c,m,g){for(;m<=g;){const _=m+g>>1;if(c[_]===o)return!0;c[_]>o?g=_-1:m=_+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:at,overloads:[[[at,at],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[_s(at),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:at,overloads:[[[at,at],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[_s(at),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[at,[at],(r,[t])=>!t.evaluate(r)],"is-supported-script":[at,[mt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[mt,[mt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[mt,[mt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[mt,_s(dt),(r,t)=>t.map(n=>Za(n.evaluate(r))).join("")],"resolved-locale":[mt,[fn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Wo{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Do,this._defaultValue=n?(o=n).type==="color"&&Go(o.default)?new Ot(0,0,0,0):o.type==="color"?Ot.parse(o.default)||null:o.type==="padding"?gi.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Pi.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new cr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Xo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in qs}function Ks(r,t){const n=new hs(qs,Ja,[],t?function(c){const m={color:ri,string:mt,number:De,enum:mt,boolean:at,formatted:An,padding:Hn,resolvedImage:mn,variableAnchorOffsetCollection:W};return c.type==="array"?L(m[c.value]||dt,c.length):m[c.type]}(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?qo(new Wo(o,t)):Hs(n.errors)}class Js{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Gs(n.expression)}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}}class Ys{constructor(t,n,o,c){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Gs(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}interpolationFactor(t,n,o){return this.interpolationType?ni.interpolationFactor(this.interpolationType,t,n,o):0}}function Iu(r,t){const n=Ks(r,t);if(n.result==="error")return n;const o=n.value.expression,c=Ya(o);if(!c&&!Ws(t))return Hs([new Zr("","data expressions not supported")]);const m=Qa(o,["zoom"]);if(!m&&!vh(t))return Hs([new Zr("","zoom expressions not supported")]);const g=eo(o);return g||m?g instanceof Zr?Hs([g]):g instanceof ni&&!Tu(t)?Hs([new Zr("",'"interpolate" expressions cannot be used with this property')]):qo(g?new Ys(c?"camera":"composite",n.value,g.labels,g instanceof ni?g.interpolation:void 0):new Js(c?"constant":"source",n.value)):Hs([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qs{constructor(t,n){this._parameters=t,this._specification=n,dn(this,xh(this._parameters,this._specification))}static deserialize(t){return new Qs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function eo(r){let t=null;if(r instanceof Wn)t=eo(r.result);else if(r instanceof Bo){for(const n of r.args)if(t=eo(n),t)break}else(r instanceof Us||r instanceof ni)&&r.input instanceof Ei&&r.input.name==="zoom"&&(t=r);return t instanceof Zr||r.eachChild(n=>{const o=eo(n);o instanceof Zr?t=o:!t&&o?t=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ko(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Ko(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Jo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ko(r)||(r=Yo(r));const t=Ks(r,Jo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>t.value.evaluate(n,o,{},c),needGeometry:kh(r)}}function Op(r,t){return r<t?-1:r>t?1:0}function kh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(kh(r[t]))return!0;return!1}function Yo(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Pu(r[1],r[2],"=="):t==="!="?Lr(Pu(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Pu(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Yo))):t==="all"?["all"].concat(r.slice(1).map(Yo)):t==="none"?["all"].concat(r.slice(1).map(Yo).map(Lr)):t==="in"?to(r[1],r.slice(2)):t==="!in"?Lr(to(r[1],r.slice(2))):t==="has"?ro(r[1]):t!=="!has"||Lr(ro(r[1]));var n}function Pu(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function to(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Op)]]:["filter-in-small",r,["literal",t]]}}function ro(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Lr(r){return["!",r]}function vs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${vs(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${vs(r[n[c]])},`;return`${o}}`}function Th(r){let t="";for(const n of us)t+=`/${vs(r[n])}`;return t}function Ih(r){const t=r.value;return t?[new Ie(r.key,t,"constants have been deprecated as of v8")]:[]}function or(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Wi(r){if(Array.isArray(r))return r.map(Wi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Wi(r[n]);return t}return or(r)}function _i(r){const t=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,_=r.validateSpec;let x=[];const T=Et(n);if(T!=="object")return[new Ie(t,n,`object expected, ${T} found`)];for(const C in n){const E=C.split(".")[0],z=o[E]||o["*"];let R;if(c[E])R=c[E];else if(o[E])R=_;else if(c["*"])R=c["*"];else{if(!o["*"]){x.push(new Ie(t,n[C],`unknown property "${C}"`));continue}R=_}x=x.concat(R({key:(t&&`${t}.`)+C,value:n[C],valueSpec:z,style:m,styleSpec:g,object:n,objectKey:C,validateSpec:_},n))}for(const C in o)c[C]||o[C].required&&o[C].default===void 0&&n[C]===void 0&&x.push(new Ie(t,n,`missing required property "${C}"`));return x}function io(r){const t=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Et(t)!=="array")return[new Ie(m,t,`array expected, ${Et(t)} found`)];if(n.length&&t.length!==n.length)return[new Ie(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ie(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let _={type:n.value,values:n.values};c.$version<7&&(_.function=n.function),Et(n.value)==="object"&&(_=n.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(g({array:t,arrayIndex:T,value:t[T],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${T}]`}));return x}function Eu(r){const t=r.key,n=r.value,o=r.valueSpec;let c=Et(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ie(t,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ie(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ie(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Qo(r){const t=r.valueSpec,n=or(r.value.type);let o,c,m,g={};const _=n!=="categorical"&&r.value.property===void 0,x=!_,T=Et(r.value.stops)==="array"&&Et(r.value.stops[0])==="array"&&Et(r.value.stops[0][0])==="object",C=_i({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Ie(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const O=R.value;return B=B.concat(io({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:E})),Et(O)==="array"&&O.length===0&&B.push(new Ie(R.key,O,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&_&&C.push(new Ie(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||C.push(new Ie(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Tu(r.valueSpec)&&C.push(new Ie(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Ws(r.valueSpec)?C.push(new Ie(r.key,r.value,"property functions not supported")):_&&!vh(r.valueSpec)&&C.push(new Ie(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!T||r.value.property!==void 0||C.push(new Ie(r.key,r.value,'"property" property is required')),C;function E(R){let B=[];const O=R.value,q=R.key;if(Et(O)!=="array")return[new Ie(q,O,`array expected, ${Et(O)} found`)];if(O.length!==2)return[new Ie(q,O,`array length 2 expected, length ${O.length} found`)];if(T){if(Et(O[0])!=="object")return[new Ie(q,O,`object expected, ${Et(O[0])} found`)];if(O[0].zoom===void 0)return[new Ie(q,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Ie(q,O,"object stop key must have value")];if(m&&m>or(O[0].zoom))return[new Ie(q,O[0].zoom,"stop zoom values must appear in ascending order")];or(O[0].zoom)!==m&&(m=or(O[0].zoom),c=void 0,g={}),B=B.concat(_i({key:`${q}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Eu,value:z}}))}else B=B.concat(z({key:`${q}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return Xo(Wi(O[1]))?B.concat([new Ie(`${q}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${q}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,B){const O=Et(R.value),q=or(R.value),X=R.value!==null?R.value:B;if(o){if(O!==o)return[new Ie(R.key,X,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Ie(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let pe=`number expected, ${O} found`;return Ws(t)&&n===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(R.key,X,pe)]}return n!=="categorical"||O!=="number"||isFinite(q)&&Math.floor(q)===q?n!=="categorical"&&O==="number"&&c!==void 0&&q<c?[new Ie(R.key,X,"stop domain values must appear in ascending order")]:(c=q,n==="categorical"&&q in g?[new Ie(R.key,X,"stop domain values must be unique")]:(g[q]=!0,[])):[new Ie(R.key,X,`integer expected, found ${q}`)]}}function ea(r){const t=(r.expressionContext==="property"?Iu:Ks)(Wi(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new Ie(`${r.key}${o.key}`,r.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ie(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Gs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Gs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Qa(n,["zoom","feature-state"]))return[new Ie(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Ya(n))return[new Ie(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zn(r){const t=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(or(n))===-1&&c.push(new Ie(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(or(n))===-1&&c.push(new Ie(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Au(r){return Ko(Wi(r.value))?ea(dn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):el(r)}function el(r){const t=r.value,n=r.key;if(Et(t)!=="array")return[new Ie(n,t,`array expected, ${Et(t)} found`)];const o=r.styleSpec;let c,m=[];if(t.length<1)return[new Ie(n,t,"filter array must have at least 1 element")];switch(m=m.concat(zn({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),or(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&or(t[1])==="$type"&&m.push(new Ie(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ie(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Et(t[1]),c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Et(t[g]),or(t[1])==="$type"?m=m.concat(zn({key:`${n}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ie(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(el({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Et(t[1]),t.length!==2?m.push(new Ie(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Mu(r,t){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,_=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const T=_.match(/^(.*)-transition$/);if(t==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const C=r.valueSpec||x[_];if(!C)return[new Ie(n,g,`unknown property "${_}"`)];let E;if(Et(g)==="string"&&Ws(C)&&!C.tokens&&(E=/^{([^}]+)}$/.exec(g)))return[new Ie(n,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const z=[];return r.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&z.push(new Ie(n,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Go(Wi(g))&&or(g.type)==="identity"&&z.push(new Ie(n,g,'"text-font" does not support identity functions'))),z.concat(o({key:r.key,value:g,valueSpec:C,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:_}))}function tl(r){return Mu(r,"paint")}function zu(r){return Mu(r,"layout")}function Du(r){let t=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ie(o,n,'either "type" or "ref" is required'));let g=or(n.type);const _=or(n.ref);if(n.id){const x=or(n.id);for(let T=0;T<r.arrayIndex;T++){const C=c.layers[T];or(C.id)===x&&t.push(new Ie(o,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&t.push(new Ie(o,n[T],`"${T}" is prohibited for ref layers`))}),c.layers.forEach(T=>{or(T.id)===_&&(x=T)}),x?x.ref?t.push(new Ie(o,n.ref,"ref cannot reference another ref layer")):g=or(x.type):t.push(new Ie(o,n.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],T=x&&or(x.type);x?T==="vector"&&g==="raster"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&g==="hillshade"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&g!=="raster"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&g!=="hillshade"?t.push(new Ie(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||t.push(new Ie(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ie(o,n.source,`source "${n.source}" not found`))}else t.push(new Ie(o,n,'missing required property "source"'));return t=t.concat(_i({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Au,layout:x=>_i({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>zu(dn({layerType:g},T))}}),paint:x=>_i({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>tl(dn({layerType:g},T))}})}})),t}function xs(r){const t=r.value,n=r.key,o=Et(t);return o!=="string"?[new Ie(n,t,`string expected, ${o} found`)]:[]}const rl={promoteId:function({key:r,value:t}){if(Et(t)==="string")return xs({key:r,value:t});{const n=[];for(const o in t)n.push(...xs({key:`${r}.${o}`,value:t[o]}));return n}}};function no(r){const t=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ie(n,t,'"type" is required')];const g=or(t.type);let _;switch(g){case"vector":case"raster":return _=_i({key:n,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:rl,validateSpec:m}),_;case"raster-dem":return _=function(x){var T;const C=(T=x.sourceName)!==null&&T!==void 0?T:"",E=x.value,z=x.styleSpec,R=z.source_raster_dem,B=x.style;let O=[];const q=Et(E);if(E===void 0)return O;if(q!=="object")return O.push(new Ie("source_raster_dem",E,`object expected, ${q} found`)),O;const X=or(E.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],ie=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const he in E)!X&&pe.includes(he)?O.push(new Ie(he,E[he],`In "${C}": "${he}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):R[he]?O=O.concat(x.validateSpec({key:he,value:E[he],valueSpec:R[he],validateSpec:x.validateSpec,style:B,styleSpec:z})):O.push(new Ie(he,E[he],`unknown property "${he}"`));return O}({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),_;case"geojson":if(_=_i({key:n,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:rl}),t.cluster)for(const x in t.clusterProperties){const[T,C]=t.clusterProperties[x],E=typeof T=="string"?[T,["accumulated"],["get",x]]:T;_.push(...ea({key:`${n}.${x}.map`,value:C,expressionContext:"cluster-map"})),_.push(...ea({key:`${n}.${x}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return _;case"video":return _i({key:n,value:t,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return _i({key:n,value:t,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new Ie(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zn({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Lu(r){const t=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=Et(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("light",t,`object expected, ${g} found`)]),m;for(const _ in t){const x=_.match(/^(.*)-transition$/);m=m.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:_,value:t[_],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)])}return m}function Ru(r){const t=r.value,n=r.styleSpec,o=n.sky,c=r.style,m=Et(t);if(t===void 0)return[];if(m!=="object")return[new Ie("sky",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return g}function Fu(r){const t=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=Et(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("terrain",t,`object expected, ${g} found`)]),m;for(const _ in t)m=m.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return m}function Bu(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ie(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ie(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(_i({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return xs({key:o,value:n})}const il={"*":()=>[],array:io,boolean:function(r){const t=r.value,n=r.key,o=Et(t);return o!=="boolean"?[new Ie(n,t,`boolean expected, ${o} found`)]:[]},number:Eu,color:function(r){const t=r.key,n=r.value,o=Et(n);return o!=="string"?[new Ie(t,n,`color expected, ${o} found`)]:Ot.parse(String(n))?[]:[new Ie(t,n,`color expected, "${n}" found`)]},constants:Ih,enum:zn,filter:Au,function:Qo,layer:Du,object:_i,source:no,light:Lu,sky:Ru,terrain:Fu,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,c=r.style,m=Et(t);if(t===void 0)return[];if(m!=="object")return[new Ie("projection",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return g},string:xs,formatted:function(r){return xs(r).length===0?[]:ea(r)},resolvedImage:function(r){return xs(r).length===0?[]:ea(r)},padding:function(r){const t=r.key,n=r.value;if(Et(n)==="array"){if(n.length<1||n.length>4)return[new Ie(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return Eu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=Et(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ie(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(zn({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(io({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Bu};function so(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=so,n.expression&&Go(or(t))?Qo(r):n.expression&&Xo(Wi(t))?ea(r):n.type&&il[n.type]?il[n.type](r):_i(dn({},r,{valueSpec:n.type?o[n.type]:n}))}function Ch(r){const t=r.value,n=r.key,o=xs(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ie(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ie(n,t,'"glyphs" url must include a "{range}" token'))),o}function Ai(r,t=ge){let n=[];return n=n.concat(so({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:so,objectElementValidators:{glyphs:Ch,"*":()=>[]}})),r.constants&&(n=n.concat(Ih({key:"constants",value:r.constants}))),Ou(n)}function yn(r){return function(t){return r({...t,validateSpec:so})}}function Ou(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Xi(r){return function(...t){return Ou(r.apply(this,t))}}Ai.source=Xi(yn(no)),Ai.sprite=Xi(yn(Bu)),Ai.glyphs=Xi(yn(Ch)),Ai.light=Xi(yn(Lu)),Ai.sky=Xi(yn(Ru)),Ai.terrain=Xi(yn(Fu)),Ai.layer=Xi(yn(Du)),Ai.filter=Xi(yn(Au)),Ai.paintProperty=Xi(yn(tl)),Ai.layoutProperty=Xi(yn(zu));const ws=Ai,Np=ws.light,jp=ws.sky,Ph=ws.paintProperty,Eh=ws.layoutProperty;function Nu(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new Zn(new Error(o.message))),n=!0;return n}class ta{constructor(t,n,o){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let x=0;x<this.d*this.d;x++){const T=g[3+x],C=g[3+x+1];c.push(T===C?null:g.subarray(T,C))}const _=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,c,m,g){this.cells[m].push(g)}query(t,n,o,c,m){const g=this.min,_=this.max;if(t<=g&&n<=g&&_<=o&&_<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,c,this._queryCell,x,{},m),x}}_queryCell(t,n,o,c,m,g,_,x){const T=this.cells[m];if(T!==null){const C=this.keys,E=this.bboxes;for(let z=0;z<T.length;z++){const R=T[z];if(_[R]===void 0){const B=4*R;(x?x(E[B+0],E[B+1],E[B+2],E[B+3]):t<=E[B+2]&&n<=E[B+3]&&o>=E[B+0]&&c>=E[B+1])?(_[R]=!0,g.push(C[R])):_[R]=!1}}}}_forEachCell(t,n,o,c,m,g,_,x){const T=this._convertToCellCoord(t),C=this._convertToCellCoord(n),E=this._convertToCellCoord(o),z=this._convertToCellCoord(c);for(let R=T;R<=E;R++)for(let B=C;B<=z;B++){const O=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&m.call(this,t,n,o,c,O,g,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const _=t[g];c[3+g]=m,c.set(_,m),m+=_.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new ta(t.buffer)}}const Mi={};function Ze(r,t,n={}){if(Mi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Mi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ze("Object",Object),Ze("TransferableGridIndex",ta),Ze("Color",Ot),Ze("Error",Error),Ze("AJAXError",br),Ze("ResolvedImage",yi),Ze("StylePropertyFunction",Qs),Ze("StyleExpression",Wo,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",Ys),Ze("ZoomConstantExpression",Js),Ze("CompoundExpression",Ei,{omit:["_evaluate"]});for(const r in qs)qs[r]._classRegistryKey||Ze(`Expression_${r}`,qs[r]);function nl(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function ju(r){return r.$name||r.constructor._classRegistryKey}function Ah(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=ju(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||nl(r)||Qr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function ra(r,t){if(Ah(r))return(nl(r)||Qr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(ra(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=ju(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Mi[n])throw new Error(`${n} is not registered.`);const{klass:o}=Mi[n],c=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Mi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Mi[n].shallow.indexOf(m)>=0?g:ra(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function ia(r){if(Ah(r))return r;if(Array.isArray(r))return r.map(ia);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=ju(r)||"Object";if(!Mi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Mi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=Mi[t].shallow.indexOf(c)>=0?m:ia(m)}return o}class Vu{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const bt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Uu(r){for(const t of r)if(Zu(t.charCodeAt(0)))return!0;return!1}function Vp(r){for(const t of r)if(!na(t.charCodeAt(0)))return!1;return!0}function $u(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Up=$u(["Arab","Dupl","Mong","Ougr","Syrc"]);function na(r){return!Up.test(String.fromCodePoint(r))}const Mh=$u(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Zu(r){return!(r!==746&&r!==747&&(r<4352||!(bt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||bt["CJK Compatibility"](r)||bt["CJK Strokes"](r)||!(!bt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||bt["Enclosed CJK Letters and Months"](r)||bt["Ideographic Description Characters"](r)||bt.Kanbun(r)||bt.Katakana(r)&&r!==12540||!(!bt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!bt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||bt["Vertical Forms"](r)||bt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Mh.test(String.fromCodePoint(r)))))}function zh(r){return!(Zu(r)||function(t){return!!(bt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||bt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||bt["Letterlike Symbols"](t)||bt["Number Forms"](t)||bt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||bt["Control Pictures"](t)&&t!==9251||bt["Optical Character Recognition"](t)||bt["Enclosed Alphanumerics"](t)||bt["Geometric Shapes"](t)||bt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||bt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||bt["CJK Symbols and Punctuation"](t)||bt.Katakana(t)||bt["Private Use Area"](t)||bt["CJK Compatibility Forms"](t)||bt["Small Form Variants"](t)||bt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const $p=$u(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function qu(r){return $p.test(String.fromCodePoint(r))}function Zp(r,t){return!(!t&&qu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||bt.Khmer(r))}function qp(r){for(const t of r)if(qu(t.charCodeAt(0)))return!0;return!1}const vi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Gt{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vu,this.transition={})}isSupportedScript(t){return function(n,o){for(const c of n)if(!Zp(c.charCodeAt(0),o))return!1;return!0}(t,vi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class sa{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,c){if(Go(o))return new Qs(o,c);if(Xo(o)){const m=Iu(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Ot.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Pi.parse(o)):m=gi.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class sl{constructor(t){this.property=t,this.value=new sa(t,void 0)}transitioned(t,n){return new Dh(this.property,this.value,n,He({},t.transition,this.transition),t.now)}untransitioned(){return new Dh(this.property,this.value,null,{},0)}}class al{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return _t(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sl(this._values[t].property)),this._values[t].value=new sa(this._values[t].property,n===null?void 0:_t(n))}getTransition(t){return _t(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sl(this._values[t].property)),this._values[t].transition=_t(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const o=new ao(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,n._values[c]);return o}untransitioned(){const t=new ao(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Dh{constructor(t,n,o,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,o);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,o),m,function(x){if(x<=0)return 0;if(x>=1)return 1;const T=x*x,C=T*x;return 4*(x<.5?C:3*(x-T)+C-.75)}(_))}}return m}}class ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const c=new lo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class oo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return _t(this._values[t].value)}setValue(t,n){this._values[t]=new sa(this._values[t].property,n===null?void 0:_t(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const c=new lo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}}class _n{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,c){return this.property.evaluate(this.value,this.parameters,t,n,o,c)}}class lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xe{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const c=ii[this.specification.type];return c?c(t,n,o):t}}class st{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,c){return new _n(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,c)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new _n(this,{kind:"constant",value:void 0},t.parameters);const c=ii[this.specification.type];if(c){const m=c(t.value.value,n.value.value,o);return new _n(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,o,c,m,g)}}class ol extends st{possiblyEvaluate(t,n,o,c){if(t.value===void 0)return new _n(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,n);return new _n(this,{kind:"constant",value:_},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new _n(this,{kind:"constant",value:m},n)}return new _n(this,t.expression,n)}evaluate(t,n,o,c,m,g){if(t.kind==="source"){const _=t.evaluate(n,o,c,m,g);return this._calculate(_,_,_,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,c),t.evaluate({zoom:Math.floor(n.zoom)},o,c),t.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):t.value}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class ll{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new Gt(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Gt(Math.floor(n.zoom),n)),t.expression.evaluate(new Gt(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Gu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){return!!t.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new sa(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new sl(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}Ze("DataDrivenProperty",st),Ze("DataConstantProperty",Xe),Ze("CrossFadedDataDrivenProperty",ol),Ze("CrossFadedProperty",ll),Ze("ColorRampProperty",Gu);const e="-transition";class s extends Bs{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new oo(n.layout)),n.paint)){this._transitionablePaint=new al(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Eh,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Ph,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),yt(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,c,m={}){return(!m||m.validate!==!1)&&Nu(this,t.call(ws,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof _n&&Ws(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let n=0,o=0;return{members:r.map(c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=w(n,Math.max(t,m)),_=c.components||1;return o=Math.max(o,m),n+=m*_,{name:c.name,type:c.type,components:_,offset:g}}),size:w(n,Math.max(o,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class k extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=o,t}}k.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",k);class P extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,t}}P.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",P);class A extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,t}}A.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",A);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}M.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4i12",M);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=4*t,T=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[T+4]=c,this.uint8[T+5]=m,this.uint8[T+6]=g,this.uint8[T+7]=_,t}}F.prototype.bytesPerElement=8,Ze("StructArrayLayout2i4ub8",F);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=o,t}}j.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",j);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,T,C){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,c,m,g,_,x,T,C)}emplace(t,n,o,c,m,g,_,x,T,C,E){const z=10*t;return this.uint16[z+0]=n,this.uint16[z+1]=o,this.uint16[z+2]=c,this.uint16[z+3]=m,this.uint16[z+4]=g,this.uint16[z+5]=_,this.uint16[z+6]=x,this.uint16[z+7]=T,this.uint16[z+8]=C,this.uint16[z+9]=E,t}}V.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",V);class H extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,T,C,E,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,c,m,g,_,x,T,C,E,z)}emplace(t,n,o,c,m,g,_,x,T,C,E,z,R){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=o,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=_,this.uint16[B+6]=x,this.uint16[B+7]=T,this.int16[B+8]=C,this.int16[B+9]=E,this.int16[B+10]=z,this.int16[B+11]=R,t}}H.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",H);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}J.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",J);class Y extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Y.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",Y);class te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,T){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,c,m,g,_,x,T)}emplace(t,n,o,c,m,g,_,x,T,C){const E=10*t,z=5*t;return this.int16[E+0]=n,this.int16[E+1]=o,this.int16[E+2]=c,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=_,this.uint32[z+3]=x,this.uint16[E+8]=T,this.uint16[E+9]=C,t}}te.prototype.bytesPerElement=20,Ze("StructArrayLayout6i1ul2ui20",te);class Z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}Z.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",Z);class se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,c,m)}emplace(t,n,o,c,m,g){const _=4*t,x=8*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}se.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",se);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=16*t,T=4*t,C=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[T+1]=c,this.float32[T+2]=m,this.int16[C+6]=g,this.int16[C+7]=_,t}}ce.prototype.bytesPerElement=16,Ze("StructArrayLayout2ub2f2i16",ce);class fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,t}}fe.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",fe);class we extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X){const pe=this.length;return this.resize(pe+1),this.emplace(pe,t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X)}emplace(t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X,pe){const ie=24*t,he=12*t,ye=48*t;return this.int16[ie+0]=n,this.int16[ie+1]=o,this.uint16[ie+2]=c,this.uint16[ie+3]=m,this.uint32[he+2]=g,this.uint32[he+3]=_,this.uint32[he+4]=x,this.uint16[ie+10]=T,this.uint16[ie+11]=C,this.uint16[ie+12]=E,this.float32[he+7]=z,this.float32[he+8]=R,this.uint8[ye+36]=B,this.uint8[ye+37]=O,this.uint8[ye+38]=q,this.uint32[he+10]=X,this.int16[ie+22]=pe,t}}we.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",we);class Te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X,pe,ie,he,ye,Se,Ve,nt,Ne,Re,Ye,Ge){const $e=this.length;return this.resize($e+1),this.emplace($e,t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X,pe,ie,he,ye,Se,Ve,nt,Ne,Re,Ye,Ge)}emplace(t,n,o,c,m,g,_,x,T,C,E,z,R,B,O,q,X,pe,ie,he,ye,Se,Ve,nt,Ne,Re,Ye,Ge,$e){const ve=32*t,Qe=16*t;return this.int16[ve+0]=n,this.int16[ve+1]=o,this.int16[ve+2]=c,this.int16[ve+3]=m,this.int16[ve+4]=g,this.int16[ve+5]=_,this.int16[ve+6]=x,this.int16[ve+7]=T,this.uint16[ve+8]=C,this.uint16[ve+9]=E,this.uint16[ve+10]=z,this.uint16[ve+11]=R,this.uint16[ve+12]=B,this.uint16[ve+13]=O,this.uint16[ve+14]=q,this.uint16[ve+15]=X,this.uint16[ve+16]=pe,this.uint16[ve+17]=ie,this.uint16[ve+18]=he,this.uint16[ve+19]=ye,this.uint16[ve+20]=Se,this.uint16[ve+21]=Ve,this.uint16[ve+22]=nt,this.uint32[Qe+12]=Ne,this.float32[Qe+13]=Re,this.float32[Qe+14]=Ye,this.uint16[ve+30]=Ge,this.uint16[ve+31]=$e,t}}Te.prototype.bytesPerElement=64,Ze("StructArrayLayout8i15ui1ul2f2ui64",Te);class Fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Fe.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",Fe);class Ue extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}Ue.prototype.bytesPerElement=12,Ze("StructArrayLayout1ui2f12",Ue);class Me extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,t}}Me.prototype.bytesPerElement=8,Ze("StructArrayLayout1ul2ui8",Me);class Ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=o,t}}Ae.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",Ae);class Ke extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Ke.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",Ke);class ut extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,t}}ut.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",ut);class Le extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ae(this.anchorPointX,this.anchorPointY)}}Le.prototype.size=20;class je extends te{get(t){return new Le(this,t)}}Ze("CollisionBoxArray",je);class ot extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ot.prototype.size=48;class Ht extends we{get(t){return new ot(this,t)}}Ze("PlacedSymbolArray",Ht);class ft extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ft.prototype.size=64;class wt extends Te{get(t){return new ft(this,t)}}Ze("SymbolInstanceArray",wt);class Wt extends Fe{getoffsetX(t){return this.float32[1*t+0]}}Ze("GlyphOffsetArray",Wt);class Rr extends P{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ze("SymbolLineVertexArray",Rr);class Ki extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ki.prototype.size=12;class Xt extends Ue{get(t){return new Ki(this,t)}}Ze("TextAnchorOffsetArray",Xt);class si extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}si.prototype.size=8;class Gr extends Me{get(t){return new si(this,t)}}Ze("FeatureIndexArray",Gr);class Fr extends k{}class Hr extends k{}class vn extends k{}class aa extends M{}class ul extends F{}class oa extends j{}class zi extends V{}class cl extends H{}class Hu extends J{}class Di extends Y{}class Li extends Z{}class Kn extends ce{}class Ji extends fe{}class Er extends Ae{}const Br=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=Br;class St{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,c){let m=this.segments[this.segments.length-1];return t>St.MAX_VERTEX_ARRAY_LENGTH&&sr(`Max vertices per segment is ${St.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>St.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,c){return new St([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function bs(r,t){return 256*(r=Oe(Math.floor(r),0,255))+Oe(Math.floor(t),0,255)}St.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",St);const la=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ua={exports:{}},Lh={exports:{}};Lh.exports=function(r,t){var n,o,c,m,g,_,x,T;for(o=r.length-(n=3&r.length),c=t,g=3432918353,_=461845907,T=0;T<o;)x=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(T+2))<<16;case 2:x^=(255&r.charCodeAt(T+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(T)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Gp=Lh.exports,Rh={exports:{}};Rh.exports=function(r,t){for(var n,o=r.length,c=t^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Jn=Gp,Fh=Rh.exports;ua.exports=Jn,ua.exports.murmur3=Jn,ua.exports.murmur2=Fh;var hl=$(ua.exports);class uo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,c){this.ids.push(dl(t)),this.positions.push(n,o,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=dl(t);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return pl(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(t){const n=new uo;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function dl(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:hl(String(r))}function pl(r,t,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;ca(r,m,g),ca(t,3*m,3*g),ca(t,3*m+1,3*g+1),ca(t,3*m+2,3*g+2)}g-n<o-g?(pl(r,t,n,g),n=g+1):(pl(r,t,g+1,o),o=g)}}function ca(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}Ze("FeaturePositionMap",uo);class co{constructor(t,n){this.gl=t.gl,this.location=n}}class Bh extends co{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Jg extends co{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Yg extends co{constructor(t,n){super(t,n),this.current=Ot.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const c1=new Float32Array(16);function Hp(r){return[bs(255*r.r,255*r.g),bs(255*r.b,255*r.a)]}class Wu{constructor(t,n,o){this.value=t,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Yg(t,n):new Bh(t,n)}}class fl{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Jg(t,n):new Bh(t,n)}}class Ss{constructor(t,n,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,n,o,c,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Gt(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,_)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,o){if(this.type==="color"){const c=Hp(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Dn{constructor(t,n,o,c,m,g){this.expression=t,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,o,c,m){const g=this.expression.evaluate(new Gt(this.zoom),n,{},c,[],m),_=this.expression.evaluate(new Gt(this.zoom+1),n,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,_)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,o,c){if(this.type==="color"){const m=Hp(o),g=Hp(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Oe(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,o){return new Bh(t,n)}}class ha{constructor(t,n,o,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,c,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(t,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:_}=o,x=c[m],T=c[g],C=c[_];if(x&&T&&C)for(let E=t;E<n;E++)this.zoomInPaintVertexArray.emplace(E,T.tl[0],T.tl[1],T.br[0],T.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],T.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,T.tl[0],T.tl[1],T.br[0],T.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],T.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,la.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,la.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Qg{constructor(t,n,o){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!o(m))continue;const g=t.paint.get(m);if(!(g instanceof _n&&Ws(g.property.specification)))continue;const _=h1(m,t.type),x=g.value,T=g.property.specification.type,C=g.property.useIntegerZoom,E=g.property.specification["property-type"],z=E==="cross-faded"||E==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=z?new fl(x.value,_):new Wu(x.value,_,T),c.push(`/u_${m}`);else if(x.kind==="source"||z){const R=ey(m,T,"source");this.binders[m]=z?new ha(x,T,C,n,R,t.id):new Ss(x,_,T,R),c.push(`/a_${m}`)}else{const R=ey(m,T,"composite");this.binders[m]=new Dn(x,_,T,C,n,R),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ss||n instanceof Dn?n.maxValue:0}populatePaintArrays(t,n,o,c,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof Ss||_ instanceof Dn||_ instanceof ha)&&_.populatePaintArray(t,n,o,c,m)}}setConstantPatternPositions(t,n){for(const o in this.binders){const c=this.binders[o];c instanceof fl&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,c,m){let g=!1;for(const _ in t){const x=n.getPositions(_);for(const T of x){const C=o.feature(T.index);for(const E in this.binders){const z=this.binders[E];if((z instanceof Ss||z instanceof Dn||z instanceof ha)&&z.expression.isStateDependent===!0){const R=c.paint.get(E);z.expression=R.value,z.updatePaintArray(T.start,T.end,C,t[_],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Wu||o instanceof fl)&&t.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ss||o instanceof Dn)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name);else if(o instanceof ha)for(let c=0;c<la.members.length;c++)t.push(la.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Wu||o instanceof fl||o instanceof Dn)for(const c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Wu||m instanceof fl||m instanceof Dn){for(const g of m.uniformNames)if(n[g]){const _=m.getBinding(t,n[g],g);o.push({name:g,property:c,binding:_})}}}return o}setUniforms(t,n,o,c){for(const{name:m,property:g,binding:_}of n)this.binders[g].setUniform(_,c,o.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof ha){const c=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof Ss||o instanceof Dn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ss||o instanceof Dn||o instanceof ha)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ss||n instanceof Dn||n instanceof ha)&&n.destroy()}}}class ho{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Qg(c,n,o);this.needsUpload=!1,this._featureMap=new uo,this._bufferOffset=0}populatePaintArrays(t,n,o,c,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function h1(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function ey(r,t,n){const o={color:{source:j,composite:ut},number:{source:Fe,composite:j}},c=function(m){return{"line-pattern":{source:zi,composite:zi},"fill-pattern":{source:zi,composite:zi},"fill-extrusion-pattern":{source:zi,composite:zi}}[m]}(r);return c&&c[n]||o[t][n]}Ze("ConstantBinder",Wu),Ze("CrossFadedConstantBinder",fl),Ze("SourceExpressionBinder",Ss),Ze("CrossFadedCompositeBinder",ha),Ze("CompositeExpressionBinder",Dn),Ze("ProgramConfiguration",Qg,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",ho);const yr=8192,Wp=Math.pow(2,14)-1,ty=-Wp-1;function po(r){const t=yr/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],_=Math.round(g.x*t),x=Math.round(g.y*t);g.x=Oe(_,ty,Wp),g.y=Oe(x,ty,Wp),(_<g.x||_>g.x+1||x<g.y||x>g.y+1)&&sr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function fo(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?po(r):[]}}function Oh(r,t,n,o,c){r.emplaceBack(2*t+(o+1)/2,2*n+(c+1)/2)}class Xp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Hr,this.indexArray=new Ji,this.segments=new St,this.programConfigurations=new ho(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const c=this.layers[0],m=[];let g=null,_=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:x,id:T,index:C,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,R=fo(x,z);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),R,o))continue;const B=_?g.evaluate(R,{},o):void 0,O={id:T,properties:x.properties,type:x.type,sourceLayerIndex:E,index:C,geometry:z?R.geometry:po(x),patterns:{},sortKey:B};m.push(O)}_&&m.sort((x,T)=>x.sortKey-T.sortKey);for(const x of m){const{geometry:T,index:C,sourceLayerIndex:E}=x,z=t[C].feature;this.addFeature(x,T,C,o),n.featureIndex.insert(z,T,C,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,c){for(const m of n)for(const g of m){const _=g.x,x=g.y;if(_<0||_>=yr||x<0||x>=yr)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=T.vertexLength;Oh(this.layoutVertexArray,_,x,-1,-1),Oh(this.layoutVertexArray,_,x,1,-1),Oh(this.layoutVertexArray,_,x,1,1),Oh(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c)}}function ry(r,t){for(let n=0;n<r.length;n++)if(ml(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(ml(r,t[n]))return!0;return!!Kp(r,t)}function d1(r,t,n){return!!ml(r,t)||!!Jp(t,r,n)}function iy(r,t){if(r.length===1)return sy(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let c=0;c<o.length;c++)if(ml(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(sy(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Kp(r,t[n]))return!0;return!1}function p1(r,t,n){if(r.length>1){if(Kp(r,t))return!0;for(let o=0;o<t.length;o++)if(Jp(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Jp(r[o],t,n))return!0;return!1}function Kp(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(f1(o,c,t[m],t[m+1]))return!0}return!1}function f1(r,t,n,o){return wr(r,n,o)!==wr(t,n,o)&&wr(r,t,n)!==wr(r,t,o)}function Jp(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(ny(r,t[c-1],t[c])<o)return!0;return!1}function ny(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function sy(r,t){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let _=0,x=n.length-1;_<n.length;x=_++)o=n[_],c=n[x],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function ml(r,t){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function m1(r,t,n){const o=n[0],c=n[2];if(r.x<o.x&&t.x<o.x||r.x>c.x&&t.x>c.x||r.y<o.y&&t.y<o.y||r.y>c.y&&t.y>c.y)return!1;const m=wr(r,t,n[0]);return m!==wr(r,t,n[1])||m!==wr(r,t,n[2])||m!==wr(r,t,n[3])}function Xu(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Nh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function jh(r,t,n,o,c){if(!t[0]&&!t[1])return r;const m=ae.convert(t)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(m));return g}let ay,oy;Ze("CircleBucket",Xp,{omit:["layers"]});var g1={get paint(){return oy=oy||new f({"circle-radius":new st(ge.paint_circle["circle-radius"]),"circle-color":new st(ge.paint_circle["circle-color"]),"circle-blur":new st(ge.paint_circle["circle-blur"]),"circle-opacity":new st(ge.paint_circle["circle-opacity"]),"circle-translate":new Xe(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return ay=ay||new f({"circle-sort-key":new st(ge.layout_circle["circle-sort-key"])})}},ai=1e-6,gl=typeof Float32Array<"u"?Float32Array:Array;function Yp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ly(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],T=t[6],C=t[7],E=t[8],z=t[9],R=t[10],B=t[11],O=t[12],q=t[13],X=t[14],pe=t[15],ie=n[0],he=n[1],ye=n[2],Se=n[3];return r[0]=ie*o+he*_+ye*E+Se*O,r[1]=ie*c+he*x+ye*z+Se*q,r[2]=ie*m+he*T+ye*R+Se*X,r[3]=ie*g+he*C+ye*B+Se*pe,r[4]=(ie=n[4])*o+(he=n[5])*_+(ye=n[6])*E+(Se=n[7])*O,r[5]=ie*c+he*x+ye*z+Se*q,r[6]=ie*m+he*T+ye*R+Se*X,r[7]=ie*g+he*C+ye*B+Se*pe,r[8]=(ie=n[8])*o+(he=n[9])*_+(ye=n[10])*E+(Se=n[11])*O,r[9]=ie*c+he*x+ye*z+Se*q,r[10]=ie*m+he*T+ye*R+Se*X,r[11]=ie*g+he*C+ye*B+Se*pe,r[12]=(ie=n[12])*o+(he=n[13])*_+(ye=n[14])*E+(Se=n[15])*O,r[13]=ie*c+he*x+ye*z+Se*q,r[14]=ie*m+he*T+ye*R+Se*X,r[15]=ie*g+he*C+ye*B+Se*pe,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Ku,y1=ly;function Vh(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}Ku=new gl(4),gl!=Float32Array&&(Ku[0]=0,Ku[1]=0,Ku[2]=0,Ku[3]=0);class _1 extends s{constructor(t){super(t,g1)}createBucket(t){return new Xp(t)}queryRadius(t){const n=t;return Xu("circle-radius",this,n)+Xu("circle-stroke-width",this,n)+Nh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_,x){const T=jh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),C=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),E=this.paint.get("circle-pitch-alignment")==="map",z=E?T:function(B,O){return B.map(q=>uy(q,O))}(T,x),R=E?C*_:C;for(const B of c)for(const O of B){const q=E?O:uy(O,x);let X=R;const pe=Vh([],[O.x,O.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=pe[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=g.cameraToCenterDistance/pe[3]),d1(z,q,X))return!0}return!1}}function uy(r,t){const n=Vh([],[r.x,r.y,0,1],t);return new ae(n[0]/n[3],n[1]/n[3])}class cy extends Xp{}let hy;Ze("HeatmapBucket",cy,{omit:["layers"]});var v1={get paint(){return hy=hy||new f({"heatmap-radius":new st(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gu(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(ge.paint_heatmap["heatmap-opacity"])})}};function Qp(r,{width:t,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*o}`)}else c=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=c,r}function dy(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const c=Qp({},{width:t,height:n},o);ef(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=c.data}function ef(r,t,n,o,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=t.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const T=((n.y+x)*r.width+n.x)*m,C=((o.y+x)*t.width+o.x)*m;for(let E=0;E<c.width*m;E++)_[C+E]=g[T+E]}return t}class Ju{constructor(t,n){Qp(this,t,1,n)}resize(t){dy(this,t,1)}clone(){return new Ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){ef(t,n,o,c,m,1)}}class Yi{constructor(t,n){Qp(this,t,4,n)}resize(t){dy(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Yi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){ef(t,n,o,c,m,4)}}function py(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new Yi({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,_,x)=>{t[r.evaluationKey]=x;const T=r.expression.evaluate(t);c.data[g+_+0]=Math.floor(255*T.r/T.a),c.data[g+_+1]=Math.floor(255*T.g/T.a),c.data[g+_+2]=Math.floor(255*T.b/T.a),c.data[g+_+3]=Math.floor(255*T.a)};if(r.clips)for(let g=0,_=0;g<o;++g,_+=4*n)for(let x=0,T=0;x<n;x++,T+=4){const C=x/(n-1),{start:E,end:z}=r.clips[g];m(_,T,E*(1-C)+z*C)}else for(let g=0,_=0;g<n;g++,_+=4)m(0,_,g/(n-1));return c}Ze("AlphaImage",Ju),Ze("RGBAImage",Yi);const tf="big-fb";class x1 extends s{createBucket(t){return new cy(t)}constructor(t){super(t,v1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=py({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(tf)&&this.heatmapFbos.delete(tf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let fy;var w1={get paint(){return fy=fy||new f({"hillshade-illumination-direction":new Xe(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(ge.paint_hillshade["hillshade-accent-color"])})}};class b1 extends s{constructor(t){super(t,w1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const S1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:k1}=S1;function my(r,t,n=2){const o=t&&t.length,c=o?t[0]*n:r.length;let m=gy(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let _,x,T;if(o&&(m=function(C,E,z,R){const B=[];for(let O=0,q=E.length;O<q;O++){const X=gy(C,E[O]*R,O<q-1?E[O+1]*R:C.length,R,!1);X===X.next&&(X.steiner=!0),B.push(z1(X))}B.sort(E1);for(let O=0;O<B.length;O++)z=A1(B[O],z);return z}(r,t,m,n)),r.length>80*n){_=1/0,x=1/0;let C=-1/0,E=-1/0;for(let z=n;z<c;z+=n){const R=r[z],B=r[z+1];R<_&&(_=R),B<x&&(x=B),R>C&&(C=R),B>E&&(E=B)}T=Math.max(C-_,E-x),T=T!==0?32767/T:0}return Yu(m,g,n,_,x,T,0),g}function gy(r,t,n,o,c){let m;if(c===function(g,_,x,T){let C=0;for(let E=_,z=x-T;E<x;E+=T)C+=(g[z]-g[E])*(g[E+1]+g[z+1]),z=E;return C}(r,t,n,o)>0)for(let g=t;g<n;g+=o)m=vy(g/o|0,r[g],r[g+1],m);else for(let g=n-o;g>=t;g-=o)m=vy(g/o|0,r[g],r[g+1],m);return m&&Uh(m,m.next)&&(ec(m),m=m.next),m}function mo(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!Uh(o,o.next)&&hr(o.prev,o,o.next)!==0)o=o.next;else{if(ec(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Yu(r,t,n,o,c,m,g){if(!r)return;!g&&m&&function(x,T,C,E){let z=x;do z.z===0&&(z.z=rf(z.x,z.y,T,C,E)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==x);z.prevZ.nextZ=null,z.prevZ=null,function(R){let B,O=1;do{let q,X=R;R=null;let pe=null;for(B=0;X;){B++;let ie=X,he=0;for(let Se=0;Se<O&&(he++,ie=ie.nextZ,ie);Se++);let ye=O;for(;he>0||ye>0&&ie;)he!==0&&(ye===0||!ie||X.z<=ie.z)?(q=X,X=X.nextZ,he--):(q=ie,ie=ie.nextZ,ye--),pe?pe.nextZ=q:R=q,q.prevZ=pe,pe=q;X=ie}pe.nextZ=null,O*=2}while(B>1)}(z)}(r,o,c,m);let _=r;for(;r.prev!==r.next;){const x=r.prev,T=r.next;if(m?I1(r,o,c,m):T1(r))t.push(x.i,r.i,T.i),ec(r),r=T.next,_=T.next;else if((r=T)===_){g?g===1?Yu(r=C1(mo(r),t),t,n,o,c,m,2):g===2&&P1(r,t,n,o,c,m):Yu(mo(r),t,n,o,c,m,1);break}}}function T1(r){const t=r.prev,n=r,o=r.next;if(hr(t,n,o)>=0)return!1;const c=t.x,m=n.x,g=o.x,_=t.y,x=n.y,T=o.y,C=c<m?c<g?c:g:m<g?m:g,E=_<x?_<T?_:T:x<T?x:T,z=c>m?c>g?c:g:m>g?m:g,R=_>x?_>T?_:T:x>T?x:T;let B=o.next;for(;B!==t;){if(B.x>=C&&B.x<=z&&B.y>=E&&B.y<=R&&yl(c,_,m,x,g,T,B.x,B.y)&&hr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function I1(r,t,n,o){const c=r.prev,m=r,g=r.next;if(hr(c,m,g)>=0)return!1;const _=c.x,x=m.x,T=g.x,C=c.y,E=m.y,z=g.y,R=_<x?_<T?_:T:x<T?x:T,B=C<E?C<z?C:z:E<z?E:z,O=_>x?_>T?_:T:x>T?x:T,q=C>E?C>z?C:z:E>z?E:z,X=rf(R,B,t,n,o),pe=rf(O,q,t,n,o);let ie=r.prevZ,he=r.nextZ;for(;ie&&ie.z>=X&&he&&he.z<=pe;){if(ie.x>=R&&ie.x<=O&&ie.y>=B&&ie.y<=q&&ie!==c&&ie!==g&&yl(_,C,x,E,T,z,ie.x,ie.y)&&hr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,he.x>=R&&he.x<=O&&he.y>=B&&he.y<=q&&he!==c&&he!==g&&yl(_,C,x,E,T,z,he.x,he.y)&&hr(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ie&&ie.z>=X;){if(ie.x>=R&&ie.x<=O&&ie.y>=B&&ie.y<=q&&ie!==c&&ie!==g&&yl(_,C,x,E,T,z,ie.x,ie.y)&&hr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;he&&he.z<=pe;){if(he.x>=R&&he.x<=O&&he.y>=B&&he.y<=q&&he!==c&&he!==g&&yl(_,C,x,E,T,z,he.x,he.y)&&hr(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function C1(r,t){let n=r;do{const o=n.prev,c=n.next.next;!Uh(o,c)&&yy(o,n,n.next,c)&&Qu(o,c)&&Qu(c,o)&&(t.push(o.i,n.i,c.i),ec(n),ec(n.next),n=r=c),n=n.next}while(n!==r);return mo(n)}function P1(r,t,n,o,c,m){let g=r;do{let _=g.next.next;for(;_!==g.prev;){if(g.i!==_.i&&D1(g,_)){let x=_y(g,_);return g=mo(g,g.next),x=mo(x,x.next),Yu(g,t,n,o,c,m,0),void Yu(x,t,n,o,c,m,0)}_=_.next}g=g.next}while(g!==r)}function E1(r,t){return r.x-t.x}function A1(r,t){const n=function(c,m){let g=m;const _=c.x,x=c.y;let T,C=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const O=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(O<=_&&O>C&&(C=O,T=g.x<g.next.x?g:g.next,O===_))return T}g=g.next}while(g!==m);if(!T)return null;const E=T,z=T.x,R=T.y;let B=1/0;g=T;do{if(_>=g.x&&g.x>=z&&_!==g.x&&yl(x<R?_:C,x,z,R,x<R?C:_,x,g.x,g.y)){const O=Math.abs(x-g.y)/(_-g.x);Qu(g,c)&&(O<B||O===B&&(g.x>T.x||g.x===T.x&&M1(T,g)))&&(T=g,B=O)}g=g.next}while(g!==E);return T}(r,t);if(!n)return t;const o=_y(n,r);return mo(o,o.next),mo(n,n.next)}function M1(r,t){return hr(r.prev,r,t.prev)<0&&hr(t.next,r,r.next)<0}function rf(r,t,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function z1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function yl(r,t,n,o,c,m,g,_){return(c-g)*(t-_)>=(r-g)*(m-_)&&(r-g)*(o-_)>=(n-g)*(t-_)&&(n-g)*(m-_)>=(c-g)*(o-_)}function D1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,o){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&yy(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,t)&&(Qu(r,t)&&Qu(t,r)&&function(n,o){let c=n,m=!1;const g=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&g<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,t)&&(hr(r.prev,r,t.prev)||hr(r,t.prev,t))||Uh(r,t)&&hr(r.prev,r,r.next)>0&&hr(t.prev,t,t.next)>0)}function hr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function Uh(r,t){return r.x===t.x&&r.y===t.y}function yy(r,t,n,o){const c=Zh(hr(r,t,n)),m=Zh(hr(r,t,o)),g=Zh(hr(n,o,r)),_=Zh(hr(n,o,t));return c!==m&&g!==_||!(c!==0||!$h(r,n,t))||!(m!==0||!$h(r,o,t))||!(g!==0||!$h(n,r,o))||!(_!==0||!$h(n,t,o))}function $h(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function Zh(r){return r>0?1:r<0?-1:0}function Qu(r,t){return hr(r.prev,r,r.next)<0?hr(r,t,r.next)>=0&&hr(r,r.prev,t)>=0:hr(r,t,r.prev)<0||hr(r,r.next,t)<0}function _y(r,t){const n=nf(r.i,r.x,r.y),o=nf(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function vy(r,t,n,o){const c=nf(r,t,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function ec(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function nf(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sf(r,t,n){const o=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const _=g.constantOr(null);_&&(c=!0,o[_.to]=!0,o[_.from]=!0)}return c}function af(r,t,n,o,c){const m=c.patternDependencies;for(const g of t){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o-1},n,{},c.availableImages),T=_.evaluate({zoom:o},n,{},c.availableImages),C=_.evaluate({zoom:o+1},n,{},c.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,m[x]=!0,m[T]=!0,m[C]=!0,n.patterns[g.id]={min:x,mid:T,max:C}}}return n}class of{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vn,this.indexArray=new Ji,this.indexArray2=new Er,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new St,this.segments2=new St,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=sf("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:C}of t){const E=this.layers[0]._featureFilter.needGeometry,z=fo(_,E);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),z,o))continue;const R=m?c.evaluate(z,{},o,n.availableImages):void 0,B={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:T,geometry:E?z.geometry:po(_),patterns:{},sortKey:R};g.push(B)}m&&g.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of g){const{geometry:x,index:T,sourceLayerIndex:C}=_;if(this.hasPattern){const E=af("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(_,x,T,o,{});n.featureIndex.insert(t[T].feature,x,T,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,k1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,c,m){for(const g of Vo(n,500)){let _=0;for(const R of g)_+=R.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),T=x.vertexLength,C=[],E=[];for(const R of g){if(R.length===0)continue;R!==g[0]&&E.push(C.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(O+R.length-1,O),C.push(R[0].x),C.push(R[0].y);for(let q=1;q<R.length;q++)this.layoutVertexArray.emplaceBack(R[q].x,R[q].y),this.indexArray2.emplaceBack(O+q-1,O+q),C.push(R[q].x),C.push(R[q].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const z=my(C,E);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(T+z[R],T+z[R+1],T+z[R+2]);x.vertexLength+=_,x.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}let xy,wy;Ze("FillBucket",of,{omit:["layers","patternFeatures"]});var L1={get paint(){return wy=wy||new f({"fill-antialias":new Xe(ge.paint_fill["fill-antialias"]),"fill-opacity":new st(ge.paint_fill["fill-opacity"]),"fill-color":new st(ge.paint_fill["fill-color"]),"fill-outline-color":new st(ge.paint_fill["fill-outline-color"]),"fill-translate":new Xe(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(ge.paint_fill["fill-pattern"])})},get layout(){return xy=xy||new f({"fill-sort-key":new st(ge.layout_fill["fill-sort-key"])})}};class R1 extends s{constructor(t){super(t,L1)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new of(t)}queryRadius(){return Nh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_){return iy(jh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),c)}isTileClipped(){return!0}}const F1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),B1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:O1}=F1;var da={},N1=ue,by=_l;function _l(r,t,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(j1,this,t)}function j1(r,t,n){r==1?t.id=n.readVarint():r==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[g]=_}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function V1(r){for(var t,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return o}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,_=[];r.pos<n;){if(c<=0){var x=r.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(t&&_.push(t),t=[]),t.push(new N1(m,g));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&_.push(t),_},_l.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,_=-1/0,x=1/0,T=-1/0;r.pos<t;){if(o<=0){var C=r.readVarint();n=7&C,o=C>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>_&&(_=c),(m+=r.readSVarint())<x&&(x=m),m>T&&(T=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,_,T]},_l.prototype.toGeoJSON=function(r,t,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,_=this.extent*t,x=this.loadGeometry(),T=_l.types[this.type];function C(R){for(var B=0;B<R.length;B++){var O=R[B];R[B]=[360*(O.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(o=0;o<x.length;o++)E[o]=x[o][0];C(x=E);break;case 2:for(o=0;o<x.length;o++)C(x[o]);break;case 3:for(x=function(R){var B=R.length;if(B<=1)return[R];for(var O,q,X=[],pe=0;pe<B;pe++){var ie=V1(R[pe]);ie!==0&&(q===void 0&&(q=ie<0),q===ie<0?(O&&X.push(O),O=[R[pe]]):O.push(R[pe]))}return O&&X.push(O),X}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)C(x[o][c])}x.length===1?x=x[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:x},properties:this.properties};return"id"in this&&(z.id=this.id),z};var U1=by,Sy=ky;function ky(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields($1,this,t),this.length=this._features.length}function $1(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}ky.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new U1(this._pbf,t,this.extent,this._keys,this._values)};var Z1=Sy;function q1(r,t,n){if(r===3){var o=new Z1(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}da.VectorTile=function(r,t){this.layers=r.readFields(q1,{},t)},da.VectorTileFeature=by,da.VectorTileLayer=Sy;const G1=da.VectorTileFeature.types,lf=Math.pow(2,13);function tc(r,t,n,o,c,m,g,_){r.emplaceBack(t,n,2*Math.floor(o*lf)+g,c*lf*2,m*lf*2,Math.round(_))}class uf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new aa,this.centroidVertexArray=new Fr,this.indexArray=new Ji,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new St,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=sf("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,T=fo(c,x);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),T,o))continue;const C={id:m,sourceLayerIndex:_,index:g,geometry:x?T.geometry:po(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(af("fill-extrusion",this.layers,C,this.zoom,n)):this.addFeature(C,C.geometry,g,o,{}),n.featureIndex.insert(c,C.geometry,g,_,this.index,!0)}}addFeatures(t,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,O1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,B1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,c,m){for(const g of Vo(n,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const B of g)x+=B.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of g){if(B.length===0||W1(B))continue;let O=0;for(let q=0;q<B.length;q++){const X=B[q];if(q>=1){const pe=B[q-1];if(!H1(X,pe)){T.vertexLength+4>St.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=X.sub(pe)._perp()._unit(),he=pe.dist(X);O+he>32768&&(O=0),tc(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,0,O),tc(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,1,O),_.x+=2*X.x,_.y+=2*X.y,_.vertexCount+=2,O+=he,tc(this.layoutVertexArray,pe.x,pe.y,ie.x,ie.y,0,0,O),tc(this.layoutVertexArray,pe.x,pe.y,ie.x,ie.y,0,1,O),_.x+=2*pe.x,_.y+=2*pe.y,_.vertexCount+=2;const ye=T.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+x>St.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),G1[t.type]!=="Polygon")continue;const C=[],E=[],z=T.vertexLength;for(const B of g)if(B.length!==0){B!==g[0]&&E.push(C.length/2);for(let O=0;O<B.length;O++){const q=B[O];tc(this.layoutVertexArray,q.x,q.y,0,0,1,1,0),_.x+=q.x,_.y+=q.y,_.vertexCount+=1,C.push(q.x),C.push(q.y)}}const R=my(C,E);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(z+R[B],z+R[B+2],z+R[B+1]);T.primitiveLength+=R.length/3,T.vertexLength+=x;for(let B=0;B<_.vertexCount;B++){const O=Math.floor(_.x/_.vertexCount),q=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(O,q)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}function H1(r,t){return r.x===t.x&&(r.x<0||r.x>yr)||r.y===t.y&&(r.y<0||r.y>yr)}function W1(r){return r.every(t=>t.x<0)||r.every(t=>t.x>yr)||r.every(t=>t.y<0)||r.every(t=>t.y>yr)}let Ty;Ze("FillExtrusionBucket",uf,{omit:["layers","features"]});var X1={get paint(){return Ty=Ty||new f({"fill-extrusion-opacity":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class K1 extends s{constructor(t){super(t,X1)}createBucket(t){return new uf(t)}queryRadius(){return Nh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,c,m,g,_,x){const T=jh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(n,o),E=this.paint.get("fill-extrusion-base").evaluate(n,o),z=function(B,O,q,X){const pe=[];for(const ie of B){const he=[ie.x,ie.y,0,1];Vh(he,he,O),pe.push(new ae(he[0]/he[3],he[1]/he[3]))}return pe}(T,x),R=function(B,O,q,X){const pe=[],ie=[],he=X[8]*O,ye=X[9]*O,Se=X[10]*O,Ve=X[11]*O,nt=X[8]*q,Ne=X[9]*q,Re=X[10]*q,Ye=X[11]*q;for(const Ge of B){const $e=[],ve=[];for(const Qe of Ge){const Je=Qe.x,lt=Qe.y,Ut=X[0]*Je+X[4]*lt+X[12],Vt=X[1]*Je+X[5]*lt+X[13],kr=X[2]*Je+X[6]*lt+X[14],xn=X[3]*Je+X[7]*lt+X[15],Nr=kr+Se,Tr=xn+Ve,oi=Ut+nt,li=Vt+Ne,ui=kr+Re,lr=xn+Ye,Ir=new ae((Ut+he)/Tr,(Vt+ye)/Tr);Ir.z=Nr/Tr,$e.push(Ir);const Wr=new ae(oi/lr,li/lr);Wr.z=ui/lr,ve.push(Wr)}pe.push($e),ie.push(ve)}return[pe,ie]}(c,E,C,x);return function(B,O,q){let X=1/0;iy(q,O)&&(X=Iy(q,O[0]));for(let pe=0;pe<O.length;pe++){const ie=O[pe],he=B[pe];for(let ye=0;ye<ie.length-1;ye++){const Se=ie[ye],Ve=[Se,ie[ye+1],he[ye+1],he[ye],Se];ry(q,Ve)&&(X=Math.min(X,Iy(q,Ve)))}}return X!==1/0&&X}(R[0],R[1],z)}}function rc(r,t){return r.x*t.x+r.y*t.y}function Iy(r,t){if(r.length===1){let n=0;const o=t[n++];let c;for(;!c||o.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],_=c.sub(o),x=m.sub(o),T=g.sub(o),C=rc(_,_),E=rc(_,x),z=rc(x,x),R=rc(T,_),B=rc(T,x),O=C*z-E*E,q=(z*R-E*B)/O,X=(C*B-E*R)/O,pe=o.z*(1-q-X)+c.z*q+m.z*X;if(isFinite(pe))return pe}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const J1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Y1}=J1,Q1=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ew}=Q1,tw=da.VectorTileFeature.types,rw=Math.cos(Math.PI/180*37.5),Cy=Math.pow(2,14)/.5;class cf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ul,this.layoutVertexArray2=new oa,this.indexArray=new Ji,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new St,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=sf("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:C}of t){const E=this.layers[0]._featureFilter.needGeometry,z=fo(_,E);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),z,o))continue;const R=m?c.evaluate(z,{},o):void 0,B={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:T,geometry:E?z.geometry:po(_),patterns:{},sortKey:R};g.push(B)}m&&g.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of g){const{geometry:x,index:T,sourceLayerIndex:C}=_;if(this.hasPattern){const E=af("line",this.layers,_,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(_,x,T,o,{});n.featureIndex.insert(t[T].feature,x,T,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ew)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Y1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,c,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),T=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const E of n)this.addLine(E,t,_,x,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}addLine(t,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=tw[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let T=0;for(;T<x-1&&t[T].equals(t[T+1]);)T++;if(x<(_?3:2))return;o==="bevel"&&(m=1.05);const C=this.overscaling<=16?15*yr/(512*this.overscaling):0,E=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let z,R,B,O,q;this.e1=this.e2=-1,_&&(z=t[x-2],q=t[T].sub(z)._unit()._perp());for(let X=T;X<x;X++){if(B=X===x-1?_?t[T+1]:void 0:t[X+1],B&&t[X].equals(B))continue;q&&(O=q),z&&(R=z),z=t[X],q=B?B.sub(z)._unit()._perp():O,O=O||q;let pe=O.add(q);pe.x===0&&pe.y===0||pe._unit();const ie=O.x*q.x+O.y*q.y,he=pe.x*q.x+pe.y*q.y,ye=he!==0?1/he:1/0,Se=2*Math.sqrt(2-2*he),Ve=he<rw&&R&&B,nt=O.x*q.y-O.y*q.x>0;if(Ve&&X>T){const Ye=z.dist(R);if(Ye>2*C){const Ge=z.sub(z.sub(R)._mult(C/Ye)._round());this.updateDistance(R,Ge),this.addCurrentVertex(Ge,O,0,0,E),R=Ge}}const Ne=R&&B;let Re=Ne?o:_?"butt":c;if(Ne&&Re==="round"&&(ye<g?Re="miter":ye<=2&&(Re="fakeround")),Re==="miter"&&ye>m&&(Re="bevel"),Re==="bevel"&&(ye>2&&(Re="flipbevel"),ye<m&&(Re="miter")),R&&this.updateDistance(R,z),Re==="miter")pe._mult(ye),this.addCurrentVertex(z,pe,0,0,E);else if(Re==="flipbevel"){if(ye>100)pe=q.mult(-1);else{const Ye=ye*O.add(q).mag()/O.sub(q).mag();pe._perp()._mult(Ye*(nt?-1:1))}this.addCurrentVertex(z,pe,0,0,E),this.addCurrentVertex(z,pe.mult(-1),0,0,E)}else if(Re==="bevel"||Re==="fakeround"){const Ye=-Math.sqrt(ye*ye-1),Ge=nt?Ye:0,$e=nt?0:Ye;if(R&&this.addCurrentVertex(z,O,Ge,$e,E),Re==="fakeround"){const ve=Math.round(180*Se/Math.PI/20);for(let Qe=1;Qe<ve;Qe++){let Je=Qe/ve;if(Je!==.5){const Ut=Je-.5;Je+=Je*Ut*(Je-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Ut*Ut+(.848013+ie*(.215638*ie-1.06021)))}const lt=q.sub(O)._mult(Je)._add(O)._unit()._mult(nt?-1:1);this.addHalfVertex(z,lt.x,lt.y,!1,nt,0,E)}}B&&this.addCurrentVertex(z,q,-Ge,-$e,E)}else if(Re==="butt")this.addCurrentVertex(z,pe,0,0,E);else if(Re==="square"){const Ye=R?1:-1;this.addCurrentVertex(z,pe,Ye,Ye,E)}else Re==="round"&&(R&&(this.addCurrentVertex(z,O,0,0,E),this.addCurrentVertex(z,O,1,1,E,!0)),B&&(this.addCurrentVertex(z,q,-1,-1,E,!0),this.addCurrentVertex(z,q,0,0,E)));if(Ve&&X<x-1){const Ye=z.dist(B);if(Ye>2*C){const Ge=z.add(B.sub(z)._mult(C/Ye)._round());this.updateDistance(z,Ge),this.addCurrentVertex(Ge,q,0,0,E),z=Ge}}}}addCurrentVertex(t,n,o,c,m,g=!1){const _=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(t,_,x,g,!0,-c,m),this.distance>Cy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,c,m,g))}addHalfVertex({x:t,y:n},o,c,m,g,_,x){const T=.5*(this.lineClips?this.scaledDistance*(Cy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),x.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Py,Ey;Ze("LineBucket",cf,{omit:["layers","patternFeatures"]});var Ay={get paint(){return Ey=Ey||new f({"line-opacity":new st(ge.paint_line["line-opacity"]),"line-color":new st(ge.paint_line["line-color"]),"line-translate":new Xe(ge.paint_line["line-translate"]),"line-translate-anchor":new Xe(ge.paint_line["line-translate-anchor"]),"line-width":new st(ge.paint_line["line-width"]),"line-gap-width":new st(ge.paint_line["line-gap-width"]),"line-offset":new st(ge.paint_line["line-offset"]),"line-blur":new st(ge.paint_line["line-blur"]),"line-dasharray":new ll(ge.paint_line["line-dasharray"]),"line-pattern":new ol(ge.paint_line["line-pattern"]),"line-gradient":new Gu(ge.paint_line["line-gradient"])})},get layout(){return Py=Py||new f({"line-cap":new Xe(ge.layout_line["line-cap"]),"line-join":new st(ge.layout_line["line-join"]),"line-miter-limit":new Xe(ge.layout_line["line-miter-limit"]),"line-round-limit":new Xe(ge.layout_line["line-round-limit"]),"line-sort-key":new st(ge.layout_line["line-sort-key"])})}};class iw extends st{possiblyEvaluate(t,n){return n=new Gt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,c){return n=He({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,c)}}let qh;class nw extends s{constructor(t){super(t,Ay),this.gradientVersion=0,qh||(qh=new iw(Ay.paint.properties["line-width"].specification),qh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=qh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cf(t)}queryRadius(t){const n=t,o=My(Xu("line-width",this,n),Xu("line-gap-width",this,n)),c=Xu("line-offset",this,n);return o/2+Math.abs(c)+Nh(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_){const x=jh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),T=_/2*My(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(c=function(E,z){const R=[];for(let B=0;B<E.length;B++){const O=E[B],q=[];for(let X=0;X<O.length;X++){const pe=O[X-1],ie=O[X],he=O[X+1],ye=X===0?new ae(0,0):ie.sub(pe)._unit()._perp(),Se=X===O.length-1?new ae(0,0):he.sub(ie)._unit()._perp(),Ve=ye._add(Se)._unit(),nt=Ve.x*Se.x+Ve.y*Se.y;nt!==0&&Ve._mult(1/nt),q.push(Ve._mult(z)._add(ie))}R.push(q)}return R}(c,C*_)),function(E,z,R){for(let B=0;B<z.length;B++){const O=z[B];if(E.length>=3){for(let q=0;q<O.length;q++)if(ml(E,O[q]))return!0}if(p1(E,O,R))return!0}return!1}(x,c,T)}isTileClipped(){return!0}}function My(r,t){return t>0?t+2*r:r}const sw=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),aw=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ow=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zy=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lw=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function uw(r,t,n){return r.sections.forEach(o=>{o.text=function(c,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),vi.applyArabicShaping&&(c=vi.applyArabicShaping(c)),c}(o.text,t,n)}),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ic={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var vr=24,Dy=jt,Ly=function(r,t,n,o,c){var m,g,_=8*c-o-1,x=(1<<_)-1,T=x>>1,C=-7,E=c-1,z=-1,R=r[t+E];for(E+=z,m=R&(1<<-C)-1,R>>=-C,C+=_;C>0;m=256*m+r[t+E],E+=z,C-=8);for(g=m&(1<<-C)-1,m>>=-C,C+=o;C>0;g=256*g+r[t+E],E+=z,C-=8);if(m===0)m=1-T;else{if(m===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,o),m-=T}return(R?-1:1)*g*Math.pow(2,m-o)},Ry=function(r,t,n,o,c,m){var g,_,x,T=8*m-c-1,C=(1<<T)-1,E=C>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,g=C):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+E>=1?z/x:z*Math.pow(2,1-E))*x>=2&&(g++,x/=2),g+E>=C?(_=0,g=C):g+E>=1?(_=(t*x-1)*Math.pow(2,c),g+=E):(_=t*Math.pow(2,E-1)*Math.pow(2,c),g=0));c>=8;r[n+R]=255&_,R+=B,_/=256,c-=8);for(g=g<<c|_,T+=c;T>0;r[n+R]=255&g,R+=B,g/=256,T-=8);r[n+R-B]|=128*O};function jt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var hf=4294967296,Fy=1/hf,By=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ks(r){return r.type===jt.Bytes?r.readVarint()+r.pos:r.pos+1}function vl(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Oy(r,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function cw(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function hw(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function dw(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function pw(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function fw(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function mw(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function gw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function yw(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function _w(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function Gh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function xl(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function Ny(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}jt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,t,this),this.pos===m&&this.skip(o)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Gh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Ny(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Gh(this.buf,this.pos)+Gh(this.buf,this.pos+4)*hf;return this.pos+=8,r},readSFixed64:function(){var r=Gh(this.buf,this.pos)+Ny(this.buf,this.pos+4)*hf;return this.pos+=8,r},readFloat:function(){var r=Ly(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Ly(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(c,m,g){var _,x,T=g.buf;if(_=(112&(x=T[g.pos++]))>>4,x<128||(_|=(127&(x=T[g.pos++]))<<3,x<128)||(_|=(127&(x=T[g.pos++]))<<10,x<128)||(_|=(127&(x=T[g.pos++]))<<17,x<128)||(_|=(127&(x=T[g.pos++]))<<24,x<128)||(_|=(1&(x=T[g.pos++]))<<31,x<128))return vl(c,_,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&By?function(n,o,c){return By.decode(n.subarray(o,c))}(this.buf,t,r):function(n,o,c){for(var m="",g=o;g<c;){var _,x,T,C=n[g],E=null,z=C>239?4:C>223?3:C>191?2:1;if(g+z>c)break;z===1?C<128&&(E=C):z===2?(192&(_=n[g+1]))==128&&(E=(31&C)<<6|63&_)<=127&&(E=null):z===3?(x=n[g+2],(192&(_=n[g+1]))==128&&(192&x)==128&&((E=(15&C)<<12|(63&_)<<6|63&x)<=2047||E>=55296&&E<=57343)&&(E=null)):z===4&&(x=n[g+2],T=n[g+3],(192&(_=n[g+1]))==128&&(192&x)==128&&(192&T)==128&&((E=(15&C)<<18|(63&_)<<12|(63&x)<<6|63&T)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,z=1):E>65535&&(E-=65536,m+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),m+=String.fromCharCode(E),g+=z}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==jt.Bytes)return r.push(this.readVarint(t));var n=ks(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==jt.Bytes)return r.push(this.readSVarint());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==jt.Bytes)return r.push(this.readBoolean());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==jt.Bytes)return r.push(this.readFloat());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==jt.Bytes)return r.push(this.readDouble());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed32());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed32());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed64());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed64());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===jt.Varint)for(;this.buf[this.pos++]>127;);else if(t===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jt.Fixed32)this.pos+=4;else{if(t!==jt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),xl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),xl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),xl(this.buf,-1&r,this.pos),xl(this.buf,Math.floor(r*Fy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),xl(this.buf,-1&r,this.pos),xl(this.buf,Math.floor(r*Fy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(o,c,m){for(var g,_,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!_){g>56319||x+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):_=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(o[m++]=239,o[m++]=191,o[m++]=189,_=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Oy(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Ry(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ry(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var o=this.pos-n;o>=128&&Oy(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,t,n){this.writeTag(r,jt.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,cw,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,hw,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,fw,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,dw,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,pw,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,mw,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,gw,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,yw,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,_w,t)},writeBytesField:function(r,t){this.writeTag(r,jt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,jt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,jt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var df=$(Dy);const pf=3;function vw(r,t,n){r===1&&n.readMessage(xw,t)}function xw(r,t,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:_,top:x,advance:T}=n.readMessage(ww,{});t.push({id:o,bitmap:new Ju({width:m+2*pf,height:g+2*pf},c),metrics:{width:m,height:g,left:_,top:x,advance:T}})}}function ww(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const jy=pf;function Vy(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,_)=>_.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let _=o.length-1;_>=0;_--){const x=o[_];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const T=o.pop();_<o.length&&(o[_]=T)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(o.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const wi=1;class ff{constructor(t,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+wi,this.paddedRect.y+wi]}get br(){return[this.paddedRect.x+this.paddedRect.w-wi,this.paddedRect.y+this.paddedRect.h-wi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wi)/this.pixelRatio,(this.paddedRect.h-2*wi)/this.pixelRatio]}}class Uy{constructor(t,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,c,m);const{w:g,h:_}=Vy(m),x=new Yi({width:g||1,height:_||1});for(const T in t){const C=t[T],E=o[T].paddedRect;Yi.copy(C.data,x,{x:0,y:0},{x:E.x+wi,y:E.y+wi},C.data)}for(const T in n){const C=n[T],E=c[T].paddedRect,z=E.x+wi,R=E.y+wi,B=C.data.width,O=C.data.height;Yi.copy(C.data,x,{x:0,y:0},{x:z,y:R},C.data),Yi.copy(C.data,x,{x:0,y:O-1},{x:z,y:R-1},{width:B,height:1}),Yi.copy(C.data,x,{x:0,y:0},{x:z,y:R+O},{width:B,height:1}),Yi.copy(C.data,x,{x:B-1,y:0},{x:z-1,y:R},{width:1,height:O}),Yi.copy(C.data,x,{x:0,y:0},{x:z+B,y:R},{width:1,height:O})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(t,n,o){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*wi,h:m.data.height+2*wi};o.push(g),n[c]=new ff(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;o.update(n.data,void 0,{x:c,y:m})}}var pa;Ze("ImagePosition",ff),Ze("ImageAtlas",Uy),S.ah=void 0,(pa=S.ah||(S.ah={}))[pa.none=0]="none",pa[pa.horizontal=1]="horizontal",pa[pa.vertical=2]="vertical",pa[pa.horizontalOnly=3]="horizontalOnly";const nc=-17;class sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new sc;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new sc;return n.imageName=t,n}}class wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new wl;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const c=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=c&&zh(c)&&!ic[t[o+1]]||m&&zh(m)&&!ic[t[o-1]]||!ic[t[o]]?t[o]:ic[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Wh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Wh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new wl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(sc.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void sr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(sc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hh(r,t,n,o,c,m,g,_,x,T,C,E,z,R,B){const O=wl.fromFeature(r,c);let q;E===S.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:pe}=vi;if(X&&O.sections.length===1){q=[];const ye=X(O.toString(),mf(O,T,m,t,o,R));for(const Se of ye){const Ve=new wl;Ve.text=Se,Ve.sections=O.sections;for(let nt=0;nt<Se.length;nt++)Ve.sectionIndex.push(0);q.push(Ve)}}else if(pe){q=[];const ye=pe(O.text,O.sectionIndex,mf(O,T,m,t,o,R));for(const Se of ye){const Ve=new wl;Ve.text=Se[0],Ve.sectionIndex=Se[1],Ve.sections=O.sections,q.push(Ve)}}else q=function(ye,Se){const Ve=[],nt=ye.text;let Ne=0;for(const Re of Se)Ve.push(ye.substring(Ne,Re)),Ne=Re;return Ne<nt.length&&Ve.push(ye.substring(Ne,nt.length)),Ve}(O,mf(O,T,m,t,o,R));const ie=[],he={positionedLines:ie,text:O.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(ye,Se,Ve,nt,Ne,Re,Ye,Ge,$e,ve,Qe,Je){let lt=0,Ut=nc,Vt=0,kr=0;const xn=Ge==="right"?1:Ge==="left"?0:.5;let Nr=0;for(const lr of Ne){lr.trim();const Ir=lr.getMaxScale(),Wr=(Ir-1)*vr,jr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Nr]=jr;const ci=jr.positionedGlyphs;let Vr=0;if(!lr.length()){Ut+=Re,++Nr;continue}for(let bi=0;bi<lr.length();bi++){const At=lr.getSection(bi),Zt=lr.getSectionIndex(bi),Kt=lr.getCharCode(bi);let Ri=0,tr=null,Tl=null,Qn=null,es=vr;const wn=!($e===S.ah.horizontal||!Qe&&!Zu(Kt)||Qe&&(Wh[Kt]||(Tr=Kt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Tr)))));if(At.imageName){const tn=nt[At.imageName];if(!tn)continue;Qn=At.imageName,ye.iconsInText=ye.iconsInText||!0,Tl=tn.paddedRect;const Ar=tn.displaySize;At.scale=At.scale*vr/Je,tr={width:Ar[0],height:Ar[1],left:wi,top:-jy,advance:wn?Ar[1]:Ar[0]},Ri=Wr+(vr-Ar[1]*At.scale),es=tr.advance;const Ts=wn?Ar[0]*At.scale-vr*Ir:Ar[1]*At.scale-vr*Ir;Ts>0&&Ts>Vr&&(Vr=Ts)}else{const tn=Ve[At.fontStack],Ar=tn&&tn[Kt];if(Ar&&Ar.rect)Tl=Ar.rect,tr=Ar.metrics;else{const Ts=Se[At.fontStack],hc=Ts&&Ts[Kt];if(!hc)continue;tr=hc.metrics}Ri=(Ir-At.scale)*vr}wn?(ye.verticalizable=!0,ci.push({glyph:Kt,imageName:Qn,x:lt,y:Ut+Ri,vertical:wn,scale:At.scale,fontStack:At.fontStack,sectionIndex:Zt,metrics:tr,rect:Tl}),lt+=es*At.scale+ve):(ci.push({glyph:Kt,imageName:Qn,x:lt,y:Ut+Ri,vertical:wn,scale:At.scale,fontStack:At.fontStack,sectionIndex:Zt,metrics:tr,rect:Tl}),lt+=tr.advance*At.scale+ve)}ci.length!==0&&(Vt=Math.max(lt-ve,Vt),Tw(ci,0,ci.length-1,xn,Vr)),lt=0;const en=Re*Ir+Vr;jr.lineOffset=Math.max(Vr,Wr),Ut+=en,kr=Math.max(en,kr),++Nr}var Tr;const oi=Ut-nc,{horizontalAlign:li,verticalAlign:ui}=gf(Ye);(function(lr,Ir,Wr,jr,ci,Vr,en,bi,At){const Zt=(Ir-Wr)*ci;let Kt=0;Kt=Vr!==en?-bi*jr-nc:(-jr*At+.5)*en;for(const Ri of lr)for(const tr of Ri.positionedGlyphs)tr.x+=Zt,tr.y+=Kt})(ye.positionedLines,xn,li,ui,Vt,kr,Re,oi,Ne.length),ye.top+=-ui*oi,ye.bottom=ye.top+oi,ye.left+=-li*Vt,ye.right=ye.left+Vt}(he,t,n,o,q,g,_,x,E,T,z,B),!function(ye){for(const Se of ye)if(Se.positionedGlyphs.length!==0)return!1;return!0}(ie)&&he}const Wh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Sw={40:!0};function $y(r,t,n,o,c,m){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*vr/m+c:0}{const g=n[t.fontStack],_=g&&g[r];return _?_.metrics.advance*t.scale+c:0}}function Zy(r,t,n,o){const c=Math.pow(r-t,2);return o?r<t?c/2:2*c:c+Math.abs(n)*n}function kw(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function qy(r,t,n,o,c,m){let g=null,_=Zy(t,n,c,m);for(const x of o){const T=Zy(t-x.x,n,c,m)+x.badness;T<=_&&(g=x,_=T)}return{index:r,x:t,priorBreak:g,badness:_}}function Gy(r){return r?Gy(r.priorBreak).concat(r.index):[]}function mf(r,t,n,o,c,m){if(!r)return[];const g=[],_=function(E,z,R,B,O,q){let X=0;for(let pe=0;pe<E.length();pe++){const ie=E.getSection(pe);X+=$y(E.getCharCode(pe),ie,B,O,z,q)}return X/Math.max(1,Math.ceil(X/R))}(r,t,n,o,c,m),x=r.text.indexOf("")>=0;let T=0;for(let E=0;E<r.length();E++){const z=r.getSection(E),R=r.getCharCode(E);if(Wh[R]||(T+=$y(R,z,o,c,t,m)),E<r.length()-1){const B=!((C=R)<11904)&&(!!bt["CJK Compatibility Forms"](C)||!!bt["CJK Compatibility"](C)||!!bt["CJK Strokes"](C)||!!bt["CJK Symbols and Punctuation"](C)||!!bt["Enclosed CJK Letters and Months"](C)||!!bt["Halfwidth and Fullwidth Forms"](C)||!!bt["Ideographic Description Characters"](C)||!!bt["Vertical Forms"](C)||Mh.test(String.fromCodePoint(C)));(bw[R]||B||z.imageName||E!==r.length()-2&&Sw[r.getCharCode(E+1)])&&g.push(qy(E+1,T,_,g,kw(R,r.getCharCode(E+1),B&&x),!1))}}var C;return Gy(qy(r.length(),T,_,g,0,!0))}function gf(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Tw(r,t,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let _=t;_<=n;_++)r[_].x-=g,r[_].y+=c}function Iw(r,t,n){const{horizontalAlign:o,verticalAlign:c}=gf(n),m=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Hy(r){var t,n;let o=r.left,c=r.top,m=r.right-o,g=r.bottom-c;const _=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",T=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&m/g<T||_==="proportional"){const C=Math.ceil(g*T);o*=C/m,m=C}}else if(_==="proportional"&&x==="stretchOnly"&&T!==0&&m/g>T){const C=Math.ceil(m/T);c*=C/g,g=C}return{x1:o,y1:c,x2:o+m,y2:c+g}}function Wy(r,t,n,o,c,m){const g=r.image;let _;if(g.content){const q=g.content,X=g.pixelRatio||1;_=[q[0]/X,q[1]/X,g.displaySize[0]-q[2]/X,g.displaySize[1]-q[3]/X]}const x=t.left*m,T=t.right*m;let C,E,z,R;n==="width"||n==="both"?(R=c[0]+x-o[3],E=c[0]+T+o[1]):(R=c[0]+(x+T-g.displaySize[0])/2,E=R+g.displaySize[0]);const B=t.top*m,O=t.bottom*m;return n==="height"||n==="both"?(C=c[1]+B-o[0],z=c[1]+O+o[2]):(C=c[1]+(B+O-g.displaySize[1])/2,z=C+g.displaySize[1]),{image:g,top:C,right:E,bottom:z,left:R,collisionPadding:_}}const ac=255,Yn=128,fa=ac*Yn;function Xy(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Gt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const _=o[m],x=o[g];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:n.evaluate(new Gt(_)),maxSize:n.evaluate(new Gt(x)),interpolationType:c}}}function yf(r,t,n){let o="never";const c=r.get(t);return c?o=c:r.get(n)&&(o="always"),o}const Cw=da.VectorTileFeature.types,Pw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xh(r,t,n,o,c,m,g,_,x,T,C,E,z){const R=_?Math.min(fa,Math.round(_[0])):0,B=_?Math.min(fa,Math.round(_[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*c),m,g,(R<<1)+(x?1:0),B,16*T,16*C,256*E,256*z)}function _f(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Ew(r){for(const t of r.sections)if(qp(t.text))return!0;return!1}class vf{constructor(t){this.layoutVertexArray=new cl,this.indexArray=new Ji,this.programConfigurations=t,this.segments=new St,this.dynamicLayoutVertexArray=new Hu,this.opacityVertexArray=new Di,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ht}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,aw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Pw,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",vf);class xf{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new St,this.collisionVertexArray=new Kn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ow.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ze("CollisionBuffers",xf);class bl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yp([]),this.placementViewportMatrix=Yp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xy(this.zoom,n["text-size"]),this.iconSizeData=Xy(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=yf(o,"text-overlap","text-allow-overlap")!=="never"||yf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new vf(new ho(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new vf(new ho(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Wt,this.lineVertexArray=new Rr,this.symbolInstances=new wt,this.textAnchorOffsets=new Xt}calculateGlyphDependencies(t,n,o,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(o||c)&&m){const _=ic[t.charAt(g)];_&&(n[_.charCodeAt(0)]=!0)}}populate(t,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),_=m.get("text-field"),x=m.get("icon-image"),T=(_.value.kind!=="constant"||_.value.value instanceof mi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,E=m.get("symbol-sort-key");if(this.features=[],!T&&!C)return;const z=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,O=new Gt(this.zoom);for(const{feature:q,id:X,index:pe,sourceLayerIndex:ie}of t){const he=c._featureFilter.needGeometry,ye=fo(q,he);if(!c._featureFilter.filter(O,ye,o))continue;let Se,Ve;if(he||(ye.geometry=po(q)),T){const Ne=c.getValueAndResolveTokens("text-field",ye,o,B),Re=mi.factory(Ne),Ye=this.hasRTLText=this.hasRTLText||Ew(Re);(!Ye||vi.getRTLTextPluginStatus()==="unavailable"||Ye&&vi.isParsed())&&(Se=uw(Re,c,ye))}if(C){const Ne=c.getValueAndResolveTokens("icon-image",ye,o,B);Ve=Ne instanceof yi?Ne:yi.fromString(Ne)}if(!Se&&!Ve)continue;const nt=this.sortFeaturesByKey?E.evaluate(ye,{},o):void 0;if(this.features.push({id:X,text:Se,icon:Ve,index:pe,sourceLayerIndex:ie,geometry:ye.geometry,properties:q.properties,type:Cw[q.type],sortKey:nt}),Ve&&(z[Ve.name]=!0),Se){const Ne=g.evaluate(ye,{},o).join(","),Re=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Ye of Se.sections)if(Ye.image)z[Ye.image.name]=!0;else{const Ge=Uu(Se.toString()),$e=Ye.fontStack||Ne,ve=R[$e]=R[$e]||{};this.calculateGlyphDependencies(Ye.text,ve,Re,this.allowVerticalPlacement,Ge)}}}m.get("symbol-placement")==="line"&&(this.features=function(q){const X={},pe={},ie=[];let he=0;function ye(Ne){ie.push(q[Ne]),he++}function Se(Ne,Re,Ye){const Ge=pe[Ne];return delete pe[Ne],pe[Re]=Ge,ie[Ge].geometry[0].pop(),ie[Ge].geometry[0]=ie[Ge].geometry[0].concat(Ye[0]),Ge}function Ve(Ne,Re,Ye){const Ge=X[Re];return delete X[Re],X[Ne]=Ge,ie[Ge].geometry[0].shift(),ie[Ge].geometry[0]=Ye[0].concat(ie[Ge].geometry[0]),Ge}function nt(Ne,Re,Ye){const Ge=Ye?Re[0][Re[0].length-1]:Re[0][0];return`${Ne}:${Ge.x}:${Ge.y}`}for(let Ne=0;Ne<q.length;Ne++){const Re=q[Ne],Ye=Re.geometry,Ge=Re.text?Re.text.toString():null;if(!Ge){ye(Ne);continue}const $e=nt(Ge,Ye),ve=nt(Ge,Ye,!0);if($e in pe&&ve in X&&pe[$e]!==X[ve]){const Qe=Ve($e,ve,Ye),Je=Se($e,ve,ie[Qe].geometry);delete X[$e],delete pe[ve],pe[nt(Ge,ie[Je].geometry,!0)]=Je,ie[Qe].geometry=null}else $e in pe?Se($e,ve,Ye):ve in X?Ve($e,ve,Ye):(ye(Ne),X[$e]=he-1,pe[ve]=he-1)}return ie.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,X)=>q.sortKey-X.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let _=t.segment+1;_<n.length;_++)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:c},_<n.length-1&&(c+=n[_+1].dist(n[_]));for(let _=t.segment||0;_>=0;_--)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=n[_-1].dist(n[_]));for(let _=0;_<n.length;_++){const x=g[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,c,m,g,_,x,T,C,E,z){const R=t.indexArray,B=t.layoutVertexArray,O=t.segments.prepareSegment(4*n.length,B,R,this.canOverlap?g.sortKey:void 0),q=this.glyphOffsetArray.length,X=O.vertexLength,pe=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,ie=g.text&&g.text.sections;for(let he=0;he<n.length;he++){const{tl:ye,tr:Se,bl:Ve,br:nt,tex:Ne,pixelOffsetTL:Re,pixelOffsetBR:Ye,minFontScaleX:Ge,minFontScaleY:$e,glyphOffset:ve,isSDF:Qe,sectionIndex:Je}=n[he],lt=O.vertexLength,Ut=ve[1];Xh(B,x.x,x.y,ye.x,Ut+ye.y,Ne.x,Ne.y,o,Qe,Re.x,Re.y,Ge,$e),Xh(B,x.x,x.y,Se.x,Ut+Se.y,Ne.x+Ne.w,Ne.y,o,Qe,Ye.x,Re.y,Ge,$e),Xh(B,x.x,x.y,Ve.x,Ut+Ve.y,Ne.x,Ne.y+Ne.h,o,Qe,Re.x,Ye.y,Ge,$e),Xh(B,x.x,x.y,nt.x,Ut+nt.y,Ne.x+Ne.w,Ne.y+Ne.h,o,Qe,Ye.x,Ye.y,Ge,$e),_f(t.dynamicLayoutVertexArray,x,pe),R.emplaceBack(lt,lt+1,lt+2),R.emplaceBack(lt+1,lt+2,lt+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ve[0]),he!==n.length-1&&Je===n[he+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,g,g.index,{},z,ie&&ie[Je])}t.placedSymbolArray.emplaceBack(x.x,x.y,q,this.glyphOffsetArray.length-q,X,T,C,x.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,E)}_addCollisionDebugVertex(t,n,o,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,o,c,m,g,_){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),T=x.vertexLength,C=m.layoutVertexArray,E=m.collisionVertexArray,z=_.anchorX,R=_.anchorY;this._addCollisionDebugVertex(C,E,g,z,R,new ae(t,n)),this._addCollisionDebugVertex(C,E,g,z,R,new ae(o,n)),this._addCollisionDebugVertex(C,E,g,z,R,new ae(o,c)),this._addCollisionDebugVertex(C,E,g,z,R,new ae(t,c)),x.vertexLength+=4;const B=m.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xf(Li,zy.members,Er),this.iconCollisionBox=new xf(Li,zy.members,Er);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,c,m,g,_,x,T){const C={};for(let E=n;E<o;E++){const z=t.get(E);C.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.textFeatureIndex=z.featureIndex;break}for(let E=c;E<m;E++){const z=t.get(E);C.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.verticalTextFeatureIndex=z.featureIndex;break}for(let E=g;E<_;E++){const z=t.get(E);C.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.iconFeatureIndex=z.featureIndex;break}for(let E=x;E<T;E++){const z=t.get(E);C.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},C.verticalIconFeatureIndex=z.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),c=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.anchorX+o*x.anchorY)),m.push(x.featureIndex)}return g.sort((_,x)=>c[_]-c[x]||m[x]-m[_]),g}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ky,Jy;Ze("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=_f;var wf={get paint(){return Jy=Jy||new f({"icon-opacity":new st(ge.paint_symbol["icon-opacity"]),"icon-color":new st(ge.paint_symbol["icon-color"]),"icon-halo-color":new st(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(ge.paint_symbol["text-opacity"]),"text-color":new st(ge.paint_symbol["text-color"],{runtimeType:ri,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new st(ge.paint_symbol["text-halo-color"]),"text-halo-width":new st(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new st(ge.paint_symbol["text-halo-blur"]),"text-translate":new Xe(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(ge.paint_symbol["text-translate-anchor"])})},get layout(){return Ky=Ky||new f({"symbol-placement":new Xe(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xe(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xe(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xe(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(ge.layout_symbol["icon-size"]),"icon-text-fit":new Xe(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xe(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(ge.layout_symbol["icon-image"]),"icon-rotate":new st(ge.layout_symbol["icon-rotate"]),"icon-padding":new st(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new st(ge.layout_symbol["icon-offset"]),"icon-anchor":new st(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(ge.layout_symbol["text-rotation-alignment"]),"text-field":new st(ge.layout_symbol["text-field"]),"text-font":new st(ge.layout_symbol["text-font"]),"text-size":new st(ge.layout_symbol["text-size"]),"text-max-width":new st(ge.layout_symbol["text-max-width"]),"text-line-height":new Xe(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new st(ge.layout_symbol["text-letter-spacing"]),"text-justify":new st(ge.layout_symbol["text-justify"]),"text-radial-offset":new st(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new st(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new st(ge.layout_symbol["text-anchor"]),"text-max-angle":new Xe(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(ge.layout_symbol["text-writing-mode"]),"text-rotate":new st(ge.layout_symbol["text-rotate"]),"text-padding":new Xe(ge.layout_symbol["text-padding"]),"text-keep-upright":new Xe(ge.layout_symbol["text-keep-upright"]),"text-transform":new st(ge.layout_symbol["text-transform"]),"text-offset":new st(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Xe(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Xe(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(ge.layout_symbol["text-optional"])})}};class Yy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Gn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",Yy,{omit:["defaultValue"]});class Kh extends s{constructor(t){super(t,wf)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,c){const m=this.layout.get(t).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Xo(g.value)||!m?m:function(_,x){return x.replace(/{([^{}]+)}/g,(T,C)=>_&&C in _?String(_[C]):"")}(n.properties,m)}createBucket(t){return new bl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of wf.paint.overridableProperties){if(!Kh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Yy(n),c=new Wo(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Js("source",c):new Ys("composite",c,n.value.zoomStops),this.paint._values[t]=new _n(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Kh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),c=wf.paint.properties[n];let m=!1;const g=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof mi)g(o.value.value.sections);else if(o.value.kind==="source"){const _=T=>{m||(T instanceof qi&&gr(T.value)===An?g(T.value.sections):T instanceof No?g(T.sections):T.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return m}}let Qy;var Aw={get paint(){return Qy=Qy||new f({"background-color":new Xe(ge.paint_background["background-color"]),"background-pattern":new ll(ge.paint_background["background-pattern"]),"background-opacity":new Xe(ge.paint_background["background-opacity"])})}};class Mw extends s{constructor(t){super(t,Aw)}}let e_;var zw={get paint(){return e_=e_||new f({"raster-opacity":new Xe(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xe(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(ge.paint_raster["raster-saturation"]),"raster-contrast":new Xe(ge.paint_raster["raster-contrast"]),"raster-resampling":new Xe(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(ge.paint_raster["raster-fade-duration"])})}};class Dw extends s{constructor(t){super(t,zw)}}class Lw extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Rw{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const bf=63710088e-1;class ma{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ma(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,c=t.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return bf*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof ma)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ma(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ma(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const t_=2*Math.PI*bf;function r_(r){return t_*Math.cos(r*Math.PI/180)}function i_(r){return(180+r)/360}function n_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function s_(r,t){return r/r_(t)}function Sf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class oc{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=ma.convert(t);return new oc(i_(o.lng),n_(o.lat),s_(n,o.lat))}toLngLat(){return new ma(360*this.x-180,Sf(this.y))}toAltitude(){return this.z*r_(Sf(this.y))}meterInMercatorCoordinateUnits(){return 1/t_*(t=Sf(this.y),1/Math.cos(t*Math.PI/180));var t}}function a_(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class kf{constructor(t,n,o){if(!function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=lc(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const c=(g=this.y,_=this.z,x=a_(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),T=a_(256*(m+1),256*(g+1),_),x[0]+","+x[1]+","+T[0]+","+T[1]);var m,g,_,x,T;const C=function(E,z,R){let B,O="";for(let q=E;q>0;q--)B=1<<q-1,O+=(z&B?1:0)+(R&B?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new ae((t.x*n-this.x)*yr,(t.y*n-this.y)*yr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class o_{constructor(t,n){this.wrap=t,this.canonical=n,this.key=lc(t,n.z,n.z,n.x,n.y)}}class Qi{constructor(t,n,o,c,m){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new kf(o,+c,+m),this.key=lc(n,t,o,c,m)}clone(){return new Qi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Qi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qi(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?lc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):lc(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Qi(n,this.wrap,n,o,c),new Qi(n,this.wrap,n,o+1,c),new Qi(n,this.wrap,n,o,c+1),new Qi(n,this.wrap,n,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Qi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new o_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new oc(t.x-this.wrap,t.y))}}function lc(r,t,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+t.toString(36)}Ze("CanonicalTileID",kf),Ze("OverscaledTileID",Qi,{omit:["posMatrix"]});class l_{constructor(t,n,o,c=1,m=1,g=1,_=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void sr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let C=0;C<x;C++){const E=this.get(T,C);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Yi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=_-1;break;case 1:_=g+1}const x=-n*this.dim,T=-o*this.dim;for(let C=g;C<_;C++)for(let E=c;E<m;E++)this.data[this._idx(E,C)]=t.data[this._idx(E+x,C+T)]}}Ze("DEMData",l_);class u_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class c_{constructor(t,n,o,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class h_{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ta(yr,16,0),this.grid3D=new ta(yr,16,0),this.featureIndexArray=new Gr,this.promoteId=n}insert(t,n,o,c,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const x=g?this.grid3D:this.grid;for(let T=0;T<n.length;T++){const C=n[T],E=[1/0,1/0,-1/0,-1/0];for(let z=0;z<C.length;z++){const R=C[z];E[0]=Math.min(E[0],R.x),E[1]=Math.min(E[1],R.y),E[2]=Math.max(E[2],R.x),E[3]=Math.max(E[3],R.y)}E[0]<yr&&E[1]<yr&&E[2]>=0&&E[3]>=0&&x.insert(_,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new da.VectorTile(new df(this.rawTileData)).layers,this.sourceLayerCoder=new u_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,c){this.loadVTLayers();const m=t.params||{},g=yr/t.tileSize/t.scale,_=Cu(m.filter),x=t.queryGeometry,T=t.queryPadding*g,C=p_(x),E=this.grid.query(C.minX-T,C.minY-T,C.maxX+T,C.maxY+T),z=p_(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,(q,X,pe,ie)=>function(he,ye,Se,Ve,nt){for(const Re of he)if(ye<=Re.x&&Se<=Re.y&&Ve>=Re.x&&nt>=Re.y)return!0;const Ne=[new ae(ye,Se),new ae(ye,nt),new ae(Ve,nt),new ae(Ve,Se)];if(he.length>2){for(const Re of Ne)if(ml(he,Re))return!0}for(let Re=0;Re<he.length-1;Re++)if(m1(he[Re],he[Re+1],Ne))return!0;return!1}(t.cameraQueryGeometry,q-T,X-T,pe+T,ie+T));for(const q of R)E.push(q);E.sort(Fw);const B={};let O;for(let q=0;q<E.length;q++){const X=E[q];if(X===O)continue;O=X;const pe=this.featureIndexArray.get(X);let ie=null;this.loadMatchingFeature(B,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,_,m.layers,m.availableImages,n,o,c,(he,ye,Se)=>(ie||(ie=po(he)),ye.queryIntersectsFeature(x,he,Se,ie,this.z,t.transform,g,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,o,c,m,g,_,x,T,C,E){const z=this.bucketLayerIDs[n];if(g&&!function(q,X){for(let pe=0;pe<q.length;pe++)if(X.indexOf(q[pe])>=0)return!0;return!1}(g,z))return;const R=this.sourceLayerCoder.decode(o),B=this.vtLayers[R].feature(c);if(m.needGeometry){const q=fo(B,!0);if(!m.filter(new Gt(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!m.filter(new Gt(this.tileID.overscaledZ),B))return;const O=this.getId(B,R);for(let q=0;q<z.length;q++){const X=z[q];if(g&&g.indexOf(X)<0)continue;const pe=x[X];if(!pe)continue;let ie={};O&&C&&(ie=C.getState(pe.sourceLayer||"_geojsonTileLayer",O));const he=He({},T[X]);he.paint=d_(he.paint,pe.paint,B,ie,_),he.layout=d_(he.layout,pe.layout,B,ie,_);const ye=!E||E(B,pe,ie);if(!ye)continue;const Se=new c_(B,this.z,this.x,this.y,O);Se.layer=he;let Ve=t[X];Ve===void 0&&(Ve=t[X]=[]),Ve.push({featureIndex:c,feature:Se,intersectionZ:ye})}}lookupSymbolFeatures(t,n,o,c,m,g,_,x){const T={};this.loadVTLayers();const C=Cu(m);for(const E of t)this.loadMatchingFeature(T,o,c,E,C,g,_,x,n);return T}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function d_(r,t,n,o,c){return Dt(r,(m,g)=>{const _=t instanceof lo?t.get(g):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function p_(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:o,maxY:c}}function Fw(r,t){return t-r}function f_(r,t,n,o,c){const m=[];for(let g=0;g<r.length;g++){const _=r[g];let x;for(let T=0;T<_.length-1;T++){let C=_[T],E=_[T+1];C.x<t&&E.x<t||(C.x<t?C=new ae(t,C.y+(t-C.x)/(E.x-C.x)*(E.y-C.y))._round():E.x<t&&(E=new ae(t,C.y+(t-C.x)/(E.x-C.x)*(E.y-C.y))._round()),C.y<n&&E.y<n||(C.y<n?C=new ae(C.x+(n-C.y)/(E.y-C.y)*(E.x-C.x),n)._round():E.y<n&&(E=new ae(C.x+(n-C.y)/(E.y-C.y)*(E.x-C.x),n)._round()),C.x>=o&&E.x>=o||(C.x>=o?C=new ae(o,C.y+(o-C.x)/(E.x-C.x)*(E.y-C.y))._round():E.x>=o&&(E=new ae(o,C.y+(o-C.x)/(E.x-C.x)*(E.y-C.y))._round()),C.y>=c&&E.y>=c||(C.y>=c?C=new ae(C.x+(c-C.y)/(E.y-C.y)*(E.x-C.x),c)._round():E.y>=c&&(E=new ae(C.x+(c-C.y)/(E.y-C.y)*(E.x-C.x),c)._round()),x&&C.equals(x[x.length-1])||(x=[C],m.push(x)),x.push(E)))))}}return m}Ze("FeatureIndex",h_,{omit:["rawTileData","sourceLayerCoder"]});class ga extends ae{constructor(t,n,o,c){super(t,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new ga(this.x,this.y,this.angle,this.segment)}}function m_(r,t,n,o,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,_=0;for(;_>-n/2;){if(g--,g<0)return!1;_-=r[g].dist(m),m=r[g]}_+=r[g].dist(r[g+1]),g++;const x=[];let T=0;for(;_<n/2;){const C=r[g],E=r[g+1];if(!E)return!1;let z=r[g-1].angleTo(C)-C.angleTo(E);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:z}),T+=z;_-x[0].distance>o;)T-=x.shift().angleDelta;if(T>c)return!1;g++,_+=C.dist(E)}return!0}function g_(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function y_(r,t,n){return r?.6*t*n:0}function __(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Bw(r,t,n,o,c,m){const g=y_(n,c,m),_=__(n,o)*m;let x=0;const T=g_(r)/2;for(let C=0;C<r.length-1;C++){const E=r[C],z=r[C+1],R=E.dist(z);if(x+R>T){const B=(T-x)/R,O=ii.number(E.x,z.x,B),q=ii.number(E.y,z.y,B),X=new ga(O,q,z.angleTo(E),C);return X._round(),!g||m_(r,X,_,g,t)?X:void 0}x+=R}}function Ow(r,t,n,o,c,m,g,_,x){const T=y_(o,m,g),C=__(o,c),E=C*g,z=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-E<t/4&&(t=E+t/4),v_(r,z?t/2*_%t:(C/2+2*m)*g*_%t,t,T,n,E,z,!1,x)}function v_(r,t,n,o,c,m,g,_,x){const T=m/2,C=g_(r);let E=0,z=t-n,R=[];for(let B=0;B<r.length-1;B++){const O=r[B],q=r[B+1],X=O.dist(q),pe=q.angleTo(O);for(;z+n<E+X;){z+=n;const ie=(z-E)/X,he=ii.number(O.x,q.x,ie),ye=ii.number(O.y,q.y,ie);if(he>=0&&he<x&&ye>=0&&ye<x&&z-T>=0&&z+T<=C){const Se=new ga(he,ye,pe,B);Se._round(),o&&!m_(r,Se,m,o,c)||R.push(Se)}}E+=X}return _||R.length||g||(R=v_(r,E/2,n,o,c,m,g,!0,x)),R}Ze("Anchor",ga);const Sl=wi;function x_(r,t,n,o){const c=[],m=r.image,g=m.pixelRatio,_=m.paddedRect.w-2*Sl,x=m.paddedRect.h-2*Sl;let T={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const C=m.stretchX||[[0,_]],E=m.stretchY||[[0,x]],z=(ve,Qe)=>ve+Qe[1]-Qe[0],R=C.reduce(z,0),B=E.reduce(z,0),O=_-R,q=x-B;let X=0,pe=R,ie=0,he=B,ye=0,Se=O,Ve=0,nt=q;if(m.content&&o){const ve=m.content,Qe=ve[2]-ve[0],Je=ve[3]-ve[1];(m.textFitWidth||m.textFitHeight)&&(T=Hy(r)),X=Jh(C,0,ve[0]),ie=Jh(E,0,ve[1]),pe=Jh(C,ve[0],ve[2]),he=Jh(E,ve[1],ve[3]),ye=ve[0]-X,Ve=ve[1]-ie,Se=Qe-pe,nt=Je-he}const Ne=T.x1,Re=T.y1,Ye=T.x2-Ne,Ge=T.y2-Re,$e=(ve,Qe,Je,lt)=>{const Ut=Yh(ve.stretch-X,pe,Ye,Ne),Vt=Qh(ve.fixed-ye,Se,ve.stretch,R),kr=Yh(Qe.stretch-ie,he,Ge,Re),xn=Qh(Qe.fixed-Ve,nt,Qe.stretch,B),Nr=Yh(Je.stretch-X,pe,Ye,Ne),Tr=Qh(Je.fixed-ye,Se,Je.stretch,R),oi=Yh(lt.stretch-ie,he,Ge,Re),li=Qh(lt.fixed-Ve,nt,lt.stretch,B),ui=new ae(Ut,kr),lr=new ae(Nr,kr),Ir=new ae(Nr,oi),Wr=new ae(Ut,oi),jr=new ae(Vt/g,xn/g),ci=new ae(Tr/g,li/g),Vr=t*Math.PI/180;if(Vr){const At=Math.sin(Vr),Zt=Math.cos(Vr),Kt=[Zt,-At,At,Zt];ui._matMult(Kt),lr._matMult(Kt),Wr._matMult(Kt),Ir._matMult(Kt)}const en=ve.stretch+ve.fixed,bi=Qe.stretch+Qe.fixed;return{tl:ui,tr:lr,bl:Wr,br:Ir,tex:{x:m.paddedRect.x+Sl+en,y:m.paddedRect.y+Sl+bi,w:Je.stretch+Je.fixed-en,h:lt.stretch+lt.fixed-bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jr,pixelOffsetBR:ci,minFontScaleX:Se/g/Ye,minFontScaleY:nt/g/Ge,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const ve=w_(C,O,R),Qe=w_(E,q,B);for(let Je=0;Je<ve.length-1;Je++){const lt=ve[Je],Ut=ve[Je+1];for(let Vt=0;Vt<Qe.length-1;Vt++)c.push($e(lt,Qe[Vt],Ut,Qe[Vt+1]))}}else c.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Jh(r,t,n){let o=0;for(const c of r)o+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return o}function w_(r,t,n){const o=[{fixed:-Sl,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:t+Sl,stretch:n}),o}function Yh(r,t,n,o){return r/t*n+o}function Qh(r,t,n,o){return r-t*n/o}class ed{constructor(t,n,o,c,m,g,_,x,T,C){var E;if(this.boxStartIndex=t.length,T){let z=g.top,R=g.bottom;const B=g.collisionPadding;B&&(z-=B[1],R+=B[3]);let O=R-z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const z=!((E=g.image)===null||E===void 0)&&E.content&&(g.image.textFitWidth||g.image.textFitHeight)?Hy(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};z.y1=z.y1*_-x[0],z.y2=z.y2*_+x[2],z.x1=z.x1*_-x[3],z.x2=z.x2*_+x[1];const R=g.collisionPadding;if(R&&(z.x1-=R[0]*_,z.y1-=R[1]*_,z.x2+=R[2]*_,z.y2+=R[3]*_),C){const B=new ae(z.x1,z.y1),O=new ae(z.x2,z.y1),q=new ae(z.x1,z.y2),X=new ae(z.x2,z.y2),pe=C*Math.PI/180;B._rotate(pe),O._rotate(pe),q._rotate(pe),X._rotate(pe),z.x1=Math.min(B.x,O.x,q.x,X.x),z.x2=Math.max(B.x,O.x,q.x,X.x),z.y1=Math.min(B.y,O.y,q.y,X.y),z.y2=Math.max(B.y,O.y,q.y,X.y)}t.emplaceBack(n.x,n.y,z.x1,z.y1,z.x2,z.y2,o,c,m)}this.boxEndIndex=t.length}}class Nw{constructor(t=[],n=(o,c)=>o<c?-1:o>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(o(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:o}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const _=g+1;if(_<this.length&&o(n[_],n[g])<0&&(g=_),o(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function jw(r,t=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const _=r[0];for(let R=0;R<_.length;R++){const B=_[R];(!R||B.x<o)&&(o=B.x),(!R||B.y<c)&&(c=B.y),(!R||B.x>m)&&(m=B.x),(!R||B.y>g)&&(g=B.y)}const x=Math.min(m-o,g-c);let T=x/2;const C=new Nw([],Vw);if(x===0)return new ae(o,c);for(let R=o;R<m;R+=x)for(let B=c;B<g;B+=x)C.push(new kl(R+T,B+T,T,r));let E=function(R){let B=0,O=0,q=0;const X=R[0];for(let pe=0,ie=X.length,he=ie-1;pe<ie;he=pe++){const ye=X[pe],Se=X[he],Ve=ye.x*Se.y-Se.x*ye.y;O+=(ye.x+Se.x)*Ve,q+=(ye.y+Se.y)*Ve,B+=3*Ve}return new kl(O/B,q/B,0,R)}(r),z=C.length;for(;C.length;){const R=C.pop();(R.d>E.d||!E.d)&&(E=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-E.d<=t||(T=R.h/2,C.push(new kl(R.p.x-T,R.p.y-T,T,r)),C.push(new kl(R.p.x+T,R.p.y-T,T,r)),C.push(new kl(R.p.x-T,R.p.y+T,T,r)),C.push(new kl(R.p.x+T,R.p.y+T,T,r)),z+=4)}return n&&(console.log(`num probes: ${z}`),console.log(`best distance: ${E.d}`)),E.p}function Vw(r,t){return t.max-r.max}function kl(r,t,n,o){this.p=new ae(r,t),this.h=n,this.d=function(c,m){let g=!1,_=1/0;for(let x=0;x<m.length;x++){const T=m[x];for(let C=0,E=T.length,z=E-1;C<E;z=C++){const R=T[C],B=T[z];R.y>c.y!=B.y>c.y&&c.x<(B.x-R.x)*(c.y-R.y)/(B.y-R.y)+R.x&&(g=!g),_=Math.min(_,ny(c,R,B))}}return(g?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Or;S.aq=void 0,(Or=S.aq||(S.aq={}))[Or.center=1]="center",Or[Or.left=2]="left",Or[Or.right=3]="right",Or[Or.top=4]="top",Or[Or.bottom=5]="bottom",Or[Or["top-left"]=6]="top-left",Or[Or["top-right"]=7]="top-right",Or[Or["bottom-left"]=8]="bottom-left",Or[Or["bottom-right"]=9]="bottom-right";const ya=7,Tf=Number.POSITIVE_INFINITY;function b_(r,t){return t[1]!==Tf?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-ya;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+ya}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(r,t[0],t[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-ya;break;case"bottom-right":case"bottom-left":m=-g+ya;break;case"bottom":m=-o+ya;break;case"top":m=o-ya}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(r,t[0])}function S_(r,t,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const _=m.values,x=[];for(let T=0;T<_.length;T+=2){const C=x[T]=_[T],E=_[T+1].map(z=>z*vr);C.startsWith("top")?E[1]-=ya:C.startsWith("bottom")&&(E[1]+=ya),x[T+1]=E}return new Pi(x)}const g=c.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*vr,Tf]:c.get("text-offset").evaluate(t,{},n).map(T=>T*vr);const x=[];for(const T of g)x.push(T,b_(T,_));return new Pi(x)}return null}function If(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Uw(r,t,n,o,c,m,g,_,x,T,C){let E=m.textMaxSize.evaluate(t,{});E===void 0&&(E=g);const z=r.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},C),B=T_(n.horizontal),O=g/24,q=r.tilePixelRatio*O,X=r.tilePixelRatio*E/24,pe=r.tilePixelRatio*_,ie=r.tilePixelRatio*z.get("symbol-spacing"),he=z.get("text-padding")*r.tilePixelRatio,ye=function(ve,Qe,Je,lt=1){const Ut=ve.get("icon-padding").evaluate(Qe,{},Je),Vt=Ut&&Ut.values;return[Vt[0]*lt,Vt[1]*lt,Vt[2]*lt,Vt[3]*lt]}(z,t,C,r.tilePixelRatio),Se=z.get("text-max-angle")/180*Math.PI,Ve=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",nt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("symbol-placement"),Re=ie/2,Ye=z.get("icon-text-fit");let Ge;o&&Ye!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Ge=Wy(o,n.vertical,Ye,z.get("icon-text-fit-padding"),R,O)),B&&(o=Wy(o,B,Ye,z.get("icon-text-fit-padding"),R,O)));const $e=(ve,Qe)=>{Qe.x<0||Qe.x>=yr||Qe.y<0||Qe.y>=yr||function(Je,lt,Ut,Vt,kr,xn,Nr,Tr,oi,li,ui,lr,Ir,Wr,jr,ci,Vr,en,bi,At,Zt,Kt,Ri,tr,Tl){const Qn=Je.addToLineVertexArray(lt,Ut);let es,wn,tn,Ar,Ts=0,hc=0,E_=0,A_=0,Lf=-1,Rf=-1;const Is={};let M_=hl("");if(Je.allowVerticalPlacement&&Vt.vertical){const Xr=Tr.layout.get("text-rotate").evaluate(Zt,{},tr)+90;tn=new ed(oi,lt,li,ui,lr,Vt.vertical,Ir,Wr,jr,Xr),Nr&&(Ar=new ed(oi,lt,li,ui,lr,Nr,Vr,en,jr,Xr))}if(kr){const Xr=Tr.layout.get("icon-rotate").evaluate(Zt,{}),rn=Tr.layout.get("icon-text-fit")!=="none",go=x_(kr,Xr,Ri,rn),Rn=Nr?x_(Nr,Xr,Ri,rn):void 0;wn=new ed(oi,lt,li,ui,lr,kr,Vr,en,!1,Xr),Ts=4*go.length;const yo=Je.iconSizeData;let ts=null;yo.kind==="source"?(ts=[Yn*Tr.layout.get("icon-size").evaluate(Zt,{})],ts[0]>fa&&sr(`${Je.layerIds[0]}: Value for "icon-size" is >= ${ac}. Reduce your "icon-size".`)):yo.kind==="composite"&&(ts=[Yn*Kt.compositeIconSizes[0].evaluate(Zt,{},tr),Yn*Kt.compositeIconSizes[1].evaluate(Zt,{},tr)],(ts[0]>fa||ts[1]>fa)&&sr(`${Je.layerIds[0]}: Value for "icon-size" is >= ${ac}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,go,ts,At,bi,Zt,S.ah.none,lt,Qn.lineStartIndex,Qn.lineLength,-1,tr),Lf=Je.icon.placedSymbolArray.length-1,Rn&&(hc=4*Rn.length,Je.addSymbols(Je.icon,Rn,ts,At,bi,Zt,S.ah.vertical,lt,Qn.lineStartIndex,Qn.lineLength,-1,tr),Rf=Je.icon.placedSymbolArray.length-1)}const z_=Object.keys(Vt.horizontal);for(const Xr of z_){const rn=Vt.horizontal[Xr];if(!es){M_=hl(rn.text);const Rn=Tr.layout.get("text-rotate").evaluate(Zt,{},tr);es=new ed(oi,lt,li,ui,lr,rn,Ir,Wr,jr,Rn)}const go=rn.positionedLines.length===1;if(E_+=k_(Je,lt,rn,xn,Tr,jr,Zt,ci,Qn,Vt.vertical?S.ah.horizontal:S.ah.horizontalOnly,go?z_:[Xr],Is,Lf,Kt,tr),go)break}Vt.vertical&&(A_+=k_(Je,lt,Vt.vertical,xn,Tr,jr,Zt,ci,Qn,S.ah.vertical,["vertical"],Is,Rf,Kt,tr));const qw=es?es.boxStartIndex:Je.collisionBoxArray.length,Gw=es?es.boxEndIndex:Je.collisionBoxArray.length,Hw=tn?tn.boxStartIndex:Je.collisionBoxArray.length,Ww=tn?tn.boxEndIndex:Je.collisionBoxArray.length,Xw=wn?wn.boxStartIndex:Je.collisionBoxArray.length,Kw=wn?wn.boxEndIndex:Je.collisionBoxArray.length,Jw=Ar?Ar.boxStartIndex:Je.collisionBoxArray.length,Yw=Ar?Ar.boxEndIndex:Je.collisionBoxArray.length;let Ln=-1;const rd=(Xr,rn)=>Xr&&Xr.circleDiameter?Math.max(Xr.circleDiameter,rn):rn;Ln=rd(es,Ln),Ln=rd(tn,Ln),Ln=rd(wn,Ln),Ln=rd(Ar,Ln);const D_=Ln>-1?1:0;D_&&(Ln*=Tl/vr),Je.glyphOffsetArray.length>=bl.MAX_GLYPHS&&sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,Zt.sortKey);const Qw=S_(Tr,Zt,tr),[eb,tb]=function(Xr,rn){const go=Xr.length,Rn=rn==null?void 0:rn.values;if((Rn==null?void 0:Rn.length)>0)for(let yo=0;yo<Rn.length;yo+=2){const ts=Rn[yo+1];Xr.emplaceBack(S.aq[Rn[yo]],ts[0],ts[1])}return[go,Xr.length]}(Je.textAnchorOffsets,Qw);Je.symbolInstances.emplaceBack(lt.x,lt.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical||-1,Lf,Rf,M_,qw,Gw,Hw,Ww,Xw,Kw,Jw,Yw,li,E_,A_,Ts,hc,D_,0,Ir,Ln,eb,tb)}(r,Qe,ve,n,o,c,Ge,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,q,[he,he,he,he],Ve,x,pe,ye,nt,R,t,m,T,C,g)};if(Ne==="line")for(const ve of f_(t.geometry,0,0,yr,yr)){const Qe=Ow(ve,ie,Se,n.vertical||B,o,24,X,r.overscaling,yr);for(const Je of Qe)B&&$w(r,B.text,Re,Je)||$e(ve,Je)}else if(Ne==="line-center"){for(const ve of t.geometry)if(ve.length>1){const Qe=Bw(ve,Se,n.vertical||B,o,24,X);Qe&&$e(ve,Qe)}}else if(t.type==="Polygon")for(const ve of Vo(t.geometry,0)){const Qe=jw(ve,16);$e(ve[0],new ga(Qe.x,Qe.y,0))}else if(t.type==="LineString")for(const ve of t.geometry)$e(ve,new ga(ve[0].x,ve[0].y,0));else if(t.type==="Point")for(const ve of t.geometry)for(const Qe of ve)$e([Qe],new ga(Qe.x,Qe.y,0))}function k_(r,t,n,o,c,m,g,_,x,T,C,E,z,R,B){const O=function(pe,ie,he,ye,Se,Ve,nt,Ne){const Re=ye.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Ye=[];for(const Ge of ie.positionedLines)for(const $e of Ge.positionedGlyphs){if(!$e.rect)continue;const ve=$e.rect||{};let Qe=jy+1,Je=!0,lt=1,Ut=0;const Vt=(Se||Ne)&&$e.vertical,kr=$e.metrics.advance*$e.scale/2;if(Ne&&ie.verticalizable&&(Ut=Ge.lineOffset/2-($e.imageName?-(vr-$e.metrics.width*$e.scale)/2:($e.scale-1)*vr)),$e.imageName){const At=nt[$e.imageName];Je=At.sdf,lt=At.pixelRatio,Qe=wi/lt}const xn=Se?[$e.x+kr,$e.y]:[0,0];let Nr=Se?[0,0]:[$e.x+kr+he[0],$e.y+he[1]-Ut],Tr=[0,0];Vt&&(Tr=Nr,Nr=[0,0]);const oi=$e.metrics.isDoubleResolution?2:1,li=($e.metrics.left-Qe)*$e.scale-kr+Nr[0],ui=(-$e.metrics.top-Qe)*$e.scale+Nr[1],lr=li+ve.w/oi*$e.scale/lt,Ir=ui+ve.h/oi*$e.scale/lt,Wr=new ae(li,ui),jr=new ae(lr,ui),ci=new ae(li,Ir),Vr=new ae(lr,Ir);if(Vt){const At=new ae(-kr,kr-nc),Zt=-Math.PI/2,Kt=vr/2-kr,Ri=new ae(5-nc-Kt,-($e.imageName?Kt:0)),tr=new ae(...Tr);Wr._rotateAround(Zt,At)._add(Ri)._add(tr),jr._rotateAround(Zt,At)._add(Ri)._add(tr),ci._rotateAround(Zt,At)._add(Ri)._add(tr),Vr._rotateAround(Zt,At)._add(Ri)._add(tr)}if(Re){const At=Math.sin(Re),Zt=Math.cos(Re),Kt=[Zt,-At,At,Zt];Wr._matMult(Kt),jr._matMult(Kt),ci._matMult(Kt),Vr._matMult(Kt)}const en=new ae(0,0),bi=new ae(0,0);Ye.push({tl:Wr,tr:jr,bl:ci,br:Vr,tex:ve,writingMode:ie.writingMode,glyphOffset:xn,sectionIndex:$e.sectionIndex,isSDF:Je,pixelOffsetTL:en,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,n,_,c,m,g,o,r.allowVerticalPlacement),q=r.textSizeData;let X=null;q.kind==="source"?(X=[Yn*c.layout.get("text-size").evaluate(g,{})],X[0]>fa&&sr(`${r.layerIds[0]}: Value for "text-size" is >= ${ac}. Reduce your "text-size".`)):q.kind==="composite"&&(X=[Yn*R.compositeTextSizes[0].evaluate(g,{},B),Yn*R.compositeTextSizes[1].evaluate(g,{},B)],(X[0]>fa||X[1]>fa)&&sr(`${r.layerIds[0]}: Value for "text-size" is >= ${ac}. Reduce your "text-size".`)),r.addSymbols(r.text,O,X,_,m,g,T,t,x.lineStartIndex,x.lineLength,z,B);for(const pe of C)E[pe]=r.text.placedSymbolArray.length-1;return 4*O.length}function T_(r){for(const t in r)return r[t];return null}function $w(r,t,n,o){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(o),!1}const I_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=I_[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Cf(_,g,m,t)}constructor(t,n=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=I_.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Pf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,x=[0,m.length-1,0],T=[];for(;x.length;){const C=x.pop()||0,E=x.pop()||0,z=x.pop()||0;if(E-z<=_){for(let q=z;q<=E;q++){const X=g[2*q],pe=g[2*q+1];X>=t&&X<=o&&pe>=n&&pe<=c&&T.push(m[q])}continue}const R=z+E>>1,B=g[2*R],O=g[2*R+1];B>=t&&B<=o&&O>=n&&O<=c&&T.push(m[R]),(C===0?t<=B:n<=O)&&(x.push(z),x.push(R-1),x.push(1-C)),(C===0?o>=B:c>=O)&&(x.push(R+1),x.push(E),x.push(1-C))}return T}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,_=[0,c.length-1,0],x=[],T=o*o;for(;_.length;){const C=_.pop()||0,E=_.pop()||0,z=_.pop()||0;if(E-z<=g){for(let q=z;q<=E;q++)P_(m[2*q],m[2*q+1],t,n)<=T&&x.push(c[q]);continue}const R=z+E>>1,B=m[2*R],O=m[2*R+1];P_(B,O,t,n)<=T&&x.push(c[R]),(C===0?t-o<=B:n-o<=O)&&(_.push(z),_.push(R-1),_.push(1-C)),(C===0?t+o>=B:n+o>=O)&&(_.push(R+1),_.push(E),_.push(1-C))}return x}}function Pf(r,t,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;C_(r,t,g,o,c,m),Pf(r,t,n,o,g-1,1-m),Pf(r,t,n,g+1,c,1-m)}function C_(r,t,n,o,c,m){for(;c>o;){if(c-o>600){const T=c-o+1,C=n-o+1,E=Math.log(T),z=.5*Math.exp(2*E/3),R=.5*Math.sqrt(E*z*(T-z)/T)*(C-T/2<0?-1:1);C_(r,t,n,Math.max(o,Math.floor(n-C*z/T+R)),Math.min(c,Math.floor(n+(T-C)*z/T+R)),m)}const g=t[2*n+m];let _=o,x=c;for(uc(r,t,o,n),t[2*c+m]>g&&uc(r,t,o,c);_<x;){for(uc(r,t,_,x),_++,x--;t[2*_+m]<g;)_++;for(;t[2*x+m]>g;)x--}t[2*o+m]===g?uc(r,t,o,x):(x++,uc(r,t,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function uc(r,t,n,o){Ef(r,n,o),Ef(t,2*n,2*o),Ef(t,2*n+1,2*o+1)}function Ef(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function P_(r,t,n,o){const c=r-n,m=t-o;return c*c+m*m}var Af;S.bg=void 0,(Af=S.bg||(S.bg={})).create="create",Af.load="load",Af.fullLoad="fullLoad";let td=null,cc=[];const Mf=1e3/60,zf="loadTime",Df="fullLoadTime",Zw={mark(r){performance.mark(r)},frame(r){const t=r;td!=null&&cc.push(t-td),td=t},clearMetrics(){td=null,cc=[],performance.clearMeasures(zf),performance.clearMeasures(Df);for(const r in S.bg)performance.clearMarks(S.bg[r])},getPerformanceMetrics(){performance.measure(zf,S.bg.create,S.bg.load),performance.measure(Df,S.bg.create,S.bg.fullLoad);const r=performance.getEntriesByName(zf)[0].duration,t=performance.getEntriesByName(Df)[0].duration,n=cc.length,o=1/(cc.reduce((m,g)=>m+g,0)/n/1e3),c=cc.filter(m=>m>Mf).reduce((m,g)=>m+(g-Mf)/Mf,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=class extends A{},S.A=gl,S.B=jp,S.C=function(r){if(hn==null){const t=r.navigator?r.navigator.userAgent:null;hn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return hn},S.D=Xe,S.E=Bs,S.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Rw(()=>this.process()),this.subscription=function(n,o,c,m){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Vi(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const _={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:ra(r.data,m)});this.target.postMessage(g,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Vi(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(ia(t.error)):c.resolve(ia(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ia(t.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ra(t):null,data:ra(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=ti,S.H=function(){var r=new gl(16);return gl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.I=ff,S.J=function(r,t,n){var o,c,m,g,_,x,T,C,E,z,R,B,O=n[0],q=n[1],X=n[2];return t===r?(r[12]=t[0]*O+t[4]*q+t[8]*X+t[12],r[13]=t[1]*O+t[5]*q+t[9]*X+t[13],r[14]=t[2]*O+t[6]*q+t[10]*X+t[14],r[15]=t[3]*O+t[7]*q+t[11]*X+t[15]):(c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],T=t[6],C=t[7],E=t[8],z=t[9],R=t[10],B=t[11],r[0]=o=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=_,r[5]=x,r[6]=T,r[7]=C,r[8]=E,r[9]=z,r[10]=R,r[11]=B,r[12]=o*O+_*q+E*X+t[12],r[13]=c*O+x*q+z*X+t[13],r[14]=m*O+T*q+R*X+t[14],r[15]=g*O+C*q+B*X+t[15]),r},S.K=function(r,t,n){var o=n[0],c=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.L=ly,S.M=function(r,t){const n={};for(let o=0;o<t.length;o++){const c=t[o];c in r&&(n[c]=r[c])}return n},S.N=ma,S.O=i_,S.P=ae,S.Q=n_,S.R=Yi,S.S=Qi,S.T=al,S.U=re,S.V=Q,S.W=ct,S.X=yr,S.Y=v,S.Z=oc,S._=d,S.a=Dr,S.a$=function(r,t){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],_=r[5],x=r[6],T=r[7],C=r[8],E=r[9],z=r[10],R=r[11],B=r[12],O=r[13],q=r[14],X=r[15],pe=t[0],ie=t[1],he=t[2],ye=t[3],Se=t[4],Ve=t[5],nt=t[6],Ne=t[7],Re=t[8],Ye=t[9],Ge=t[10],$e=t[11],ve=t[12],Qe=t[13],Je=t[14],lt=t[15];return Math.abs(n-pe)<=ai*Math.max(1,Math.abs(n),Math.abs(pe))&&Math.abs(o-ie)<=ai*Math.max(1,Math.abs(o),Math.abs(ie))&&Math.abs(c-he)<=ai*Math.max(1,Math.abs(c),Math.abs(he))&&Math.abs(m-ye)<=ai*Math.max(1,Math.abs(m),Math.abs(ye))&&Math.abs(g-Se)<=ai*Math.max(1,Math.abs(g),Math.abs(Se))&&Math.abs(_-Ve)<=ai*Math.max(1,Math.abs(_),Math.abs(Ve))&&Math.abs(x-nt)<=ai*Math.max(1,Math.abs(x),Math.abs(nt))&&Math.abs(T-Ne)<=ai*Math.max(1,Math.abs(T),Math.abs(Ne))&&Math.abs(C-Re)<=ai*Math.max(1,Math.abs(C),Math.abs(Re))&&Math.abs(E-Ye)<=ai*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(z-Ge)<=ai*Math.max(1,Math.abs(z),Math.abs(Ge))&&Math.abs(R-$e)<=ai*Math.max(1,Math.abs(R),Math.abs($e))&&Math.abs(B-ve)<=ai*Math.max(1,Math.abs(B),Math.abs(ve))&&Math.abs(O-Qe)<=ai*Math.max(1,Math.abs(O),Math.abs(Qe))&&Math.abs(q-Je)<=ai*Math.max(1,Math.abs(q),Math.abs(Je))&&Math.abs(X-lt)<=ai*Math.max(1,Math.abs(X),Math.abs(lt))},S.a0=St,S.a1=kf,S.a2=Ie,S.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of r){const c=window.document.createElement("source");ls(o)||(t.crossOrigin="Anonymous"),c.src=o,t.appendChild(c)}})},S.a4=function(){return it++},S.a5=je,S.a6=bl,S.a7=Cu,S.a8=fo,S.a9=c_,S.aA=function(r){if(r.type==="custom")return new Lw(r);switch(r.type){case"background":return new Mw(r);case"circle":return new _1(r);case"fill":return new R1(r);case"fill-extrusion":return new K1(r);case"heatmap":return new x1(r);case"hillshade":return new b1(r);case"line":return new nw(r);case"raster":return new Dw(r);case"symbol":return new Kh(r)}},S.aB=_t,S.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Mt(r.version,t.version))return[{command:"setStyle",args:[t]}];Mt(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Mt(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Mt(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Mt(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Mt(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Mt(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Mt(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Mt(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),Mt(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Mt(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Mt(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},c=[];(function(g,_,x,T){let C;for(C in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(_,C)||qn(C,x,T));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(g,C)?Mt(g[C],_[C])||(g[C].type==="geojson"&&_[C].type==="geojson"&&Os(g,_,C)?Qt(x,{command:"setGeoJSONSourceData",args:[C,_[C].data]}):En(C,_,x,T)):Va(C,_,x))})(r.sources,t.sources,c,o);const m=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,_,x){_=_||[];const T=(g=g||[]).map(Ua),C=_.map(Ua),E=g.reduce($a,{}),z=_.reduce($a,{}),R=T.slice(),B=Object.create(null);let O,q,X,pe,ie;for(let he=0,ye=0;he<T.length;he++)O=T[he],Object.prototype.hasOwnProperty.call(z,O)?ye++:(Qt(x,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,ye),1));for(let he=0,ye=0;he<C.length;he++)O=C[C.length-1-he],R[R.length-1-he]!==O&&(Object.prototype.hasOwnProperty.call(E,O)?(Qt(x,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-ye),1)):ye++,pe=R[R.length-he],Qt(x,{command:"addLayer",args:[z[O],pe]}),R.splice(R.length-he,0,O),B[O]=!0);for(let he=0;he<C.length;he++)if(O=C[he],q=E[O],X=z[O],!B[O]&&!Mt(q,X))if(Mt(q.source,X.source)&&Mt(q["source-layer"],X["source-layer"])&&Mt(q.type,X.type)){for(ie in Ci(q.layout,X.layout,x,O,null,"setLayoutProperty"),Ci(q.paint,X.paint,x,O,null,"setPaintProperty"),Mt(q.filter,X.filter)||Qt(x,{command:"setFilter",args:[O,X.filter]}),Mt(q.minzoom,X.minzoom)&&Mt(q.maxzoom,X.maxzoom)||Qt(x,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Ci(q[ie],X[ie],x,O,ie.slice(6),"setPaintProperty"):Mt(q[ie],X[ie])||Qt(x,{command:"setLayerProperty",args:[O,ie,X[ie]]}));for(ie in X)Object.prototype.hasOwnProperty.call(X,ie)&&!Object.prototype.hasOwnProperty.call(q,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Ci(q[ie],X[ie],x,O,ie.slice(6),"setPaintProperty"):Mt(q[ie],X[ie])||Qt(x,{command:"setLayerProperty",args:[O,ie,X[ie]]}))}else Qt(x,{command:"removeLayer",args:[O]}),pe=R[R.lastIndexOf(O)+1],Qt(x,{command:"addLayer",args:[X,pe]})}(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},S.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},S.aF=Dt,S.aG=yt,S.aH=class extends co{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Bh,S.aJ=class extends co{constructor(r,t){super(r,t),this.current=c1}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=Jg,S.aL=Yg,S.aM=Ot,S.aN=class extends co{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aO=class extends co{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aP=function(r,t,n,o,c,m,g){var _=1/(t-n),x=1/(o-c),T=1/(m-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(t+n)*_,r[13]=(c+o)*x,r[14]=(g+m)*T,r[15]=1,r},S.aQ=y1,S.aR=class extends se{},S.aS=lw,S.aT=class extends fe{},S.aU=tf,S.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aW=py,S.aX=Fr,S.aY=Ji,S.aZ=class extends Ke{},S.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return t[o]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ab=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},S.ac=Oe,S.ad=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],_=t[2],x=t[3],T=t[4],C=t[5],E=t[6],z=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+T*o,r[1]=g*c+C*o,r[2]=_*c+E*o,r[3]=x*c+z*o,r[4]=T*c-m*o,r[5]=C*c-g*o,r[6]=E*c-_*o,r[7]=z*c-x*o,r},S.ae=function(r){var t=new gl(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.af=Vh,S.ag=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,_=c?Oe(ni.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?o=ii.number(r.minSize,r.maxSize,_):n=_}return{uSizeT:n,uSize:o}},S.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Yn:r.kind==="composite"?ii.number(o/Yn,c/Yn,n):t},S.aj=_f,S.ak=function(r,t,n,o){const c=t.y-r.y,m=t.x-r.x,g=o.y-n.y,_=o.x-n.x,x=g*m-_*c;if(x===0)return null;const T=(_*(r.y-n.y)-g*(r.x-n.x))/x;return new ae(r.x+T*m,r.y+T*c)},S.al=f_,S.am=ry,S.an=Yp,S.ao=function(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return[t,n,o,c]},S.ap=vr,S.ar=yf,S.as=function(r,t){var n=t[0],o=t[1],c=t[2],m=t[3],g=t[4],_=t[5],x=t[6],T=t[7],C=t[8],E=t[9],z=t[10],R=t[11],B=t[12],O=t[13],q=t[14],X=t[15],pe=n*_-o*g,ie=n*x-c*g,he=n*T-m*g,ye=o*x-c*_,Se=o*T-m*_,Ve=c*T-m*x,nt=C*O-E*B,Ne=C*q-z*B,Re=C*X-R*B,Ye=E*q-z*O,Ge=E*X-R*O,$e=z*X-R*q,ve=pe*$e-ie*Ge+he*Ye+ye*Re-Se*Ne+Ve*nt;return ve?(r[0]=(_*$e-x*Ge+T*Ye)*(ve=1/ve),r[1]=(c*Ge-o*$e-m*Ye)*ve,r[2]=(O*Ve-q*Se+X*ye)*ve,r[3]=(z*Se-E*Ve-R*ye)*ve,r[4]=(x*Re-g*$e-T*Ne)*ve,r[5]=(n*$e-c*Re+m*Ne)*ve,r[6]=(q*he-B*Ve-X*ie)*ve,r[7]=(C*Ve-z*he+R*ie)*ve,r[8]=(g*Ge-_*Re+T*nt)*ve,r[9]=(o*Re-n*Ge-m*nt)*ve,r[10]=(B*Se-O*he+X*pe)*ve,r[11]=(E*he-C*Se-R*pe)*ve,r[12]=(_*Ne-g*Ye-x*nt)*ve,r[13]=(n*Ye-o*Ne+c*nt)*ve,r[14]=(O*ie-B*ye-q*pe)*ve,r[15]=(C*ye-E*ie+z*pe)*ve,r):null},S.at=If,S.au=gf,S.av=Cf,S.aw=function(){const r={},t=ge.$version;for(const n in ge.$root){const o=ge.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Vu,S.ay=$i,S.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=ja(r[n],t[r[n].ref]));return r},S.b=Qr,S.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},S.b3=qe,S.b4=o_,S.b5=s_,S.b6=function(r,t,n,o,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},S.b7=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],_=t[6],x=t[7],T=t[8],C=t[9],E=t[10],z=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+T*o,r[5]=g*c+C*o,r[6]=_*c+E*o,r[7]=x*c+z*o,r[8]=T*c-m*o,r[9]=C*c-g*o,r[10]=E*c-_*o,r[11]=z*c-x*o,r},S.b8=le,S.b9=ke,S.bA=Dy,S.bB=function(r){return r.message===Ft},S.bC=Ks,S.bD=vi,S.ba=function(r){return r*Math.PI/180},S.bb=function(r,t){const{x:n,y:o}=oc.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},S.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bd=class extends P{},S.be=bf,S.bf=Zw,S.bh=br,S.bi=function(r,t){Dr.REGISTERED_PROTOCOLS[r]=t},S.bj=function(r){delete Dr.REGISTERED_PROTOCOLS[r]},S.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||Th(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},S.bl=Ze,S.bm=u_,S.bn=h_,S.bo=Uy,S.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=yr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Gt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:C}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Gt(T),r.canonical),o["text-size"].possiblyEvaluate(new Gt(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:C}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Gt(T),r.canonical),o["icon-size"].possiblyEvaluate(new Gt(C),r.canonical)]}const m=n.get("text-line-height")*vr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",_=n.get("text-keep-upright"),x=n.get("text-size");for(const T of r.bucket.features){const C=n.get("text-font").evaluate(T,{},r.canonical).join(","),E=x.evaluate(T,{},r.canonical),z=c.layoutTextSize.evaluate(T,{},r.canonical),R=c.layoutIconSize.evaluate(T,{},r.canonical),B={horizontal:{},vertical:void 0},O=T.text;let q,X=[0,0];if(O){const he=O.toString(),ye=n.get("text-letter-spacing").evaluate(T,{},r.canonical)*vr,Se=Vp(he)?ye:0,Ve=n.get("text-anchor").evaluate(T,{},r.canonical),nt=S_(t,T,r.canonical);if(!nt){const Ge=n.get("text-radial-offset").evaluate(T,{},r.canonical);X=Ge?b_(Ve,[Ge*vr,Tf]):n.get("text-offset").evaluate(T,{},r.canonical).map($e=>$e*vr)}let Ne=g?"center":n.get("text-justify").evaluate(T,{},r.canonical);const Re=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(T,{},r.canonical)*vr:1/0,Ye=()=>{r.bucket.allowVerticalPlacement&&Uu(he)&&(B.vertical=Hh(O,r.glyphMap,r.glyphPositions,r.imagePositions,C,Re,m,Ve,"left",Se,X,S.ah.vertical,!0,z,E))};if(!g&&nt){const Ge=new Set;if(Ne==="auto")for(let ve=0;ve<nt.values.length;ve+=2)Ge.add(If(nt.values[ve]));else Ge.add(Ne);let $e=!1;for(const ve of Ge)if(!B.horizontal[ve])if($e)B.horizontal[ve]=B.horizontal[0];else{const Qe=Hh(O,r.glyphMap,r.glyphPositions,r.imagePositions,C,Re,m,"center",ve,Se,X,S.ah.horizontal,!1,z,E);Qe&&(B.horizontal[ve]=Qe,$e=Qe.positionedLines.length===1)}Ye()}else{Ne==="auto"&&(Ne=If(Ve));const Ge=Hh(O,r.glyphMap,r.glyphPositions,r.imagePositions,C,Re,m,Ve,Ne,Se,X,S.ah.horizontal,!1,z,E);Ge&&(B.horizontal[Ne]=Ge),Ye(),Uu(he)&&g&&_&&(B.vertical=Hh(O,r.glyphMap,r.glyphPositions,r.imagePositions,C,Re,m,Ve,Ne,Se,X,S.ah.vertical,!1,z,E))}}let pe=!1;if(T.icon&&T.icon.name){const he=r.imageMap[T.icon.name];he&&(q=Iw(r.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},r.canonical),n.get("icon-anchor").evaluate(T,{},r.canonical)),pe=!!he.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=pe:r.bucket.sdfIcons!==pe&&sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(he.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ie=T_(B.horizontal)||B.vertical;r.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||q)&&Uw(r.bucket,T,B,q,r.imageMap,c,z,R,X,pe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bq=cf,S.br=of,S.bs=uf,S.bt=da,S.bu=df,S.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bw=function(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(Q())try{return yield ct(r,t,n,o,c)}catch{}return function(m,g,_,x,T){const C=m.width,E=m.height;ht&&kt||(ht=new OffscreenCanvas(C,E),kt=ht.getContext("2d",{willReadFrequently:!0})),ht.width=C,ht.height=E,kt.drawImage(m,0,0,C,E);const z=kt.getImageData(g,_,x,T);return kt.clearRect(0,0,C,E),z.data}(r,t,n,o,c)})},S.bx=l_,S.by=$,S.bz=ue,S.c=Ui,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=He,S.f=r=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=We})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):We}),S.g=ei,S.h=(r,t)=>os(He(r,{type:"json"}),t),S.i=Vi,S.j=Zn,S.k=$n,S.l=(r,t)=>os(He(r,{type:"arrayBuffer"}),t),S.m=os,S.n=function(r){return new df(r).readFields(vw,[])},S.o=Ju,S.p=Vy,S.q=f,S.r=Np,S.s=ls,S.t=Nu,S.u=ws,S.v=ge,S.w=sr,S.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.y=ii,S.z=Gt}),b("worker",["./shared"],function(S){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const G of L){this._layerConfigs[G.id]=G;const ne=this._layers[G.id]=S.aA(G);ne._featureFilter=S.a7(ne.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of D)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const N=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const G of N){const ne=G.map(me=>this._layers[me.id]),oe=ne[0];if(oe.visibility==="none")continue;const de=oe.source||"";let ee=this.familiesBySource[de];ee||(ee=this.familiesBySource[de]={});const _e=oe.sourceLayer||"_geojsonTileLayer";let be=ee[_e];be||(be=ee[_e]=[]),be.push(ne)}}}class ${constructor(L){const D={},N=[];for(const de in L){const ee=L[de],_e=D[de]={};for(const be in ee){const me=ee[+be];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const Ee={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};N.push(Ee),_e[be]={rect:Ee,metrics:me.metrics}}}const{w:G,h:ne}=S.p(N),oe=new S.o({width:G||1,height:ne||1});for(const de in L){const ee=L[de];for(const _e in ee){const be=ee[+_e];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const me=D[de][_e].rect;S.o.copy(be.bitmap,oe,{x:0,y:0},{x:me.x+1,y:me.y+1},be.bitmap)}}this.image=oe,this.positions=D}}S.bl("GlyphAtlas",$);class ue{constructor(L){this.tileID=new S.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,N,G){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new S.a5;const ne=new S.bm(Object.keys(L.layers).sort()),oe=new S.bn(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const de={},ee={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},_e=D.familiesBySource[this.source];for(const gt in _e){const Bt=L.layers[gt];if(!Bt)continue;Bt.version===1&&S.w(`Vector tile source "${this.source}" layer "${gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Jt=ne.encode(gt),Sr=[];for(let Pr=0;Pr<Bt.length;Pr++){const qr=Bt.feature(Pr),Ns=oe.getId(qr,gt);Sr.push({feature:qr,id:Ns,index:Pr,sourceLayerIndex:Jt})}for(const Pr of _e[gt]){const qr=Pr[0];qr.source!==this.source&&S.w(`layer.source = ${qr.source} does not equal this.source = ${this.source}`),qr.minzoom&&this.zoom<Math.floor(qr.minzoom)||qr.maxzoom&&this.zoom>=qr.maxzoom||qr.visibility!=="none"&&(xe(Pr,this.zoom,N),(de[qr.id]=qr.createBucket({index:oe.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jt,sourceID:this.source})).populate(Sr,ee,this.tileID.canonical),oe.bucketLayerIDs.push(Pr.map(Ns=>Ns.id)))}}const be=S.aF(ee.glyphDependencies,gt=>Object.keys(gt).map(Number));this.inFlightDependencies.forEach(gt=>gt==null?void 0:gt.abort()),this.inFlightDependencies=[];let me=Promise.resolve({});if(Object.keys(be).length){const gt=new AbortController;this.inFlightDependencies.push(gt),me=G.sendAsync({type:"GG",data:{stacks:be,source:this.source,tileID:this.tileID,type:"glyphs"}},gt)}const Ee=Object.keys(ee.iconDependencies);let et=Promise.resolve({});if(Ee.length){const gt=new AbortController;this.inFlightDependencies.push(gt),et=G.sendAsync({type:"GI",data:{icons:Ee,source:this.source,tileID:this.tileID,type:"icons"}},gt)}const rt=Object.keys(ee.patternDependencies);let It=Promise.resolve({});if(rt.length){const gt=new AbortController;this.inFlightDependencies.push(gt),It=G.sendAsync({type:"GI",data:{icons:rt,source:this.source,tileID:this.tileID,type:"patterns"}},gt)}const[pt,Ct,xt]=yield Promise.all([me,et,It]),mr=new $(pt),er=new S.bo(Ct,xt);for(const gt in de){const Bt=de[gt];Bt instanceof S.a6?(xe(Bt.layers,this.zoom,N),S.bp({bucket:Bt,glyphMap:pt,glyphPositions:mr.positions,imageMap:Ct,imagePositions:er.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Bt.hasPattern&&(Bt instanceof S.bq||Bt instanceof S.br||Bt instanceof S.bs)&&(xe(Bt.layers,this.zoom,N),Bt.addFeatures(ee,this.tileID.canonical,er.patternPositions))}return this.status="done",{buckets:Object.values(de).filter(gt=>!gt.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mr.image,imageAtlas:er,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?mr.positions:null}})}}function xe(W,L,D){const N=new S.z(L);for(const G of W)G.recalculate(N,D)}class ae{constructor(L,D,N){this.actor=L,this.layerIndex=D,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=yield S.l(L.request,D);try{return{vectorTile:new S.bt.VectorTile(new S.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(G){const ne=new Uint8Array(N.data);let oe=`Unable to parse the tile at ${L.request.url}, `;throw oe+=ne[0]===31&&ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${G.message}`,new Error(oe)}})}loadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid,N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request),G=new ue(L);this.loading[D]=G;const ne=new AbortController;G.abort=ne;try{const oe=yield this.loadVectorTile(L,ne);if(delete this.loading[D],!oe)return null;const de=oe.rawData,ee={};oe.expires&&(ee.expires=oe.expires),oe.cacheControl&&(ee.cacheControl=oe.cacheControl);const _e={};if(N){const me=N.finish();me&&(_e.resourceTiming=JSON.parse(JSON.stringify(me)))}G.vectorTile=oe.vectorTile;const be=G.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=G,this.fetching[D]={rawTileData:de,cacheControl:ee,resourceTiming:_e};try{const me=yield be;return S.e({rawTileData:de.slice(0)},me,ee,_e)}finally{delete this.fetching[D]}}catch(oe){throw delete this.loading[D],G.status="done",this.loaded[D]=G,oe}})}reloadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[D];if(N.showCollisionBoxes=L.showCollisionBoxes,N.status==="parsing"){const G=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let ne;if(this.fetching[D]){const{rawTileData:oe,cacheControl:de,resourceTiming:ee}=this.fetching[D];delete this.fetching[D],ne=S.e({rawTileData:oe.slice(0)},G,de,ee)}else ne=G;return ne}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return S._(this,void 0,void 0,function*(){const D=this.loading,N=L.uid;D&&D[N]&&D[N].abort&&(D[N].abort.abort(),delete D[N])})}removeTile(L){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class U{constructor(){this.loaded={}}loadTile(L){return S._(this,void 0,void 0,function*(){const{uid:D,encoding:N,rawImageData:G,redFactor:ne,greenFactor:oe,blueFactor:de,baseShift:ee}=L,_e=G.width+2,be=G.height+2,me=S.b(G)?new S.R({width:_e,height:be},yield S.bw(G,-1,-1,_e,be)):G,Ee=new S.bx(D,me,N,ne,oe,de,ee);return this.loaded=this.loaded||{},this.loaded[D]=Ee,Ee})}removeTile(L){const D=this.loaded,N=L.uid;D&&D[N]&&delete D[N]}}function ze(W,L){if(W.length!==0){Be(W[0],L);for(var D=1;D<W.length;D++)Be(W[D],!L)}}function Be(W,L){for(var D=0,N=0,G=0,ne=W.length,oe=ne-1;G<ne;oe=G++){var de=(W[G][0]-W[oe][0])*(W[oe][1]+W[G][1]),ee=D+de;N+=Math.abs(D)>=Math.abs(de)?D-ee+de:de-ee+D,D=ee}D+N>=0!=!!L&&W.reverse()}var Pe=S.by(function W(L,D){var N,G=L&&L.type;if(G==="FeatureCollection")for(N=0;N<L.features.length;N++)W(L.features[N],D);else if(G==="GeometryCollection")for(N=0;N<L.geometries.length;N++)W(L.geometries[N],D);else if(G==="Feature")W(L.geometry,D);else if(G==="Polygon")ze(L.coordinates,D);else if(G==="MultiPolygon")for(N=0;N<L.coordinates.length;N++)ze(L.coordinates[N],D);return L});const Tt=S.bt.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},Q=S.bz,le=S.bt.VectorTileFeature,ke=Oe;function Oe(W,L){this.options=L||{},this.features=W,this.length=W.length}function qe(W,L){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=L||4096}Oe.prototype.feature=function(W){return new qe(this.features[W],this.options.extent)},qe.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var L=0;L<W.length;L++){for(var D=W[L],N=[],G=0;G<D.length;G++)N.push(new Q(D[G][0],D[G][1]));this.geometry.push(N)}return this.geometry},qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,L=1/0,D=-1/0,N=1/0,G=-1/0,ne=0;ne<W.length;ne++)for(var oe=W[ne],de=0;de<oe.length;de++){var ee=oe[de];L=Math.min(L,ee.x),D=Math.max(D,ee.x),N=Math.min(N,ee.y),G=Math.max(G,ee.y)}return[L,N,D,G]},qe.prototype.toGeoJSON=le.prototype.toGeoJSON;var He=S.bA,it=ke;function Dt(W){var L=new He;return function(D,N){for(var G in D.layers)N.writeMessage(3,yt,D.layers[G])}(W,L),L.finish()}function yt(W,L){var D;L.writeVarintField(15,W.version||1),L.writeStringField(1,W.name||""),L.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)N.feature=W.feature(D),L.writeMessage(2,_t,N);var G=N.keys;for(D=0;D<G.length;D++)L.writeStringField(3,G[D]);var ne=N.values;for(D=0;D<ne.length;D++)L.writeMessage(4,hn,ne[D])}function _t(W,L){var D=W.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,cn,W),L.writeVarintField(3,D.type),L.writeMessage(4,Vi,D)}function cn(W,L){var D=W.feature,N=W.keys,G=W.values,ne=W.keycache,oe=W.valuecache;for(var de in D.properties){var ee=D.properties[de],_e=ne[de];if(ee!==null){_e===void 0&&(N.push(de),ne[de]=_e=N.length-1),L.writeVarint(_e);var be=typeof ee;be!=="string"&&be!=="boolean"&&be!=="number"&&(ee=JSON.stringify(ee));var me=be+":"+ee,Ee=oe[me];Ee===void 0&&(G.push(ee),oe[me]=Ee=G.length-1),L.writeVarint(Ee)}}}function sr(W,L){return(L<<3)+(7&W)}function wr(W){return W<<1^W>>31}function Vi(W,L){for(var D=W.loadGeometry(),N=W.type,G=0,ne=0,oe=D.length,de=0;de<oe;de++){var ee=D[de],_e=1;N===1&&(_e=ee.length),L.writeVarint(sr(1,_e));for(var be=N===3?ee.length-1:ee.length,me=0;me<be;me++){me===1&&N!==1&&L.writeVarint(sr(2,be-1));var Ee=ee[me].x-G,et=ee[me].y-ne;L.writeVarint(wr(Ee)),L.writeVarint(wr(et)),G+=Ee,ne+=et}N===3&&L.writeVarint(sr(7,1))}}function hn(W,L){var D=typeof W;D==="string"?L.writeStringField(1,W):D==="boolean"?L.writeBooleanField(7,W):D==="number"&&(W%1!=0?L.writeDoubleField(3,W):W<0?L.writeSVarintField(6,W):L.writeVarintField(5,W))}re.exports=Dt,re.exports.fromVectorTileJs=Dt,re.exports.fromGeojsonVt=function(W,L){L=L||{};var D={};for(var N in W)D[N]=new it(W[N].features,L),D[N].name=N,D[N].version=L.version,D[N].extent=L.extent;return Dt({layers:D})},re.exports.GeoJSONWrapper=it;var Qr=S.by(re.exports);const We={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},ct=Math.fround||(ht=new Float32Array(1),W=>(ht[0]=+W,ht[0]));var ht;const kt=3,Ft=5,Ui=6;class Dr{constructor(L){this.options=Object.assign(Object.create(We),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:N,maxZoom:G}=this.options;D&&console.time("total time");const ne=`prepare ${L.length} points`;D&&console.time(ne),this.points=L;const oe=[];for(let ee=0;ee<L.length;ee++){const _e=L[ee];if(!_e.geometry)continue;const[be,me]=_e.geometry.coordinates,Ee=ct(br(be)),et=ct($i(me));oe.push(Ee,et,1/0,ee,-1,1),this.options.reduce&&oe.push(0)}let de=this.trees[G+1]=this._createTree(oe);D&&console.timeEnd(ne);for(let ee=G;ee>=N;ee--){const _e=+Date.now();de=this.trees[ee]=this._createTree(this._cluster(de,ee)),D&&console.log("z%d: %d clusters in %dms",ee,de.numItems,+Date.now()-_e)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let N=((L[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,L[1]));let ne=L[2]===180?180:((L[2]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)N=-180,ne=180;else if(N>ne){const me=this.getClusters([N,G,180,oe],D),Ee=this.getClusters([-180,G,ne,oe],D);return me.concat(Ee)}const de=this.trees[this._limitZoom(D)],ee=de.range(br(N),$i(oe),br(ne),$i(G)),_e=de.data,be=[];for(const me of ee){const Ee=this.stride*me;be.push(_e[Ee+Ft]>1?ei(_e,Ee,this.clusterProps):this.points[_e[Ee+kt]])}return be}getChildren(L){const D=this._getOriginId(L),N=this._getOriginZoom(L),G="No cluster with the specified id.",ne=this.trees[N];if(!ne)throw new Error(G);const oe=ne.data;if(D*this.stride>=oe.length)throw new Error(G);const de=this.options.radius/(this.options.extent*Math.pow(2,N-1)),ee=ne.within(oe[D*this.stride],oe[D*this.stride+1],de),_e=[];for(const be of ee){const me=be*this.stride;oe[me+4]===L&&_e.push(oe[me+Ft]>1?ei(oe,me,this.clusterProps):this.points[oe[me+kt]])}if(_e.length===0)throw new Error(G);return _e}getLeaves(L,D,N){const G=[];return this._appendLeaves(G,L,D=D||10,N=N||0,0),G}getTile(L,D,N){const G=this.trees[this._limitZoom(L)],ne=Math.pow(2,L),{extent:oe,radius:de}=this.options,ee=de/oe,_e=(N-ee)/ne,be=(N+1+ee)/ne,me={features:[]};return this._addTileFeatures(G.range((D-ee)/ne,_e,(D+1+ee)/ne,be),G.data,D,N,ne,me),D===0&&this._addTileFeatures(G.range(1-ee/ne,_e,1,be),G.data,ne,N,ne,me),D===ne-1&&this._addTileFeatures(G.range(0,_e,ee/ne,be),G.data,-1,N,ne,me),me.features.length?me:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(L);if(D++,N.length!==1)break;L=N[0].properties.cluster_id}return D}_appendLeaves(L,D,N,G,ne){const oe=this.getChildren(D);for(const de of oe){const ee=de.properties;if(ee&&ee.cluster?ne+ee.point_count<=G?ne+=ee.point_count:ne=this._appendLeaves(L,ee.cluster_id,N,G,ne):ne<G?ne++:L.push(de),L.length===N)break}return ne}_createTree(L){const D=new S.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<L.length;N+=this.stride)D.add(L[N],L[N+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,N,G,ne,oe){for(const de of L){const ee=de*this.stride,_e=D[ee+Ft]>1;let be,me,Ee;if(_e)be=ti(D,ee,this.clusterProps),me=D[ee],Ee=D[ee+1];else{const It=this.points[D[ee+kt]];be=It.properties;const[pt,Ct]=It.geometry.coordinates;me=br(pt),Ee=$i(Ct)}const et={type:1,geometry:[[Math.round(this.options.extent*(me*ne-N)),Math.round(this.options.extent*(Ee*ne-G))]],tags:be};let rt;rt=_e||this.options.generateId?D[ee+kt]:this.points[D[ee+kt]].id,rt!==void 0&&(et.id=rt),oe.features.push(et)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:N,extent:G,reduce:ne,minPoints:oe}=this.options,de=N/(G*Math.pow(2,D)),ee=L.data,_e=[],be=this.stride;for(let me=0;me<ee.length;me+=be){if(ee[me+2]<=D)continue;ee[me+2]=D;const Ee=ee[me],et=ee[me+1],rt=L.within(ee[me],ee[me+1],de),It=ee[me+Ft];let pt=It;for(const Ct of rt){const xt=Ct*be;ee[xt+2]>D&&(pt+=ee[xt+Ft])}if(pt>It&&pt>=oe){let Ct,xt=Ee*It,mr=et*It,er=-1;const gt=((me/be|0)<<5)+(D+1)+this.points.length;for(const Bt of rt){const Jt=Bt*be;if(ee[Jt+2]<=D)continue;ee[Jt+2]=D;const Sr=ee[Jt+Ft];xt+=ee[Jt]*Sr,mr+=ee[Jt+1]*Sr,ee[Jt+4]=gt,ne&&(Ct||(Ct=this._map(ee,me,!0),er=this.clusterProps.length,this.clusterProps.push(Ct)),ne(Ct,this._map(ee,Jt)))}ee[me+4]=gt,_e.push(xt/pt,mr/pt,1/0,gt,-1,pt),ne&&_e.push(er)}else{for(let Ct=0;Ct<be;Ct++)_e.push(ee[me+Ct]);if(pt>1)for(const Ct of rt){const xt=Ct*be;if(!(ee[xt+2]<=D)){ee[xt+2]=D;for(let mr=0;mr<be;mr++)_e.push(ee[xt+mr])}}}}return _e}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,N){if(L[D+Ft]>1){const oe=this.clusterProps[L[D+Ui]];return N?Object.assign({},oe):oe}const G=this.points[L[D+kt]].properties,ne=this.options.map(G);return N&&ne===G?Object.assign({},ne):ne}}function ei(W,L,D){return{type:"Feature",id:W[L+kt],properties:ti(W,L,D),geometry:{type:"Point",coordinates:[(N=W[L],360*(N-.5)),os(W[L+1])]}};var N}function ti(W,L,D){const N=W[L+Ft],G=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,ne=W[L+Ui],oe=ne===-1?{}:Object.assign({},D[ne]);return Object.assign(oe,{cluster:!0,cluster_id:W[L+kt],point_count:N,point_count_abbreviated:G})}function br(W){return W/360+.5}function $i(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function os(W){const L=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function ls(W,L,D,N){let G=N;const ne=L+(D-L>>1);let oe,de=D-L;const ee=W[L],_e=W[L+1],be=W[D],me=W[D+1];for(let Ee=L+3;Ee<D;Ee+=3){const et=Na(W[Ee],W[Ee+1],ee,_e,be,me);if(et>G)oe=Ee,G=et;else if(et===G){const rt=Math.abs(Ee-ne);rt<de&&(oe=Ee,de=rt)}}G>N&&(oe-L>3&&ls(W,L,oe,N),W[oe+2]=G,D-oe>3&&ls(W,oe,D,N))}function Na(W,L,D,N,G,ne){let oe=G-D,de=ne-N;if(oe!==0||de!==0){const ee=((W-D)*oe+(L-N)*de)/(oe*oe+de*de);ee>1?(D=G,N=ne):ee>0&&(D+=oe*ee,N+=de*ee)}return oe=W-D,de=L-N,oe*oe+de*de}function Pn(W,L,D,N){const G={id:W??null,type:L,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")$n(G,D);else if(L==="Polygon")$n(G,D[0]);else if(L==="MultiLineString")for(const ne of D)$n(G,ne);else if(L==="MultiPolygon")for(const ne of D)$n(G,ne[0]);return G}function $n(W,L){for(let D=0;D<L.length;D+=3)W.minX=Math.min(W.minX,L[D]),W.minY=Math.min(W.minY,L[D+1]),W.maxX=Math.max(W.maxX,L[D]),W.maxY=Math.max(W.maxY,L[D+1])}function Zn(W,L,D,N){if(!L.geometry)return;const G=L.geometry.coordinates;if(G&&G.length===0)return;const ne=L.geometry.type,oe=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let de=[],ee=L.id;if(D.promoteId?ee=L.properties[D.promoteId]:D.generateId&&(ee=N||0),ne==="Point")Bs(G,de);else if(ne==="MultiPoint")for(const _e of G)Bs(_e,de);else if(ne==="LineString")ge(G,de,oe,!1);else if(ne==="MultiLineString"){if(D.lineMetrics){for(const _e of G)de=[],ge(_e,de,oe,!1),W.push(Pn(ee,"LineString",de,L.properties));return}us(G,de,oe,!1)}else if(ne==="Polygon")us(G,de,oe,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(const _e of L.geometry.geometries)Zn(W,{id:ee,geometry:_e,properties:L.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _e of G){const be=[];us(_e,be,oe,!0),de.push(be)}}W.push(Pn(ee,ne,de,L.properties))}function Bs(W,L){L.push(ja(W[0]),Mt(W[1]),0)}function ge(W,L,D,N){let G,ne,oe=0;for(let ee=0;ee<W.length;ee++){const _e=ja(W[ee][0]),be=Mt(W[ee][1]);L.push(_e,be,0),ee>0&&(oe+=N?(G*be-_e*ne)/2:Math.sqrt(Math.pow(_e-G,2)+Math.pow(be-ne,2))),G=_e,ne=be}const de=L.length-3;L[2]=1,ls(L,0,de,D),L[de+2]=1,L.size=Math.abs(oe),L.start=0,L.end=L.size}function us(W,L,D,N){for(let G=0;G<W.length;G++){const ne=[];ge(W[G],ne,D,N),L.push(ne)}}function ja(W){return W/360+.5}function Mt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function Qt(W,L,D,N,G,ne,oe,de){if(N/=L,ne>=(D/=L)&&oe<N)return W;if(oe<D||ne>=N)return null;const ee=[];for(const _e of W){const be=_e.geometry;let me=_e.type;const Ee=G===0?_e.minX:_e.minY,et=G===0?_e.maxX:_e.maxY;if(Ee>=D&&et<N){ee.push(_e);continue}if(et<D||Ee>=N)continue;let rt=[];if(me==="Point"||me==="MultiPoint")Va(be,rt,D,N,G);else if(me==="LineString")qn(be,rt,D,N,G,!1,de.lineMetrics);else if(me==="MultiLineString")Os(be,rt,D,N,G,!1);else if(me==="Polygon")Os(be,rt,D,N,G,!0);else if(me==="MultiPolygon")for(const It of be){const pt=[];Os(It,pt,D,N,G,!0),pt.length&&rt.push(pt)}if(rt.length){if(de.lineMetrics&&me==="LineString"){for(const It of rt)ee.push(Pn(_e.id,me,It,_e.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(rt.length===1?(me="LineString",rt=rt[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=rt.length===3?"Point":"MultiPoint"),ee.push(Pn(_e.id,me,rt,_e.tags))}}return ee.length?ee:null}function Va(W,L,D,N,G){for(let ne=0;ne<W.length;ne+=3){const oe=W[ne+G];oe>=D&&oe<=N&&Ci(L,W[ne],W[ne+1],W[ne+2])}}function qn(W,L,D,N,G,ne,oe){let de=En(W);const ee=G===0?Ua:$a;let _e,be,me=W.start;for(let pt=0;pt<W.length-3;pt+=3){const Ct=W[pt],xt=W[pt+1],mr=W[pt+2],er=W[pt+3],gt=W[pt+4],Bt=G===0?Ct:xt,Jt=G===0?er:gt;let Sr=!1;oe&&(_e=Math.sqrt(Math.pow(Ct-er,2)+Math.pow(xt-gt,2))),Bt<D?Jt>D&&(be=ee(de,Ct,xt,er,gt,D),oe&&(de.start=me+_e*be)):Bt>N?Jt<N&&(be=ee(de,Ct,xt,er,gt,N),oe&&(de.start=me+_e*be)):Ci(de,Ct,xt,mr),Jt<D&&Bt>=D&&(be=ee(de,Ct,xt,er,gt,D),Sr=!0),Jt>N&&Bt<=N&&(be=ee(de,Ct,xt,er,gt,N),Sr=!0),!ne&&Sr&&(oe&&(de.end=me+_e*be),L.push(de),de=En(W)),oe&&(me+=_e)}let Ee=W.length-3;const et=W[Ee],rt=W[Ee+1],It=G===0?et:rt;It>=D&&It<=N&&Ci(de,et,rt,W[Ee+2]),Ee=de.length-3,ne&&Ee>=3&&(de[Ee]!==de[0]||de[Ee+1]!==de[1])&&Ci(de,de[0],de[1],de[2]),de.length&&L.push(de)}function En(W){const L=[];return L.size=W.size,L.start=W.start,L.end=W.end,L}function Os(W,L,D,N,G,ne){for(const oe of W)qn(oe,L,D,N,G,ne,!1)}function Ci(W,L,D,N){W.push(L,D,N)}function Ua(W,L,D,N,G,ne){const oe=(ne-L)/(N-L);return Ci(W,ne,D+(G-D)*oe,1),oe}function $a(W,L,D,N,G,ne){const oe=(ne-D)/(G-D);return Ci(W,L+(N-L)*oe,ne,1),oe}function Ie(W,L){const D=[];for(let N=0;N<W.length;N++){const G=W[N],ne=G.type;let oe;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")oe=dn(G.geometry,L);else if(ne==="MultiLineString"||ne==="Polygon"){oe=[];for(const de of G.geometry)oe.push(dn(de,L))}else if(ne==="MultiPolygon"){oe=[];for(const de of G.geometry){const ee=[];for(const _e of de)ee.push(dn(_e,L));oe.push(ee)}}D.push(Pn(G.id,ne,oe,G.tags))}return D}function dn(W,L){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let N=0;N<W.length;N+=3)D.push(W[N]+L,W[N+1],W[N+2]);return D}function Zr(W,L){if(W.transformed)return W;const D=1<<W.z,N=W.x,G=W.y;for(const ne of W.features){const oe=ne.geometry,de=ne.type;if(ne.geometry=[],de===1)for(let ee=0;ee<oe.length;ee+=2)ne.geometry.push(pn(oe[ee],oe[ee+1],L,D,N,G));else for(let ee=0;ee<oe.length;ee++){const _e=[];for(let be=0;be<oe[ee].length;be+=2)_e.push(pn(oe[ee][be],oe[ee][be+1],L,D,N,G));ne.geometry.push(_e)}}return W.transformed=!0,W}function pn(W,L,D,N,G,ne){return[Math.round(D*(W*N-G)),Math.round(D*(L*N-ne))]}function Gn(W,L,D,N,G){const ne=L===G.maxZoom?0:G.tolerance/((1<<L)*G.extent),oe={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:N,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const de of W)De(oe,de,ne,G);return oe}function De(W,L,D,N){const G=L.geometry,ne=L.type,oe=[];if(W.minX=Math.min(W.minX,L.minX),W.minY=Math.min(W.minY,L.minY),W.maxX=Math.max(W.maxX,L.maxX),W.maxY=Math.max(W.maxY,L.maxY),ne==="Point"||ne==="MultiPoint")for(let de=0;de<G.length;de+=3)oe.push(G[de],G[de+1]),W.numPoints++,W.numSimplified++;else if(ne==="LineString")mt(oe,G,W,D,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(let de=0;de<G.length;de++)mt(oe,G[de],W,D,ne==="Polygon",de===0);else if(ne==="MultiPolygon")for(let de=0;de<G.length;de++){const ee=G[de];for(let _e=0;_e<ee.length;_e++)mt(oe,ee[_e],W,D,!0,_e===0)}if(oe.length){let de=L.tags||null;if(ne==="LineString"&&N.lineMetrics){de={};for(const _e in L.tags)de[_e]=L.tags[_e];de.mapbox_clip_start=G.start/G.size,de.mapbox_clip_end=G.end/G.size}const ee={geometry:oe,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:de};L.id!==null&&(ee.id=L.id),W.features.push(ee)}}function mt(W,L,D,N,G,ne){const oe=N*N;if(N>0&&L.size<(G?oe:N))return void(D.numPoints+=L.length/3);const de=[];for(let ee=0;ee<L.length;ee+=3)(N===0||L[ee+2]>oe)&&(D.numSimplified++,de.push(L[ee],L[ee+1])),D.numPoints++;G&&function(ee,_e){let be=0;for(let me=0,Ee=ee.length,et=Ee-2;me<Ee;et=me,me+=2)be+=(ee[me]-ee[et])*(ee[me+1]+ee[et+1]);if(be>0===_e)for(let me=0,Ee=ee.length;me<Ee/2;me+=2){const et=ee[me],rt=ee[me+1];ee[me]=ee[Ee-2-me],ee[me+1]=ee[Ee-1-me],ee[Ee-2-me]=et,ee[Ee-1-me]=rt}}(de,ne),W.push(de)}const at={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ri{constructor(L,D){const N=(D=this.options=function(ne,oe){for(const de in oe)ne[de]=oe[de];return ne}(Object.create(at),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let G=function(ne,oe){const de=[];if(ne.type==="FeatureCollection")for(let ee=0;ee<ne.features.length;ee++)Zn(de,ne.features[ee],oe,ee);else Zn(de,ne.type==="Feature"?ne:{geometry:ne},oe);return de}(L,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(ne,oe){const de=oe.buffer/oe.extent;let ee=ne;const _e=Qt(ne,1,-1-de,de,0,-1,2,oe),be=Qt(ne,1,1-de,2+de,0,-1,2,oe);return(_e||be)&&(ee=Qt(ne,1,-de,1+de,0,-1,2,oe)||[],_e&&(ee=Ie(_e,1).concat(ee)),be&&(ee=ee.concat(Ie(be,-1)))),ee}(G,D),G.length&&this.splitTile(G,0,0,0),N&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,N,G,ne,oe,de){const ee=[L,D,N,G],_e=this.options,be=_e.debug;for(;ee.length;){G=ee.pop(),N=ee.pop(),D=ee.pop(),L=ee.pop();const me=1<<D,Ee=Zi(D,N,G);let et=this.tiles[Ee];if(!et&&(be>1&&console.time("creation"),et=this.tiles[Ee]=Gn(L,D,N,G,_e),this.tileCoords.push({z:D,x:N,y:G}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,G,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));const Sr=`z${D}`;this.stats[Sr]=(this.stats[Sr]||0)+1,this.total++}if(et.source=L,ne==null){if(D===_e.indexMaxZoom||et.numPoints<=_e.indexMaxPoints)continue}else{if(D===_e.maxZoom||D===ne)continue;if(ne!=null){const Sr=ne-D;if(N!==oe>>Sr||G!==de>>Sr)continue}}if(et.source=null,L.length===0)continue;be>1&&console.time("clipping");const rt=.5*_e.buffer/_e.extent,It=.5-rt,pt=.5+rt,Ct=1+rt;let xt=null,mr=null,er=null,gt=null,Bt=Qt(L,me,N-rt,N+pt,0,et.minX,et.maxX,_e),Jt=Qt(L,me,N+It,N+Ct,0,et.minX,et.maxX,_e);L=null,Bt&&(xt=Qt(Bt,me,G-rt,G+pt,1,et.minY,et.maxY,_e),mr=Qt(Bt,me,G+It,G+Ct,1,et.minY,et.maxY,_e),Bt=null),Jt&&(er=Qt(Jt,me,G-rt,G+pt,1,et.minY,et.maxY,_e),gt=Qt(Jt,me,G+It,G+Ct,1,et.minY,et.maxY,_e),Jt=null),be>1&&console.timeEnd("clipping"),ee.push(xt||[],D+1,2*N,2*G),ee.push(mr||[],D+1,2*N,2*G+1),ee.push(er||[],D+1,2*N+1,2*G),ee.push(gt||[],D+1,2*N+1,2*G+1)}}getTile(L,D,N){L=+L,D=+D,N=+N;const G=this.options,{extent:ne,debug:oe}=G;if(L<0||L>24)return null;const de=1<<L,ee=Zi(L,D=D+de&de-1,N);if(this.tiles[ee])return Zr(this.tiles[ee],ne);oe>1&&console.log("drilling down to z%d-%d-%d",L,D,N);let _e,be=L,me=D,Ee=N;for(;!_e&&be>0;)be--,me>>=1,Ee>>=1,_e=this.tiles[Zi(be,me,Ee)];return _e&&_e.source?(oe>1&&(console.log("found parent tile z%d-%d-%d",be,me,Ee),console.time("drilling down")),this.splitTile(_e.source,be,me,Ee,L,D,N),oe>1&&console.timeEnd("drilling down"),this.tiles[ee]?Zr(this.tiles[ee],ne):null):null}}function Zi(W,L,D){return 32*((1<<W)*D+L)+W}function dt(W,L){return L?W.properties[L]:W.id}function fn(W,L){if(W==null)return!0;if(W.type==="Feature")return dt(W,L)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const N of W.features){const G=dt(N,L);if(G==null||D.has(G))return!1;D.add(G)}return!0}return!1}function An(W,L){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(dt(W,L),W);else for(const N of W.features)D.set(dt(N,L),N);return D}class Hn extends ae{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const G=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!G)return null;const ne=new class{constructor(de){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=de.length,this._features=de}feature(de){return new class{constructor(ee){this._feature=ee,this.extent=S.X,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const _e of this._feature.geometry)ee.push([new S.P(_e[0],_e[1])]);return ee}{const ee=[];for(const _e of this._feature.geometry){const be=[];for(const me of _e)be.push(new S.P(me[0],me[1]));ee.push(be)}return ee}}toGeoJSON(ee,_e,be){return Tt.call(this,ee,_e,be)}}(this._features[de])}}(G.features);let oe=Qr(ne);return oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),{vectorTile:ne,rawData:oe.buffer}})}loadData(L){return S._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Dr(function({superclusterOptions:oe,clusterProperties:de}){if(!de||!oe)return oe;const ee={},_e={},be={accumulated:null,zoom:0},me={properties:null},Ee=Object.keys(de);for(const et of Ee){const[rt,It]=de[et],pt=S.bC(It),Ct=S.bC(typeof rt=="string"?[rt,["accumulated"],["get",et]]:rt);ee[et]=pt.value,_e[et]=Ct.value}return oe.map=et=>{me.properties=et;const rt={};for(const It of Ee)rt[It]=ee[It].evaluate(be,me);return rt},oe.reduce=(et,rt)=>{me.properties=rt;for(const It of Ee)be.accumulated=et[It],et[It]=_e[It].evaluate(be,me)},oe}(L)).load((yield this._pendingData).features):(G=yield this._pendingData,new ri(G,L.geojsonVtOptions)),this.loaded={};const ne={};if(N){const oe=N.finish();oe&&(ne.resourceTiming={},ne.resourceTiming[L.source]=JSON.parse(JSON.stringify(oe)))}return ne}catch(ne){if(delete this._pendingRequest,S.bB(ne))return{abandoned:!0};throw ne}var G})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return S._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Pe(N,!0),L.filter){const G=S.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(G.result==="error")throw new Error(G.value.map(oe=>`${oe.key}: ${oe.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(oe=>G.value.evaluate({zoom:0},oe))}}return N})}loadGeoJSON(L,D){return S._(this,void 0,void 0,function*(){const{promoteId:N}=L;if(L.request){const G=yield S.h(L.request,D);return this._dataUpdateable=fn(G.data,N)?An(G.data,N):void 0,G.data}if(typeof L.data=="string")try{const G=JSON.parse(L.data);return this._dataUpdateable=fn(G,N)?An(G,N):void 0,G}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(G,ne,oe){var de,ee,_e,be;if(ne.removeAll&&G.clear(),ne.remove)for(const me of ne.remove)G.delete(me);if(ne.add)for(const me of ne.add){const Ee=dt(me,oe);Ee!=null&&G.set(Ee,me)}if(ne.update)for(const me of ne.update){let Ee=G.get(me.id);if(Ee==null)continue;const et=!me.removeAllProperties&&(((de=me.removeProperties)===null||de===void 0?void 0:de.length)>0||((ee=me.addOrUpdateProperties)===null||ee===void 0?void 0:ee.length)>0);if((me.newGeometry||me.removeAllProperties||et)&&(Ee=Object.assign({},Ee),G.set(me.id,Ee),et&&(Ee.properties=Object.assign({},Ee.properties))),me.newGeometry&&(Ee.geometry=me.newGeometry),me.removeAllProperties)Ee.properties={};else if(((_e=me.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const rt of me.removeProperties)Object.prototype.hasOwnProperty.call(Ee.properties,rt)&&delete Ee.properties[rt];if(((be=me.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0)for(const{key:rt,value:It}of me.addOrUpdateProperties)Ee.properties[rt]=It}}(this._dataUpdateable,L.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class mn{constructor(L){this.self=L,this.actor=new S.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,N)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=N},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=D=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,N)=>this._getDEMWorkerSource(D,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(D,N)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(D,N)=>this._getWorkerSource(D,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(D,N)=>this._getWorkerSource(D,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(D,N)=>this._getWorkerSource(D,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(D,N)=>this._getWorkerSource(D,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(D,N)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const G=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],G.removeSource!==void 0&&G.removeSource(N)})),this.actor.registerMessageHandler("RM",D=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,N)=>S._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(D,N)=>this._syncRTLPluginState(D,N)),this.actor.registerMessageHandler("IS",(D,N)=>S._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(D,N)=>this._setImages(D,N)),this.actor.registerMessageHandler("UL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(N)}))}_setImages(L,D){return S._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const N in this.workerSources[L]){const G=this.workerSources[L][N];for(const ne in G)G[ne].availableImages=D}})}_syncRTLPluginState(L,D){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(D.pluginStatus!=="loading")return S.bD.setState(D),D;const N=D.pluginURL;if(this.self.importScripts(N),S.bD.isParsed()){const G={pluginStatus:"loaded",pluginURL:N};return S.bD.setState(G),G}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,N){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][N]){const G={sendAsync:(ne,oe)=>(ne.targetMapId=L,this.actor.sendAsync(ne,oe))};switch(D){case"vector":this.workerSources[L][D][N]=new ae(G,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][N]=new Hn(G,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][N]=new this.externalWorkerSourceTypes[D](G,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][N]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new U),this.demWorkerSources[L][D]}}return S.i(self)&&(self.worker=new mn(self)),mn}),b("index",["exports","./shared"],function(S,d){var $="4.7.1";let ue,xe;const ae={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(ue||(ue=document.createElement("a")),ue.href=f,ue.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xe==null&&(xe=matchMedia("(prefers-reduced-motion: reduce)")),xe.matches)}};class U{static testProp(e){if(!U.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in U.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(e,s){e.style[U.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=U.getScale(e);return U.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=U.getScale(e);for(let p=0;p<s.length;p++)l.push(U.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const ze={supported:!1,testSupport:function(f){!Tt&&Pe&&(re?Q(f):Be=f)}};let Be,Pe,Tt=!1,re=!1;function Q(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Pe),f.isContextLost())return;ze.supported=!0}catch{}f.deleteTexture(e),Tt=!0}var le;typeof document<"u"&&(Pe=document.createElement("img"),Pe.onload=()=>{Be&&Q(Be),Be=null,re=!0},Pe.onerror=()=>{Tt=!0,Be=null},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=k=>{const P=l++;return u[P]=k,P},f.removeThrottleControl=k=>{delete u[k],v()},f.getImage=(k,P,A=!0)=>new Promise((M,F)=>{ze.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),d.e(k,{type:"image"}),e.push({abortController:P,requestParameters:k,supportImageRefresh:A,state:"queued",onError:j=>{F(j)},onSuccess:j=>{M(j)}}),v()});const p=k=>d._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:P,supportImageRefresh:A,onError:M,onSuccess:F,abortController:j}=k,V=A===!1&&!d.i(self)&&!d.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((Y,te)=>Y&&te==="accept",!0));s++;const H=V?w(P,j):d.m(P,j);try{const Y=yield H;delete k.abortController,k.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?F(Y):Y.data&&F({data:yield(J=Y.data,typeof createImageBitmap=="function"?d.d(J):d.f(J)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete k.abortController,M(Y)}finally{s--,v()}var J}),v=()=>{const k=(()=>{for(const P of Object.keys(u))if(u[P]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=s;P<k&&e.length>0;P++){const A=e.shift();A.abortController.signal.aborted?P--:p(A)}},w=(k,P)=>new Promise((A,M)=>{const F=new Image,j=k.url,V=k.credentials;V&&V==="include"?F.crossOrigin="use-credentials":(V&&V==="same-origin"||!d.s(j))&&(F.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,A({data:F})},F.onerror=()=>{F.onerror=F.onload=null,P.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=j})}(le||(le={})),le.resetRequestQueue();class ke{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Oe(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var qe,He=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};qe=new d.A(3),d.A!=Float32Array&&(qe[0]=0,qe[1]=0,qe[2]=0);var it=function(f){var e=f[0],s=f[1];return e*e+s*s};function Dt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function yt(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class _t{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:k}=w;if(this.useMipmap=!!(s&&s.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,u,p,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:P,y:A}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texSubImage2D(k.TEXTURE_2D,0,P,A,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,P,A,u,p,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function cn(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class sr extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new d.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _t(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=d.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,k=v.y+1,P=this.getImage(p).data,A=P.width,M=P.height;d.R.copy(P,u,{x:0,y:0},{x:w,y:k},{width:A,height:M}),d.R.copy(P,u,{x:0,y:M-1},{x:w,y:k-1},{width:A,height:1}),d.R.copy(P,u,{x:0,y:0},{x:w,y:k+M},{width:A,height:1}),d.R.copy(P,u,{x:A-1,y:0},{x:w-1,y:k},{width:1,height:M}),d.R.copy(P,u,{x:0,y:0},{x:w+A,y:k},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),cn(l)&&this.updateImage(s,l)}}}const wr=1e20;function Vi(f,e,s,l,u,p,v,w,k){for(let P=e;P<e+l;P++)hn(f,s*p+P,p,u,v,w,k);for(let P=s;P<s+u;P++)hn(f,P*p+e,1,l,v,w,k)}function hn(f,e,s,l,u,p,v){p[0]=0,v[0]=-wr,v[1]=wr,u[0]=f[e];for(let w=1,k=0,P=0;w<l;w++){u[w]=f[e+w*s];const A=w*w;do{const M=p[k];P=(u[w]-u[M]+A-M*M)/(w-M)/2}while(P<=v[k]&&--k>-1);k++,p[k]=w,v[k]=P,v[k+1]=wr}for(let w=0,k=0;w<l;w++){for(;v[k+1]<w;)k++;const P=p[k],A=w-P;f[e+w*s]=u[P]+A*A}}class Qr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=Qr.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new Qr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qr.loadGlyphRange=function(f,e,s,l){return d._(this,void 0,void 0,function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const k={};for(const P of d.n(w.data))k[P.id]=P;return k})},Qr.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,k=this._createCanvas(w),P=this.ctx=k.getContext("2d",{willReadFrequently:!0});P.font=`${v} ${p} ${f}px ${u}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),k=Math.min(this.size-this.buffer,v+Math.ceil(l)),P=w+2*this.buffer,A=k+2*this.buffer,M=Math.max(P*A,0),F=new Uint8ClampedArray(M),j={data:F,width:P,height:A,glyphWidth:w,glyphHeight:k,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||k===0)return j;const{ctx:V,buffer:H,gridInner:J,gridOuter:Y}=this;V.clearRect(H,H,w,k),V.fillText(f,H,H+v);const te=V.getImageData(H,H,w,k);Y.fill(wr,0,M),J.fill(0,0,M);for(let Z=0;Z<k;Z++)for(let se=0;se<w;se++){const ce=te.data[4*(Z*w+se)+3]/255;if(ce===0)continue;const fe=(Z+H)*P+se+H;if(ce===1)Y[fe]=0,J[fe]=wr;else{const we=.5-ce;Y[fe]=we>0?we*we:0,J[fe]=we<0?we*we:0}}Vi(Y,0,0,P,A,P,this.f,this.v,this.z),Vi(J,H,H,w,k,P,this.f,this.v,this.z);for(let Z=0;Z<M;Z++){const se=Math.sqrt(Y[Z])-Math.sqrt(J[Z]);F[Z]=Math.round(255-255*(se/this.radius+this.cutoff))}return j}};class We{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:d.y.number(e.x,s.x,l),y:d.y.number(e.y,s.y,l),z:d.y.number(e.z,s.z,l)}}}let ct;class ht extends d.E{constructor(e){super(),ct=ct||new d.q({anchor:new d.D(d.v.light.anchor),position:new We,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const kt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Ft extends d.E{constructor(e){super(),this._transitionable=new d.T(kt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ui{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let k=e[0];for(let P=1;P<e.length;P++){w=!w;const A=e[P];p=k*l,k+=A,v=k*l,u.push({left:p,right:v,isDash:w,zeroLength:A===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,k=e[w];for(let P=0;P<this.width;P++){P/k.right>1&&(k=e[++w]);const A=Math.abs(P-k.left),M=Math.abs(P-k.right),F=Math.min(A,M);let j;const V=p/l*(u+1);if(k.isDash){const H=u-Math.abs(V);j=Math.sqrt(F*F+H*H)}else j=u-Math.sqrt(F*F+V*V);this.data[v+P]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const k=e[w],P=e[w+1];k.zeroLength?e.splice(w,1):P&&P.isDash===k.isDash&&(P.left=k.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const k=Math.abs(w-v.left),P=Math.abs(w-v.right),A=Math.min(k,P);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?A:-A)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,k=this.getDashRanges(e,this.width,w);s?this.addRoundDash(k,w,l):this.addRegularDash(k)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Dr="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Dr]}numActive(){return Object.keys(this.active).length}}const ti=Math.floor(ae.hardwareConcurrency/2);let br,$i;function os(){return br||(br=new ei),br}ei.workerCount=d.C(globalThis)?Math.max(Math.min(ti,3),1):1;class ls{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new d.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function Na(){return $i||($i=new ls(os(),d.G),$i.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),$i}function Pn(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function $n(f,e,s,l,u,p){const v=function(M,F,j){if(M)for(const V of M){const H=F[V];if(H&&H.source===j&&H.type==="fill-extrusion")return!0}else for(const V in F){const H=F[V];if(H.source===j&&H.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),k=f.tilesIn(l,w,v);k.sort(Zn);const P=[];for(const M of k)P.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,s,f._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,u,p,w,Pn(f.transform,M.tileID))});const A=function(M){const F={},j={};for(const V of M){const H=V.queryResults,J=V.wrappedTileID,Y=j[J]=j[J]||{};for(const te in H){const Z=H[te],se=Y[te]=Y[te]||{},ce=F[te]=F[te]||[];for(const fe of Z)se[fe.featureIndex]||(se[fe.featureIndex]=!0,ce.push(fe))}}return F}(P);for(const M in A)A[M].forEach(F=>{const j=F.feature,V=f.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=V});return A}function Zn(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Bs(f,e,s){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield ae.frameAsync(s),!l)return null;const u=d.M(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(p=>p.id)),u})}class ge{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof d.N)u=e,p=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new d.N(u.lng,u.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=d.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof ge?e:e&&new ge(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new ge(new d.N(e.lng-u,e.lat-l),new d.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new ge(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class us{constructor(e,s,l){this.bounds=ge.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(d.O(this.bounds.getWest())*s),u=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),v=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class ja extends d.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new us(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,v)=>{e.reloadPromise={resolve:p,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Mt extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new us(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield le.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new _t(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Qt extends Mt{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield le.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(p)&&d.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,l=e.height+2;try{return new d.R({width:s,height:l},yield d.W(e,-1,-1,s,l))}catch{}}return ae.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,k={};return k[new d.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},k[new d.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(k[new d.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(k[new d.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),k}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Va extends d.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(ae.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(p,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var qn=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class En extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(u){let p=1/0,v=1/0,w=-1/0,k=-1/0;for(const F of u)p=Math.min(p,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),k=Math.max(k,F.y);const P=Math.max(w-p,k-v),A=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),M=Math.pow(2,A);return new d.a1(A,Math.floor((p+w)/2*M),Math.floor((v+k)/2*M))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _t(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Os extends En{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new _t(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ci extends En{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _t(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ua={},$a=f=>{switch(f){case"geojson":return Va;case"image":return En;case"raster":return Mt;case"raster-dem":return Qt;case"vector":return ja;case"video":return Os;case"canvas":return Ci}return Ua[f]},Ie="RTLPluginLoaded";class dn extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Na()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ae.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zr=null;function pn(){return Zr||(Zr=new dn),Zr}class Gn{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const v={};if(!p)return v;for(const w of u){const k=w.layerIds.map(P=>p.getLayer(P)).filter(Boolean);if(k.length!==0){w.layers=k,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>k.filter(A=>A.id===P)[0]));for(const P of k)v[P.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,pn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _t(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _t(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,k,P,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:A,transform:k,params:w,queryPadding:this.queryPadding*P},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=d.a7(s&&s.filter),{z:k,x:P,y:A}=this.tileID.canonical,M={z:k,x:P,y:A};for(let F=0;F<v.length;F++){const j=v.feature(F);if(w.needGeometry){const J=d.a8(j,!0);if(!w.filter(new d.z(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!w.filter(new d.z(this.tileID.overscaledZ),j))continue;const V=l.getId(j,p),H=new d.a9(j,k,P,A,V);H.tile=M,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=d.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],k=e[v];if(!w||!k||Object.keys(k).length===0)continue;p.update(k,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(u);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ae.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ae.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class De{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class mt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class at extends d.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,v,w)=>{const k=new($a(p.type))(u,p,v,w);if(k.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${k.id}`);return k})(e,s,l,this),this._tiles={},this._cache=new De(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new mt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(ri).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,v=u.tileID,w=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),k=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||k.y-w.y||k.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(ri).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=ae.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,k=Math.pow(2,u.tileID.canonical.z),P=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+k)===1?v+=k:Math.abs(v-k)===1&&(v-=k)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[P]&&(u.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const P=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[P.key],v&&v.hasData()&&(w=P)}let k=w;for(;k.overscaledZ>s;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},k={},P=Object.keys(e),A=ae.now();for(const M of P){const F=e[M],j=this._tiles[M];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=A)continue;const V=this.findLoadedParent(F,s),H=this.findLoadedSibling(F),J=V||H||null;J&&(this._addTile(J.tileID),w[J.tileID.key]=J.tileID),k[M]=F}this._retainLoadedChildren(k,u,l,e);for(const M in w)e[M]||(this._coveredTiles[M]=!0,e[M]=w[M]);if(v){const M={},F={};for(const j of p)this._tiles[j.key].hasData()?M[j.key]=j:F[j.key]=j;for(const j in F){const V=F[j].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(M[V[0].key]=e[V[0].key]=V[0],M[V[1].key]=e[V[1].key]=V[1],M[V[2].key]=e[V[2].key]=V[2],M[V[3].key]=e[V[3].key]=V[3],delete F[j])}for(const j in F){const V=F[j],H=this.findLoadedParent(V,this._source.minzoom),J=this.findLoadedSibling(V),Y=H||J||null;if(Y){M[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const te in M)M[te].isChildOf(Y.tileID)&&delete M[te]}}for(const j in this._tiles)M[j]||(this._coveredTiles[j]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(A=>this._source.hasTile(A)))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-at.maxOverzooming,this._source.minzoom),v=Math.max(u+at.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of l)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);A[F.key]=F;const j=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[j.key]=j}l=l.concat(Object.values(A))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(l,u);Zi(this._source.type)&&this._updateCoveredAndRetainedTiles(k,p,v,u,l,s);for(const A in k)this._tiles[A].clearFadeHold();const P=d.ab(this._tiles,k);for(const A of P){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-at.maxOverzooming,this._source.minzoom),w=Math.max(s+at.maxUnderzooming,this._source.minzoom),k={};for(const P of e){const A=this._addTile(P);u[P.key]=P,A.hasData()||s<this._source.maxzoom&&(k[P.key]=P)}this._retainLoadedChildren(k,s,w,u);for(const P of e){let A=this._tiles[P.key];if(A.hasData())continue;if(s+1>this._source.maxzoom){const F=P.children(this._source.maxzoom)[0],j=this.getTile(F);if(j&&j.hasData()){u[F.key]=F;continue}}else{const F=P.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let M=A.wasRequested();for(let F=P.overscaledZ-1;F>=v;--F){const j=P.scaledTo(F);if(p[j.key])break;if(p[j.key]=!0,A=this.getTile(j),!A&&M&&(A=this._addTile(j)),A){const V=A.hasData();if((V||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||M)&&(u[j.key]=j),M=A.wasRequested(),V)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Gn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map(V=>p.pointCoordinate(V,this.terrain)),k=v.map(V=>p.pointCoordinate(V,this.terrain)),P=this.getIds();let A=1/0,M=1/0,F=-1/0,j=-1/0;for(const V of k)A=Math.min(A,V.x),M=Math.min(M,V.y),F=Math.max(F,V.x),j=Math.max(j,V.y);for(let V=0;V<P.length;V++){const H=this._tiles[P[V]];if(H.holdingForFade())continue;const J=H.tileID,Y=Math.pow(2,p.zoom-H.tileID.overscaledZ),te=s*H.queryPadding*d.X/H.tileSize/Y,Z=[J.getTilePoint(new d.Z(A,M)),J.getTilePoint(new d.Z(F,j))];if(Z[0].x-te<d.X&&Z[0].y-te<d.X&&Z[1].x+te>=0&&Z[1].y+te>=0){const se=w.map(fe=>J.getTilePoint(fe)),ce=k.map(fe=>J.getTilePoint(fe));u.push({tile:H,tileID:J,queryGeometry:se,cameraQueryGeometry:ce,scale:Y})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Zi(this._source.type)){const e=ae.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function ri(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Zi(f){return f==="raster"||f==="image"||f==="video"}at.maxOverzooming=10,at.maxUnderzooming=3;class dt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,k=w>0?(u-v)/w:0;return this.points[p].mult(1-k).add(this.points[s].mult(k))}}function fn(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class An{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const k=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let P=0;P<this.boxKeys.length;P++)k.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const A=this.circles[3*P],M=this.circles[3*P+1],F=this.circles[3*P+2];k.push({key:this.circleKeys[P],x1:A-F,y1:M-F,x2:A+F,y2:M+F})}}else this._forEachCell(e,s,l,u,this._queryCell,k,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return k}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,k=s-l,P=s+l;if(w<0||v>this.width||P<0||k>this.height)return!1;const A=[];return this._forEachCell(v,k,w,P,this._queryCellCircle,A,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),A.length>0}_queryCell(e,s,l,u,p,v,w,k){const{seenUids:P,hitTest:A,overlapMode:M}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const H of F)if(!P.box[H]){P.box[H]=!0;const J=4*H,Y=this.boxKeys[H];if(e<=V[J+2]&&s<=V[J+3]&&l>=V[J+0]&&u>=V[J+1]&&(!k||k(Y))&&(!A||!fn(M,Y.overlapMode))&&(v.push({key:Y,x1:V[J],y1:V[J+1],x2:V[J+2],y2:V[J+3]}),A))return!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const H of j)if(!P.circle[H]){P.circle[H]=!0;const J=3*H,Y=this.circleKeys[H];if(this._circleAndRectCollide(V[J],V[J+1],V[J+2],e,s,l,u)&&(!k||k(Y))&&(!A||!fn(M,Y.overlapMode))){const te=V[J],Z=V[J+1],se=V[J+2];if(v.push({key:Y,x1:te-se,y1:Z-se,x2:te+se,y2:Z+se}),A)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,k){const{circle:P,seenUids:A,overlapMode:M}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const H of F)if(!A.box[H]){A.box[H]=!0;const J=4*H,Y=this.boxKeys[H];if(this._circleAndRectCollide(P.x,P.y,P.radius,V[J+0],V[J+1],V[J+2],V[J+3])&&(!k||k(Y))&&!fn(M,Y.overlapMode))return v.push(!0),!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const H of j)if(!A.circle[H]){A.circle[H]=!0;const J=3*H,Y=this.circleKeys[H];if(this._circlesCollide(V[J],V[J+1],V[J+2],P.x,P.y,P.radius)&&(!k||k(Y))&&!fn(M,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,k){const P=this._convertToXCellCoord(e),A=this._convertToYCellCoord(s),M=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let j=P;j<=M;j++)for(let V=A;V<=F;V++)if(p.call(this,e,s,l,u,this.xCellCount*V+j,v,w,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,k=p-s,P=l+v;return P*P>w*w+k*k}_circleAndRectCollide(e,s,l,u,p,v,w){const k=(v-u)/2,P=Math.abs(e-(u+k));if(P>k+l)return!1;const A=(w-p)/2,M=Math.abs(s-(p+A));if(M>A+l)return!1;if(P<=k||M<=A)return!0;const F=P-k,j=M-A;return F*F+j*j<=l*l}}function Hn(f,e,s,l,u){const p=d.H();return e?(d.K(p,p,[1/u,1/u,1]),s||d.ad(p,p,l.angle)):d.L(p,l.labelPlaneMatrix,f),p}function mn(f,e,s,l,u){if(e){const p=d.ae(f);return d.K(p,p,[u,u,1]),s||d.ad(p,p,-l.angle),p}return l.glCoordMatrix}function W(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],d.af(u,u,s)):(u=[f,e,0,1],It(u,u,s));const p=u[3];return{point:new d.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function N(f,e,s,l,u,p,v,w,k,P,A,M,F,j,V){const H=l?f.textSizeData:f.iconSizeData,J=d.ag(H,s.transform.zoom),Y=[256/s.width*2+1,256/s.height*2+1],te=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();const Z=f.lineVertexArray,se=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let fe=!1;for(let we=0;we<se.length;we++){const Te=se.get(we);if(Te.hidden||Te.writingMode===d.ah.vertical&&!fe){rt(Te.numGlyphs,te);continue}fe=!1;const Fe=W(Te.anchorX,Te.anchorY,e,V);if(!D(Fe.point,Y)){rt(Te.numGlyphs,te);continue}const Ue=L(s.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Me=d.ai(H,J,Te),Ae=v?Me/Ue:Me*Ue,Ke={getElevation:V,labelPlaneMatrix:u,lineVertexArray:Z,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:P,tileAnchorPoint:new d.P(Te.anchorX,Te.anchorY),unwrappedTileID:A,width:M,height:F,translation:j},ut=oe(Ke,Te,Ae,!1,w,e,p,f.glyphOffsetArray,te,ce,k);fe=ut.useVertical,(ut.notEnoughRoom||fe||ut.needsFlipping&&oe(Ke,Te,Ae,!0,w,e,p,f.glyphOffsetArray,te,ce,k).notEnoughRoom)&&rt(Te.numGlyphs,te)}l?f.text.dynamicLayoutVertexBuffer.updateData(te):f.icon.dynamicLayoutVertexBuffer.updateData(te)}function G(f,e,s,l,u,p,v,w){const k=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,A=p.lineStartIndex+p.lineLength,M=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(k-1),j=Ee(f*M,s,l,u,p.segment,P,A,w,v);if(!j)return null;const V=Ee(f*F,s,l,u,p.segment,P,A,w,v);return V?w.projectionCache.anyProjectionOccluded?null:{first:j,last:V}:null}function ne(f,e,s,l){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function oe(f,e,s,l,u,p,v,w,k,P,A){const M=s/24,F=e.lineOffsetX*M,j=e.lineOffsetY*M;let V;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,J=e.lineStartIndex,Y=e.lineStartIndex+e.lineLength,te=G(M,w,F,j,l,e,A,f);if(!te)return{notEnoughRoom:!0};const Z=W(te.first.point.x,te.first.point.y,v,f.getElevation).point,se=W(te.last.point.x,te.last.point.y,v,f.getElevation).point;if(u&&!l){const ce=ne(e.writingMode,Z,se,P);if(ce)return ce}V=[te.first];for(let ce=e.glyphStartIndex+1;ce<H-1;ce++)V.push(Ee(M*w.getoffsetX(ce),F,j,l,e.segment,J,Y,f,A));V.push(te.last)}else{if(u&&!l){const J=W(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,Y=e.lineStartIndex+e.segment+1,te=new d.P(f.lineVertexArray.getx(Y),f.lineVertexArray.gety(Y)),Z=W(te.x,te.y,p,f.getElevation),se=Z.signedDistanceFromCamera>0?Z.point:function(fe,we,Te,Fe,Ue,Me){return de(fe,we,Te,1,Ue,Me)}(f.tileAnchorPoint,te,J,0,p,f),ce=ne(e.writingMode,J,se,P);if(ce)return ce}const H=Ee(M*w.getoffsetX(e.glyphStartIndex),F,j,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,A);if(!H||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};V=[H]}for(const H of V)d.aj(k,H.point,H.angle);return{}}function de(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?W(v.x,v.y,u,p.getElevation).point:_e(v.x,v.y,p).point,k=s.sub(w);return s.add(k._mult(l/k.mag()))}function ee(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=_e(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return function(w,k,P,A,M){return de(w,k,P,A,void 0,M)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function _e(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=W(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function be(f,e,s){return f._unit()._perp()._mult(e*s)}function me(f,e,s,l,u,p,v,w,k){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const P=s.add(e);if(f+k.direction<l||f+k.direction>=u)return w.projectionCache.offsets[f]=P,P;const A=ee(f+k.direction,w,k),M=be(A.sub(s),v,k.direction),F=s.add(M),j=A.add(M);return w.projectionCache.offsets[f]=d.ak(p,P,F,j)||P,w.projectionCache.offsets[f]}function Ee(f,e,s,l,u,p,v,w,k){const P=l?f-e:f+e;let A=P>0?1:-1,M=0;l&&(A*=-1,M=Math.PI),A<0&&(M+=Math.PI);let F,j=A>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=_e(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let V,H,J=F,Y=F,te=0,Z=0;const se=Math.abs(P),ce=[];let fe;for(;te+Z<=se;){if(j+=A,j<p||j>=v)return null;te+=Z,Y=J,H=V;const Fe={absOffsetX:se,direction:A,distanceFromAnchor:te,previousVertex:Y};if(J=ee(j,w,Fe),s===0)ce.push(Y),fe=J.sub(Y);else{let Ue;const Me=J.sub(Y);Ue=Me.mag()===0?be(ee(j+A,w,Fe).sub(J),s,A):be(Me,s,A),H||(H=Y.add(Ue)),V=me(j,Ue,J,p,v,H,s,w,Fe),ce.push(H),fe=V.sub(H)}Z=fe.mag()}const we=fe._mult((se-te)/Z)._add(H||Y),Te=M+Math.atan2(J.y-Y.y,J.x-Y.x);return ce.push(we),{point:we,angle:k?Te:0,path:ce}}const et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(et,3*l)}}function It(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const pt=100;class Ct{constructor(e,s,l=new An(e.width+200,e.height+200,25),u=new An(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+pt,this.screenBottomBoundary=e.height+pt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,k,P,A,M){const F=e.anchorPointX+k[0],j=e.anchorPointY+k[1],V=this.projectAndGetPerspectiveRatio(u,F,j,p,A),H=l*V.perspectiveRatio;let J;if(v||w)J=this._projectCollisionBox(e,H,u,p,v,w,k,V,A,M);else{const ce=V.point.x+(M?M.x*H:0),fe=V.point.y+(M?M.y*H:0);J={allPointsOccluded:!1,box:[ce+e.x1*H,fe+e.y1*H,ce+e.x2*H,fe+e.y2*H]}}const[Y,te,Z,se]=J.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?J.allPointsOccluded:this.mapProjection.isOccluded(F,j,p))||V.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Y,te,Z,se)||s!=="always"&&this.grid.hitTest(Y,te,Z,se,s,P)?{box:[Y,te,Z,se],placeable:!1,offscreen:!1}:{box:[Y,te,Z,se],placeable:!0,offscreen:this.isOffscreen(Y,te,Z,se)}}placeCollisionCircles(e,s,l,u,p,v,w,k,P,A,M,F,j,V,H,J){const Y=[],te=new d.P(s.anchorX,s.anchorY),Z=this.getPerspectiveRatio(v,te.x,te.y,w,J),se=(M?p/Z:p*Z)/d.ap,ce={getElevation:J,labelPlaneMatrix:k,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:te,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:H},fe=G(se,u,s.lineOffsetX*se,s.lineOffsetY*se,!1,s,!1,ce);let we=!1,Te=!1,Fe=!0;if(fe){const Ue=.5*j*Z+V,Me=new d.P(-100,-100),Ae=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new dt,ut=fe.first,Le=fe.last;let je=[];for(let ft=ut.path.length-1;ft>=1;ft--)je.push(ut.path[ft]);for(let ft=1;ft<Le.path.length;ft++)je.push(Le.path[ft]);const ot=2.5*Ue;if(P){const ft=this.projectPathToScreenSpace(je,ce,P);je=ft.some(wt=>wt.signedDistanceFromCamera<=0)?[]:ft.map(wt=>wt.point)}let Ht=[];if(je.length>0){const ft=je[0].clone(),wt=je[0].clone();for(let Wt=1;Wt<je.length;Wt++)ft.x=Math.min(ft.x,je[Wt].x),ft.y=Math.min(ft.y,je[Wt].y),wt.x=Math.max(wt.x,je[Wt].x),wt.y=Math.max(wt.y,je[Wt].y);Ht=ft.x>=Me.x&&wt.x<=Ae.x&&ft.y>=Me.y&&wt.y<=Ae.y?[je]:wt.x<Me.x||ft.x>Ae.x||wt.y<Me.y||ft.y>Ae.y?[]:d.al([je],Me.x,Me.y,Ae.x,Ae.y)}for(const ft of Ht){Ke.reset(ft,.25*Ue);let wt=0;wt=Ke.length<=.5*Ue?1:Math.ceil(Ke.paddedLength/ot)+1;for(let Wt=0;Wt<wt;Wt++){const Rr=Wt/Math.max(wt-1,1),Ki=Ke.lerp(Rr),Xt=Ki.x+pt,si=Ki.y+pt;Y.push(Xt,si,Ue,0);const Gr=Xt-Ue,Fr=si-Ue,Hr=Xt+Ue,vn=si+Ue;if(Fe=Fe&&this.isOffscreen(Gr,Fr,Hr,vn),Te=Te||this.isInsideGrid(Gr,Fr,Hr,vn),e!=="always"&&this.grid.hitTestCircle(Xt,si,Ue,e,F)&&(we=!0,!A))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!A&&we||!Te||Z<this.perspectiveRatioCutoff?[]:Y,offscreen:Fe,collisionDetected:we}}projectPathToScreenSpace(e,s,l){return e.map(u=>W(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const A of e){const M=new d.P(A.x+pt,A.y+pt);l=Math.min(l,M.x),u=Math.min(u,M.y),p=Math.max(p,M.x),v=Math.max(v,M.y),s.push(M)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),k={},P={};for(const A of w){const M=A.key;if(k[M.bucketInstanceId]===void 0&&(k[M.bucketInstanceId]={}),k[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(A.x1,A.y1),new d.P(A.x2,A.y1),new d.P(A.x2,A.y2),new d.P(A.x1,A.y2)];d.am(s,F)&&(k[M.bucketInstanceId][M.featureIndex]=!0,P[M.bucketInstanceId]===void 0&&(P[M.bucketInstanceId]=[]),P[M.bucketInstanceId].push(M.featureIndex))}return P}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,k={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let P=0;P<e.length;P+=4)w.insertCircle(k,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],d.af(v,v,e)):(v=[s,l,0,1],It(v,v,e));const w=v[3];return{point:new d.P((v[0]/w+1)/2*this.transform.width+pt,(-v[1]/w+1)/2*this.transform.height+pt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):W(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<pt||e>=this.screenRightBoundary||u<pt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,k,P,A){let M=new d.P(1,0),F=new d.P(0,1);const j=new d.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const Fe=this.projectAndGetPerspectiveRatio(l,j.x+1,j.y,u,P).point.sub(k.point).unit(),Ue=Math.atan(Fe.y/Fe.x)+(Fe.x<0?Math.PI:0),Me=Math.sin(Ue),Ae=Math.cos(Ue);M=new d.P(Ae,Me),F=new d.P(-Me,Ae)}else if(!v&&p){const Fe=-this.transform.angle,Ue=Math.sin(Fe),Me=Math.cos(Fe);M=new d.P(Me,Ue),F=new d.P(-Ue,Me)}let V=k.point,H=s;if(p){V=j;const Fe=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-Fe),H*=this.mapProjection.getPitchedTextCorrection(this.transform,j,u),A||(H*=d.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&(V=V.add(M.mult(A.x*H)).add(F.mult(A.y*H)));const J=e.x1*H,Y=e.x2*H,te=(J+Y)/2,Z=e.y1*H,se=e.y2*H,ce=(Z+se)/2,fe=[{offsetX:J,offsetY:Z},{offsetX:te,offsetY:Z},{offsetX:Y,offsetY:Z},{offsetX:Y,offsetY:ce},{offsetX:Y,offsetY:se},{offsetX:te,offsetY:se},{offsetX:J,offsetY:se},{offsetX:J,offsetY:ce}];let we=[];for(const{offsetX:Fe,offsetY:Ue}of fe)we.push(new d.P(V.x+M.x*Fe+F.x*Ue,V.y+M.y*Fe+F.y*Ue));let Te=!1;if(p){const Fe=we.map(Ue=>this.projectAndGetPerspectiveRatio(l,Ue.x,Ue.y,u,P));Te=Fe.some(Ue=>!Ue.isOccluded),we=Fe.map(Ue=>Ue.point)}else Te=!0;return{box:d.ao(we),allPointsOccluded:!Te}}}function xt(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class mr{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class er{constructor(e,s,l,u,p){this.text=new mr(e?e.text:null,s,l,p),this.icon=new mr(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class Bt{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class Jt{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class Sr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Pr(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=d.au(f);return new d.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class qr{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new Ct(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Sr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,k=p.layers[0].layout,P=p.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/d.X,F=l.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(F),V=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",J=xt(l,1,this.transform.zoom),Y=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),te=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),Z=Hn(j,V,H,this.transform,J);let se=null;if(V){const fe=mn(j,V,H,this.transform,J);se=d.L([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[p.bucketInstanceId]=new Jt(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const ce={bucket:p,layout:k,translationText:Y,translationIcon:te,posMatrix:j,unwrappedTileID:F,textLabelPlaneMatrix:Z,labelToScreenMatrix:se,scale:A,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const fe of p.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Te,symbolInstanceEnd:Fe}=fe;e.push({sortKey:we,symbolInstanceStart:Te,symbolInstanceEnd:Fe,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,s,l,u,p,v,w,k,P,A,M,F,j,V,H,J,Y,te,Z){const se=d.aq[e.textAnchor],ce=[e.textOffset0,e.textOffset1],fe=Pr(se,l,u,ce,p),we=this.collisionIndex.placeCollisionBox(s,F,k,P,A,w,v,J,M.predicate,Z,fe);if((!te||this.collisionIndex.placeCollisionBox(te,F,k,P,A,w,v,Y,M.predicate,Z,fe).placeable)&&we.placeable){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ce,width:l,height:u,anchor:se,textBoxScale:p,prevAnchor:Te},this.markUsedJustification(V,se,j,H),V.allowVerticalPlacement&&(this.markUsedOrientation(V,H,j),this.placedOrientations[j.crossTileID]=H),{shift:fe,placedGlyphBoxes:we}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:k,unwrappedTileID:P,textLabelPlaneMatrix:A,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:H,collisionGroup:J}=e.parameters,Y=p.get("text-optional"),te=p.get("icon-optional"),Z=d.ar(p,"text-overlap","text-allow-overlap"),se=Z==="always",ce=d.ar(p,"icon-overlap","icon-allow-overlap"),fe=ce==="always",we=p.get("text-rotation-alignment")==="map",Te=p.get("text-pitch-alignment")==="map",Fe=p.get("icon-text-fit")!=="none",Ue=p.get("symbol-z-order")==="viewport-y",Me=se&&(fe||!u.hasIconData()||te),Ae=fe&&(se||!u.hasTextData()||Y);!u.collisionArrays&&V&&u.deserializeCollisionBoxes(V);const Ke=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),ut=(Le,je,ot)=>{var Ht,ft;if(s[Le.crossTileID])return;if(j)return void(this.placements[Le.crossTileID]=new gt(!1,!1,!1));let wt=!1,Wt=!1,Rr=!0,Ki=null,Xt={box:null,placeable:!1,offscreen:null},si={placeable:!1},Gr=null,Fr=null,Hr=null,vn=0,aa=0,ul=0;je.textFeatureIndex?vn=je.textFeatureIndex:Le.useRuntimeCollisionCircles&&(vn=Le.featureIndex),je.verticalTextFeatureIndex&&(aa=je.verticalTextFeatureIndex);const oa=je.textBox;if(oa){const Di=Er=>{let Br=d.ah.horizontal;if(u.allowVerticalPlacement&&!Er&&this.prevPlacement){const xi=this.prevPlacement.placedOrientations[Le.crossTileID];xi&&(this.placedOrientations[Le.crossTileID]=xi,Br=xi,this.markUsedOrientation(u,Br,Le))}return Br},Li=(Er,Br)=>{if(u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&je.verticalTextBox){for(const xi of u.writingModes)if(xi===d.ah.vertical?(Xt=Br(),si=Xt):Xt=Er(),Xt&&Xt.placeable)break}else Xt=Er()},Kn=Le.textAnchorOffsetStartIndex,Ji=Le.textAnchorOffsetEndIndex;if(Ji===Kn){const Er=(Br,xi)=>{const St=this.collisionIndex.placeCollisionBox(Br,Z,F,k,P,Te,we,v,J.predicate,Ke);return St&&St.placeable&&(this.markUsedOrientation(u,xi,Le),this.placedOrientations[Le.crossTileID]=xi),St};Li(()=>Er(oa,d.ah.horizontal),()=>{const Br=je.verticalTextBox;return u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Br?Er(Br,d.ah.vertical):{box:null,offscreen:null}}),Di(Xt&&Xt.placeable)}else{let Er=d.aq[(ft=(Ht=this.prevPlacement)===null||Ht===void 0?void 0:Ht.variableOffsets[Le.crossTileID])===null||ft===void 0?void 0:ft.anchor];const Br=(St,bs,la)=>{const ua=St.x2-St.x1,Lh=St.y2-St.y1,Gp=Le.textBoxScale,Rh=Fe&&ce==="never"?bs:null;let Jn=null,Fh=Z==="never"?1:2,hl="never";Er&&Fh++;for(let uo=0;uo<Fh;uo++){for(let dl=Kn;dl<Ji;dl++){const pl=u.textAnchorOffsets.get(dl);if(Er&&pl.textAnchor!==Er)continue;const ca=this.attemptAnchorPlacement(pl,St,ua,Lh,Gp,we,Te,F,k,P,J,hl,Le,u,la,v,w,Rh,Ke);if(ca&&(Jn=ca.placedGlyphBoxes,Jn&&Jn.placeable))return wt=!0,Ki=ca.shift,Jn}Er?Er=null:hl=Z}return l&&!Jn&&(Jn={box:this.collisionIndex.placeCollisionBox(oa,"always",F,k,P,Te,we,v,J.predicate,Ke,new d.P(0,0)).box,offscreen:!1,placeable:!1}),Jn};Li(()=>Br(oa,je.iconBox,d.ah.horizontal),()=>{const St=je.verticalTextBox;return u.allowVerticalPlacement&&(!Xt||!Xt.placeable)&&Le.numVerticalGlyphVertices>0&&St?Br(St,je.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Xt&&(wt=Xt.placeable,Rr=Xt.offscreen);const xi=Di(Xt&&Xt.placeable);if(!wt&&this.prevPlacement){const St=this.prevPlacement.variableOffsets[Le.crossTileID];St&&(this.variableOffsets[Le.crossTileID]=St,this.markUsedJustification(u,St.anchor,Le,xi))}}}if(Gr=Xt,wt=Gr&&Gr.placeable,Rr=Gr&&Gr.offscreen,Le.useRuntimeCollisionCircles){const Di=u.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),Li=d.ai(u.textSizeData,H,Di),Kn=p.get("text-padding");Fr=this.collisionIndex.placeCollisionCircles(Z,Di,u.lineVertexArray,u.glyphOffsetArray,Li,k,P,A,M,l,Te,J.predicate,Le.collisionCircleDiameter,Kn,v,Ke),Fr.circles.length&&Fr.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),wt=se||Fr.circles.length>0&&!Fr.collisionDetected,Rr=Rr&&Fr.offscreen}if(je.iconFeatureIndex&&(ul=je.iconFeatureIndex),je.iconBox){const Di=Li=>this.collisionIndex.placeCollisionBox(Li,ce,F,k,P,Te,we,w,J.predicate,Ke,Fe&&Ki?Ki:void 0);si&&si.placeable&&je.verticalIconBox?(Hr=Di(je.verticalIconBox),Wt=Hr.placeable):(Hr=Di(je.iconBox),Wt=Hr.placeable),Rr=Rr&&Hr.offscreen}const zi=Y||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,cl=te||Le.numIconVertices===0;zi||cl?cl?zi||(Wt=Wt&&wt):wt=Wt&&wt:Wt=wt=Wt&&wt;const Hu=Wt&&Hr.placeable;if(wt&&Gr.placeable&&this.collisionIndex.insertCollisionBox(Gr.box,Z,p.get("text-ignore-placement"),u.bucketInstanceId,si&&si.placeable&&aa?aa:vn,J.ID),Hu&&this.collisionIndex.insertCollisionBox(Hr.box,ce,p.get("icon-ignore-placement"),u.bucketInstanceId,ul,J.ID),Fr&&wt&&this.collisionIndex.insertCollisionCircles(Fr.circles,Z,p.get("text-ignore-placement"),u.bucketInstanceId,vn,J.ID),l&&this.storeCollisionData(u.bucketInstanceId,ot,je,Gr,Hr,Fr),Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new gt(wt||Me,Wt||Ae,Rr||u.justReloaded),s[Le.crossTileID]=!0};if(Ue){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=u.getSortedSymbolIndexes(this.transform.angle);for(let je=Le.length-1;je>=0;--je){const ot=Le[je];ut(u.symbolInstances.get(ot),u.collisionArrays[ot],ot)}}else for(let Le=e.symbolInstanceStart;Le<e.symbolInstanceEnd;Le++)ut(u.symbolInstances.get(Le),u.collisionArrays[Le],Le);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[u.bucketInstanceId];d.as(Le.invProjMatrix,k),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,k;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?k=w.get(s):(k={text:null,icon:null},w.set(s,k)),l.textBox&&(k.text=u.box),l.iconBox&&(k.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new Bt);for(let k=0;k<v.circles.length;k+=4)w.circles.push(v.circles[k+0]),w.circles.push(v.circles[k+1]),w.circles.push(v.circles[k+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const k in this.placements){const P=this.placements[k],A=p[k];A?(this.opacities[k]=new er(A,u,P.text,P.icon),l=l||P.text!==A.text.placed||P.icon!==A.icon.placed):(this.opacities[k]=new er(null,u,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const k in p){const P=p[k];if(!this.opacities[k]){const A=new er(P,u,!1,!1);A.isHidden()||(this.opacities[k]=A,l=l||P.text.placed||P.icon.placed)}}for(const k in v)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=v[k]);for(const k in w)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=w[k]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new er(null,0,!1,!1,!0),k=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),A=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",V=new er(null,0,k&&(P||!e.hasIconData()||v.get("icon-optional")),P&&(k||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const H=(Y,te,Z)=>{for(let se=0;se<te/4;se++)Y.opacityVertexArray.emplaceBack(Z);Y.hasVisibleVertices=Y.hasVisibleVertices||Z!==js},J=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const te=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:se,crossTileID:ce}=te;let fe=this.opacities[ce];l[ce]?fe=w:fe||(fe=V,this.opacities[ce]=fe),l[ce]=!0;const we=te.numIconVertices>0,Te=this.placedOrientations[te.crossTileID],Fe=Te===d.ah.vertical,Ue=Te===d.ah.horizontal||Te===d.ah.horizontalOnly;if(Z>0||se>0){const Ae=yi(fe.text);H(e.text,Z,Fe?js:Ae),H(e.text,se,Ue?js:Ae);const Ke=fe.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach(je=>{je>=0&&(e.text.placedSymbolArray.get(je).hidden=Ke||Fe?1:0)}),te.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=Ke||Ue?1:0);const ut=this.variableOffsets[te.crossTileID];ut&&this.markUsedJustification(e,ut.anchor,te,Te);const Le=this.placedOrientations[te.crossTileID];Le&&(this.markUsedJustification(e,"left",te,Le),this.markUsedOrientation(e,Le,te))}if(we){const Ae=yi(fe.icon),Ke=!(j&&te.verticalPlacedIconSymbolIndex&&Fe);te.placedIconSymbolIndex>=0&&(H(e.icon,te.numIconVertices,Ke?Ae:js),e.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=fe.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,te.numVerticalIconVertices,Ke?js:Ae),e.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}const Me=J&&J.has(Y)?J.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ae=e.collisionArrays[Y];if(Ae){let Ke=new d.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let ut=!0;if(A){const Le=this.variableOffsets[ce];Le?(Ke=Pr(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),M&&Ke._rotate(F?this.transform.angle:-this.transform.angle)):ut=!1}if(Ae.textBox||Ae.verticalTextBox){let Le;Ae.textBox&&(Le=Fe),Ae.verticalTextBox&&(Le=Ue),Ns(e.textCollisionBox.collisionVertexArray,fe.text.placed,!ut||Le,Me.text,Ke.x,Ke.y)}}if(Ae.iconBox||Ae.verticalIconBox){const ut=!!(!Ue&&Ae.verticalIconBox);let Le;Ae.iconBox&&(Le=ut),Ae.verticalIconBox&&(Le=!ut),Ns(e.iconCollisionBox.collisionVertexArray,fe.icon.placed,Le,Me.icon,j?Ke.x:0,j?Ke.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Y.invProjMatrix,e.placementViewportMatrix=Y.viewportMatrix,e.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Ns(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-pt,w=l[1]-pt,k=l[2]-pt,P=l[3]-pt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,k,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,k,P),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,P)}const Ot=Math.pow(2,25),nu=Math.pow(2,24),su=Math.pow(2,17),mi=Math.pow(2,16),gi=Math.pow(2,9),xp=Math.pow(2,8),Pi=Math.pow(2,1);function yi(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ot+e*nu+s*su+e*mi+s*gi+e*xp+s*Pi+e}const js=0;function cs(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(u,p,v,w,k=!1){if(!v[0]&&!v[1])return[0,0];const P=k?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(P){const A=Math.sin(P),M=Math.cos(P);v=[v[0]*M-v[1]*A,v[0]*A+v[1]*M]}return[k?v[0]:xt(p,v[0],u.zoom),k?v[1]:xt(p,v[1],u.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class gr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,k)=>w.sortKey-k.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class Za{constructor(e,s,l,u,p,v,w,k){this.placement=new qr(e,cs(),s,v,w,k),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=ae.now(),p=()=>!this._forceFullPlacement&&ae.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new gr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const qi=512/d.X/2;class cr{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,k=u.get(w);k?k.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map(k=>({x:Math.floor(k.anchorX*qi),y:Math.floor(k.anchorY*qi)})),crossTileIDs:v.map(k=>k.crossTileID)};if(w.positions.length>128){const k=new d.av(w.positions.length,16,Uint16Array);for(const{x:P,y:A}of w.positions)k.add(P,A);k.finish(),delete w.positions,w.index=k}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:k}=s.canonical,P=qi/Math.pow(2,k-p),A=(w*d.X+e.anchorY)*P,M=u*d.X*qi;return{x:Math.floor((v*d.X+e.anchorX)*P-l*d.X*qi),y:Math.floor(A-M)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const k=this.getScaledCoordinates(v,s);if(w.index){const P=w.index.range(k.x-u,k.y-u,k.x+u,k.y+u).sort();for(const A of P){const M=w.crossTileIDs[A];if(!l[M]){l[M]=!0,v.crossTileID=M;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){const A=w.positions[P],M=w.crossTileIDs[P];if(Math.abs(A.x-k.x)<=u&&Math.abs(A.y-k.y)<=u&&!l[M]){l[M]=!0,v.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class zo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const k=v[w];k.tileID.isChildOf(e)&&k.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new cr(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class au{constructor(){this.layerIndexes={},this.crossTileIDs=new zo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Gi);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const k=w.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,k,this.crossTileIDs)&&(p=!0),v[k.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Hi=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),wp=d.aw();class Do extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new ls(os(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new sr,this.imageManager.setEventedParent(this),this.glyphManager=new Qr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Ui(256,512),this.crossTileSymbolIndex=new au,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),pn().on(Ie,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ae.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(wp,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Hi(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ht(this.stylesheet.light),this.sky=new Ft(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,v,w,k){return d._(this,void 0,void 0,function*(){const P=Dt(p),A=w>1?"@2x":"",M={},F={};for(const{id:j,url:V}of P){const H=v.transformRequest(yt(V,A,".json"),"SpriteJSON");M[j]=d.h(H,k);const J=v.transformRequest(yt(V,A,".png"),"SpriteImage");F[j]=le.getImage(J,k)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(j,V){return d._(this,void 0,void 0,function*(){const H={};for(const J in j){H[J]={};const Y=ae.getImageCanvasContext((yield V[J]).data),te=(yield j[J]).data;for(const Z in te){const{width:se,height:ce,x:fe,y:we,sdf:Te,pixelRatio:Fe,stretchX:Ue,stretchY:Me,content:Ae,textFitWidth:Ke,textFitHeight:ut}=te[Z];H[J][Z]={data:null,pixelRatio:Fe,sdf:Te,stretchX:Ue,stretchY:Me,content:Ae,textFitWidth:Ke,textFitHeight:ut,spriteData:{width:se,height:ce,x:fe,y:we,context:Y}}}}return H})}(M,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(k=>!(k in p)):[];for(const k of w)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in p[v]){const P=v==="default"?k:`${v}:${k}`;this._spritesImagesIds[v].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[v][k],!1):this.imageManager.addImage(P,p[v][k]),s&&(this._changedImages[P]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?d.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&Hi(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new at(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(Hi(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.aB(e),e=d.e(e,{source:u})),this._validate(d.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const k of e){const P=k[w];if(P)for(const A of P)u.push(A)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let k=u.length-1;k>=0;k--){const P=u[k].feature;if(l[P.layer.id]<v)break;p.push(P),u.pop()}else for(const k of e){const P=k[w];if(P)for(const A of P)p.push(A.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const k=this._layers[w];if(!k)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[k.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push($n(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push(function(w,k,P,A,M,F,j){const V={},H=F.queryRenderedSymbols(A),J=[];for(const Y of Object.keys(H).map(Number))J.push(j[Y]);J.sort(Zn);for(const Y of J){const te=Y.featureIndex.lookupSymbolFeatures(H[Y.bucketInstanceId],k,Y.bucketIndex,Y.sourceLayerIndex,M.filter,M.layers,M.availableImages,w);for(const Z in te){const se=V[Z]=V[Z]||[],ce=te[Z];ce.sort((fe,we)=>{const Te=Y.featureSortOrder;if(Te){const Fe=Te.indexOf(fe.featureIndex);return Te.indexOf(we.featureIndex)-Fe}return we.featureIndex-fe.featureIndex});for(const fe of ce)se.push(fe)}}for(const Y in V)V[Y].forEach(te=>{const Z=te.feature,se=P[w[Y].source].getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=se});return V}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,p){const v=u.getRenderableIds().map(P=>u.getTileByID(P)),w=[],k={};for(let P=0;P<v.length;P++){const A=v[P],M=A.tileID.canonical.key;k[M]||(k[M]=!0,A.querySourceFeatures(w,p))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:ae.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:ae.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&Hi(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),pn().off(Ie,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const k={};for(const P of this._order){const A=this._layers[P];if(A.type!=="symbol")continue;if(!k[A.source]){const F=this.sourceCaches[A.source];k[A.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,V)=>V.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(V.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,k[A.source],e.center.lng);v=v||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ae.now(),e.zoom))&&(this.pauseablePlacement=new Za(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ae.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const P of this._order){const A=this._layers[P];A.type==="symbol"&&this.placement.updateLayerOpacities(A,k[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ae.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...Dt(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=Dt(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Dt(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var hs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const Wn={prelude:zt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:zt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:zt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:zt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function zt(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,(k,P,A,M,F)=>(w[F]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(k,P,A,M,F)=>{const j=M==="float"?"vec2":"vec4",V=F.match(/color/)?"color":j;return w[F]?P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
varying ${A} ${M} ${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${j} a_${F};
#else
uniform ${A} ${M} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = a_${F};
#else
    ${A} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${M} ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${A} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class ou{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,k,P){this.context=e;let A=this.boundPaintVertexBuffers.length!==u.length;for(let M=0;!A&&M<u.length;M++)this.boundPaintVertexBuffers[M]!==u[M]&&(A=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==P?this.freshBind(s,l,u,p,v,w,k,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),k&&k.bind(),P&&P.bind())}freshBind(e,s,l,u,p,v,w,k){const P=e.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=k,s.enableAttributes(M,e);for(const F of l)F.enableAttributes(M,e);v&&v.enableAttributes(M,e),w&&w.enableAttributes(M,e),k&&k.enableAttributes(M,e),s.bind(),s.setVertexAttribPointers(M,e,p);for(const F of l)F.bind(),F.setVertexAttribPointers(M,e,p);v&&(v.bind(),v.setVertexAttribPointers(M,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(M,e,p)),k&&(k.bind(),k.setVertexAttribPointers(M,e,p)),A.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const lu=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function Vs(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class uu{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const k=Vs(s.staticAttributes),P=l?l.getBinderAttributes():[],A=k.concat(P),M=Wn.prelude.staticUniforms?Vs(Wn.prelude.staticUniforms):[],F=s.staticUniforms?Vs(s.staticUniforms):[],j=l?l.getBinderUniforms():[],V=M.concat(F).concat(j),H=[];for(const fe of V)H.indexOf(fe)<0&&H.push(fe);const J=l?l.defines():[];p&&J.push("#define OVERDRAW_INSPECTOR;"),v&&J.push("#define TERRAIN3D;");const Y=J.concat(Wn.prelude.fragmentSource,s.fragmentSource).join(`
`),te=J.concat(Wn.prelude.vertexSource,s.vertexSource).join(`
`),Z=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Z,Y),w.compileShader(Z),!w.getShaderParameter(Z,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Z)}`);w.attachShader(this.program,Z);const se=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(se,te),w.compileShader(se),!w.getShaderParameter(se,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(se)}`);w.attachShader(this.program,se),this.attributes={};const ce={};this.numAttributes=A.length;for(let fe=0;fe<this.numAttributes;fe++)A[fe]&&(w.bindAttribLocation(this.program,fe,A[fe]),this.attributes[A[fe]]=fe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(se),w.deleteShader(Z);for(let fe=0;fe<H.length;fe++){const we=H[fe];if(we&&!ce[we]){const Te=w.getUniformLocation(this.program,we);Te&&(ce[we]=Te)}}this.fixedUniforms=u(e,ce),this.terrainUniforms=((fe,we)=>({u_depth:new d.aH(fe,we.u_depth),u_terrain:new d.aH(fe,we.u_terrain),u_terrain_dim:new d.aI(fe,we.u_terrain_dim),u_terrain_matrix:new d.aJ(fe,we.u_terrain_matrix),u_terrain_unpack:new d.aK(fe,we.u_terrain_unpack),u_terrain_exaggeration:new d.aI(fe,we.u_terrain_exaggeration)}))(e,ce),this.binderUniforms=l?l.getUniforms(e,ce):[]}draw(e,s,l,u,p,v,w,k,P,A,M,F,j,V,H,J,Y,te){const Z=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),k){e.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,k.depthTexture),e.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,k.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(k[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(w[ce]);H&&H.setUniforms(e,this.binderUniforms,j,{zoom:V});let se=0;switch(s){case Z.LINES:se=2;break;case Z.TRIANGLES:se=3;break;case Z.LINE_STRIP:se=1}for(const ce of F.get()){const fe=ce.vaos||(ce.vaos={});(fe[P]||(fe[P]=new ou)).bind(e,this,A,H?H.getPaintVertexBuffers():[],M,ce.vertexOffset,J,Y,te),Z.drawElements(s,ce.primitiveLength*se,Z.UNSIGNED_SHORT,ce.primitiveOffset*se*2)}}}function Lo(f,e,s){const l=1/xt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const qa=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=function(){var P=new d.A(9);return d.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();u.properties.get("anchor")==="viewport"&&function(P,A){var M=Math.sin(A),F=Math.cos(A);P[0]=F,P[1]=M,P[2]=0,P[3]=-M,P[4]=F,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(w,-e.transform.angle),function(P,A,M){var F=A[0],j=A[1],V=A[2];P[0]=F*M[0]+j*M[3]+V*M[6],P[1]=F*M[1]+j*M[4]+V*M[7],P[2]=F*M[2]+j*M[5]+V*M[8]}(v,v,w);const k=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+s,u_opacity:l}},Ro=(f,e,s,l,u,p,v)=>d.e(qa(f,e,s,l),Lo(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Us=f=>({u_matrix:f}),th=(f,e,s,l)=>d.e(Us(f),Lo(s,e,l)),bp=(f,e)=>({u_matrix:f,u_world:e}),rh=(f,e,s,l,u)=>d.e(th(f,e,s,l),{u_world:u}),Sp=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=xt(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},ds=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Ga=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),ii=f=>({u_matrix:f}),ni=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:xt(e,1,s),u_intensity:l}),Fo=(f,e,s,l)=>{const u=d.H();d.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Bo(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.Z(0,l/s).toLngLat().lat,new d.Z(0,(l+1)/s).toLngLat().lat]}const Oo=(f,e,s,l)=>{const u=f.transform;return{u_matrix:sh(f,e,s,l),u_ratio:1/xt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},ih=(f,e,s,l,u)=>d.e(Oo(f,e,s,u),{u_image:0,u_image_height:l}),$s=(f,e,s,l,u)=>{const p=f.transform,v=nh(e,p);return{u_matrix:sh(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/xt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},kp=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=nh(e,f.transform),k=s.layout.get("line-cap")==="round",P=v.getDash(l.from,k),A=v.getDash(l.to,k),M=P.width*u.fromScale,F=A.width*u.toScale;return d.e(Oo(f,e,s,p),{u_patternscale_a:[w/M,-P.height/2],u_patternscale_b:[w/F,-A.height/2],u_sdfgamma:v.width/(256*Math.min(M,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:A.y,u_mix:u.t})};function nh(f,e){return 1/xt(f,1,e.tileZoom)}function sh(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Tp=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Ip(u.paint.get("raster-hue-rotate"))};var p,v};function Ip(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ah=(f,e,s,l,u,p,v,w,k,P,A,M,F,j)=>{const V=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:V.width/V.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:k,u_coord_matrix:P,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:A,u_pitched_scale:j}},Ha=(f,e,s,l,u,p,v,w,k,P,A,M,F,j,V)=>{const H=v.transform;return d.e(ah(f,e,s,l,u,p,v,w,k,P,A,M,F,V),{u_gamma_scale:l?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},cu=(f,e,s,l,u,p,v,w,k,P,A,M,F,j)=>d.e(Ha(f,e,s,l,u,p,v,w,k,P,A,!0,M,!0,j),{u_texsize_icon:F,u_texture_icon:1}),No=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),hu=(f,e,s,l,u,p)=>d.e(function(v,w,k,P){const A=k.imageManager.getPattern(v.from.toString()),M=k.imageManager.getPattern(v.to.toString()),{width:F,height:j}=k.imageManager.getPixelSize(),V=Math.pow(2,P.tileID.overscaledZ),H=P.tileSize*Math.pow(2,k.transform.tileZoom)/V,J=H*(P.tileID.canonical.x+P.tileID.wrap*V),Y=H*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,j],u_mix:w.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/xt(P,1,k.transform.tileZoom),u_pixel_coord_upper:[J>>16,Y>>16],u_pixel_coord_lower:[65535&J,65535&Y]}}(l,p,s,u),{u_matrix:f,u_opacity:e}),du={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class gn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Cp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pu{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[Cp[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ps=new WeakMap;function Xn(f){var e;if(ps.has(f))return ps.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ps.set(f,s),s}}class Lt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jo extends Lt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Pp extends Lt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Zs extends Lt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ep extends Lt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oh extends Lt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ap extends Lt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class lh extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class fu extends Lt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class uh extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class ch extends Lt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class hh extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class dh extends Lt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class fs extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ph extends Lt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Mp extends Lt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class fh extends Lt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wa extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class zp extends Lt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Vo extends Lt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Dp extends Lt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Lp extends Lt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class mh extends Lt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class gh extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class yh extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class mu extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class _h extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Uo extends Lt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Mn extends Lt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Xn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class gu extends Lt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class yu extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class _u extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class $o extends Lt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class vu extends $o{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ms extends $o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class xu extends $o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rp{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new vu(e,w),u)this.depthAttachment=p?new xu(e,w):new ms(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class ar{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}ar.Replace=[1,0],ar.disabled=new ar(ar.Replace,d.aM.transparent,[!1,!1,!1,!1]),ar.unblended=new ar(ar.Replace,d.aM.transparent,[!0,!0,!0,!0]),ar.alphaBlended=new ar([1,771],d.aM.transparent,[!0,!0,!0,!0]);class Fp{constructor(e){var s,l;if(this.gl=e,this.clearColor=new jo(this),this.clearDepth=new Pp(this),this.clearStencil=new Zs(this),this.colorMask=new Ep(this),this.depthMask=new oh(this),this.stencilMask=new Ap(this),this.stencilFunc=new lh(this),this.stencilOp=new fu(this),this.stencilTest=new uh(this),this.depthRange=new ch(this),this.depthTest=new hh(this),this.depthFunc=new dh(this),this.blend=new fs(this),this.blendFunc=new ph(this),this.blendColor=new Mp(this),this.blendEquation=new fh(this),this.cullFace=new Wa(this),this.cullFaceSide=new zp(this),this.frontFace=new Vo(this),this.program=new Dp(this),this.activeTexture=new Lp(this),this.viewport=new mh(this),this.bindFramebuffer=new gh(this),this.bindRenderbuffer=new yh(this),this.bindTexture=new mu(this),this.bindVertexBuffer=new _h(this),this.bindElementBuffer=new Uo(this),this.bindVertexArray=new Mn(this),this.pixelStoreUnpack=new gu(this),this.pixelStoreUnpackPremultiplyAlpha=new yu(this),this.pixelStoreUnpackFlipY=new _u(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Xn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new gn(this,e,s)}createVertexBuffer(e,s,l){return new pu(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Rp(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,ar.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Xn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Xn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class vt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const Zo=7680;class $t{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}$t.disabled=new $t({func:519,mask:0},0,0,Zo,Zo,Zo);class Nt{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let gs;function Xa(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),k=[];let P=0,A=0;for(let Y=0;Y<l.length;Y++){const te=l[Y],Z=e.getTile(te).getBucket(s);if(!Z)continue;const se=u?Z.textCollisionBox:Z.iconCollisionBox,ce=Z.collisionCircleArray;if(ce.length>0){const fe=d.H();d.aQ(fe,Z.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(fe,fe,Z.placementViewportMatrix),k.push({circleArray:ce,circleOffset:A,transform:te.posMatrix,invTransform:fe,coord:te}),P+=ce.length/4,A=P}se&&w.draw(p,v.LINES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,{u_matrix:te.posMatrix,u_pixel_extrude_scale:[1/(M=f.transform).width,1/M.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(te),s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,null,f.transform.zoom,null,null,se.collisionVertexBuffer)}var M;if(!u||!k.length)return;const F=f.useProgram("collisionCircle"),j=new d.aR;j.resize(4*P),j._trim();let V=0;for(const Y of k)for(let te=0;te<Y.circleArray.length/4;te++){const Z=4*te,se=Y.circleArray[Z+0],ce=Y.circleArray[Z+1],fe=Y.circleArray[Z+2],we=Y.circleArray[Z+3];j.emplace(V++,se,ce,fe,we,0),j.emplace(V++,se,ce,fe,we,1),j.emplace(V++,se,ce,fe,we,2),j.emplace(V++,se,ce,fe,we,3)}(!gs||gs.length<2*P)&&(gs=function(Y){const te=2*Y,Z=new d.aT;Z.resize(te),Z._trim();for(let se=0;se<te;se++){const ce=6*se;Z.uint16[ce+0]=4*se+0,Z.uint16[ce+1]=4*se+1,Z.uint16[ce+2]=4*se+2,Z.uint16[ce+3]=4*se+2,Z.uint16[ce+4]=4*se+3,Z.uint16[ce+5]=4*se+0}return Z}(P));const H=p.createIndexBuffer(gs,!0),J=p.createVertexBuffer(j,d.aS.members,!0);for(const Y of k){const te=ds(Y.transform,Y.invTransform,f.transform);F.draw(p,v.TRIANGLES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,te,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y.coord),s.id,J,H,d.a0.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,f.transform.zoom,null,null,null)}J.destroy(),H.destroy()}Nt.disabled=new Nt(!1,1029,2305),Nt.backCCW=new Nt(!0,1029,2305);const Ka=d.an(new Float32Array(16));function wu(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=d.au(f);return new d.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function ys(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const k=v.add(w);return W(k.x,k.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=_e(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),k=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(k))}return f.add(l)}function qs(f,e,s,l,u,p,v,w,k,P,A,M,F,j){const V=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,J=f.icon.dynamicLayoutVertexArray,Y={};H.clear();for(let te=0;te<V.length;te++){const Z=V.get(te),se=Z.hidden||!Z.crossTileID||f.allowVerticalPlacement&&!Z.placedOrientation?null:l[Z.crossTileID];if(se){const ce=new d.P(Z.anchorX,Z.anchorY),fe={getElevation:j,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:A,tileAnchorPoint:ce,translation:M,unwrappedTileID:F},we=s?W(ce.x,ce.y,v,j):_e(ce.x,ce.y,fe),Te=L(u.cameraToCenterDistance,we.signedDistanceFromCamera);let Fe=d.ai(f.textSizeData,k,Z)*Te/d.ap;s&&(Fe*=f.tilePixelRatio/w);const{width:Ue,height:Me,anchor:Ae,textOffset:Ke,textBoxScale:ut}=se,Le=wu(Ae,Ue,Me,Ke,ut,Fe),je=A.getPitchedTextCorrection(u,ce.add(new d.P(M[0],M[1])),F),ot=ys(we.point,fe,e,Le,u.angle,je),Ht=f.allowVerticalPlacement&&Z.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let ft=0;ft<Z.numGlyphs;ft++)d.aj(H,ot,Ht);P&&Z.associatedIconIndex>=0&&(Y[Z.associatedIconIndex]={shiftedAnchor:ot,angle:Ht})}else rt(Z.numGlyphs,H)}if(P){J.clear();const te=f.icon.placedSymbolArray;for(let Z=0;Z<te.length;Z++){const se=te.get(Z);if(se.hidden)rt(se.numGlyphs,J);else{const ce=Y[Z];if(ce)for(let fe=0;fe<se.numGlyphs;fe++)d.aj(J,ce.shiftedAnchor,ce.angle);else rt(se.numGlyphs,J)}}f.icon.dynamicLayoutVertexBuffer.updateData(J)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function Ei(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function bu(f,e,s,l,u,p,v,w,k,P,A,M){const F=f.context,j=F.gl,V=f.transform,H=cs(),J=w==="map",Y=k==="map",te=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",Z=J&&!Y&&!te,se=!Y&&te,ce=!s.layout.get("symbol-sort-key").isConstant();let fe=!1;const we=f.depthModeForSublayer(0,vt.ReadOnly),Te=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Fe=[],Ue=H.getCircleRadiusCorrection(V);for(const Me of l){const Ae=e.getTile(Me),Ke=Ae.getBucket(s);if(!Ke)continue;const ut=u?Ke.text:Ke.icon;if(!ut||!ut.segments.get().length||!ut.hasVisibleVertices)continue;const Le=ut.programConfigurations.get(s.id),je=u||Ke.sdfIcons,ot=u?Ke.textSizeData:Ke.iconSizeData,Ht=Y||V.pitch!==0,ft=f.useProgram(Ei(je,u,Ke),Le),wt=d.ag(ot,V.zoom),Wt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me);let Rr,Ki,Xt,si,Gr=[0,0],Fr=null;if(u)Ki=Ae.glyphAtlasTexture,Xt=j.LINEAR,Rr=Ae.glyphAtlasTexture.size,Ke.iconsInText&&(Gr=Ae.imageAtlasTexture.size,Fr=Ae.imageAtlasTexture,si=Ht||f.options.rotating||f.options.zooming||ot.kind==="composite"||ot.kind==="camera"?j.LINEAR:j.NEAREST);else{const St=s.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;Ki=Ae.imageAtlasTexture,Xt=je||f.options.rotating||f.options.zooming||St||Ht?j.LINEAR:j.NEAREST,Rr=Ae.imageAtlasTexture.size}const Hr=xt(Ae,1,f.transform.zoom),vn=se?Me.posMatrix:Ka,aa=Hn(vn,Y,J,f.transform,Hr),ul=mn(vn,Y,J,f.transform,Hr),oa=mn(Me.posMatrix,Y,J,f.transform,Hr),zi=H.translatePosition(f.transform,Ae,p,v),cl=Te&&Ke.hasTextData(),Hu=s.layout.get("icon-text-fit")!=="none"&&cl&&Ke.hasIconData();if(te){const St=f.style.map.terrain?(la,ua)=>f.style.map.terrain.getElevation(Me,la,ua):null,bs=s.layout.get("text-rotation-alignment")==="map";N(Ke,Me.posMatrix,f,u,aa,oa,Y,P,bs,H,Me.toUnwrapped(),V.width,V.height,zi,St)}const Di=Me.posMatrix,Li=u&&Te||Hu,Kn=te||Li?Ka:aa,Ji=ul,Er=je&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Br;Br=je?Ke.iconsInText?cu(ot.kind,wt,Z,Y,te,Li,f,Di,Kn,Ji,zi,Rr,Gr,Ue):Ha(ot.kind,wt,Z,Y,te,Li,f,Di,Kn,Ji,zi,u,Rr,!0,Ue):ah(ot.kind,wt,Z,Y,te,Li,f,Di,Kn,Ji,zi,u,Rr,Ue);const xi={program:ft,buffers:ut,uniformValues:Br,atlasTexture:Ki,atlasTextureIcon:Fr,atlasInterpolation:Xt,atlasInterpolationIcon:si,isSDF:je,hasHalo:Er};if(ce&&Ke.canOverlap){fe=!0;const St=ut.segments.get();for(const bs of St)Fe.push({segments:new d.a0([bs]),sortKey:bs.sortKey,state:xi,terrainData:Wt})}else Fe.push({segments:ut.segments,sortKey:0,state:xi,terrainData:Wt})}fe&&Fe.sort((Me,Ae)=>Me.sortKey-Ae.sortKey);for(const Me of Fe){const Ae=Me.state;if(F.activeTexture.set(j.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,j.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Ae.isSDF){const Ke=Ae.uniformValues;Ae.hasHalo&&(Ke.u_is_halo=1,Su(Ae.buffers,Me.segments,s,f,Ae.program,we,A,M,Ke,Me.terrainData)),Ke.u_is_halo=0}Su(Ae.buffers,Me.segments,s,f,Ae.program,we,A,M,Ae.uniformValues,Me.terrainData)}}function Su(f,e,s,l,u,p,v,w,k,P){const A=l.context;u.draw(A,A.gl.TRIANGLES,p,v,w,Nt.disabled,k,P,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function ku(f,e,s,l){const u=f.context,p=u.gl,v=$t.disabled,w=new ar([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),k=e.getBucket(s);if(!k)return;const P=l.key;let A=s.heatmapFbos.get(P);A||(A=Ja(u,e.tileSize,e.tileSize),s.heatmapFbos.set(P,A)),u.bindFramebuffer.set(A.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:d.aM.transparent});const M=k.programConfigurations.get(s.id),F=f.useProgram("heatmap",M),j=f.style.map.terrain.getTerrainData(l);F.draw(u,p.TRIANGLES,vt.disabled,v,w,Nt.disabled,ni(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),j,s.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,s.paint,f.transform.zoom,M)}function _s(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=Ya(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,Fo(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function Ja(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,k=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,k,e,s,0,p.RGBA,w,null);const P=f.createFramebuffer(e,s,!1,!1);return P.colorAttachment.set(v),P}function Ya(f,e){return e.colorRampTexture||(e.colorRampTexture=new _t(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Gs(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const k=u.getPaintProperty(e);v=p[k],w=p[k]}v&&w&&f.setConstantPatternPositions(v,w)}function Qa(f,e,s,l,u,p,v){const w=f.context.gl,k="fill-pattern",P=s.paint.get(k),A=P&&P.constantOr(1),M=s.getCrossfadeParameters();let F,j,V,H,J;v?(j=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(j=A?"fillPattern":"fill",F=w.TRIANGLES);const Y=P.constantOr(null);for(const te of l){const Z=e.getTile(te);if(A&&!Z.patternsLoaded())continue;const se=Z.getBucket(s);if(!se)continue;const ce=se.programConfigurations.get(s.id),fe=f.useProgram(j,ce),we=f.style.map.terrain&&f.style.map.terrain.getTerrainData(te);A&&(f.context.activeTexture.set(w.TEXTURE0),Z.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ce.updatePaintBuffers(M)),Gs(ce,k,Y,Z,s);const Te=we?te:null,Fe=f.translatePosMatrix(Te?Te.posMatrix:te.posMatrix,Z,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){H=se.indexBuffer2,J=se.segments2;const Ue=[w.drawingBufferWidth,w.drawingBufferHeight];V=j==="fillOutlinePattern"&&A?rh(Fe,f,M,Z,Ue):bp(Fe,Ue)}else H=se.indexBuffer,J=se.segments,V=A?th(Fe,f,M,Z):Us(Fe);fe.draw(f.context,F,u,f.stencilModeForClipping(te),p,Nt.disabled,V,we,s.id,se.layoutVertexBuffer,H,J,s.paint,f.transform.zoom,ce)}}function qo(f,e,s,l,u,p,v){const w=f.context,k=w.gl,P="fill-extrusion-pattern",A=s.paint.get(P),M=A.constantOr(1),F=s.getCrossfadeParameters(),j=s.paint.get("fill-extrusion-opacity"),V=A.constantOr(null);for(const H of l){const J=e.getTile(H),Y=J.getBucket(s);if(!Y)continue;const te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(H),Z=Y.programConfigurations.get(s.id),se=f.useProgram(M?"fillExtrusionPattern":"fillExtrusion",Z);M&&(f.context.activeTexture.set(k.TEXTURE0),J.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Z.updatePaintBuffers(F)),Gs(Z,P,V,J,s);const ce=f.translatePosMatrix(H.posMatrix,J,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),fe=s.paint.get("fill-extrusion-vertical-gradient"),we=M?Ro(ce,f,fe,j,H,F,J):qa(ce,f,fe,j);se.draw(w,w.gl.TRIANGLES,u,p,v,Nt.backCCW,we,te,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,f.transform.zoom,Z,f.style.map.terrain&&Y.centroidVertexBuffer)}}function Hs(f,e,s,l,u,p,v){const w=f.context,k=w.gl,P=s.fbo;if(!P)return;const A=f.useProgram("hillshade"),M=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,P.colorAttachment.get()),A.draw(w,k.TRIANGLES,u,p,v,Nt.disabled,((F,j,V,H)=>{const J=V.paint.get("hillshade-shadow-color"),Y=V.paint.get("hillshade-highlight-color"),te=V.paint.get("hillshade-accent-color");let Z=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=F.transform.angle);const se=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(j.tileID.toUnwrapped(),se),u_image:0,u_latrange:Bo(0,j.tileID),u_light:[V.paint.get("hillshade-exaggeration"),Z],u_shadow:J,u_highlight:Y,u_accent:te}})(f,s,l,M?e:null),M,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Ws(f,e,s,l,u,p){const v=f.context,w=v.gl,k=e.dem;if(k&&k.data){const P=k.dim,A=k.stride,M=k.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(A),e.demTexture){const j=e.demTexture;j.update(M,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new _t(v,M,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const j=new _t(v,{width:P,height:P,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(P,P,!0,!1),F.colorAttachment.set(j.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,P,P]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,Nt.disabled,((j,V)=>{const H=V.stride,J=d.H();return d.aP(J,0,d.X,-d.X,0,0,1),d.J(J,J,[0,-d.X,0]),{u_matrix:J,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ,u_unpack:V.getUnpackVector()}})(e.tileID,k),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function vh(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=ae.now(),k=(w-f.timeAdded)/v,P=e?(w-e.timeAdded)/v:-1,A=s.getSource(),M=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(f.tileID.overscaledZ-M),j=F&&f.refreshedUponExpiration?1:d.ac(F?k:1-P,0,1);return f.refreshedUponExpiration&&k>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Tu=new d.aM(1,0,0,1),Et=new d.aM(0,1,0,1),Go=new d.aM(0,0,1,1),Bp=new d.aM(1,0,1,1),xh=new d.aM(0,1,1,1);function Xs(f,e,s,l){Ho(f,0,e+s/2,f.transform.width,s,l)}function wh(f,e,s,l){Ho(f,e-s/2,0,s,f.transform.height,l)}function Ho(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function bh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=vt.disabled,k=$t.disabled,P=f.colorModeForRenderPass(),A="$debug",M=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,j=Math.floor((F&&F.byteLength||0)/1024),V=e.getTile(s).tileSize,H=512/Math.min(V,512)*(s.overscaledZ/f.transform.zoom)*.5;let J=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(J+=` => ${s.overscaledZ}`),function(Y,te){Y.initDebugOverlayCanvas();const Z=Y.debugOverlayCanvas,se=Y.context.gl,ce=Y.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,Z.width,Z.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(te,5,5),ce.strokeText(te,5,5),Y.debugOverlayTexture.update(Z),Y.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(f,`${J} ${j}kB`),v.draw(l,u.TRIANGLES,w,k,ar.alphaBlended,Nt.disabled,Ga(p,d.aM.transparent,H),null,A,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,k,P,Nt.disabled,Ga(p,d.aM.red),M,A,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Sh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new vt(u.LEQUAL,vt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),k=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const P of s){const A=f.renderToTexture.getTexture(P),M=e.getTerrainData(P.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,A.texture);const F=f.transform.calculatePosMatrix(P.tileID.toUnwrapped()),j=e.getMeshFrameDelta(f.transform.zoom),V=f.transform.calculateFogMatrix(P.tileID.toUnwrapped()),H=lu(F,j,V,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,$t.disabled,p,Nt.backCCW,H,M,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class Wo{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Xo{constructor(e,s){this.context=new Fp(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=at.maxUnderzooming+at.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new au}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,hs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.X,0),l.emplaceBack(0,d.X),l.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(l,hs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const u=new d.$;u.emplaceBack(0,0,0,0),u.emplaceBack(d.X,0,d.X,0),u.emplaceBack(0,d.X,0,d.X),u.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,qn.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,hs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const k=this.context.gl;this.stencilClearMode=new $t({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.H();d.aP(l,0,this.width,this.height,0,0,1),d.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,vt.disabled,this.stencilClearMode,ar.disabled,Nt.disabled,ii(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(ar.disabled),l.setDepthMode(vt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,vt.disabled,new $t({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),ar.disabled,Nt.disabled,ii(v.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new $t({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new $t({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new $t({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:$t.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new ar([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ar.unblended:ar.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return vt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ae.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const k in u){const P=u[k];P.used&&P.prepare(this.context),p[k]=P.getVisibleCoordinates(),v[k]=p[k].slice().reverse(),w[k]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<l.length;k++)if(this.style._layers[l[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of l){const P=this.style._layers[k];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const A=v[P.source];(P.type==="custom"||A.length)&&this.renderLayer(this,u[P.source],P,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(k,P){const A=k.context,M=A.gl,F=((Y,te,Z)=>({u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:(te.height/2+te.getHorizon())*Z,u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*te.height/2*Z}))(P,k.style.map.transform,k.pixelRatio),j=new vt(M.LEQUAL,vt.ReadWrite,[0,1]),V=$t.disabled,H=k.colorModeForRenderPass(),J=k.useProgram("sky");if(!P.mesh){const Y=new d.aX;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(1,1),Y.emplaceBack(-1,1);const te=new d.aY;te.emplaceBack(0,1,2),te.emplaceBack(0,2,3),P.mesh=new Wo(A.createVertexBuffer(Y,hs.members),A.createIndexBuffer(te),d.a0.simpleSegment(0,0,Y.length,te.length))}J.draw(A,M.TRIANGLES,j,V,H,Nt.disabled,F,void 0,"sky",P.mesh.vertexBuffer,P.mesh.indexBuffer,P.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[l[this.currentLayer]],P=u[k.source],A=p[k.source];this._renderTileClippingMasks(k,A),this.renderLayer(this,P,k,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const k=this.style._layers[l[this.currentLayer]],P=u[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const A=(k.type==="symbol"?w:v)[k.source];this._renderTileClippingMasks(k,p[k.source]),this.renderLayer(this,P,k,A)}if(this.options.showTileBoundaries){const k=function(P,A){let M=null;const F=Object.values(P._layers).flatMap(J=>J.source&&!J.isHidden(A)?[P.sourceCaches[J.source]]:[]),j=F.filter(J=>J.getSource().type==="vector"),V=F.filter(J=>J.getSource().type!=="vector"),H=J=>{(!M||M.getSource().maxzoom<J.getSource().maxzoom)&&(M=J)};return j.forEach(J=>H(J)),M||V.forEach(J=>H(J)),M}(this.style,this.transform.zoom);k&&function(P,A,M){for(let F=0;F<M.length;F++)bh(P,A,M[F])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const P=k.transform.padding;Xs(k,k.transform.height-(P.top||0),3,Tu),Xs(k,P.bottom||0,3,Et),wh(k,P.left||0,3,Go),wh(k,k.transform.width-(P.right||0),3,Bp);const A=k.transform.centerPoint;(function(M,F,j,V){Ho(M,F-1,j-10,2,20,V),Ho(M,F-10,j-1,20,2,V)})(k,A.x,k.transform.height-A.y,xh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.a_(s,l):!d.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,v){const w=p.context,k=w.gl,P=ar.unblended,A=new vt(k.LEQUAL,vt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),j=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1});for(const V of F){const H=v.getTerrainData(V.tileID),J={u_matrix:p.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};j.draw(w,k.TRIANGLES,A,$t.disabled,P,Nt.backCCW,J,H,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,v){const w=p.context,k=w.gl,P=ar.unblended,A=new vt(k.LEQUAL,vt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.getCoordsTexture(),j=v.sourceCache.getRenderableTiles(),V=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const H of j){const J=v.getTerrainData(H.tileID);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.texture);const Y={u_matrix:p.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};V.draw(w,k.TRIANGLES,A,$t.disabled,P,Nt.backCCW,Y,J,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),v.coordsIndex.push(H.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,k,P){if(p.renderPass!=="translucent")return;const A=$t.disabled,M=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,j,V,H,J,Y,te,Z,se){const ce=j.transform,fe=cs(),we=J==="map",Te=Y==="map";for(const Fe of F){const Ue=H.getTile(Fe),Me=Ue.getBucket(V);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const Ae=d.ag(Me.textSizeData,ce.zoom),Ke=xt(Ue,1,j.transform.zoom),ut=Hn(Fe.posMatrix,Te,we,j.transform,Ke),Le=V.layout.get("icon-text-fit")!=="none"&&Me.hasIconData();if(Ae){const je=Math.pow(2,ce.zoom-Ue.tileID.overscaledZ),ot=j.style.map.terrain?(ft,wt)=>j.style.map.terrain.getElevation(Fe,ft,wt):null,Ht=fe.translatePosition(ce,Ue,te,Z);qs(Me,we,Te,se,ce,ut,Fe.posMatrix,je,Ae,Le,fe,Ht,Fe.toUnwrapped(),ot)}}}(k,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),P),w.paint.get("icon-opacity").constantOr(1)!==0&&bu(p,v,w,k,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),A,M),w.paint.get("text-opacity").constantOr(1)!==0&&bu(p,v,w,k,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),A,M),v.map.showCollisionBoxes&&(Xa(p,v,w,k,!0),Xa(p,v,w,k,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,k){if(p.renderPass!=="translucent")return;const P=w.paint.get("circle-opacity"),A=w.paint.get("circle-stroke-width"),M=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const j=p.context,V=j.gl,H=p.depthModeForSublayer(0,vt.ReadOnly),J=$t.disabled,Y=p.colorModeForRenderPass(),te=[];for(let Z=0;Z<k.length;Z++){const se=k[Z],ce=v.getTile(se),fe=ce.getBucket(w);if(!fe)continue;const we=fe.programConfigurations.get(w.id),Te=p.useProgram("circle",we),Fe=fe.layoutVertexBuffer,Ue=fe.indexBuffer,Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),Ae={programConfiguration:we,program:Te,layoutVertexBuffer:Fe,indexBuffer:Ue,uniformValues:Sp(p,se,ce,w),terrainData:Me};if(F){const Ke=fe.segments.get();for(const ut of Ke)te.push({segments:new d.a0([ut]),sortKey:ut.sortKey,state:Ae})}else te.push({segments:fe.segments,sortKey:0,state:Ae})}F&&te.sort((Z,se)=>Z.sortKey-se.sortKey);for(const Z of te){const{programConfiguration:se,program:ce,layoutVertexBuffer:fe,indexBuffer:we,uniformValues:Te,terrainData:Fe}=Z.state;ce.draw(j,V.TRIANGLES,H,J,Y,Nt.disabled,Te,Fe,w.id,fe,we,Z.segments,w.paint,p.transform.zoom,se)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,k){if(w.paint.get("heatmap-opacity")===0)return;const P=p.context;if(p.style.map.terrain){for(const A of k){const M=v.getTile(A);v.hasRenderableParent(A)||(p.renderPass==="offscreen"?ku(p,M,w,A):p.renderPass==="translucent"&&_s(p,w,A))}P.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(A,M,F,j){const V=A.context,H=V.gl,J=$t.disabled,Y=new ar([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(te,Z,se){const ce=te.gl;te.activeTexture.set(ce.TEXTURE1),te.viewport.set([0,0,Z.width/4,Z.height/4]);let fe=se.heatmapFbos.get(d.aU);fe?(ce.bindTexture(ce.TEXTURE_2D,fe.colorAttachment.get()),te.bindFramebuffer.set(fe.framebuffer)):(fe=Ja(te,Z.width/4,Z.height/4),se.heatmapFbos.set(d.aU,fe))})(V,A,F),V.clear({color:d.aM.transparent});for(let te=0;te<j.length;te++){const Z=j[te];if(M.hasRenderableParent(Z))continue;const se=M.getTile(Z),ce=se.getBucket(F);if(!ce)continue;const fe=ce.programConfigurations.get(F.id),we=A.useProgram("heatmap",fe),{zoom:Te}=A.transform;we.draw(V,H.TRIANGLES,vt.disabled,J,Y,Nt.disabled,ni(Z.posMatrix,se,Te,F.paint.get("heatmap-intensity")),null,F.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,F.paint,A.transform.zoom,fe)}V.viewport.set([0,0,A.width,A.height])}(p,v,w,k):p.renderPass==="translucent"&&function(A,M){const F=A.context,j=F.gl;F.setColorMode(A.colorModeForRenderPass());const V=M.heatmapFbos.get(d.aU);V&&(F.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,V.colorAttachment.get()),F.activeTexture.set(j.TEXTURE1),Ya(F,M).bind(j.LINEAR,j.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(F,j.TRIANGLES,vt.disabled,$t.disabled,A.colorModeForRenderPass(),Nt.disabled,Fo(A,M,0,1),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom))}(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,k){if(p.renderPass!=="translucent")return;const P=w.paint.get("line-opacity"),A=w.paint.get("line-width");if(P.constantOr(1)===0||A.constantOr(1)===0)return;const M=p.depthModeForSublayer(0,vt.ReadOnly),F=p.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),V=w.paint.get("line-pattern"),H=V.constantOr(1),J=w.paint.get("line-gradient"),Y=w.getCrossfadeParameters(),te=H?"linePattern":j?"lineSDF":J?"lineGradient":"line",Z=p.context,se=Z.gl;let ce=!0;for(const fe of k){const we=v.getTile(fe);if(H&&!we.patternsLoaded())continue;const Te=we.getBucket(w);if(!Te)continue;const Fe=Te.programConfigurations.get(w.id),Ue=p.context.program.get(),Me=p.useProgram(te,Fe),Ae=ce||Me.program!==Ue,Ke=p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe),ut=V.constantOr(null);if(ut&&we.imageAtlas){const ot=we.imageAtlas,Ht=ot.patternPositions[ut.to.toString()],ft=ot.patternPositions[ut.from.toString()];Ht&&ft&&Fe.setConstantPatternPositions(Ht,ft)}const Le=Ke?fe:null,je=H?$s(p,we,w,Y,Le):j?kp(p,we,w,j,Y,Le):J?ih(p,we,w,Te.lineClipsArray.length,Le):Oo(p,we,w,Le);if(H)Z.activeTexture.set(se.TEXTURE0),we.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Fe.updatePaintBuffers(Y);else if(j&&(Ae||p.lineAtlas.dirty))Z.activeTexture.set(se.TEXTURE0),p.lineAtlas.bind(Z);else if(J){const ot=Te.gradients[w.id];let Ht=ot.texture;if(w.gradientVersion!==ot.version){let ft=256;if(w.stepInterpolant){const wt=v.getSource().maxzoom,Wt=fe.canonical.z===wt?Math.ceil(1<<p.transform.maxZoom-fe.canonical.z):1;ft=d.ac(d.aV(Te.maxLineLength/d.X*1024*Wt),256,Z.maxTextureSize)}ot.gradient=d.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:ft,image:ot.gradient||void 0,clips:Te.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new _t(Z,ot.gradient,se.RGBA),ot.version=w.gradientVersion,Ht=ot.texture}Z.activeTexture.set(se.TEXTURE0),Ht.bind(w.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Me.draw(Z,se.TRIANGLES,M,p.stencilModeForClipping(fe),F,Nt.disabled,je,Ke,w.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,w.paint,p.transform.zoom,Fe,Te.layoutVertexBuffer2),ce=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,k){const P=w.paint.get("fill-color"),A=w.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=p.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),j=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&P.constantOr(d.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===j){const V=p.depthModeForSublayer(1,p.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);Qa(p,v,w,k,V,M,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const V=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);Qa(p,v,w,k,V,M,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,k){const P=w.paint.get("fill-extrusion-opacity");if(P!==0&&p.renderPass==="translucent"){const A=new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D);if(P!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))qo(p,v,w,k,A,$t.disabled,ar.disabled),qo(p,v,w,k,A,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const M=p.colorModeForRenderPass();qo(p,v,w,k,A,$t.disabled,M)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,k){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const P=p.context,A=p.depthModeForSublayer(0,vt.ReadOnly),M=p.colorModeForRenderPass(),[F,j]=p.renderPass==="translucent"?p.stencilConfigForOverlap(k):[{},k];for(const V of j){const H=v.getTile(V);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&p.renderPass==="offscreen"?Ws(p,H,w,A,$t.disabled,M):p.renderPass==="translucent"&&Hs(p,V,H,w,A,F[V.overscaledZ],M)}P.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,k){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!k.length)return;const P=p.context,A=P.gl,M=v.getSource(),F=p.useProgram("raster"),j=p.colorModeForRenderPass(),[V,H]=M instanceof En?[{},k]:p.stencilConfigForOverlap(k),J=H[H.length-1].overscaledZ,Y=!p.options.moving;for(const te of H){const Z=p.depthModeForSublayer(te.overscaledZ-J,w.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,A.LESS),se=v.getTile(te);se.registerFadeDuration(w.paint.get("raster-fade-duration"));const ce=v.findLoadedParent(te,0),fe=v.findLoadedSibling(te),we=vh(se,ce||fe||null,v,w,p.transform,p.style.map.terrain);let Te,Fe;const Ue=w.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;P.activeTexture.set(A.TEXTURE0),se.texture.bind(Ue,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(A.TEXTURE1),ce?(ce.texture.bind(Ue,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Te=Math.pow(2,ce.tileID.overscaledZ-se.tileID.overscaledZ),Fe=[se.tileID.canonical.x*Te%1,se.tileID.canonical.y*Te%1]):se.texture.bind(Ue,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),se.texture.useMipmap&&P.extTextureFilterAnisotropic&&p.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(te),Ae=Me?te:null,Ke=Ae?Ae.posMatrix:p.transform.calculatePosMatrix(te.toUnwrapped(),Y),ut=Tp(Ke,Fe||[0,0],Te||1,we,w);M instanceof En?F.draw(P,A.TRIANGLES,Z,$t.disabled,j,Nt.disabled,ut,Me,w.id,M.boundsBuffer,p.quadTriangleIndexBuffer,M.boundsSegments):F.draw(P,A.TRIANGLES,Z,V[te.overscaledZ],j,Nt.disabled,ut,Me,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,k){const P=w.paint.get("background-color"),A=w.paint.get("background-opacity");if(A===0)return;const M=p.context,F=M.gl,j=p.transform,V=j.tileSize,H=w.paint.get("background-pattern");if(p.isPatternMissing(H))return;const J=!H&&P.a===1&&A===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==J)return;const Y=$t.disabled,te=p.depthModeForSublayer(0,J==="opaque"?vt.ReadWrite:vt.ReadOnly),Z=p.colorModeForRenderPass(),se=p.useProgram(H?"backgroundPattern":"background"),ce=k||j.coveringTiles({tileSize:V,terrain:p.style.map.terrain});H&&(M.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const fe=w.getCrossfadeParameters();for(const we of ce){const Te=k?we.posMatrix:p.transform.calculatePosMatrix(we.toUnwrapped()),Fe=H?hu(Te,A,p,H,{tileID:we,tileSize:V},fe):No(Te,A,P),Ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(we);se.draw(M,F.TRIANGLES,te,Y,Z,Nt.disabled,Fe,Ue,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const k=p.context,P=w.implementation;if(p.renderPass==="offscreen"){const A=P.prerender;A&&(p.setCustomLayerDefaults(),k.setColorMode(p.colorModeForRenderPass()),A.call(P,k.gl,p.transform.customLayerMatrix()),k.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),k.setColorMode(p.colorModeForRenderPass()),k.setStencilMode($t.disabled);const A=P.renderingMode==="3d"?new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,vt.ReadOnly);k.setDepthMode(A),P.render(k.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),k.setDirty(),p.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const P=Math.sin(v),A=Math.cos(v);l=[l[0]*A-l[1]*P,l[0]*P+l[1]*A]}const w=[p?l[0]:xt(s,l[0],this.transform.zoom),p?l[1]:xt(s,l[1],this.transform.zoom),0],k=new Float32Array(16);return d.J(k,e,w),k}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new uu(this.context,Wn[e],s,du[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _t(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Ks{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const k=1/(w=d.af([],w,e))[3]/s*u;return d.b1(w,w,[k,k,1/w[3],k])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const k=function(F,j){var V=j[0],H=j[1],J=j[2],Y=V*V+H*H+J*J;return Y>0&&(Y=1/Math.sqrt(Y)),F[0]=j[0]*Y,F[1]=j[1]*Y,F[2]=j[2]*Y,F}([],function(F,j,V){var H=j[0],J=j[1],Y=j[2],te=V[0],Z=V[1],se=V[2];return F[0]=J*se-Y*Z,F[1]=Y*te-H*se,F[2]=H*Z-J*te,F}([],He([],p[w[0]],p[w[1]]),He([],p[w[2]],p[w[1]]))),P=-((A=k)[0]*(M=p[w[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return k.concat(P)});return new Ks(p,v)}}class Js{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Oe(this.min),u=Oe(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Js(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)d.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const k=e.points[w][u]-this.min[u];p=Math.min(p,k),v=Math.max(v,k)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class Ys{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=d.ac((this.left+e-this.right)/2,0,e),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ys(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Iu=85.051129;class Qs{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ys,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Qs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,p){var v=u[0],w=u[1],k=u[2],P=u[3],A=Math.sin(p),M=Math.cos(p);l[0]=v*M+k*A,l[1]=w*M+P*A,l[2]=v*-A+k*M,l[3]=w*-A+P*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),k=Math.floor(Math.max(l.x,u.x,p.x,v.x)),P=1;for(let A=w-P;A<=k+P;A++)A!==0&&s.push(new d.b4(A,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Z.fromLngLat(this.center),k=Math.pow(2,u),P=[k*v.x,k*v.y,0],A=[k*w.x,k*w.y,0],M=Ks.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,V=Z=>({aabb:new Js([Z*k,0,0],[(Z+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),H=[],J=[],Y=u,te=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)H.push(V(-Z)),H.push(V(Z));for(H.push(V(0));H.length>0;){const Z=H.pop(),se=Z.x,ce=Z.y;let fe=Z.fullyVisible;if(!fe){const Me=Z.aabb.intersects(M);if(Me===0)continue;fe=Me===2}const we=e.terrain?P:A,Te=Z.aabb.distanceX(we),Fe=Z.aabb.distanceY(we),Ue=Math.max(Math.abs(Te),Math.abs(Fe));if(Z.zoom===Y||Ue>j+(1<<Y-Z.zoom)-2&&Z.zoom>=F){const Me=Y-Z.zoom,Ae=P[0]-.5-(se<<Me),Ke=P[1]-.5-(ce<<Me);J.push({tileID:new d.S(Z.zoom===Y?te:Z.zoom,Z.wrap,Z.zoom,se,ce),distanceSq:it([A[0]-.5-se,A[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(Ae*Ae+Ke*Ke)})}else for(let Me=0;Me<4;Me++){const Ae=(se<<1)+Me%2,Ke=(ce<<1)+(Me>>1),ut=Z.zoom+1;let Le=Z.aabb.quadrant(Me);if(e.terrain){const je=new d.S(ut,Z.wrap,ut,Ae,Ke),ot=e.terrain.getMinMaxElevation(je),Ht=(s=ot.minElevation)!==null&&s!==void 0?s:this.elevation,ft=(l=ot.maxElevation)!==null&&l!==void 0?l:this.elevation;Le=new Js([Le.min[0],Le.min[1],Ht],[Le.max[0],Le.max[1],ft])}H.push({aabb:Le,zoom:ut,x:Ae,y:Ke,wrap:Z.wrap,fullyVisible:fe})}}return J.sort((Z,se)=>Z.distanceSq-se.distanceSq).map(Z=>Z.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,Iu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,u.lat),k=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=k}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new d.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,k=u[1]/v,P=l[2]/p,A=u[2]/v,M=P===A?0:(0-P)/(A-P);return new d.Z(d.y.number(l[0]/p,u[0]/v,M)/this.worldSize,d.y.number(w,k,M)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ge().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Iu])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[u*l,s.y*l,0]),d.K(p,p,[l/d.X,l/d.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return d.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const Z=179.9999999999;u=[-Z,Z]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,k=0,P=p,A=0,M=0;const{x:F,y:j}=this.size;if(this.latRange){const Z=this.latRange;v=d.Q(Z[1])*p,w=d.Q(Z[0])*p,w-v<j&&(A=j/(w-v))}u&&(k=d.b3(d.O(u[0])*p,0,p),P=d.b3(d.O(u[1])*p,0,p),P<k&&(P+=p),P-k<F&&(M=F/(P-k)));const{x:V,y:H}=this.project.call({worldSize:p},e);let J,Y;const te=Math.max(M||0,A||0);if(te){const Z=new d.P(M?(P+k)/2:V,A?(w+v)/2:H);return l.center=this.unproject.call({worldSize:p},Z).wrap(),l.zoom+=this.scaleZoom(te),l}if(this.latRange){const Z=j/2;H-Z<v&&(Y=v+Z),H+Z>w&&(Y=w-Z)}if(u){const Z=(k+P)/2;let se=V;this._renderWorldCopies&&(se=d.b3(V,Z-p/2,Z+p/2));const ce=F/2;se-ce<k&&(J=k+ce),se+ce>P&&(J=P-ce)}if(J!==void 0||Y!==void 0){const Z=new d.P(J??V,Y??H);l.center=this.unproject.call({worldSize:p},Z).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.K(u,u,[this.width/2,-this.height/2,1]),d.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.K(u,u,[1,-1,1]),d.J(u,u,[-1,-1,0]),d.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),k=v<0?w:p,P=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),M=Math.sin(A)*k/Math.sin(d.ac(Math.PI-P-A,.01,Math.PI-.01)),F=this.getHorizon(),j=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),V=Math.sin(j)*k/Math.sin(d.ac(Math.PI-P-j,.01,Math.PI-.01)),H=Math.min(M,V);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+k),this.nearZ=this.height/50,u=new Float64Array(16),d.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=d.ae(u),d.K(u,u,[1,-1,1]),d.J(u,u,[0,0,-this.cameraToCenterDistance]),d.b7(u,u,this._pitch),d.ad(u,u,this.angle),d.J(u,u,[-s,-l,0]),this.mercatorMatrix=d.K([],u,[this.worldSize,this.worldSize,this.worldSize]),d.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,u),d.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=d.as([],u),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,u);const J=this.width%2/2,Y=this.height%2/2,te=Math.cos(this.angle),Z=Math.sin(this.angle),se=s-Math.round(s)+te*J+Z*Y,ce=l-Math.round(l)+te*Y+Z*J,fe=new Float64Array(u);if(d.J(fe,fe,[se>.5?se-1:se,ce>.5?ce-1:ce,0]),this.alignedModelViewProjectionMatrix=fe,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new d.P(l,u),new d.P(p,u),new d.P(p,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function eo(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class Ko{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=eo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,k=this._map.getBearing(),P=this._map.getPitch();let A="";if(A+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(k||P)&&(A+="/"+Math.round(10*k)/10),P&&(A+=`/${Math.round(P)}`),this._hashName){const M=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map(V=>{const H=V.split("=")[0];return H===M?(F=!0,`${H}=${A}`):V}).filter(V=>V);return F||j.push(`${M}=${A}`),`#${j.join("&")}`}return`#${A}`}}const Jo={linearity:.3,easing:d.b8(0,0,.3,1)},Cu=d.e({deceleration:2500,maxSpeed:1400},Jo),Op=d.e({deceleration:20,maxSpeed:1400},Jo),kh=d.e({deceleration:1e3,maxSpeed:360},Jo),Yo=d.e({deceleration:1e3,maxSpeed:90},Jo);class Pu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ae.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=ae.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=ro(s.pan.mag(),l,d.e({},Cu,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,to(u,p)}if(s.zoom){const p=ro(s.zoom,l,Op);u.zoom=this._map.transform.zoom+p.amount,to(u,p)}if(s.bearing){const p=ro(s.bearing,l,kh);u.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),to(u,p)}if(s.pitch){const p=ro(s.pitch,l,Yo);u.pitch=this._map.transform.pitch+p.amount,to(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function to(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function ro(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=d.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class Lr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=U.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,d.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class vs extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=U.touchPos(s.getCanvasContainer(),u),v=p.map(k=>s.unproject(k)),w=p.reduce((k,P,A,M)=>k.add(P.div(M.length)),new d.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Th extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Ih{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Th(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Lr(e.type,this._map,e))}mouseup(e){this._map.fire(new Lr(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Lr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Lr(e.type,this._map,e))}mouseover(e){this._map.fire(new Lr(e.type,this._map,e))}mouseout(e){this._map.fire(new Lr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new vs(e.type,this._map,e))}touchmove(e){this._map.fire(new vs(e.type,this._map,e))}touchend(e){this._map.fire(new vs(e.type,this._map,e))}touchcancel(e){this._map.fire(new vs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class or{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Lr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Lr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wi{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class _i{constructor(e,s){this._map=e,this._tr=new Wi(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(U.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),k=Math.max(u.y,l.y);U.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=k-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),U.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function io(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Eu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const p=new d.P(0,0);for(const v of u)p._add(v);return p.div(u.length)}(s),this.touches=io(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=io(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Qo{constructor(e){this.singleTap=new Eu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class ea{constructor(e){this._tr=new Wi(e),this._zoomIn=new Qo({numTouches:1,numTaps:2}),this._zoomOut=new Qo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&U.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Au={0:1,2:2};class el{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=U.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Au[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return U.mouseButton(e)===this._eventButton}}class Mu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const tl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},zu=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new el({checkCorrectEvent:u=>U.mouseButton(u)===0&&u.ctrlKey||U.mouseButton(u)===2});return new zn({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:tl})},Du=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new el({checkCorrectEvent:u=>U.mouseButton(u)===0&&u.ctrlKey||U.mouseButton(u)===2});return new zn({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:tl})};class xs{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=io(l,s),p=new d.P(0,0),v=new d.P(0,0);let w=0;for(const P in u){const A=u[P],M=this._touches[P];M&&(p._add(A),v._add(A.sub(M)),w++,u[P]=A)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const k=v.div(w);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=no(l,s,u),w=no(l,s,p);if(!v||!w)return;const k=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],k,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=no(l,s,u),w=no(l,s,p);v&&w||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function no(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Lu(f,e){return Math.log(f/e)/Math.LN2}class Ru extends rl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lu(this._distance,l),pinchAround:s}}}function Fu(f,e){return 180*f.angleWith(e)/Math.PI}class Bu extends rl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fu(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Fu(e,this._startVector);return Math.abs(l)<s}}function il(f){return Math.abs(f.y)>Math.abs(f.x)}class so extends rl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,il(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return il(e)&&il(s)&&v}}const Ch={panStep:100,bearingStep:15,pitchStep:10};class Ai{constructor(e){this._tr=new Wi(e);const s=Ch;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const k=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:yn,zoom:s?Math.round(k.zoom)+s*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+l*this._bearingStep,pitch:k.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yn(f){return f*(2-f)}const Ou=4.000244140625;class Xi{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Wi(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=ae.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Ou==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=U.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.N.convert(this._aroundCenter?l.center:l.unproject(s)):d.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Ou?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&P!==0&&(P=1/P);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=ae.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const k=Math.min(w/200,1),P=u(k);p=d.y.number(l,s,P),k<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const l=this._prevEase,u=(ae.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=d.b8(v,w,.25,1)}return this._prevEase={start:ae.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ws{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Np{constructor(e){this._tr=new Wi(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jp{constructor(){this._tap=new Qo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ph{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Eh{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nu{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ta{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Mi=f=>f.zoom||f.drag||f.pitch||f.rotate;class Ze extends d.k{}function nl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ju{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},k={},P={},A=u.touches,M=A?this._getMapTouches(A):void 0,F=M?U.touchPos(this._map.getCanvas(),M):U.mousePos(this._map.getCanvas(),u);for(const{handlerName:H,handler:J,allowed:Y}of this._handlers){if(!J.isEnabled())continue;let te;this._blockedByActive(P,Y,H)?J.reset():J[p||u.type]&&(te=J[p||u.type](u,F,M),this.mergeHandlerResult(w,k,te,H,v),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||J.isActive())&&(P[H]=J)}const j={};for(const H in this._previousActiveHandlers)P[H]||(j[H]=v);this._previousActiveHandlers=P,(Object.keys(j).length||nl(w))&&(this._changes.push([w,k,j]),this._triggerRenderFrame()),(Object.keys(P).length||nl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=w;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pu(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)U.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)U.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Ih(s,e));const u=s.boxZoom=new _i(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new ta(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new ea(s),w=new Np(s);s.doubleClickZoom=new ws(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const k=new jp;this._add("tapDragZoom",k);const P=s.touchPitch=new so(s);this._add("touchPitch",P),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const A=zu(e),M=Du(e);s.dragRotate=new Eh(e,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:te,clickTolerance:Z})=>{const se=new el({checkCorrectEvent:ce=>U.mouseButton(ce)===0&&!ce.ctrlKey});return new zn({clickTolerance:Z,move:(ce,fe)=>({around:fe,panDelta:fe.sub(ce)}),activateOnStart:!0,moveStateManager:se,enable:te,assignEvents:tl})})(e),j=new xs(e,s);s.dragPan=new Ph(l,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const V=new Bu,H=new Ru;s.touchZoomRotate=new Nu(l,H,V,k),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const J=s.scrollZoom=new Xi(s,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const Y=s.keyboard=new Ai(s);this._add("keyboard",Y),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new or(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;d.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(s,p),d.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(nl(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:k,bearingDelta:P,pitchDelta:A,around:M,pinchAround:F}=e;F!==void 0&&(M=F),u._stop(!0),M=M||u.transform.centerPoint;const j=p.pointLocation(w?M.sub(w):M);P&&(p.bearing+=P),A&&(p.pitch+=A),k&&(p.zoom+=k),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(j,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(j,M)):p.setLocationAtPoint(j,M),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Mi(this._eventsInProgress),p=Mi(e),v={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(v[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const M in v)this._fireEvent(M,v[M]);p&&this._fireEvent("move",p.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const w={};let k;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],k=s[F]||j,w[`${M}end`]=k)}for(const M in w)this._fireEvent(M,w[M]);const P=Mi(this._eventsInProgress),A=(u||p)&&!P;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(l&&A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!M||!M.essential&&ae.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:k})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ze("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ah extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((ae.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(d.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(d.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(d.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=ge.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Me=u.padding;u.padding={top:Me,bottom:Me,right:Me,left:Me}}u.padding=d.e(p,u.padding);const v=this.transform,w=v.padding,k=new ge(e,s),P=v.project(k.getNorthWest()),A=v.project(k.getNorthEast()),M=v.project(k.getSouthEast()),F=v.project(k.getSouthWest()),j=d.ba(-l),V=P.rotate(j),H=A.rotate(j),J=M.rotate(j),Y=F.rotate(j),te=new d.P(Math.max(V.x,H.x,Y.x,J.x),Math.max(V.y,H.y,Y.y,J.y)),Z=new d.P(Math.min(V.x,H.x,Y.x,J.x),Math.min(V.y,H.y,Y.y,J.y)),se=te.sub(Z),ce=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/se.x,fe=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/se.y;if(fe<0||ce<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const we=Math.min(v.scaleZoom(v.scale*Math.min(ce,fe)),u.maxZoom),Te=d.P.convert(u.offset),Fe=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.ba(l)),Ue=Te.add(Fe).mult(v.scale/v.zoomScale(we));return{center:v.unproject(P.add(M).div(2).sub(Ue)),zoom:we,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=d.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=d.Z.fromLngLat(e,s),v=d.Z.fromLngLat(l,u),w=v.x-p.x,k=v.y-p.y,P=v.z-p.z,A=Math.hypot(w,k,P);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(w,k),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),j=180*Math.atan2(w,-k)/Math.PI;let V=180*Math.acos(M/A)/Math.PI;return V=P<0?90-V:90+V,{center:v.toLngLat(),zoom:F,pitch:V,bearing:j}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&ae.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,k=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,A="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:H,zoom:J}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(H,u);const Y=u.project(V),te=u.project(H).sub(Y),Z=u.zoomScale(J-p);let se,ce;e.around&&(se=d.N.convert(e.around),ce=u.locationPoint(se));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||J!==p,this._rotating=this._rotating||v!==P,this._pitching=this._pitching||A!==w,this._padding=!u.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,fe),this.terrain&&this._prepareElevation(H),this._ease(we=>{if(this._zooming&&(u.zoom=d.y.number(p,J,we)),this._rotating&&(u.bearing=d.y.number(v,P,we)),this._pitching&&(u.pitch=d.y.number(w,A,we)),this._padding&&(u.interpolatePadding(k,M,we),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(we),se)u.setLocationAtPoint(se,ce);else{const Te=u.zoomScale(u.zoom-p),Fe=J>p?Math.min(2,Z):Math.max(.5,Z),Ue=Math.pow(Fe,1-we),Me=u.unproject(Y.add(te.mult(we*Ue)).mult(Te));u.setLocationAtPoint(u.renderWorldCopies?Me.wrap():Me,j)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},we=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,we)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:k,bearing:P,elevation:A}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),k!==void 0&&(p.pitch=k),P!==void 0&&(p.bearing=P),A!==void 0&&(p.elevation=A),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",e)),u&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&ae.prefersReducedMotion){const je=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,k=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,A="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:H,zoom:J}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(H,u);const Y=u.zoomScale(J-p),te=u.project(V),Z=u.project(H).sub(te);let se=e.curve;const ce=Math.max(u.width,u.height),fe=ce/Y,we=Z.mag();if("minZoom"in e){const je=d.ac(Math.min(e.minZoom,p,J),u.minZoom,u.maxZoom),ot=ce/u.zoomScale(je-p);se=Math.sqrt(ot/we*2)}const Te=se*se;function Fe(je){const ot=(fe*fe-ce*ce+(je?-1:1)*Te*Te*we*we)/(2*(je?fe:ce)*Te*we);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ue(je){return(Math.exp(je)-Math.exp(-je))/2}function Me(je){return(Math.exp(je)+Math.exp(-je))/2}const Ae=Fe(!1);let Ke=function(je){return Me(Ae)/Me(Ae+se*je)},ut=function(je){return ce*((Me(Ae)*(Ue(ot=Ae+se*je)/Me(ot))-Ue(Ae))/Te)/we;var ot},Le=(Fe(!0)-Ae)/se;if(Math.abs(we)<1e-6||!isFinite(Le)){if(Math.abs(ce-fe)<1e-6)return this.easeTo(e,s);const je=fe<ce?-1:1;Le=Math.abs(Math.log(fe/ce))/se,ut=()=>0,Ke=ot=>Math.exp(je*se*ot)}return e.duration="duration"in e?+e.duration:1e3*Le/("screenSpeed"in e?+e.screenSpeed/se:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==P,this._pitching=A!==w,this._padding=!u.isPaddingEqual(M),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(H),this._ease(je=>{const ot=je*Le,Ht=1/Ke(ot);u.zoom=je===1?J:p+u.scaleZoom(Ht),this._rotating&&(u.bearing=d.y.number(v,P,je)),this._pitching&&(u.pitch=d.y.number(w,A,je)),this._padding&&(u.interpolatePadding(k,M,je),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(je);const ft=je===1?H:u.unproject(te.add(Z.mult(ut(ot))).mult(Ht));u.setLocationAtPoint(u.renderWorldCopies?ft.wrap():ft,j),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=ae.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const ra={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ia{constructor(e=ra){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,p)=>u.length-p.length),e=e.filter((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vu{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const s=U.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class bt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Uu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Vp extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aP(u.posMatrix,0,d.X,0,d.X,0,1),this._tiles[u.key]=new Gn(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),k=u.canonical.y-(u.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,P,0,P,0,1),d.J(p.posMatrix,p.posMatrix,[-w*P,-k*P,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),k=e.canonical.y-(e.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[w*P,k*P,0]),d.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class $u{constructor(e,s,l){this.painter=e,this.sourceCache=new Vp(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=d.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const k=function(V,H,J){var Y=H[0],te=H[1];return V[0]=J[0]*Y+J[4]*te+J[12],V[1]=J[1]*Y+J[5]*te+J[13],V}([],[s/u*d.X,l/u*d.X],v.u_terrain_matrix),P=[k[0]*w.dim,k[1]*w.dim],A=Math.floor(P[0]),M=Math.floor(P[1]),F=P[0]-A,j=P[1]-M;return w.get(A,M)*(1-F)*(1-j)+w.get(A+1,M)*F*(1-j)+w.get(A,M+1)*(1-F)*j+w.get(A+1,M+1)*F*j}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%d.X,p%d.X,d.X)}getElevation(e,s,l,u=d.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _t(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _t(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new _t(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),k=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(k,k,[v*d.X,w*d.X,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _t(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _t(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new _t(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const k=s[0]+(s[2]>>4<<8),P=s[1]+((15&s[2])<<8),A=this.coordsIndex[255-s[3]],M=A&&this.sourceCache.getTileByID(A);if(!M)return null;const F=this._coordsTextureSize,j=(1<<M.tileID.canonical.z)*F;return new d.Z((M.tileID.canonical.x*F+k)/j+M.tileID.wrap,(M.tileID.canonical.y*F+P)/j,this.getElevation(M.tileID,k,P,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,l=new d.aY,u=this.meshSize,p=d.X/u,v=u*u;for(let M=0;M<=u;M++)for(let F=0;F<=u;F++)s.emplaceBack(F*p,M*p,0);for(let M=0;M<v;M+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+M,u+F+M+1,u+F+M+2),l.emplaceBack(F+M,u+F+M+2,F+M+1);const w=s.length,k=w+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(F*p,M*d.X,j);for(let M=0;M<2*u;M+=2)l.emplaceBack(k+M,k+M+1,k+M+3),l.emplaceBack(k+M,k+M+3,k+M+2),l.emplaceBack(w+M,w+M+3,w+M+1),l.emplaceBack(w+M,w+M+2,w+M+3);const P=s.length,A=P+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(M*d.X,F*p,j);for(let M=0;M<2*u;M+=2)l.emplaceBack(P+M,P+M+1,P+M+3),l.emplaceBack(P+M,P+M+3,P+M+2),l.emplaceBack(A+M,A+M+3,A+M+1),l.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh=new Wo(e.createVertexBuffer(s,Uu.members),e.createIndexBuffer(l),d.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=d.Z.fromLngLat(e.wrap()),u=(1<<s)*d.X,p=l.x*u,v=l.y*u,w=Math.floor(p/d.X),k=Math.floor(v/d.X);return{tileID:new d.S(s,0,s,w,k),mercatorX:p,mercatorY:v}}}class Up{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new _t(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const na={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Mh{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Up(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(na[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(na[s]&&(this._prevType&&na[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(na[this._prevType]||na[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Sh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const P=this.pool.getObjectForId(w.rtt[p].id);if(P.stamp===w.rtt[p].stamp){this.pool.useObject(P);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),w.rtt[p]={id:k.id,stamp:k.stamp},l.context.bindFramebuffer.set(k.fbo.framebuffer),l.context.clear({color:d.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let P=0;P<v.length;P++){const A=l.style._layers[v[P]],M=A.source?this._coordsDescendingInv[A.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),l._renderTileClippingMasks(A,M),l.renderLayer(l,l.style.sourceCaches[A.source],A,M),A.source&&(w.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][w.tileID.key])}}return Sh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),na[s]}return!1}}const Zu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},zh=$,$p={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ra,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},qu=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Zp={showCompass:!0,showZoom:!0,visualizePitch:!1};class qp{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),U.mousePos(this.element,v)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,U.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=zu({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:k=.8})=>{const P=new Mu;return new zn({clickTolerance:w,move:(A,M)=>({bearingDelta:(M.x-A.x)*k}),moveStateManager:P,enable:v,assignEvents:qu})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Du({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:k=-.5})=>{const P=new Mu;return new zn({clickTolerance:w,move:(A,M)=>({pitchDelta:(M.y-A.y)*k}),moveStateManager:P,enable:v,assignEvents:qu})})({clickTolerance:p,enable:!0})),U.addEventListener(s,"mousedown",this.mousedown),U.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),U.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),U.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;U.removeEventListener(e,"mousedown",this.mousedown),U.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let vi;function Gt(f,e,s){const l=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const u=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sl(f,e,s){const l=f.classList;for(const u in sa)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class al extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Gt(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${sa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),ae.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const s=U.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=U.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=U.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=U.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of k){const te=U.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",Y.rx),te.setAttributeNS(null,"ry",Y.ry),w.appendChild(te)}const P=U.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const A=U.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(A);const M=U.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=U.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const j=U.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const V=U.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=U.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const J=U.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),V.appendChild(H),V.appendChild(J),v.appendChild(w),v.appendChild(P),v.appendChild(M),v.appendChild(j),v.appendChild(V),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),sl(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,k=Math.sin(u.getPitch()*Math.PI/180)*w,P=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),A=u.transform.lngLatToCameraDepth(this._lngLat,v+k)-P>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Dh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ao=0,oo=!1;const _n={maxWidth:100,unit:"metric"};function lo(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const k=3.2808*w;k>5280?Xe(e,l,k/5280,f._getUIString("ScaleControl.Miles")):Xe(e,l,k,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Xe(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Xe(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):Xe(e,l,w,f._getUIString("ScaleControl.Meters"))}function Xe(f,e,s,l){const u=function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(k){const P=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*P)/P}(w),v*w}(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const st={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ol=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ll(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return ll(new d.P(0,0))}const Gu=$;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=ia,S.BoxZoomHandler=_i,S.CanvasSource=Ci,S.CooperativeGesturesHandler=ta,S.DoubleClickZoomHandler=ws,S.DragPanHandler=Ph,S.DragRotateHandler=Eh,S.EdgeInsets=Ys,S.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Va,S.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=d.e({bearing:u},this.options.fitBoundsOptions),v=ge.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&oo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new al({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Dh,f)}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(vi!==void 0&&!e)return vi;if(window.navigator.permissions===void 0)return vi=!!window.navigator.geolocation,vi;try{vi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{vi=!!window.navigator.geolocation}return vi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ao=0,oo=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ao--,oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ao++,ao>1?(f={maximumAge:6e5,timeout:0},oo=!0):(f=this.options.positionOptions,oo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Ko,S.ImageSource=En,S.KeyboardHandler=Ai,S.LngLatBounds=ge,S.LogoControl=Vu,S.Map=class extends Ah{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},$p),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qs(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new bt,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Zu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=le.addThrottleControl(()=>this.isMoving()),this._requestManager=new ke(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=eo(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ju(this,e),this._hash=e.hash&&new Ko(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ia(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Vu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const k=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,k),this.painter.resize(l,u,k)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),v&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(ge.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter(k=>this.getLayer(k)),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new Lr(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(k=>this.getLayer(k));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new Lr(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Lr(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter(w=>this.getLayer(w)),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(v=>e.includes(v))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const p=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[p,new d.P(v.x,p.y),v,new d.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Do(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $u(this.painter,e,f),this.painter.renderToTexture=new Mh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:k,textFitHeight:P}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=e,j=e;return this.style.addImage(f,{data:new d.R({width:A,height:M},new Uint8Array(F)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:k,textFitHeight:P,sdf:u,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f),this}}{const{width:A,height:M,data:F}=ae.getImageData(e);this.style.addImage(f,{data:new d.R({width:A,height:M},F),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:k,textFitHeight:P,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?ae.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return le.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=U.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=U.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{p[v]=U.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Xo(s,this.transform),ze.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=ae.now();this.style.zoomHistory.update(u,p);const v=new d.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),le.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ae.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return zh}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Lr,S.MapTouchEvent=vs,S.MapWheelEvent=Th,S.Marker=al,S.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Zp,f),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new qp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=U.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},S.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Gt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=ll(this.options.offset);if(!u){const w=this._container.offsetWidth,k=this._container.offsetHeight;let P;P=l.y+p.bottom.y<k?["top"]:l.y>this._map.transform.height-k?["bottom"]:[],l.x<w/2?P.push("left"):l.x>this._map.transform.width-w/2&&P.push("right"),u=P.length===0?"bottom":P.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),U.setTransform(this._container,`${sa[u]} translate(${v.x}px,${v.y}px)`),sl(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(st),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ol);f&&f.focus()}},S.RasterDEMTileSource=Qt,S.RasterTileSource=Mt,S.ScaleControl=class{constructor(f){this._onMove=()=>{lo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,lo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_n),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Xi,S.Style=Do,S.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=so,S.TwoFingersTouchRotateHandler=Bu,S.TwoFingersTouchZoomHandler=Ru,S.TwoFingersTouchZoomRotateHandler=Nu,S.VectorTileSource=ja,S.VideoSource=Os,S.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if($a(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{Ua[s]=l})(f,e)}),S.clearPrewarmedResources=function(){const f=br;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Dr),br=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return pn().getRTLTextPluginStatus()},S.getVersion=function(){return Gu},S.getWorkerCount=function(){return ei.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(f){return Na().broadcast("IS",f)},S.prewarm=function(){os().acquire(Dr)},S.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},S.setRTLTextPlugin=function(f,e){return pn().setRTLTextPlugin(f,e)},S.setWorkerCount=function(f){ei.workerCount=f},S.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var I=h;return I})})(n1);var zS=n1.exports;const Cl=qv(zS),eu=i=>typeof i=="string"?i.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"",Kg=eu("All");function DS(i){return i.replace(/And/g," & ").replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())}function LS({groups:i,selectedGroup:a,onSelect:h}){return K.jsxs("div",{className:`\r
        filter-row \r
        flex \r
        flex-col \r
       \r
        md:items-center    \r
        md:gap-4\r
      `,"aria-label":"Group filters",children:[K.jsx("div",{className:"flex justify-center",children:K.jsx("span",{className:`\r
          inline-flex \r
          items-center \r
          gap-1 \r
          rounded-xl \r
          bg-[#1877F2] \r
          px-12 md:px-20  \r
          py-2 \r
          text-base \r
          md:text-lg \r
          font-semibold \r
          text-white \r
          shadow-md \r
          shadow-[#1877F2]/30 \r
          transition\r
          whitespace-nowrap\r
        `,children:"KRABI HIGHLIGHTS ROUTES"})}),K.jsx("div",{className:"filter-row-scroll",children:i.map(y=>{const b=eu(y);return K.jsx("button",{type:"button",className:`filter-chip filter-chip--micro ${a===b?"filter-chip--active":""}`,onClick:()=>h(b),children:DS(y)},y)})})]})}const RS=[{key:"star-5",label:""},{key:"star-4",label:""},{key:"star-3",label:""},{key:"star-2",label:""},{key:"star-1",label:""}];function FS({selectedStars:i,onToggleStar:a}){return K.jsxs("div",{className:"filter-row","aria-label":"Score filters",children:[K.jsx("div",{className:"filter-row-title",children:"Score"}),K.jsx("div",{className:"filter-row-scroll filter-row-scroll--tight",children:RS.map(h=>K.jsx("button",{type:"button",className:`filter-chip filter-chip--outline filter-chip--micro ${i.includes(h.key)?"filter-chip--active":""}`,onClick:()=>a(h.key),children:h.label},h.key))})]})}const BS={shows:["FireShow","ThaiBoxing"],beach:["Sunset","Iconic"],island:["4 Islands","Iconic","Sunset"]};function OS({specialTags:i,selectedTags:a,onToggleTag:h,selectedGroup:y}){const b=eu(y),I=b&&b!==Kg?BS[b]||[]:[];return K.jsxs("div",{className:"filter-row","aria-label":"Special filters",children:[K.jsx("div",{className:"filter-row-title",children:"Special"}),K.jsx("div",{className:"filter-row-scroll",children:i.map(S=>{const d=a.includes(S),$=I.includes(S),ue=I.length>0&&!$,xe=["filter-chip","filter-chip--outline","filter-chip--micro",d?"filter-chip--active":"",$&&!d?"filter-chip--related":"",ue&&!d?"filter-chip--unrelated":""].filter(Boolean).join(" ");return K.jsx("button",{type:"button",className:xe,onClick:()=>h(S),children:S},S)})})]})}function NS({groups:i,selectedGroup:a,onSelectGroup:h,specialTags:y,selectedTags:b,onToggleTag:I,selectedStars:S,onToggleStar:d,containerRef:$}){return K.jsx("div",{ref:$,className:"filters-container","aria-label":"Krabi map filters",children:K.jsxs("div",{className:"filters-surface",children:[K.jsx(LS,{groups:i,selectedGroup:a,onSelect:h}),K.jsx(FS,{selectedStars:S,onToggleStar:d}),K.jsx(OS,{specialTags:y,selectedTags:b,onToggleTag:I,selectedGroup:a})]})})}const jS={Beach:"#0ea5e9",Shows:"#fb002aff",Adventure:"#10b981",Snorkel:"#3b82f6",Viewpoint:"#fb7185",Island:"#10b981",Kayaking:"#06b6d4",NightMarket:"#8b5cf6",cafeAndRestaurant:"#7C9A6D"},VS=["Iconic","Solo","Couple","Family","Friend","4 Islands","FireShow","ThaiBoxing","Sunset","Ao-Nang Area"],a1=[{id:"nopparat",name:"Nopparat Thara Beach",group:"Beach",tags:["Family","Easy Walk","Sunset","Ao-Nang Area"],recommended:!1,score:96,coordinates:[8.042996646771988,98.80915062374889],highlightTag:"Sunset Point",shortDescription:"Quiet sunset spot near the Landmark night market."},{id:"railay-west-sunset",name:"Railay West Beach",group:"Beach",tags:["Iconic","Couple","Romantic","Solo","Sunset"],recommended:!0,score:100,coordinates:[8.011867631403003,98.83779902910392],highlightTag:"Sunset Point",shortDescription:"Magical sunsets surrounded by dramatic limestone cliffs."},{id:"Thap-Island",name:"Thap Island And Mor Island ",group:"Island",tags:["Iconic","4 Islands","7 Islands","Solo","Couple","Family","Friend"],recommended:!1,score:100,coordinates:[7.960749334245738,98.81188600481],highlightTag:"Sandbar",shortDescription:"Thap Island is connected with Mor Island and make the sand bank when the water is lowtide which we called Separated Sea.",facebook:"https://www.facebook.com/share/r/1H278RodX6/",tiktok:"https://vt.tiktok.com/ZSPBXPGWL/",instagram:"https://www.instagram.com/reel/DP7u2ffjxAO/?igsh=M3R3a2V4OGFra3Jk",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"},{id:"Hong-Island-view",name:"Hong Island Viewpoint",group:"Viewpoint",tags:["Iconic","Swimming","Unseen","Romantic","Solo","Couple","Family","Friend"],recommended:!0,score:100,coordinates:[8.078533049633542,98.67452166336074],highlightTag:"Viewpoint",shortDescription:"One of the most beautiful Island in Krabi with clear water and white sand beach."},{id:"Ao-Nang-Landmark-night-market",name:"Ao Nang Landmark night market",group:"NightMarket",tags:["Foodie","Thai Food","Cheap Food","Solo","Peace","Couple","Family","Friend","Ao-Nang Area"],recommended:!1,score:82,coordinates:[8.042759856818227,98.81174709797625],highlightTag:"Starting Point",shortDescription:"Local Foods and souvenirs.",facebook:"https://www.facebook.com/share/p/1KikJzUVjw/",instagram:"https://www.instagram.com/p/DSWfbxAGAv3/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ=="},{id:"Phranang-Cave",name:"Phranang Beach",group:"Beach",tags:["Unseen","4 Islands","7 Islands","Sunset","Rock climbing","Romantic","Kayak","Solo","Couple"],recommended:!1,score:95,coordinates:[8.00618929910943,98.83830842932949],highlightTag:"Cliff & Sunset",shortDescription:"One of the best spot in Aonang and so many activities to do, Best for sunset."},{id:"Phranang-Cave",name:"Phranang Cave",group:"Viewpoint",tags:["Unseen","4 Islands","7 Islands","Romantic","Kayak","Solo","Couple"],recommended:!1,score:94,coordinates:[8.004652849100607,98.84025614456091],highlightTag:"Worship for safe journeys",shortDescription:"Phra Nang Cave is a place where locals and tourists come to worship for safe journeys, and it has a unique symbol."},{id:"Poda-Island",name:"Poda Island",group:"Island",tags:["Swimming","4 Islands","7 Islands","Couple","Family","Friend","Sunset"],recommended:!1,score:81,coordinates:[7.974786505695185,98.81199963655986],highlightTag:"Island Hopping",shortDescription:"White sand beach, Cleared water and good for swimming."},{id:"Chicken-Island",name:"Chicken Island",group:"Island",tags:["Unseen","Iconic","4 Islands","7 Islands","Skockeling","Family","Friend"],recommended:!1,score:86,coordinates:[7.9493382326792075,98.80909355605431],highlightTag:"Island Hopping",shortDescription:"An Island that look like a chicken that is very rare to see from nature creation."},{id:"thale-waek",name:"Thale Waek",group:"Beach",tags:["Iconic","Sandbar","4 Islands","7 Islands","Solo","Peace","Couple","Family","Friend"],recommended:!0,score:100,coordinates:[7.9609338,98.8108289],highlightTag:"Sandbar",shortDescription:"Famous sandbar that appears at low tide.",facebook:"https://www.facebook.com/share/r/1H278RodX6/",tiktok:"https://vt.tiktok.com/ZSPBXPGWL/",instagram:"https://www.instagram.com/reel/DP7u2ffjxAO/?igsh=M3R3a2V4OGFra3Jk",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"},{id:"Hong-Island",name:"Hong Island",group:"Island",tags:["Iconic","Swimming","Unseen","Romantic","Solo","Couple","Family","Friend"],recommended:!0,score:100,coordinates:[8.078533049633542,98.67452166336074],highlightTag:"Lagoon",shortDescription:"One of the most beautiful Island in Krabi with clear water and white sand beach."},{id:"phi-phi",name:"Phi Phi Islands",group:"Island",tags:["Iconic","Solo","Peace","Couple","Family","Friend","Party"],recommended:!1,score:92,coordinates:[7.7407,98.7765],highlightTag:"Island Hopping",shortDescription:"Iconic islands with turquoise water and snorkeling."},{id:"Maya-Bay",name:"Maya Bay",group:"Beach",tags:["Iconic","Swimming","Unseen","Sea Animal","Outstanding","Snorkeling","Solo","Peace","Couple","Family","Friend"],recommended:!0,score:91,coordinates:[7.676756680821906,98.76556276184752],highlightTag:"Island Hopping",shortDescription:"One of the most beautiful bay in the world from The Beach movie."},{id:"Centara-Fire-Show",name:"Centara Fire Show",group:"Shows",tags:["Exciting","Fun","Night activity","Solo","Friend","FireShow"],recommended:!1,score:89,coordinates:[8.028574742666587,98.8246180041217],highlightTag:"Starting Point",shortDescription:"One of the best Fire show in Ao nang with great performers."},{id:"Aonang-Fire-show",name:"Ao nang Fire show",group:"Shows",tags:["Exciting","Fun","Night activity","Solo","Friend","FireShow","Ao-Nang Area"],recommended:!1,score:87,coordinates:[8.031154039226333,98.82230946213717],highlightTag:"Starting Point",shortDescription:"Fire show on Ao nang beach that is very fun to watch at night."},{id:"Aonang-Fire-show-2",name:"Ao nang Fire show 2",group:"Shows",tags:["Exciting","Fun","Night activity","Solo","Friend","FireShow"],recommended:!1,score:88,coordinates:[8.0317472106498,98.82147600026569],highlightTag:"Starting Point",shortDescription:"Another famous fire show on Ao nang beach."},{id:"Ao-Nang-Landmark-Fire-Show",name:"Ao Nang Landmark Fire Show",group:"Shows",tags:["Exciting","Fun","Night activity","Solo","Friend","FireShow","Ao-Nang Area"],recommended:!1,score:82,coordinates:[8.042507,98.811847],highlightTag:"Starting Point",shortDescription:`Free exciting,One of the best Fire Show in Ao Nang Landmark.
Show Time:  9:009:30 PM`,facebook:"https://www.facebook.com/share/p/17aU2R93P9/",instagram:"https://www.instagram.com/p/DSXA85fGG7i/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA=="},{id:"Ao-Nang-Landmark-Stadium",name:"Ao Nang Landmark Stadium",group:"Shows",tags:["Exciting","Solo","Friend","ThaiBoxing"],recommended:!1,score:79,coordinates:[8.04291741147765,98.81260362536653],highlightTag:["Adventure Spot"],shortDescription:"One of the best Muay Thai Boxing Show in Krabi."},{id:"Boxing Stadium",name:"Krabi International Boxing Stadium",group:"Shows",tags:["Exciting","Solo","Friend","ThaiBoxing"],recommended:!1,score:78,coordinates:[8.0463938,98.8475367],highlightTag:["Adventure Spot"],shortDescription:"One of the best Muay Thai Boxing Show in Krabi."},{id:"Ao-nang-krabi-Stadium",name:"Ao nang krabi Stadium",group:"Shows",tags:["Exciting","Solo","Friend","ThaiBoxing"],recommended:!1,score:85,coordinates:[8.046512790919532,98.81373330764366],highlightTag:["Adventure Spot"],shortDescription:"One of the best Muay Thai Boxing Show in Krabi."},{id:"Pranang-Cave-Kayaking",name:"Pranang Cave Kayaking",group:"Kayaking",tags:["Adventure","Fun","kayaking","Solo","Family","Friend"],recommended:!1,score:76,coordinates:[8.006219,98.837293],highlightTag:["Adventure Spot","Kayaking"],shortDescription:"Fun Kayaking explore the sea near Railay and surrounding area."},{id:"Ao-Thalane-Kayak-Krabi",name:"Ao Thalane Kayak Krabi",group:"Kayaking",tags:["Adventure","Unsen","Fun","Solo","Couple","Family","Friend"],recommended:!0,score:94,coordinates:[8.143337775348652,98.7476565086452],highlightTag:["Adventure Spot"],shortDescription:"Explore the mangrove in Krabi by the adventure kayak."},{id:"Klong-Root-Kayaking",name:"Klong Root Kayaking",group:"Kayaking",tags:["Adventure","Jurassic World","Fun","Solo","Couple","Family","Friend"],recommended:!0,score:92,coordinates:[8.096931015324097,98.80975731135209],highlightTag:["Adventure Spot"],shortDescription:"Exciting kayaking where they was filming Jurassic Park."},{id:"Khaothong-Hill",name:"Khaothong Hill",group:"cafeAndRestaurant",tags:["Dinner","Sunset","Romatic","Couple","Family","Friend","Sunset"],recommended:!1,score:85,coordinates:[8.17303796762973,98.75299009230848],highlightTag:"Sunset Point",shortDescription:"One of the best place for romantic dinner and sunset."},{id:"Ao-Nang-Beach",name:"Ao Nang Beach",group:"Beach",tags:"Sunset",recommended:!1,score:95,coordinates:[8.029270233730031,98.8240309893113],highlightTag:"Sunset Point",shortDescription:"So many fun activities to do."},{id:"Klong-Muang-Beach",name:"Klong Muang Beach",group:"Beach",tags:["Sunset","Activities","Solo","Couple","Family","Friend"],recommended:!1,score:86,coordinates:[8.049013241643939,98.75915683225],highlightTag:"Sunset Point",shortDescription:"Very calm and beautiful beach for sunset."},{id:"Cafe",name:"Andalay Beach Bar & Cafe",group:"cafeAndRestaurant",tags:["Dinner","Sunset","Romatic","Couple","Family","Friend"],recommended:!1,score:78,coordinates:[8.05330930603848,98.75242703330115],highlightTag:"Viewpoint Caf",shortDescription:"One of the best place for romantic dinner and sunset."},{id:"Tiger-Cave-Temple",name:"Tiger Cave Temple",group:"Viewpoint",tags:["Adventure","Iconic","Sun rise","Sun Set","Krabi view","Temple","Family","Friend"],recommended:!1,score:78,coordinates:[8.124202021372135,98.92592490156702],highlightTag:"Viewpoint",shortDescription:"1260 Stairs to the heaven and see the 360 of Krabi."},{id:"phi-phi-view",name:"Phi Phi Viewpoint",group:"Viewpoint",tags:["Iconic","Solo","Peace","Couple","Family","Friend","Party"],recommended:!1,score:83,coordinates:[7.7407,98.7765],highlightTag:"Viewpoint",shortDescription:"Iconic islands with turquoise water and snorkeling."},{id:"Dragons-Crest",name:"Dragon is Crest",group:"Viewpoint",tags:["Adventure","Hiking","Sun rise","Sea of fog","Solo","Friend"],recommended:!1,score:79,coordinates:[8.097502651214272,98.74985901980978],highlightTag:["Viewpoint"],shortDescription:"A good hiking trail for the sunrise and sea view."},{id:"Krabi-Town-Night-Market",name:"Krabi Town Night Market",group:"NightMarket",tags:["Night market","Foodie","Thai Food","Cheap Food","Solo","Peace","Couple","Family","Friend"],recommended:!1,score:78,coordinates:[8.064555978499241,98.91725998489127],highlightTag:"Starting Point",shortDescription:"Cheap Local Foods and souvenirs in Krabi city."},{id:"Black-Crab-Night-Market",name:" Black Crab Night Market",group:"NightMarket",tags:["Night market","Foodie","Thai Food","Cheap Food","Solo","Peace","Couple","Family","Friend"],recommended:!1,score:69,coordinates:[8.067168136030764,98.91707266584214],highlightTag:"Starting Point",shortDescription:"Cheap Local Foods and souvenirs in Krabi city."},{id:"Khao-Khanab-Nam",name:"Khao Khanab Nam",group:"Local",tags:["Couple","Family","Friend"],recommended:!1,score:63,coordinates:[8.077547305488666,98.92107677748173],highlightTag:"Viewpoint",shortDescription:"Discover the history of Krabi and enter the cave."},{id:"Ko-Klang",name:"Ko Klang",group:"Local",tags:["Island","Couple","Family","Friend"],recommended:!1,score:64,coordinates:[8.041235216666491,98.93971121317364],highlightTag:"Adventure Spot",shortDescription:"Local village and thai food."},{id:"Ko-Poda-Beach",name:"Ko Poda Beach",group:"Beach",tags:["Island","Couple","Family","Friend","Couple","4 Islands","Sunset"],recommended:!1,score:74,coordinates:[7.9722381,98.809101],highlightTag:"Adventure Spot",shortDescription:"Local village and thai food."}],US=["All",...new Set(a1.map(i=>i.group))],lm=[8.043,98.915],$S="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",ZS=i=>i>=90?5:i>=80?4:i>=70?3:i>=60?2:1,qS=i=>i.map(a=>{const h=Array.isArray(a.tags)?[...a.tags]:[],y=new Set(h),b=typeof a.score=="number"&&!Number.isNaN(a.score)?a.score:Math.floor(Math.random()*41)+60;return{...a,score:b,tags:Array.from(y)}});function GS(i,a,h,y){let b=[...i];const I=eu(a);if(I&&I!==Kg&&(b=b.filter(S=>eu(S.group)===I)),h.length&&(b=b.filter(S=>S.tags&&S.tags.some(d=>h.includes(d)))),y.length){const S=y.map(d=>Number(d.split("-")[1]));b=b.filter(d=>S.includes(ZS(d.score)))}return b.sort((S,d)=>d.score-S.score)}const Pl=([i,a])=>[a,i];function HS(){const i=ir.useRef(null),a=ir.useRef([]),h=ir.useRef(null),y=ir.useRef(null),[b,I]=ir.useState(!1),[S,d]=ir.useState(Kg),[$,ue]=ir.useState([]),[xe,ae]=ir.useState([]),[U,ze]=ir.useState(null),Be=ir.useMemo(()=>qS(a1),[]),Pe=ir.useMemo(()=>GS(Be,S,$,xe),[Be,S,$,xe]),Tt=re=>d(eu(re));return ir.useEffect(()=>{if(!U&&Pe.length){ze(Pe[0]);return}U&&!Pe.find(re=>re.id===U.id)&&ze(Pe[0]||null)},[Pe,U]),ir.useEffect(()=>{if(h.current)return;const re=new Cl.Map({container:i.current,style:$S,center:Pl(lm),zoom:10.5,minZoom:7,maxZoom:17,cooperativeGestures:!1,dragPan:!0,touchZoomRotate:!0,scrollZoom:!0,interactive:!0,attributionControl:!1});return i.current.style.pointerEvents="auto",re.getCanvas().style.touchAction="pan-x pan-y",re.getCanvas().style.pointerEvents="auto",re.on("touchstart",Q=>{Q.originalEvent.stopImmediatePropagation()}),re.addControl(new Cl.NavigationControl({showCompass:!1}),"top-right"),re.addControl(new Cl.ScaleControl({unit:"metric"}),"bottom-right"),re.on("load",()=>{I(!0),re.resize(),fetch("/krabi-border.geojson").then(Q=>{if(!Q.ok)throw new Error("Failed to load border data");return Q.json()}).then(Q=>{if(re.getSource("krabi-border")||(re.addSource("krabi-border",{type:"geojson",data:Q}),re.addLayer({id:"krabi-border-fill",type:"fill",source:"krabi-border",paint:{"fill-color":"#e6f4ff","fill-opacity":.18}}),re.addLayer({id:"krabi-border-line",type:"line",source:"krabi-border",paint:{"line-color":"#0099ff","line-width":2}})),Q.features&&Q.features.length){const le=new Cl.LngLatBounds;Q.features.forEach(ke=>{const Oe=ke.geometry.coordinates.flat(2);for(let qe=0;qe<Oe.length;qe+=2)le.extend([Oe[qe],Oe[qe+1]])}),re.fitBounds(le,{padding:40})}}).catch(()=>{re.flyTo({center:Pl(lm),zoom:10.5})})}),h.current=re,()=>{a.current.forEach(({marker:Q})=>{Q.remove()}),a.current=[],re.remove(),h.current=null,I(!1)}},[]),ir.useEffect(()=>{const re=h.current;if(!re||!b)return;if(!Pe.length){re.flyTo({center:Pl(lm),zoom:10.5,essential:!0});return}const Q=new Cl.LngLatBounds;Pe.forEach(le=>Q.extend(Pl(le.coordinates))),re.fitBounds(Q,{padding:{top:80,right:60,bottom:200,left:60},maxZoom:12,duration:800,essential:!0})},[Pe,b]),ir.useEffect(()=>{const re=h.current;!re||!b||(a.current.forEach(({marker:Q})=>{Q.remove()}),a.current=[],Pe.forEach(Q=>{const le=document.createElement("button");le.type="button",le.className="krabi-marker",le.style.setProperty("--marker-color",jS[Q.group]||"#0b69c4");const ke=new Cl.Marker({element:le,anchor:"bottom"}).setLngLat(Pl(Q.coordinates)).addTo(re);le.addEventListener("click",Oe=>{Oe.stopPropagation(),ze(Q),re.flyTo({center:Pl(Q.coordinates),zoom:Math.max(re.getZoom(),11),speed:.8,essential:!0})}),a.current.push({id:Q.id,marker:ke,element:le})}))},[Pe,b]),ir.useEffect(()=>{const re=h.current;!b||!U||!re||a.current.forEach(({id:Q,element:le,marker:ke})=>{Q===U.id?le.classList.add("krabi-marker--active"):le.classList.remove("krabi-marker--active")})},[U,b]),K.jsxs("section",{className:"map-section h-full flex-1",children:[K.jsx("div",{className:"filter-container","aria-label":"Krabi map filters",children:K.jsx(NS,{groups:US,selectedGroup:S,onSelectGroup:Tt,specialTags:VS,selectedTags:$,onToggleTag:re=>ue(Q=>Q.includes(re)?Q.filter(le=>le!==re):[...Q,re]),selectedStars:xe,onToggleStar:re=>ae(Q=>Q.includes(re)?Q.filter(le=>le!==re):[...Q,re]),containerRef:y})}),K.jsxs("div",{className:"map-wrapper",children:[K.jsx("div",{className:"map-canvas",ref:i,"aria-label":"JoinJoy Krabi interactive map"}),U&&K.jsx(K.Fragment,{children:K.jsxs("div",{className:"krabi-info-card",children:[K.jsx("div",{className:"krabi-info-card__header",children:K.jsxs("div",{className:"header-left",children:[K.jsx("span",{className:"krabi-info-tag",children:U.highlightTag}),U.recommended&&K.jsx("span",{className:"krabi-recommend-pill",children:"JoinJoy Recommend"})]})}),K.jsxs("div",{className:"krabi-info-title-row",children:[K.jsx("div",{className:"krabi-info-title",children:U.name}),K.jsx("span",{className:"krabi-score-badge krabi-score-badge--dark",children:U.score})]}),K.jsx("div",{className:"krabi-info-subtitle",children:U.shortDescription}),K.jsxs("div",{className:"krabi-info-actions",children:[K.jsx("span",{className:"explore-more-text",children:"Explore More"}),U.facebook&&K.jsx("a",{href:U.facebook,target:"_blank",rel:"noopener noreferrer",children:K.jsx("img",{src:"https://cdn.simpleicons.org/facebook/ffffff",alt:"facebook",className:"social-icon"})}),U.tiktok&&K.jsx("a",{href:U.tiktok,target:"_blank",rel:"noopener noreferrer",children:K.jsx("img",{src:"https://cdn.simpleicons.org/tiktok/ffffff",alt:"tiktok",className:"social-icon"})}),U.instagram&&K.jsx("a",{href:U.instagram,target:"_blank",rel:"noopener noreferrer",children:K.jsx("img",{src:"https://cdn.simpleicons.org/instagram/ffffff",alt:"instagram",className:"social-icon"})}),U.youtube&&K.jsx("a",{href:U.youtube,target:"_blank",rel:"noopener noreferrer",children:K.jsx("img",{src:"https://cdn.simpleicons.org/youtube/ffffff",alt:"youtube",className:"social-icon"})}),K.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${U.coordinates[0]},${U.coordinates[1]}`,target:"_blank",rel:"noopener noreferrer",children:K.jsx("img",{src:"https://cdn.simpleicons.org/googlemaps/ffffff",alt:"google maps",className:"social-icon"})})]})]})})]})]})}var o1={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$v=Ta.createContext&&Ta.createContext(o1),WS=["attr","size","title"];function XS(i,a){if(i==null)return{};var h=KS(i,a),y,b;if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(i);for(b=0;b<I.length;b++)y=I[b],!(a.indexOf(y)>=0)&&Object.prototype.propertyIsEnumerable.call(i,y)&&(h[y]=i[y])}return h}function KS(i,a){if(i==null)return{};var h={};for(var y in i)if(Object.prototype.hasOwnProperty.call(i,y)){if(a.indexOf(y)>=0)continue;h[y]=i[y]}return h}function rp(){return rp=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(i[y]=h[y])}return i},rp.apply(this,arguments)}function Zv(i,a){var h=Object.keys(i);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(i);a&&(y=y.filter(function(b){return Object.getOwnPropertyDescriptor(i,b).enumerable})),h.push.apply(h,y)}return h}function ip(i){for(var a=1;a<arguments.length;a++){var h=arguments[a]!=null?arguments[a]:{};a%2?Zv(Object(h),!0).forEach(function(y){JS(i,y,h[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(h)):Zv(Object(h)).forEach(function(y){Object.defineProperty(i,y,Object.getOwnPropertyDescriptor(h,y))})}return i}function JS(i,a,h){return a=YS(a),a in i?Object.defineProperty(i,a,{value:h,enumerable:!0,configurable:!0,writable:!0}):i[a]=h,i}function YS(i){var a=QS(i,"string");return typeof a=="symbol"?a:a+""}function QS(i,a){if(typeof i!="object"||!i)return i;var h=i[Symbol.toPrimitive];if(h!==void 0){var y=h.call(i,a);if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(i)}function l1(i){return i&&i.map((a,h)=>Ta.createElement(a.tag,ip({key:h},a.attr),l1(a.child)))}function u1(i){return a=>Ta.createElement(ek,rp({attr:ip({},i.attr)},a),l1(i.child))}function ek(i){var a=h=>{var{attr:y,size:b,title:I}=i,S=XS(i,WS),d=b||h.size||"1em",$;return h.className&&($=h.className),i.className&&($=($?$+" ":"")+i.className),Ta.createElement("svg",rp({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},h.attr,y,S,{className:$,style:ip(ip({color:i.color||h.color},h.style),i.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),I&&Ta.createElement("title",null,I),i.children)};return $v!==void 0?Ta.createElement($v.Consumer,null,h=>a(h)):a(o1)}function tk(i){return u1({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"},child:[]}]})(i)}function rk(i){return u1({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"},child:[]}]})(i)}function ik(){const i=[{name:"Poda Island",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/1765649099678.jpg",caption:"Swimming & Relax",links:{facebook:"https://www.facebook.com/share/r/1H278RodX6/",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"}},{name:"Chicken Island",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/1765649028671.jpg",caption:"Iconic Limestone Cliffs",links:{facebook:"https://www.facebook.com/share/r/1H278RodX6/",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"}},{name:"Tup Sandbar",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/340726_0.jpg",caption:"Walkable Sandbar",links:{facebook:"https://www.facebook.com/share/r/1H278RodX6/",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"}},{name:"Phra Nang",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/1765649053579.jpg",caption:"Cliffs & Cave Beach",links:{facebook:"https://www.facebook.com/share/r/1H278RodX6/",youtube:"https://youtube.com/shorts/mIDeJtAXmJM?feature=shared"}}];return K.jsxs("article",{className:"rounded-2xl border border-slate-200 bg-white/80 p-4 shadow-sm ring-1 ring-white/60 sm:p-5",children:[K.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold uppercase tracking-[0.12em] text-sky-700",children:[K.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-sky-400","aria-hidden":"true"}),K.jsx("span",{children:"Route preview"})]}),K.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Krabi 4 Islands Classic"}),K.jsx("div",{className:"flex items-center gap-2 mb-2",children:K.jsx("span",{className:"rounded-full bg-slate-900 px-3 py-1 text-xs font-medium text-white",children:"CURATED BY LOCALS"})}),K.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"A locally-curated route designed for calm seas, perfect timing, and iconic views."}),K.jsxs("div",{className:"mt-4 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-3 shadow-inner sm:px-4",children:[K.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold uppercase tracking-[0.12em] text-slate-500",children:[K.jsx("span",{children:"Route steps"}),K.jsx("span",{className:"rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs text-emerald-700",children:" Calm Day Route"})]}),K.jsx("div",{className:"mt-3 grid grid-cols-2 gap-3",children:i.map((y,b)=>K.jsxs("div",{className:"relative rounded-xl border border-slate-200 bg-white/95 p-3 shadow-sm",children:[K.jsx("span",{className:"absolute top-2 left-2 z-10 text-[10px] font-medium text-white bg-black/40 px-1.5 py-0.5 rounded",children:String(b+1).padStart(2,"0")}),K.jsxs("div",{className:"relative overflow-hidden rounded-lg ring-1 ring-slate-200",children:[K.jsx("img",{src:y.image,alt:y.name,className:"h-28 w-full object-cover"}),K.jsx("div",{className:"absolute bottom-2 left-2 right-2",children:K.jsx("span",{className:"inline-block rounded-md bg-black/45 px-2 py-1 text-[12px] font-medium text-white backdrop-blur-sm",children:y.name})})]}),K.jsxs("div",{className:"mt-2 flex flex-col gap-1.5",children:[K.jsx("span",{className:"text-[11px] font-medium text-slate-700",children:y.caption}),K.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-slate-500",children:[K.jsx("span",{className:"font-medium tracking-wide whitespace-nowrap",children:"Explore more"}),y.links&&y.links.facebook&&y.links.youtube&&K.jsxs("div",{className:"flex items-center gap-1.5 opacity-70 hover:opacity-100 transition",children:[K.jsx("a",{href:y.links.facebook,target:"_blank",rel:"noopener noreferrer","aria-label":`${y.name} on Facebook`,className:`inline-flex h-6 w-6 items-center justify-center rounded-full\r
                   border border-slate-200 bg-white/80\r
                   hover:border-slate-300 hover:scale-105 transition`,children:K.jsx(tk,{className:"h-3.5 w-3.5 text-slate-500"})}),K.jsx("a",{href:y.links.youtube,target:"_blank",rel:"noopener noreferrer","aria-label":`${y.name} on YouTube`,className:`inline-flex h-6 w-6 items-center justify-center rounded-full\r
                   border border-slate-200 bg-white/80\r
                   hover:border-slate-300 hover:scale-105 transition`,children:K.jsx(rk,{className:"h-3.5 w-3.5 text-slate-500"})})]})]})]})]},y.name))}),K.jsx("p",{className:"mt-3 text-center text-[12px] font-semibold leading-snug text-slate-600",children:"A must-see island route for anyone visiting Ao Nang."})]}),K.jsxs("div",{className:"mt-4 space-y-2 border-t border-slate-200 pt-3 text-sm text-slate-700",children:[K.jsxs("a",{href:"https://www.youtube.com/shorts/qopIHbevjKY",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 rounded-xl bg-white/90 px-4 py-3 ring-1 ring-slate-200 transition hover:bg-white hover:ring-slate-300",children:[K.jsx("img",{src:"https://cdn.simpleicons.org/youtube/FF0000",alt:"YouTube",className:"h-5 w-5 transition group-hover:scale-105"}),K.jsxs("div",{className:"leading-tight",children:[K.jsx("div",{className:"font-medium text-slate-900",children:"Watch the full island journey"}),K.jsx("div",{className:"text-[12px] text-slate-500",children:"See how the day flows at sea"})]})]}),K.jsxs("a",{href:"https://www.facebook.com/reel/610063925507280?locale=th_TH",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 rounded-xl bg-white/90 px-4 py-3 ring-1 ring-slate-200 transition hover:bg-white hover:ring-slate-300",children:[K.jsx("img",{src:"https://cdn.simpleicons.org/facebook/1877F2",alt:"Facebook",className:"h-5 w-5"}),K.jsxs("div",{className:"leading-tight",children:[K.jsx("div",{className:"font-medium text-slate-900",children:"Read the local travel guide"}),K.jsx("div",{className:"text-[12px] text-slate-500",children:"Find the travel style that suits you best"})]})]})]})]})}const nk=[{name:"Join Trip Longtail Boat",type:"KRABI SEA TOUR",capacity:12,showCapacity:!1,price:500,rating:4.9,showRating:!1,description:"Join a group trip on a traditional longtail boat at an affordable price.",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/KRABISEATOUR.jpg",link:"https://krabi.joinjoytravel.com/en/trips/30",tags:["Budget","Solo","Local","Local Style","Guide","Fixed Time","Backpackers"],buttonLabel:"Book Now"},{name:"Private Longtail Boat",type:"One Piece Tour",capacity:12,showCapacity:!1,price:3e3,rating:4.9,showRating:!1,description:`Private longtail boat, affordable 
 and relaxing.`,image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/1765650127108.jpg",link:"https://wa.me/66624290062",tags:["Groups 15","Friends Trip","Local Style","Flexible Time","DIY Itinerary"],buttonLabel:"Check Available"},{name:"Private Luxury Longtail Boat",type:"The Queen Travel Krabi",capacity:12,showCapacity:!1,price:7e3,rating:4.9,showRating:!1,description:`Private longtail boat with premium comfort, beautiful views 
 and great photo spots.`,image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/S__71000089_0.jpg",link:"https://wa.me/66624290062",tags:["Groups 16","Guide","Sunset Ready","Couples","Photo Lovers","Premium Food","Local Style","GoPro Camera"],buttonLabel:"Check Available"},{name:"Join Trip Speed Boat",type:"Nang An Travel & Tour ",capacity:12,showCapacity:!1,price:700,rating:4.9,showRating:!1,description:"Join a speed boat tour to visit Krabis top spots quickly and easily.",image:"https://krabi.joinjoytravel.com/storage/527/01KCGPKB9PPSRCSJTA4F4TM9XC.jpg",link:"https://krabi.joinjoytravel.com/en/trips/34",tags:["Time-Saver Travellers","Friends Group","Solo","Fast Travel","Smooth Ride"],buttonLabel:"Book Now"},{name:"Private Trip Speed Boat",type:"Wonderful Tour Krabi",capacity:12,showCapacity:!1,price:9e3,rating:4.9,showRating:!1,description:"High-end private speed boat with comfort, privacy, and stunning photo spots.",image:"https://raw.githubusercontent.com/BorbbangZar/joinjoytravel-assets/refs/heads/main/1765649975005.jpg",link:"https://wa.me/66624290062",tags:["Groups 15","Fast & Private","Flexible Route","Smooth & Comfortable","VIP Experience"],buttonLabel:"Check Available"}],sk=[{name:"Honda Scoopy  110cc",price:300,note:"Comfortable & powerful"},{name:"YAMAHA FAZZIO Hybrid 125c",price:300,note:"Premium, long ride"},{name:"Honda Click 125cc",price:350,note:"Easy ride, city use"},{name:"YAMAHA NMAX 155cc",price:500,note:"Comfortable & powerful"}],ak=[{name:"Private SUV (City)",price:400,note:"Krabi town / Ao Nang area"},{name:"Airport transfer",price:600,note:"Hotel  Krabi Airport"},{name:"Full-day private SUV",price:2500,note:"8 hours with driver"}];function ok({onOpenTransport:i}){return K.jsxs("section",{className:"relative overflow-visible lg:overflow-hidden bg-white pt-4 pb-2 sm:pt-6 sm:pb-4 lg:pt-8 lg:pb-6 min-h-[60vh] lg:min-h-[70vh]",children:[K.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_10%_20%,rgba(24,119,242,0.1),transparent_32%),radial-gradient(circle_at_80%_0%,rgba(66,183,42,0.12),transparent_36%)]","aria-hidden":!0}),K.jsxs("div",{className:"section-shell relative grid gap-0 lg:grid-cols-2 lg:items-center h-full",children:[K.jsxs("div",{className:"space-y-5",children:[K.jsx("span",{className:"inline-flex items-center rounded-full bg-[#e8f2ff] px-4 py-2 text-sm font-semibold text-[#1877F2] ring-1 ring-[#1877F2]/20",children:"JoinJoy Travel  Krabi Local Buddy"}),K.jsx("h1",{className:"text-4xl font-black leading-tight text-slate-900 sm:text-5xl lg:text-6xl",children:"Where to go today told by a real local"}),K.jsx("p",{className:"text-lg text-slate-700 sm:max-w-xl",children:"Get real-time tips, honest recommendations, and curated spots for the best day in Krabi."}),K.jsxs("div",{className:"flex w-full justify-center sm:justify-start gap-6",children:[K.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-1",children:[K.jsxs("button",{onClick:()=>{const a=document.getElementById("Seeallboats");if(a){const h=a.getBoundingClientRect();window.scrollTo({top:window.scrollY+h.top-10,behavior:"smooth"})}},className:"inline-flex items-center justify-center gap-2 min-h-[56px] rounded-xl bg-[#1877F2] px-4 py-2 text-sm font-semibold text-white shadow-md shadow-[#1877F2]/30 transition hover:scale-[1.01]",children:[K.jsxs("span",{className:"leading-tight text-center",children:[K.jsx("span",{className:"block",children:"Explore by"}),K.jsx("span",{className:"block",children:"Boat"})]}),K.jsx("span",{"aria-hidden":"true",className:"text-base",children:""})]}),K.jsxs("p",{className:"text-xs text-slate-500 leading-snug text-center sm:text-left",children:["Island routes curated",K.jsx("br",{}),K.jsx("span",{className:"opacity-80",children:"by real locals"})]})]}),K.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-1",children:[K.jsxs("button",{onClick:i,className:"inline-flex items-center justify-center gap-2 min-h-[56px] rounded-xl bg-white px-4 py-2 text-sm font-semibold text-[#1877F2] shadow-md shadow-[#1877F2]/30 transition hover:bg-[#f0f6ff]",children:[K.jsxs("span",{className:"leading-tight text-center",children:[K.jsx("span",{className:"block",children:"Get Around"}),K.jsx("span",{className:"block",children:"Krabi"})]}),K.jsx("span",{"aria-hidden":!0,className:"text-base",children:""})]}),K.jsxs("p",{className:"text-xs text-slate-500 leading-snug text-center sm:text-left",children:["Scooters, private SUV",K.jsx("br",{}),K.jsx("span",{className:"opacity-80",children:"& airport transfers"})]})]})]}),K.jsx("div",{className:"grid max-w-lg grid-cols-2 gap-4 sm:gap-6"})]}),K.jsx("div",{id:"highlights",className:"relative h-full lg:min-h-[420px] flex items-stretch",style:{width:"100%"},children:K.jsx(HS,{})})]})]})}function lk(){return K.jsx("section",{id:"boats",className:"pt-2 pb-6 sm:pt-8 sm:pb-16",children:K.jsxs("div",{id:"Seeallboats",className:"section-shell space-y-12",children:[K.jsxs("div",{className:"space-y-3 text-center",children:[K.jsx("span",{className:"inline-flex items-center rounded-full bg-white px-4 py-2 text-sm font-semibold text-[#1877F2] ring-1 ring-[#1877F2]/20 shadow-sm",children:"A signature fleet of Longtail Boats"}),K.jsxs("h3",{className:"text-2xl font-extrabold text-slate-900 sm:text-3xl",children:["Choose your boat styles ",K.jsx("br",{}),"And head out to 4 Islands Trip"]}),K.jsxs("p",{className:"text-lg leading-snug text-slate-700 sm:mx-auto sm:max-w-2xl mb-1",children:["Each boat is inspected, professionally crewed, transparently priced",K.jsx("br",{}),"And can flex to your trip style."]})]}),K.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:nk.map(i=>K.jsx(AS,{boat:i},i.name))})]})})}function uk(){const[i,a]=ir.useState(!1),[h,y]=ir.useState("main"),b=()=>{a(!1),y("main")};return K.jsxs("main",{children:[K.jsx(ok,{onOpenTransport:()=>{y("main"),a(!0)}}),K.jsx("section",{className:"bg-[#f7f9fb] py-6 sm:py-10",children:K.jsx("div",{className:"section-shell max-w-3xl mx-auto",children:K.jsx(ik,{})})}),K.jsx(lk,{}),K.jsx(MS,{}),i&&K.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 flex items-end sm:items-center justify-center",children:K.jsxs("div",{className:"w-full sm:max-w-md bg-white rounded-t-2xl sm:rounded-2xl p-6 space-y-4 animate-slideUp",children:[K.jsxs("div",{className:"flex items-center justify-between",children:[K.jsxs("h3",{className:"text-lg font-bold text-slate-900",children:[h==="main"&&"Get Around Krabi",h==="scooter"&&"Scooter rental",h==="van"&&"Private van"]}),K.jsx("button",{onClick:b,className:"text-slate-400 hover:text-slate-600 text-xl",children:""})]}),h==="main"&&K.jsxs(K.Fragment,{children:[K.jsx("button",{onClick:()=>y("scooter"),className:"w-full rounded-xl border border-slate-200 p-4 text-left hover:border-[#1877F2] hover:bg-[#f5faff] transition",children:K.jsxs("div",{className:"flex items-start gap-3",children:[K.jsx("span",{className:"text-xl",children:""}),K.jsxs("div",{children:[K.jsx("p",{className:"font-semibold text-slate-900",children:"Scooter rental"}),K.jsx("p",{className:"text-sm text-slate-500",children:"Daily & weekly rentals, local price"})]})]})}),K.jsx("button",{onClick:()=>y("van"),className:"w-full rounded-xl border border-slate-200 p-4 text-left hover:border-[#1877F2] hover:bg-[#f5faff] transition",children:K.jsxs("div",{className:"flex items-start gap-3",children:[K.jsx("span",{className:"text-xl",children:""}),K.jsxs("div",{children:[K.jsx("p",{className:"font-semibold text-slate-900",children:"Private SUV"}),K.jsx("p",{className:"text-sm text-slate-500",children:"Airport & day trips, friendly drivers"})]})]})})]}),h==="scooter"&&K.jsxs("div",{className:"space-y-4",children:[K.jsx("button",{onClick:()=>y("main"),className:"text-[#1877F2] text-sm",children:" Back"}),K.jsx("div",{className:"space-y-3",children:sk.map(I=>K.jsxs("div",{className:"rounded-xl border border-slate-200 p-4 flex items-center justify-between",children:[K.jsxs("div",{children:[K.jsx("p",{className:"font-semibold text-slate-900",children:I.name}),K.jsx("p",{className:"text-sm text-slate-500",children:I.note})]}),K.jsxs("div",{className:"text-right",children:[K.jsxs("p",{className:"text-lg font-bold text-[#1877F2]",children:["",I.price]}),K.jsx("p",{className:"text-xs text-slate-400",children:"/ day"})]})]},I.name))}),K.jsx("a",{href:"https://wa.me/66624290062?text=Hi%20JoinJoy,%20I%20want%20to%20rent%20a%20scooter",target:"_blank",className:"block w-full text-center rounded-xl bg-[#1877F2] text-white py-3 font-semibold shadow-md shadow-[#1877F2]/30",children:"Contact via WhatsApp"}),K.jsx("p",{className:"text-center text-xs text-slate-400",children:"Helmet included  Local partner  Fair price"})]}),h==="van"&&K.jsxs("div",{className:"space-y-4",children:[K.jsx("button",{onClick:()=>y("main"),className:"text-[#1877F2] text-sm",children:" Back"}),K.jsx("div",{className:"space-y-3",children:ak.map(I=>K.jsxs("div",{className:"rounded-xl border border-slate-200 p-4 flex items-center justify-between",children:[K.jsxs("div",{children:[K.jsx("p",{className:"font-semibold text-slate-900",children:I.name}),K.jsx("p",{className:"text-sm text-slate-500",children:I.note})]}),K.jsxs("div",{className:"text-right",children:[K.jsxs("p",{className:"text-lg font-bold text-[#1877F2]",children:["",I.price]}),K.jsx("p",{className:"text-xs text-slate-400",children:"per trip"})]})]},I.name))}),K.jsx("a",{href:"https://wa.me/66624290062?text=Hi%20JoinJoy,%20I%20want%20to%20book%20a%20private%20van",target:"_blank",className:"block w-full text-center rounded-xl bg-[#1877F2] text-white py-3 font-semibold shadow-md shadow-[#1877F2]/30",children:"Book via WhatsApp"}),K.jsx("p",{className:"text-center text-xs text-slate-400",children:"Professional driver  Fuel included  Local service"})]})]})})]})}function ck(){return K.jsxs("div",{className:"min-h-screen text-slate-900",children:[K.jsx(ES,{}),K.jsx(uk,{})]})}um.createRoot(document.getElementById("root")).render(K.jsx(Ta.StrictMode,{children:K.jsx(ck,{})}));
